# Apache Integration

This integration periodically fetches metrics from [https://httpd.apache.org/](Apache) servers. It can parse access and error
logs created by the Apache server.

## Compatibility

The Apache datasets were tested with Apache 2.4.12 and 2.4.20 and are expected to work with
all versions >= 2.2.31 and >= 2.4.16.

## Logs

### Access Logs

Access logs collects the Apache access logs.

{{fields "access"}}

### Error Logs

Error logs collects the Apache error logs.

{{fields "error"}}

## Metrics

### Status Metrics

The server status stream collects data from the Apache Status module. It scrapes the status data from the web page
generated by the `mod_status` module.

An example event for status looks as following:

```$json
{
  "@timestamp": "2020-06-24T10:19:48.005Z",
  "@metadata": {
    "beat": "metricbeat",
    "type": "_doc",
    "version": "8.0.0",
    "raw_index": "metrics-apache.status-default"
  },
  "metricset": {
    "name": "status",
    "period": 10000
  },
  "apache": {
    "status": {
      "connections": {
        "total": 0,
        "async": {
          "writing": 0,
          "keep_alive": 0,
          "closing": 0
        }
      },
      "total_kbytes": 128,
      "cpu": {
        "children_user": 0,
        "children_system": 0,
        "load": 0.185185,
        "user": 1.11,
        "system": 1.79
      },
      "scoreboard": {
        "logging": 0,
        "idle_cleanup": 0,
        "starting_up": 0,
        "reading_request": 0,
        "dns_lookup": 0,
        "closing_connection": 0,
        "gracefully_finishing": 0,
        "sending_reply": 1,
        "keepalive": 0,
        "total": 400,
        "open_slot": 325,
        "waiting_for_connection": 74
      },
      "workers": {
        "busy": 1,
        "idle": 74
      },
      "bytes_per_sec": 83.6986,
      "hostname": "127.0.0.1:8088",
      "uptime": {
        "server_uptime": 1566,
        "uptime": 1566
      },
      "total_accesses": 1393,
      "bytes_per_request": 94.0933,
      "requests_per_sec": 0.889527,
      "load": {
        "1": 3.58,
        "5": 3.54,
        "15": 2.79
      }
    }
  },
  "service": {
    "address": "127.0.0.1:8088",
    "type": "apache"
  },
  "event": {
    "duration": 2381832,
    "dataset": "apache.status",
    "module": "apache"
  },
  "dataset": {
    "type": "metrics",
    "name": "apache.status",
    "namespace": "default"
  },
  "stream": {
    "dataset": "apache.status",
    "namespace": "default",
    "type": "metrics"
  },
  "ecs": {
    "version": "1.5.0"
  },
  "agent": {
    "type": "metricbeat",
    "version": "8.0.0",
    "ephemeral_id": "685f03e4-76e7-4d05-b398-8454b8964681",
    "id": "a74466da-3ea4-44f9-aea0-11c5e4b920be",
    "name": "MacBook-Elastic.local"
  }
}
```

{{fields "status"}}
