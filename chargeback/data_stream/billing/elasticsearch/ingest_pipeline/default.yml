---
description: "Set composite_key from @timestamp and deployment_id, and pull cel value from ecu_value."
processors:
  - set:
      field: ecu_rate
      value: "{{{_conf.ecu_rate}}}"
      tag: ecu_value
  - script:
      lang: painless
      source: >
        if (ctx['@timestamp'] != null) {
            ctx.composite_key = ZonedDateTime.parse(ctx['@timestamp']).toLocalDate().toString() + '_' + ctx.deployment_id;
        }
      ignore_failure: true
      tag: ess_billing
  # - remove:
  #     field:
  #       - _conf