{
    "attributes": {
        "controlGroupInput": {
            "chainingSystem": "HIERARCHICAL",
            "controlStyle": "oneLine",
            "ignoreParentSettingsJSON": {
                "ignoreFilters": false,
                "ignoreQuery": false,
                "ignoreTimerange": false,
                "ignoreValidations": false
            },
            "panelsJSON": {
                "ab7831d2-e2cb-4ece-a4a6-b22c17f30aec": {
                    "explicitInput": {
                        "dataViewId": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                        "exclude": false,
                        "existsSelected": false,
                        "fieldName": "deployment_id",
                        "id": "ab7831d2-e2cb-4ece-a4a6-b22c17f30aec",
                        "searchTechnique": "prefix",
                        "selectedOptions": [],
                        "sort": {
                            "by": "_count",
                            "direction": "desc"
                        },
                        "title": "Deployment ID"
                    },
                    "grow": false,
                    "order": 0,
                    "type": "optionsListControl",
                    "width": "large"
                }
            },
            "showApplySelections": false
        },
        "description": "Provides visual insights into cluster-level cost and usage metrics, helping track Elastic consumption across tiers, deployments, and data streams. Built from transformed billing and usage data, this dashboard enables transparent chargeback calculations and trend analysis.",
        "kibanaSavedObjectMeta": {
            "searchSourceJSON": {
                "filter": [],
                "query": {
                    "language": "kuery",
                    "query": ""
                }
            }
        },
        "optionsJSON": {
            "hidePanelTitles": false,
            "syncColors": false,
            "syncCursor": true,
            "syncTooltips": false,
            "useMargins": true
        },
        "panelsJSON": [
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "c2dbde04-0769-4485-b4fa-4cb05a1d975e": {
                                            "columns": [
                                                {
                                                    "columnId": "@timestamp",
                                                    "customLabel": true,
                                                    "fieldName": "@timestamp",
                                                    "label": "Date",
                                                    "meta": {
                                                        "esType": "date",
                                                        "type": "date"
                                                    }
                                                },
                                                {
                                                    "columnId": "deployment_name.keyword",
                                                    "customLabel": true,
                                                    "fieldName": "deployment_name.keyword",
                                                    "label": "Deployment name",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                },
                                                {
                                                    "columnId": "total_ecu",
                                                    "customLabel": true,
                                                    "fieldName": "total_ecu",
                                                    "inMetricDimension": true,
                                                    "label": "ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| EVAL total_ecu_value = total_ecu * conf_ecu_rate\n| KEEP @timestamp, deployment_name.keyword, total_ecu, total_ecu_value"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| EVAL total_ecu_value = total_ecu * conf_ecu_rate\n| KEEP @timestamp, deployment_name.keyword, total_ecu, total_ecu_value"
                            },
                            "visualization": {
                                "axisTitlesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "fittingFunction": "Linear",
                                "gridlinesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "labelsOrientation": {
                                    "x": 0,
                                    "yLeft": 0,
                                    "yRight": 0
                                },
                                "layers": [
                                    {
                                        "accessors": [
                                            "total_ecu"
                                        ],
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "c2dbde04-0769-4485-b4fa-4cb05a1d975e",
                                        "layerType": "data",
                                        "seriesType": "bar_stacked",
                                        "splitAccessor": "deployment_name.keyword",
                                        "xAccessor": "@timestamp"
                                    }
                                ],
                                "legend": {
                                    "isVisible": true,
                                    "position": "right"
                                },
                                "preferredSeriesType": "bar_stacked",
                                "tickLabelsVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "valueLabels": "hide"
                            }
                        },
                        "title": "total_ecu \u0026 total_ecu_value over @timestamp",
                        "visualizationType": "lnsXY"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| EVAL total_ecu_value = total_ecu * conf_ecu_rate\n| KEEP @timestamp, deployment_name.keyword, total_ecu, total_ecu_value"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false,
                    "timeRange": {
                        "from": "now-6M",
                        "to": "now"
                    }
                },
                "gridData": {
                    "h": 8,
                    "i": "d9069c7e-bfaf-4045-aedf-ca1042c21010",
                    "w": 48,
                    "x": 0,
                    "y": 0
                },
                "panelIndex": "d9069c7e-bfaf-4045-aedf-ca1042c21010",
                "title": "ECU spend over the last 6 months",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "savedVis": {
                        "data": {
                            "aggs": [],
                            "searchSource": {
                                "filter": [],
                                "query": {
                                    "language": "kuery",
                                    "query": ""
                                }
                            }
                        },
                        "description": "",
                        "id": "",
                        "params": {
                            "fontSize": 12,
                            "markdown": "# ECU deployment statistics",
                            "openLinksInNewTab": false
                        },
                        "title": "",
                        "type": "markdown",
                        "uiState": {}
                    }
                },
                "gridData": {
                    "h": 3,
                    "i": "08bdbcda-fa42-4fb2-bb50-b4ed2620ef6b",
                    "w": 48,
                    "x": 0,
                    "y": 8
                },
                "panelIndex": "08bdbcda-fa42-4fb2-bb50-b4ed2620ef6b",
                "type": "visualization"
            },
            {
                "embeddableConfig": {
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "savedVis": {
                        "data": {
                            "aggs": [],
                            "searchSource": {
                                "filter": [],
                                "query": {
                                    "language": "kuery",
                                    "query": ""
                                }
                            }
                        },
                        "description": "",
                        "params": {
                            "fontSize": 12,
                            "markdown": "# ECU data tier and data stream overview",
                            "openLinksInNewTab": false
                        },
                        "title": "",
                        "type": "markdown",
                        "uiState": {}
                    }
                },
                "gridData": {
                    "h": 3,
                    "i": "784ed861-b61f-4c71-a3bc-02cb513a8019",
                    "w": 48,
                    "x": 0,
                    "y": 26
                },
                "panelIndex": "784ed861-b61f-4c71-a3bc-02cb513a8019",
                "title": "",
                "type": "visualization"
            },
            {
                "embeddableConfig": {
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "savedVis": {
                        "data": {
                            "aggs": [],
                            "searchSource": {
                                "filter": [],
                                "query": {
                                    "language": "kuery",
                                    "query": ""
                                }
                            }
                        },
                        "description": "",
                        "params": {
                            "fontSize": 12,
                            "markdown": "## Indexing",
                            "openLinksInNewTab": false
                        },
                        "title": "",
                        "type": "markdown",
                        "uiState": {}
                    }
                },
                "gridData": {
                    "h": 3,
                    "i": "4d8d5ff0-b63f-4d39-be03-e6f85a8b60ce",
                    "w": 12,
                    "x": 0,
                    "y": 39
                },
                "panelIndex": "4d8d5ff0-b63f-4d39-be03-e6f85a8b60ce",
                "title": "",
                "type": "visualization"
            },
            {
                "embeddableConfig": {
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "savedVis": {
                        "data": {
                            "aggs": [],
                            "searchSource": {
                                "filter": [],
                                "query": {
                                    "language": "kuery",
                                    "query": ""
                                }
                            }
                        },
                        "description": "",
                        "params": {
                            "fontSize": 12,
                            "markdown": "## Querying",
                            "openLinksInNewTab": false
                        },
                        "title": "",
                        "type": "markdown",
                        "uiState": {}
                    }
                },
                "gridData": {
                    "h": 3,
                    "i": "40a91be7-f01d-47ce-ba7f-683bcee42626",
                    "w": 12,
                    "x": 12,
                    "y": 39
                },
                "panelIndex": "40a91be7-f01d-47ce-ba7f-683bcee42626",
                "title": "",
                "type": "visualization"
            },
            {
                "embeddableConfig": {
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "savedVis": {
                        "data": {
                            "aggs": [],
                            "searchSource": {
                                "filter": [],
                                "query": {
                                    "language": "kuery",
                                    "query": ""
                                }
                            }
                        },
                        "description": "",
                        "params": {
                            "fontSize": 12,
                            "markdown": "## Storage",
                            "openLinksInNewTab": false
                        },
                        "title": "",
                        "type": "markdown",
                        "uiState": {}
                    }
                },
                "gridData": {
                    "h": 3,
                    "i": "d0c647b4-4b26-49d3-b54a-1ddbdf995143",
                    "w": 12,
                    "x": 24,
                    "y": 39
                },
                "panelIndex": "d0c647b4-4b26-49d3-b54a-1ddbdf995143",
                "title": "",
                "type": "visualization"
            },
            {
                "embeddableConfig": {
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "savedVis": {
                        "data": {
                            "aggs": [],
                            "searchSource": {
                                "filter": [],
                                "query": {
                                    "language": "kuery",
                                    "query": ""
                                }
                            }
                        },
                        "description": "",
                        "params": {
                            "fontSize": 12,
                            "markdown": "## Blended",
                            "openLinksInNewTab": false
                        },
                        "title": "",
                        "type": "markdown",
                        "uiState": {}
                    }
                },
                "gridData": {
                    "h": 3,
                    "i": "540d6135-d996-43ed-a192-30d51e2e5454",
                    "w": 12,
                    "x": 36,
                    "y": 39
                },
                "panelIndex": "540d6135-d996-43ed-a192-30d51e2e5454",
                "title": "",
                "type": "visualization"
            },
            {
                "embeddableConfig": {
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "savedVis": {
                        "data": {
                            "aggs": [],
                            "searchSource": {
                                "filter": [],
                                "query": {
                                    "language": "kuery",
                                    "query": ""
                                }
                            }
                        },
                        "description": "",
                        "params": {
                            "fontSize": 12,
                            "markdown": "# ECU data tier and data stream per day",
                            "openLinksInNewTab": false
                        },
                        "title": "",
                        "type": "markdown",
                        "uiState": {}
                    }
                },
                "gridData": {
                    "h": 3,
                    "i": "b1e12ff9-83d2-4dd7-a16e-ec4597d14dbc",
                    "w": 48,
                    "x": 0,
                    "y": 72
                },
                "panelIndex": "b1e12ff9-83d2-4dd7-a16e-ec4597d14dbc",
                "title": "",
                "type": "visualization"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "1a2f8269-f56f-4c02-8506-76b723acc828": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_querying",
                                                    "customLabel": true,
                                                    "fieldName": "agg_querying",
                                                    "inMetricDimension": true,
                                                    "label": "ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "@timestamp",
                                                    "customLabel": true,
                                                    "fieldName": "@timestamp",
                                                    "label": "Date",
                                                    "meta": {
                                                        "esType": "date",
                                                        "type": "date"
                                                    }
                                                },
                                                {
                                                    "columnId": "datastream.keyword",
                                                    "customLabel": true,
                                                    "fieldName": "datastream.keyword",
                                                    "label": "Data stream",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n    agg_querying = sum(querying)\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n    @timestamp, \n    //deployment_name.keyword, deployment_id ,   \n    datastream.keyword\n//    tier \n| WHERE agg_querying \u003e 0 //and tier == \"hot/content\"\n| SORT agg_querying DESC"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n    agg_querying = sum(querying)\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n    @timestamp, \n    //deployment_name.keyword, deployment_id ,   \n    datastream.keyword\n//    tier \n| WHERE agg_querying \u003e 0 //and tier == \"hot/content\"\n| SORT agg_querying DESC"
                            },
                            "visualization": {
                                "axisTitlesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "fittingFunction": "Linear",
                                "gridlinesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "labelsOrientation": {
                                    "x": 0,
                                    "yLeft": 0,
                                    "yRight": 0
                                },
                                "layers": [
                                    {
                                        "accessors": [
                                            "agg_querying"
                                        ],
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "1a2f8269-f56f-4c02-8506-76b723acc828",
                                        "layerType": "data",
                                        "seriesType": "bar_stacked",
                                        "splitAccessor": "datastream.keyword",
                                        "xAccessor": "@timestamp"
                                    }
                                ],
                                "legend": {
                                    "isVisible": false,
                                    "position": "right",
                                    "showSingleSeries": false
                                },
                                "preferredSeriesType": "bar_stacked",
                                "tickLabelsVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "valueLabels": "hide"
                            }
                        },
                        "title": "agg_querying over @timestamp",
                        "visualizationType": "lnsXY"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n    agg_querying = sum(querying)\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n    @timestamp, \n    //deployment_name.keyword, deployment_id ,   \n    datastream.keyword\n//    tier \n| WHERE agg_querying \u003e 0 //and tier == \"hot/content\"\n| SORT agg_querying DESC"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 14,
                    "i": "83bbd574-571b-4401-af7f-d0998cd9af2e",
                    "w": 16,
                    "x": 0,
                    "y": 95
                },
                "panelIndex": "83bbd574-571b-4401-af7f-d0998cd9af2e",
                "title": "Querying: ECU per data stream per day",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "d24af063-ec41-4736-bf4e-70f1fe4da4cf": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_indexing",
                                                    "customLabel": true,
                                                    "fieldName": "agg_indexing",
                                                    "inMetricDimension": true,
                                                    "label": "ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "@timestamp",
                                                    "customLabel": true,
                                                    "fieldName": "@timestamp",
                                                    "label": "Date",
                                                    "meta": {
                                                        "esType": "date",
                                                        "type": "date"
                                                    }
                                                },
                                                {
                                                    "columnId": "tier",
                                                    "customLabel": true,
                                                    "fieldName": "tier",
                                                    "label": "Data tier",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time \u003e 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, tier_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying),\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n      @timestamp ,\n      //deployment_name.keyword, deployment_id , \n      tier \n| WHERE agg_indexing \u003e 0"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time \u003e 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, tier_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying),\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n      @timestamp ,\n      //deployment_name.keyword, deployment_id , \n      tier \n| WHERE agg_indexing \u003e 0"
                            },
                            "visualization": {
                                "axisTitlesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "fittingFunction": "Linear",
                                "gridlinesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "labelsOrientation": {
                                    "x": 0,
                                    "yLeft": 0,
                                    "yRight": 0
                                },
                                "layers": [
                                    {
                                        "accessors": [
                                            "agg_indexing"
                                        ],
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "d24af063-ec41-4736-bf4e-70f1fe4da4cf",
                                        "layerType": "data",
                                        "seriesType": "bar_stacked",
                                        "splitAccessor": "tier",
                                        "xAccessor": "@timestamp"
                                    }
                                ],
                                "legend": {
                                    "isVisible": false,
                                    "position": "right",
                                    "showSingleSeries": false
                                },
                                "preferredSeriesType": "bar_stacked",
                                "tickLabelsVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "valueLabels": "hide"
                            }
                        },
                        "title": "agg_indexing over @timestamp",
                        "visualizationType": "lnsXY"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time \u003e 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, tier_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying),\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n      @timestamp ,\n      //deployment_name.keyword, deployment_id , \n      tier \n| WHERE agg_indexing \u003e 0"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 14,
                    "i": "45a29dd3-1990-4717-bf6b-25a5d85d2344",
                    "w": 16,
                    "x": 16,
                    "y": 78
                },
                "panelIndex": "45a29dd3-1990-4717-bf6b-25a5d85d2344",
                "title": "Indexing: ECU per tier per day",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "3db0d6b31d8afd75067c7a445bb4f066a52d9d451e8237e51956bd0d7e1ecb52": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "3db0d6b31d8afd75067c7a445bb4f066a52d9d451e8237e51956bd0d7e1ecb52",
                                    "name": "monitoring-indices",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "monitoring-indices",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "3db0d6b31d8afd75067c7a445bb4f066a52d9d451e8237e51956bd0d7e1ecb52",
                                            "timeField": "@timestamp",
                                            "title": "monitoring-indices"
                                        }
                                    ],
                                    "layers": {
                                        "d5520b0e-567f-4f0a-b424-fc79eb79e2cc": {
                                            "columns": [
                                                {
                                                    "columnId": "@timestamp",
                                                    "customLabel": true,
                                                    "fieldName": "@timestamp",
                                                    "label": "Date",
                                                    "meta": {
                                                        "esType": "date",
                                                        "type": "date"
                                                    }
                                                },
                                                {
                                                    "columnId": "elasticsearch.index.datastream",
                                                    "customLabel": true,
                                                    "fieldName": "elasticsearch.index.datastream",
                                                    "label": "Data stream",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                },
                                                {
                                                    "columnId": "total_indexing_portion",
                                                    "customLabel": true,
                                                    "fieldName": "total_indexing_portion",
                                                    "inMetricDimension": true,
                                                    "label": "% ECU",
                                                    "meta": {
                                                        "esType": "long",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "percent",
                                                            "params": {
                                                                "decimals": 0
                                                            }
                                                        }
                                                    }
                                                }
                                            ],
                                            "index": "3db0d6b31d8afd75067c7a445bb4f066a52d9d451e8237e51956bd0d7e1ecb52",
                                            "query": {
                                                "esql": "FROM monitoring-indices\n| EVAL \n    @timestamp = DATE_TRUNC(1 day, @timestamp)\n| WHERE elasticsearch.index.total.indexing.index_time_in_millis \u003e 0\n| STATS \n //   sum_query_time_local = sum(elasticsearch.index.total.search.query_time_in_millis), \n    sum_indexing_time_local = sum(elasticsearch.index.total.indexing.index_time_in_millis)\n//    sum_data_set_store_size_local = sum(elasticsearch.index.primaries.store.total_data_set_size_in_bytes),\n//    sum_store_size_local = sum(elasticsearch.index.total.store.size_in_bytes)\n  BY \n    @timestamp,\n    elasticsearch.cluster.name,\n    elasticsearch.index.datastream\n| STATS \n    total_indexing_portion = sum(sum_indexing_time_local) \n  BY \n    @timestamp, \n    elasticsearch.index.datastream \n| KEEP \n    @timestamp,\n    elasticsearch.index.datastream,\n    total_indexing_portion\n| SORT total_indexing_portion DESC\n"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "FROM monitoring-indices\n| EVAL \n    @timestamp = DATE_TRUNC(1 day, @timestamp)\n| WHERE elasticsearch.index.total.indexing.index_time_in_millis \u003e 0\n| STATS \n //   sum_query_time_local = sum(elasticsearch.index.total.search.query_time_in_millis), \n    sum_indexing_time_local = sum(elasticsearch.index.total.indexing.index_time_in_millis)\n//    sum_data_set_store_size_local = sum(elasticsearch.index.primaries.store.total_data_set_size_in_bytes),\n//    sum_store_size_local = sum(elasticsearch.index.total.store.size_in_bytes)\n  BY \n    @timestamp,\n    elasticsearch.cluster.name,\n    elasticsearch.index.datastream\n| STATS \n    total_indexing_portion = sum(sum_indexing_time_local) \n  BY \n    @timestamp, \n    elasticsearch.index.datastream \n| KEEP \n    @timestamp,\n    elasticsearch.index.datastream,\n    total_indexing_portion\n| SORT total_indexing_portion DESC\n"
                            },
                            "visualization": {
                                "axisTitlesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "fittingFunction": "Linear",
                                "gridlinesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "labelsOrientation": {
                                    "x": 0,
                                    "yLeft": 0,
                                    "yRight": 0
                                },
                                "layers": [
                                    {
                                        "accessors": [
                                            "total_indexing_portion"
                                        ],
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "d5520b0e-567f-4f0a-b424-fc79eb79e2cc",
                                        "layerType": "data",
                                        "seriesType": "bar_percentage_stacked",
                                        "splitAccessor": "elasticsearch.index.datastream",
                                        "xAccessor": "@timestamp"
                                    }
                                ],
                                "legend": {
                                    "isVisible": false,
                                    "position": "right",
                                    "showSingleSeries": false
                                },
                                "preferredSeriesType": "bar_stacked",
                                "tickLabelsVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "valueLabels": "hide"
                            }
                        },
                        "title": "total_indexing_portion over @timestamp",
                        "visualizationType": "lnsXY"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "FROM monitoring-indices\n| EVAL \n    @timestamp = DATE_TRUNC(1 day, @timestamp)\n| WHERE elasticsearch.index.total.indexing.index_time_in_millis \u003e 0\n| STATS \n //   sum_query_time_local = sum(elasticsearch.index.total.search.query_time_in_millis), \n    sum_indexing_time_local = sum(elasticsearch.index.total.indexing.index_time_in_millis)\n//    sum_data_set_store_size_local = sum(elasticsearch.index.primaries.store.total_data_set_size_in_bytes),\n//    sum_store_size_local = sum(elasticsearch.index.total.store.size_in_bytes)\n  BY \n    @timestamp,\n    elasticsearch.cluster.name,\n    elasticsearch.index.datastream\n| STATS \n    total_indexing_portion = sum(sum_indexing_time_local) \n  BY \n    @timestamp, \n    elasticsearch.index.datastream \n| KEEP \n    @timestamp,\n    elasticsearch.index.datastream,\n    total_indexing_portion\n| SORT total_indexing_portion DESC\n"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 14,
                    "i": "9bc8fa5a-d47a-4a79-ab6a-032d726f085f",
                    "w": 16,
                    "x": 32,
                    "y": 78
                },
                "panelIndex": "9bc8fa5a-d47a-4a79-ab6a-032d726f085f",
                "title": "Indexing: % ECU per data stream per day",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "61842c44-afd9-429c-bf2e-18a4a079e5e8": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_querying",
                                                    "customLabel": true,
                                                    "fieldName": "agg_querying",
                                                    "inMetricDimension": true,
                                                    "label": "ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "@timestamp",
                                                    "customLabel": true,
                                                    "fieldName": "@timestamp",
                                                    "label": "Date",
                                                    "meta": {
                                                        "esType": "date",
                                                        "type": "date"
                                                    }
                                                },
                                                {
                                                    "columnId": "tier",
                                                    "customLabel": false,
                                                    "fieldName": "tier",
                                                    "label": "tier",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n    querying = CASE (deployment_sum_query_time \u003e 0, tier_sum_query_time / deployment_sum_query_time * total_ecu)\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, tier_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n    agg_querying = sum(querying)\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n      @timestamp ,\n      //deployment_name.keyword, deployment_id , \n      tier \n| WHERE agg_querying \u003e 0"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n    querying = CASE (deployment_sum_query_time \u003e 0, tier_sum_query_time / deployment_sum_query_time * total_ecu)\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, tier_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n    agg_querying = sum(querying)\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n      @timestamp ,\n      //deployment_name.keyword, deployment_id , \n      tier \n| WHERE agg_querying \u003e 0"
                            },
                            "visualization": {
                                "axisTitlesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "fittingFunction": "Linear",
                                "gridlinesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "labelsOrientation": {
                                    "x": 0,
                                    "yLeft": 0,
                                    "yRight": 0
                                },
                                "layers": [
                                    {
                                        "accessors": [
                                            "agg_querying"
                                        ],
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "61842c44-afd9-429c-bf2e-18a4a079e5e8",
                                        "layerType": "data",
                                        "seriesType": "bar_stacked",
                                        "splitAccessor": "tier",
                                        "xAccessor": "@timestamp"
                                    }
                                ],
                                "legend": {
                                    "isVisible": false,
                                    "position": "right",
                                    "showSingleSeries": false
                                },
                                "preferredSeriesType": "bar_stacked",
                                "tickLabelsVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "valueLabels": "hide"
                            }
                        },
                        "title": "agg_querying over @timestamp",
                        "visualizationType": "lnsXY"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n    querying = CASE (deployment_sum_query_time \u003e 0, tier_sum_query_time / deployment_sum_query_time * total_ecu)\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, tier_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n    agg_querying = sum(querying)\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n      @timestamp ,\n      //deployment_name.keyword, deployment_id , \n      tier \n| WHERE agg_querying \u003e 0"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 14,
                    "i": "b0df8c79-87d4-4a7a-8c7b-4752862fb2dd",
                    "w": 16,
                    "x": 16,
                    "y": 95
                },
                "panelIndex": "b0df8c79-87d4-4a7a-8c7b-4752862fb2dd",
                "title": "Querying: ECU per tier per day",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "ba345378-8ee0-40ec-9fb0-d26588d09107": {
                                            "columns": [
                                                {
                                                    "columnId": "c33c8ff5-8a22-4f4f-9b92-5e16485f5d9a",
                                                    "customLabel": true,
                                                    "fieldName": "deployment_name.keyword",
                                                    "label": "Deployment name",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "string"
                                                    }
                                                },
                                                {
                                                    "columnId": "b799493a-e75f-4ccc-844c-d5718215e9fb",
                                                    "customLabel": true,
                                                    "fieldName": "deployment_id",
                                                    "label": "Deployment ID",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "string"
                                                    }
                                                },
                                                {
                                                    "columnId": "2ab259ce-29c3-4c5c-817b-b7f036c62be8",
                                                    "customLabel": true,
                                                    "fieldName": "agg_blended",
                                                    "label": "ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "af3de6ff-d14d-4cea-bb56-4ee9012054b6",
                                                    "customLabel": true,
                                                    "fieldName": "tier",
                                                    "label": "Data tier",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu),\n    store = CASE (deployment_sum_store_size > 0, tier_sum_store_size / deployment_sum_store_size * total_ecu),\n    storage = CASE (store == 0, data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_blended = sum(blended)\n    BY deployment_name.keyword, deployment_id, tier\n| WHERE agg_blended > 0"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu),\n    store = CASE (deployment_sum_store_size > 0, tier_sum_store_size / deployment_sum_store_size * total_ecu),\n    storage = CASE (store == 0, data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_blended = sum(blended)\n    BY deployment_name.keyword, deployment_id, tier\n| WHERE agg_blended > 0"
                            },
                            "visualization": {
                                "columns": [
                                    {
                                        "columnId": "c33c8ff5-8a22-4f4f-9b92-5e16485f5d9a",
                                        "isMetric": false,
                                        "isTransposed": false
                                    },
                                    {
                                        "columnId": "b799493a-e75f-4ccc-844c-d5718215e9fb",
                                        "isMetric": false,
                                        "isTransposed": false
                                    },
                                    {
                                        "columnId": "2ab259ce-29c3-4c5c-817b-b7f036c62be8",
                                        "isMetric": true,
                                        "isTransposed": false
                                    },
                                    {
                                        "columnId": "af3de6ff-d14d-4cea-bb56-4ee9012054b6",
                                        "isMetric": false,
                                        "isTransposed": true
                                    }
                                ],
                                "layerId": "ba345378-8ee0-40ec-9fb0-d26588d09107",
                                "layerType": "data"
                            }
                        },
                        "title": "Table ",
                        "visualizationType": "lnsDatatable"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu),\n    store = CASE (deployment_sum_store_size > 0, tier_sum_store_size / deployment_sum_store_size * total_ecu),\n    storage = CASE (store == 0, data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_blended = sum(blended)\n    BY deployment_name.keyword, deployment_id, tier\n| WHERE agg_blended > 0"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 15,
                    "i": "8049f13b-c56d-4a6e-a4e3-5cf4274fef60",
                    "w": 24,
                    "x": 0,
                    "y": 11
                },
                "panelIndex": "8049f13b-c56d-4a6e-a4e3-5cf4274fef60",
                "title": "ECU per deployment and tier",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "91b4be84-6eb5-4b77-ad13-b85d992f3bbf": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_blended",
                                                    "customLabel": true,
                                                    "fieldName": "agg_blended",
                                                    "inMetricDimension": true,
                                                    "label": "ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "deployment_id",
                                                    "customLabel": true,
                                                    "fieldName": "deployment_id",
                                                    "label": "Deployment ID",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                },
                                                {
                                                    "columnId": "ac7df1b7-c160-46d1-96b0-f3f44810dfd0",
                                                    "customLabel": true,
                                                    "fieldName": "tier",
                                                    "label": "Data tier",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time > 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu),\n    store = CASE (deployment_sum_store_size > 0, tier_sum_store_size / deployment_sum_store_size * total_ecu),\n    storage = CASE (store == 0, data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS  \n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n    agg_blended = sum(blended)\n    BY \n      @timestamp,\n      tier ,\n      deployment_id\n| WHERE agg_indexing > 0"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time > 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu),\n    store = CASE (deployment_sum_store_size > 0, tier_sum_store_size / deployment_sum_store_size * total_ecu),\n    storage = CASE (store == 0, data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS  \n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n    agg_blended = sum(blended)\n    BY \n      @timestamp,\n      tier,\n      deployment_id \n| WHERE agg_indexing > 0"
                            },
                            "visualization": {
                                "layers": [
                                    {
                                        "categoryDisplay": "default",
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "91b4be84-6eb5-4b77-ad13-b85d992f3bbf",
                                        "layerType": "data",
                                        "legendDisplay": "default",
                                        "metrics": [
                                            "agg_blended"
                                        ],
                                        "nestedLegend": false,
                                        "numberDisplay": "percent",
                                        "primaryGroups": [
                                            "deployment_id",
                                            "ac7df1b7-c160-46d1-96b0-f3f44810dfd0"
                                        ]
                                    }
                                ],
                                "shape": "treemap"
                            }
                        },
                        "title": "Pie",
                        "visualizationType": "lnsPie"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time > 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu),\n    store = CASE (deployment_sum_store_size > 0, tier_sum_store_size / deployment_sum_store_size * total_ecu),\n    storage = CASE (store == 0, data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS  \n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n    agg_blended = sum(blended)\n    BY \n      @timestamp,\n      tier,\n      delpoyment_id \n| WHERE agg_indexing > 0"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 15,
                    "i": "c7febc32-943a-4284-888c-d9cff24e95b9",
                    "w": 24,
                    "x": 24,
                    "y": 11
                },
                "panelIndex": "c7febc32-943a-4284-888c-d9cff24e95b9",
                "title": "ECU per deployment and tier",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "a21abe71-d247-47eb-8c2f-81f2cf30b387": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_indexing",
                                                    "customLabel": false,
                                                    "fieldName": "agg_blended",
                                                    "inMetricDimension": true,
                                                    "label": "agg_indexing",
                                                    "meta": {
                                                        "esType": "double",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "datastream.keyword",
                                                    "customLabel": true,
                                                    "fieldName": "datastream.keyword",
                                                    "inMetricDimension": true,
                                                    "label": "Data stream",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql":"// ECU detail by tier\nFROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size > 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n      agg_blended = sum(blended)\n    BY\n//      @timestamp,\n      datastream.keyword,\n      //deployment_name.keyword, deployment_id ,\n      tier\n| WHERE agg_blended > 0 and tier == \"hot/content\"\n| SORT agg_blended DESC"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size > 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n      agg_blended = sum(blended)\n    BY\n//      @timestamp,\n      datastream.keyword,\n      //deployment_name.keyword, deployment_id ,\n      tier\n| WHERE agg_blended > 0 and tier == \"hot/content\"\n| SORT agg_blended DESC"
                            },
                            "visualization": {
                                "layers": [
                                    {
                                        "categoryDisplay": "default",
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "emptySizeRatio": 0.3,
                                        "layerId": "a21abe71-d247-47eb-8c2f-81f2cf30b387",
                                        "layerType": "data",
                                        "legendDisplay": "default",
                                        "metrics": [
                                            "agg_indexing"
                                        ],
                                        "nestedLegend": false,
                                        "numberDisplay": "percent",
                                        "primaryGroups": [
                                            "datastream.keyword"
                                        ]
                                    }
                                ],
                                "shape": "donut"
                            }
                        },
                        "title": "agg_indexing \u0026 agg_querying \u0026 agg_storage \u0026 agg_blended of datastream.keyword",
                        "visualizationType": "lnsPie"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size > 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n      agg_blended = sum(blended)\n    BY\n//      @timestamp,\n      datastream.keyword,\n      //deployment_name.keyword, deployment_id ,\n      tier\n| WHERE agg_blended > 0 and tier == \"hot/content\"\n| SORT agg_blended DESC"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 15,
                    "i": "cb467fdf-5cb1-41b5-8235-8b823cbd9310",
                    "w": 12,
                    "x": 36,
                    "y": 42
                },
                "panelIndex": "cb467fdf-5cb1-41b5-8235-8b823cbd9310",
                "title": "Blended: ECU totals by data stream",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "0f6d5278-b325-49bc-9eb7-2febd2a5de0f": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_indexing",
                                                    "customLabel": true,
                                                    "fieldName": "agg_indexing",
                                                    "inMetricDimension": true,
                                                    "label": "Indexing",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "datastream.keyword",
                                                    "customLabel": true,
                                                    "fieldName": "datastream.keyword",
                                                    "label": "Data stream",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying),\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n//      @timestamp,\n      datastream.keyword\n      //deployment_name.keyword, deployment_id , \n      //tier \n| WHERE agg_indexing \u003e 0 //and tier == \"hot/content\"\n| SORT agg_indexing DESC"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying),\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n//      @timestamp,\n      datastream.keyword\n      //deployment_name.keyword, deployment_id , \n      //tier \n| WHERE agg_indexing \u003e 0 //and tier == \"hot/content\"\n| SORT agg_indexing DESC"
                            },
                            "visualization": {
                                "layers": [
                                    {
                                        "categoryDisplay": "default",
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "emptySizeRatio": 0.3,
                                        "layerId": "0f6d5278-b325-49bc-9eb7-2febd2a5de0f",
                                        "layerType": "data",
                                        "legendDisplay": "default",
                                        "metrics": [
                                            "agg_indexing"
                                        ],
                                        "nestedLegend": false,
                                        "numberDisplay": "percent",
                                        "primaryGroups": [
                                            "datastream.keyword"
                                        ]
                                    }
                                ],
                                "shape": "donut"
                            }
                        },
                        "title": "Bar vertical stacked",
                        "visualizationType": "lnsPie"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying),\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n//      @timestamp,\n      datastream.keyword\n      //deployment_name.keyword, deployment_id , \n      //tier \n| WHERE agg_indexing \u003e 0 //and tier == \"hot/content\"\n| SORT agg_indexing DESC"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 15,
                    "i": "ed65354e-848c-4d93-bcd6-b9c50793e242",
                    "w": 12,
                    "x": 0,
                    "y": 42
                },
                "panelIndex": "ed65354e-848c-4d93-bcd6-b9c50793e242",
                "title": "Indexing: ECU totals by data stream",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "3b03b6a8-35ae-4554-8bd6-a887d8b36748": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_querying",
                                                    "customLabel": true,
                                                    "fieldName": "agg_querying",
                                                    "inMetricDimension": true,
                                                    "label": "Querying",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "datastream.keyword",
                                                    "customLabel": true,
                                                    "fieldName": "datastream.keyword",
                                                    "label": "Data stream",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n    agg_querying = sum(querying)\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n//      @timestamp,\n      datastream.keyword\n      //deployment_name.keyword, deployment_id , \n      //tier \n| WHERE agg_querying \u003e 0 //and tier == \"hot/content\"\n| SORT agg_querying DESC"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n    agg_querying = sum(querying)\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n//      @timestamp,\n      datastream.keyword\n      //deployment_name.keyword, deployment_id , \n      //tier \n| WHERE agg_querying \u003e 0 //and tier == \"hot/content\"\n| SORT agg_querying DESC"
                            },
                            "visualization": {
                                "layers": [
                                    {
                                        "categoryDisplay": "default",
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "emptySizeRatio": 0.3,
                                        "layerId": "3b03b6a8-35ae-4554-8bd6-a887d8b36748",
                                        "layerType": "data",
                                        "legendDisplay": "default",
                                        "metrics": [
                                            "agg_querying"
                                        ],
                                        "nestedLegend": false,
                                        "numberDisplay": "percent",
                                        "primaryGroups": [
                                            "datastream.keyword"
                                        ]
                                    }
                                ],
                                "shape": "donut"
                            }
                        },
                        "title": "Bar vertical stacked",
                        "visualizationType": "lnsPie"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n    agg_querying = sum(querying)\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n//      @timestamp,\n      datastream.keyword\n      //deployment_name.keyword, deployment_id , \n      //tier \n| WHERE agg_querying \u003e 0 //and tier == \"hot/content\"\n| SORT agg_querying DESC"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 15,
                    "i": "4a2ecf27-21c7-4fff-986b-05b25e0ce8f8",
                    "w": 12,
                    "x": 12,
                    "y": 42
                },
                "panelIndex": "4a2ecf27-21c7-4fff-986b-05b25e0ce8f8",
                "title": "Querying: ECU totals by data stream",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "2813628b-2a20-484c-9a19-11955d86e9ff": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_storage",
                                                    "customLabel": true,
                                                    "fieldName": "agg_storage",
                                                    "inMetricDimension": true,
                                                    "label": "Storage",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "datastream.keyword",
                                                    "customLabel": true,
                                                    "fieldName": "datastream.keyword",
                                                    "label": "Data stream",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store)\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying)\n    agg_storage = sum(storage)\n//    agg_blended = sum(blended)\n    BY \n//      @timestamp,\n      datastream.keyword\n      //deployment_name.keyword, deployment_id , \n      //tier \n| WHERE agg_storage \u003e 0 //and tier == \"hot/content\"\n| SORT agg_storage DESC"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store)\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying)\n    agg_storage = sum(storage)\n//    agg_blended = sum(blended)\n    BY \n//      @timestamp,\n      datastream.keyword\n      //deployment_name.keyword, deployment_id , \n      //tier \n| WHERE agg_storage \u003e 0 //and tier == \"hot/content\"\n| SORT agg_storage DESC"
                            },
                            "visualization": {
                                "layers": [
                                    {
                                        "categoryDisplay": "default",
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "emptySizeRatio": 0.3,
                                        "layerId": "2813628b-2a20-484c-9a19-11955d86e9ff",
                                        "layerType": "data",
                                        "legendDisplay": "default",
                                        "metrics": [
                                            "agg_storage"
                                        ],
                                        "nestedLegend": false,
                                        "numberDisplay": "percent",
                                        "primaryGroups": [
                                            "datastream.keyword"
                                        ]
                                    }
                                ],
                                "shape": "donut"
                            }
                        },
                        "title": "Bar vertical stacked",
                        "visualizationType": "lnsPie"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store)\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying)\n    agg_storage = sum(storage)\n//    agg_blended = sum(blended)\n    BY \n//      @timestamp,\n      datastream.keyword\n      //deployment_name.keyword, deployment_id , \n      //tier \n| WHERE agg_storage \u003e 0 //and tier == \"hot/content\"\n| SORT agg_storage DESC"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 15,
                    "i": "3269b898-7190-40b6-ad0e-d29fcf98e762",
                    "w": 12,
                    "x": 24,
                    "y": 42
                },
                "panelIndex": "3269b898-7190-40b6-ad0e-d29fcf98e762",
                "title": "Storage: ECU totals by data stream",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldAttrs": null,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "initialContext": null,
                                    "layers": {
                                        "e7e008d5-4100-482b-af1b-01db94a4274c": {
                                            "columns": [
                                                {
                                                    "columnId": "3d98e1e4-e4df-47a2-9c7f-1efd2ecf0098",
                                                    "customLabel": true,
                                                    "fieldName": "datastream",
                                                    "label": "Data stream",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "string"
                                                    },
                                                    "variable": null
                                                },
                                                {
                                                    "columnId": "93aa5ff0-235f-4d8f-b926-748804244c15",
                                                    "customLabel": true,
                                                    "fieldName": "tier",
                                                    "label": "Data tier",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "string"
                                                    },
                                                    "variable": null
                                                },
                                                {
                                                    "columnId": "4db503d0-ae68-4f07-9b2f-42a2ef99af1f",
                                                    "customLabel": true,
                                                    "fieldName": "ecu_indexing",
                                                    "label": "ECU (Indexing)",
                                                    "meta": {
                                                        "esType": "double",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    },
                                                    "variable": null
                                                },
                                                {
                                                    "columnId": "18a2dacc-eb7c-450d-8eee-8cc9a09a6362",
                                                    "customLabel": true,
                                                    "fieldName": "ecu_querying",
                                                    "label": "ECU (Querying)",
                                                    "meta": {
                                                        "esType": "double",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    },
                                                    "variable": null
                                                },
                                                {
                                                    "columnId": "6cd474f2-dda5-4131-b0d9-9f99b0f64232",
                                                    "customLabel": true,
                                                    "fieldName": "ecu_storage",
                                                    "label": "ECU (Storage)",
                                                    "meta": {
                                                        "esType": "double",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    },
                                                    "variable": null
                                                },
                                                {
                                                    "columnId": "59ed77e7-b251-475a-8f30-b905e253f944",
                                                    "customLabel": true,
                                                    "fieldName": "ecu_blended",
                                                    "label": "ECU (Blended)",
                                                    "meta": {
                                                        "esType": "double",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    },
                                                    "variable": null
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_tier_and_datastream_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| EVAL\n    // Calculate proportional ECU shares\n    indexing = CASE(\n        deployment_sum_indexing_time > 0,\n        tier_and_datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu\n    ),\n    querying = CASE(\n        deployment_sum_query_time > 0,\n        tier_and_datastream_sum_query_time / deployment_sum_query_time * total_ecu\n    ),\n    data_set = CASE(\n        deployment_sum_data_set_store_size > 0,\n        tier_and_datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu\n    ),\n    store = CASE(\n        deployment_sum_store_size > 0,\n        tier_and_datastream_sum_store_size / deployment_sum_store_size * total_ecu\n    ),\n    storage = CASE( store == 0, data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE(\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    ecu_indexing = sum(indexing),\n    ecu_querying = sum(querying),\n    ecu_storage = sum(storage),\n    ecu_blended = sum(blended)\n    BY datastream, tier\n| SORT ecu_blended DESC"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_tier_and_datastream_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| EVAL\n    // Calculate proportional ECU shares\n    indexing = CASE(\n        deployment_sum_indexing_time > 0,\n        tier_and_datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu\n    ),\n    querying = CASE(\n        deployment_sum_query_time > 0,\n        tier_and_datastream_sum_query_time / deployment_sum_query_time * total_ecu\n    ),\n    data_set = CASE(\n        deployment_sum_data_set_store_size > 0,\n        tier_and_datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu\n    ),\n    store = CASE(\n        deployment_sum_store_size > 0,\n        tier_and_datastream_sum_store_size / deployment_sum_store_size * total_ecu\n    ),\n    storage = CASE( store == 0, data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE(\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    ecu_indexing = sum(indexing),\n    ecu_querying = sum(querying),\n    ecu_storage = sum(storage),\n    ecu_blended = sum(blended)\n    BY datastream, tier\n| SORT ecu_blended DESC"
                            },
                            "visualization": {
                                "columns": [
                                    {
                                        "columnId": "3d98e1e4-e4df-47a2-9c7f-1efd2ecf0098",
                                        "isMetric": false,
                                        "isTransposed": false,
                                        "width": 536.6666666666667
                                    },
                                    {
                                        "columnId": "93aa5ff0-235f-4d8f-b926-748804244c15",
                                        "isMetric": false,
                                        "isTransposed": false
                                    },
                                    {
                                        "columnId": "4db503d0-ae68-4f07-9b2f-42a2ef99af1f",
                                        "isMetric": true,
                                        "isTransposed": false
                                    },
                                    {
                                        "columnId": "18a2dacc-eb7c-450d-8eee-8cc9a09a6362",
                                        "isMetric": true,
                                        "isTransposed": false
                                    },
                                    {
                                        "columnId": "6cd474f2-dda5-4131-b0d9-9f99b0f64232",
                                        "isMetric": true,
                                        "isTransposed": false
                                    },
                                    {
                                        "columnId": "59ed77e7-b251-475a-8f30-b905e253f944",
                                        "isMetric": true,
                                        "isTransposed": false
                                    }
                                ],
                                "layerId": "e7e008d5-4100-482b-af1b-01db94a4274c",
                                "layerType": "data",
                                "sorting": null
                            }
                        },
                        "title": "ecu_indexing \u0026 ecu_querying \u0026 ecu_storage \u0026 ecu_blended of datastream",
                        "visualizationType": "lnsDatatable"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_tier_and_datastream_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| EVAL\n    // Calculate proportional ECU shares\n    indexing = CASE(\n        deployment_sum_indexing_time > 0,\n        tier_and_datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu\n    ),\n    querying = CASE(\n        deployment_sum_query_time > 0,\n        tier_and_datastream_sum_query_time / deployment_sum_query_time * total_ecu\n    ),\n    data_set = CASE(\n        deployment_sum_data_set_store_size > 0,\n        tier_and_datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu\n    ),\n    store = CASE(\n        deployment_sum_store_size > 0,\n        tier_and_datastream_sum_store_size / deployment_sum_store_size * total_ecu\n    ),\n    storage = CASE( store == 0, data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE(\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    ecu_indexing = sum(indexing),\n    ecu_querying = sum(querying),\n    ecu_storage = sum(storage),\n    ecu_blended = sum(blended)\n    BY datastream, tier\n| SORT ecu_blended DESC"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 15,
                    "i": "964a716b-bb61-4cc0-ba77-c1e73e2da836",
                    "w": 48,
                    "x": 0,
                    "y": 57
                },
                "panelIndex": "964a716b-bb61-4cc0-ba77-c1e73e2da836",
                "title": "ECU per data stream per tier",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "52906f25-a114-4d45-b425-f0ff154f4ac1": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_blended",
                                                    "customLabel": true,
                                                    "fieldName": "agg_blended",
                                                    "inMetricDimension": true,
                                                    "label": "ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "@timestamp",
                                                    "customLabel": true,
                                                    "fieldName": "@timestamp",
                                                    "label": "Date",
                                                    "meta": {
                                                        "esType": "date",
                                                        "type": "date"
                                                    }
                                                },
                                                {
                                                    "columnId": "datastream.keyword",
                                                    "customLabel": false,
                                                    "fieldName": "datastream.keyword",
                                                    "label": "datastream.keyword",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size > 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = ((storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot\n| STATS\n //   agg_indexing = sum(indexing),\n //   agg_querying = sum(querying),\n //   agg_storage = sum(storage),\n    agg_blended = sum(blended)\n    BY\n    @timestamp,\n    //deployment_name.keyword, deployment_id ,\n    datastream.keyword\n //   tier\n| WHERE agg_blended > 0 //and tier == \"hot/content\"\n| SORT agg_blended DESC"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size > 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = ((storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot\n| STATS\n //   agg_indexing = sum(indexing),\n //   agg_querying = sum(querying),\n //   agg_storage = sum(storage),\n    agg_blended = sum(blended)\n    BY\n    @timestamp,\n    //deployment_name.keyword, deployment_id ,\n    datastream.keyword\n //   tier\n| WHERE agg_blended > 0 //and tier == \"hot/content\"\n| SORT agg_blended DESC"
                            },
                            "visualization": {
                                "axisTitlesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "fittingFunction": "Linear",
                                "gridlinesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "labelsOrientation": {
                                    "x": 0,
                                    "yLeft": 0,
                                    "yRight": 0
                                },
                                "layers": [
                                    {
                                        "accessors": [
                                            "agg_blended"
                                        ],
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "52906f25-a114-4d45-b425-f0ff154f4ac1",
                                        "layerType": "data",
                                        "seriesType": "bar_stacked",
                                        "splitAccessor": "datastream.keyword",
                                        "xAccessor": "@timestamp"
                                    }
                                ],
                                "legend": {
                                    "isVisible": false,
                                    "position": "right",
                                    "showSingleSeries": false
                                },
                                "preferredSeriesType": "bar_stacked",
                                "tickLabelsVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "valueLabels": "hide"
                            }
                        },
                        "title": "agg_blended over @timestamp",
                        "visualizationType": "lnsXY"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size > 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = ((storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot\n| STATS\n //   agg_indexing = sum(indexing),\n //   agg_querying = sum(querying),\n //   agg_storage = sum(storage),\n    agg_blended = sum(blended)\n    BY\n    @timestamp,\n    //deployment_name.keyword, deployment_id ,\n    datastream.keyword\n //   tier\n| WHERE agg_blended > 0 //and tier == \"hot/content\"\n| SORT agg_blended DESC"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 14,
                    "i": "4c97109a-2048-470f-ae18-8c424ba2c12e",
                    "w": 16,
                    "x": 0,
                    "y": 130
                },
                "panelIndex": "4c97109a-2048-470f-ae18-8c424ba2c12e",
                "title": "Blended value: ECU per data stream per day",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "b72a0ab5-dbf5-4fd2-bdef-c855fe354bee": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_storage",
                                                    "customLabel": true,
                                                    "fieldName": "agg_storage",
                                                    "inMetricDimension": true,
                                                    "label": "ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "@timestamp",
                                                    "customLabel": true,
                                                    "fieldName": "@timestamp",
                                                    "label": "Date",
                                                    "meta": {
                                                        "esType": "date",
                                                        "type": "date"
                                                    }
                                                },
                                                {
                                                    "columnId": "datastream.keyword",
                                                    "customLabel": true,
                                                    "fieldName": "datastream.keyword",
                                                    "label": "Data stream",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store)\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying)\n    agg_storage = sum(storage)\n//    agg_blended = sum(blended)\n    BY \n    @timestamp, \n    //deployment_name.keyword, deployment_id ,   \n    datastream.keyword\n//    tier \n| WHERE agg_storage \u003e 0 //and tier == \"hot/content\"\n| SORT agg_storage DESC"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store)\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying)\n    agg_storage = sum(storage)\n//    agg_blended = sum(blended)\n    BY \n    @timestamp, \n    //deployment_name.keyword, deployment_id ,   \n    datastream.keyword\n//    tier \n| WHERE agg_storage \u003e 0 //and tier == \"hot/content\"\n| SORT agg_storage DESC"
                            },
                            "visualization": {
                                "axisTitlesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "fittingFunction": "Linear",
                                "gridlinesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "labelsOrientation": {
                                    "x": 0,
                                    "yLeft": 0,
                                    "yRight": 0
                                },
                                "layers": [
                                    {
                                        "accessors": [
                                            "agg_storage"
                                        ],
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "b72a0ab5-dbf5-4fd2-bdef-c855fe354bee",
                                        "layerType": "data",
                                        "seriesType": "bar_stacked",
                                        "splitAccessor": "datastream.keyword",
                                        "xAccessor": "@timestamp"
                                    }
                                ],
                                "legend": {
                                    "isVisible": false,
                                    "position": "right",
                                    "showSingleSeries": false
                                },
                                "preferredSeriesType": "bar_stacked",
                                "tickLabelsVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "valueLabels": "hide"
                            }
                        },
                        "title": "agg_storage over @timestamp",
                        "visualizationType": "lnsXY"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store)\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying)\n    agg_storage = sum(storage)\n//    agg_blended = sum(blended)\n    BY \n    @timestamp, \n    //deployment_name.keyword, deployment_id ,   \n    datastream.keyword\n//    tier \n| WHERE agg_storage \u003e 0 //and tier == \"hot/content\"\n| SORT agg_storage DESC"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 15,
                    "i": "6430d172-9b7f-45a0-a836-c46af0276b19",
                    "w": 16,
                    "x": 0,
                    "y": 112
                },
                "panelIndex": "6430d172-9b7f-45a0-a836-c46af0276b19",
                "title": "Storage: ECU per data stream per day",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "91bcc41e-3a2c-434d-8df7-29c01340e712": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_indexing",
                                                    "customLabel": true,
                                                    "fieldName": "agg_indexing",
                                                    "inMetricDimension": true,
                                                    "label": "% ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "@timestamp",
                                                    "customLabel": true,
                                                    "fieldName": "@timestamp",
                                                    "label": "Date",
                                                    "meta": {
                                                        "esType": "date",
                                                        "type": "date"
                                                    }
                                                },
                                                {
                                                    "columnId": "datastream.keyword",
                                                    "customLabel": true,
                                                    "fieldName": "datastream.keyword",
                                                    "label": "Data stream",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "FROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n| STATS  \n    agg_indexing = sum(indexing)\n    BY \n    @timestamp,  \n    datastream.keyword\n| WHERE agg_indexing \u003e 0 \n| SORT agg_indexing DESC"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "FROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n| STATS  \n    agg_indexing = sum(indexing)\n    BY \n    @timestamp,  \n    datastream.keyword\n| WHERE agg_indexing \u003e 0 \n| SORT agg_indexing DESC"
                            },
                            "visualization": {
                                "axisTitlesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "fittingFunction": "Linear",
                                "gridlinesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "labelsOrientation": {
                                    "x": 0,
                                    "yLeft": 0,
                                    "yRight": 0
                                },
                                "layers": [
                                    {
                                        "accessors": [
                                            "agg_indexing"
                                        ],
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "91bcc41e-3a2c-434d-8df7-29c01340e712",
                                        "layerType": "data",
                                        "seriesType": "bar_percentage_stacked",
                                        "splitAccessor": "datastream.keyword",
                                        "xAccessor": "@timestamp"
                                    }
                                ],
                                "legend": {
                                    "isVisible": false,
                                    "position": "right",
                                    "showSingleSeries": false
                                },
                                "preferredSeriesType": "bar_stacked",
                                "tickLabelsVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "valueLabels": "hide"
                            }
                        },
                        "title": "agg_indexing over @timestamp",
                        "visualizationType": "lnsXY"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "FROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n| STATS  \n    agg_indexing = sum(indexing)\n    BY \n    @timestamp,  \n    datastream.keyword\n| WHERE agg_indexing \u003e 0 \n| SORT agg_indexing DESC"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 14,
                    "i": "b3e62c24-abb9-431e-a228-cbc5e7b8b02a",
                    "w": 16,
                    "x": 32,
                    "y": 95
                },
                "panelIndex": "b3e62c24-abb9-431e-a228-cbc5e7b8b02a",
                "title": "Querying: % ECU per data stream per day",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "b72a0ab5-dbf5-4fd2-bdef-c855fe354bee": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_storage",
                                                    "customLabel": true,
                                                    "fieldName": "agg_storage",
                                                    "inMetricDimension": true,
                                                    "label": "% ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "@timestamp",
                                                    "customLabel": true,
                                                    "fieldName": "@timestamp",
                                                    "label": "Date",
                                                    "meta": {
                                                        "esType": "date",
                                                        "type": "date"
                                                    }
                                                },
                                                {
                                                    "columnId": "datastream.keyword",
                                                    "customLabel": true,
                                                    "fieldName": "datastream.keyword",
                                                    "label": "Data stream",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store)\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying)\n    agg_storage = sum(storage)\n//    agg_blended = sum(blended)\n    BY \n    @timestamp, \n    //deployment_name.keyword, deployment_id ,   \n    datastream.keyword\n//    tier \n| WHERE agg_storage \u003e 0 //and tier == \"hot/content\"\n| SORT agg_storage DESC"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store)\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying)\n    agg_storage = sum(storage)\n//    agg_blended = sum(blended)\n    BY \n    @timestamp, \n    //deployment_name.keyword, deployment_id ,   \n    datastream.keyword\n//    tier \n| WHERE agg_storage \u003e 0 //and tier == \"hot/content\"\n| SORT agg_storage DESC"
                            },
                            "visualization": {
                                "axisTitlesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "fittingFunction": "Linear",
                                "gridlinesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "labelsOrientation": {
                                    "x": 0,
                                    "yLeft": 0,
                                    "yRight": 0
                                },
                                "layers": [
                                    {
                                        "accessors": [
                                            "agg_storage"
                                        ],
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "b72a0ab5-dbf5-4fd2-bdef-c855fe354bee",
                                        "layerType": "data",
                                        "seriesType": "bar_percentage_stacked",
                                        "splitAccessor": "datastream.keyword",
                                        "xAccessor": "@timestamp"
                                    }
                                ],
                                "legend": {
                                    "isVisible": false,
                                    "position": "right",
                                    "showSingleSeries": false
                                },
                                "preferredSeriesType": "bar_stacked",
                                "tickLabelsVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "valueLabels": "hide"
                            }
                        },
                        "title": "agg_storage over @timestamp",
                        "visualizationType": "lnsXY"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu)\n    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store)\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n//    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying)\n    agg_storage = sum(storage)\n//    agg_blended = sum(blended)\n    BY \n    @timestamp, \n    //deployment_name.keyword, deployment_id ,   \n    datastream.keyword\n//    tier \n| WHERE agg_storage \u003e 0 //and tier == \"hot/content\"\n| SORT agg_storage DESC"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 15,
                    "i": "a672f0fa-cdf6-4e27-a2c8-f753eef30a06",
                    "w": 16,
                    "x": 32,
                    "y": 112
                },
                "panelIndex": "a672f0fa-cdf6-4e27-a2c8-f753eef30a06",
                "title": "Storage: % ECU per data stream per day",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "8c2f087d-e623-4f6f-b232-97ab4284e4db": {
                                            "columns": [
                                                {
                                                    "columnId": "@timestamp",
                                                    "customLabel": true,
                                                    "fieldName": "@timestamp",
                                                    "inMetricDimension": true,
                                                    "label": "Date",
                                                    "meta": {
                                                        "esType": "date",
                                                        "type": "date"
                                                    }
                                                },
                                                {
                                                    "columnId": "30c47aa5-b389-479c-a2b6-d91c77a952b9",
                                                    "customLabel": true,
                                                    "fieldName": "agg_blended",
                                                    "label": "% ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "57d5389c-1311-460d-afe2-cecc4a8d16f4",
                                                    "customLabel": true,
                                                    "fieldName": "datastream.keyword",
                                                    "label": "Data stream",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size > 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n    agg_blended = sum(blended)\n    BY\n    @timestamp,\n    //deployment_name.keyword, deployment_id ,\n    datastream.keyword,\n    tier\n| WHERE agg_blended > 0 and tier == \"hot/content\"\n| SORT agg_storage DESC"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size > 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n    agg_blended = sum(blended)\n    BY\n    @timestamp,\n    //deployment_name.keyword, deployment_id ,\n    datastream.keyword,\n    tier\n| WHERE agg_blended > 0 and tier == \"hot/content\"\n| SORT agg_storage DESC"
                            },
                            "visualization": {
                                "axisTitlesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "fittingFunction": "Linear",
                                "gridlinesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "labelsOrientation": {
                                    "x": 0,
                                    "yLeft": 0,
                                    "yRight": 0
                                },
                                "layers": [
                                    {
                                        "accessors": [
                                            "30c47aa5-b389-479c-a2b6-d91c77a952b9"
                                        ],
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "8c2f087d-e623-4f6f-b232-97ab4284e4db",
                                        "layerType": "data",
                                        "seriesType": "bar_percentage_stacked",
                                        "splitAccessor": "57d5389c-1311-460d-afe2-cecc4a8d16f4",
                                        "xAccessor": "@timestamp"
                                    }
                                ],
                                "legend": {
                                    "isVisible": false,
                                    "position": "right",
                                    "showSingleSeries": false
                                },
                                "preferredSeriesType": "bar_stacked",
                                "tickLabelsVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "valueLabels": "hide"
                            }
                        },
                        "title": "agg_indexing \u0026 agg_querying \u0026 agg_storage \u0026 agg_blended over @timestamp",
                        "visualizationType": "lnsXY"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size > 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n    agg_blended = sum(blended)\n    BY\n    @timestamp,\n    //deployment_name.keyword, deployment_id ,\n    datastream.keyword,\n    tier\n| WHERE agg_blended > 0 and tier == \"hot/content\"\n| SORT agg_storage DESC"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 14,
                    "i": "4dbbad0a-7ceb-443b-912b-0c1ae9fb3a6a",
                    "w": 16,
                    "x": 32,
                    "y": 130
                },
                "panelIndex": "4dbbad0a-7ceb-443b-912b-0c1ae9fb3a6a",
                "title": "Blended value: % ECU per data stream per day",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "43f9cfe6-d828-4773-ab65-129f92cf7f4d": {
                                            "columns": [
                                                {
                                                    "columnId": "@timestamp",
                                                    "customLabel": true,
                                                    "fieldName": "@timestamp",
                                                    "inMetricDimension": true,
                                                    "label": "Date",
                                                    "meta": {
                                                        "esType": "date",
                                                        "type": "date"
                                                    }
                                                },
                                                {
                                                    "columnId": "50a91b89-2e68-4a69-90a0-d2ab79115b96",
                                                    "customLabel": true,
                                                    "fieldName": "tier",
                                                    "label": "Data tier",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "string"
                                                    }
                                                },
                                                {
                                                    "columnId": "1501af72-2509-4ae0-88a0-c1481e438377",
                                                    "customLabel": true,
                                                    "fieldName": "agg_blended",
                                                    "label": "ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu),\n    store = CASE (deployment_sum_store_size > 0, tier_sum_store_size / deployment_sum_store_size * total_ecu),\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n    agg_blended = sum(blended)\n    BY\n      @timestamp,\n      tier\n| WHERE agg_blended > 0"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu),\n    store = CASE (deployment_sum_store_size > 0, tier_sum_store_size / deployment_sum_store_size * total_ecu),\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n    agg_blended = sum(blended)\n    BY\n      @timestamp,\n      tier\n| WHERE agg_blended > 0"
                            },
                            "visualization": {
                                "axisTitlesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "fittingFunction": "Linear",
                                "gridlinesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "labelsOrientation": {
                                    "x": 0,
                                    "yLeft": 0,
                                    "yRight": 0
                                },
                                "layers": [
                                    {
                                        "accessors": [
                                            "1501af72-2509-4ae0-88a0-c1481e438377"
                                        ],
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "43f9cfe6-d828-4773-ab65-129f92cf7f4d",
                                        "layerType": "data",
                                        "seriesType": "bar_stacked",
                                        "splitAccessor": "50a91b89-2e68-4a69-90a0-d2ab79115b96",
                                        "xAccessor": "@timestamp"
                                    }
                                ],
                                "legend": {
                                    "isVisible": false,
                                    "position": "right",
                                    "showSingleSeries": false
                                },
                                "preferredSeriesType": "bar_stacked",
                                "tickLabelsVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "valueLabels": "hide"
                            }
                        },
                        "title": "agg_indexing \u0026 agg_querying \u0026 agg_storage \u0026 agg_blended over @timestamp",
                        "visualizationType": "lnsXY"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "FROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu),\n    store = CASE (deployment_sum_store_size > 0, tier_sum_store_size / deployment_sum_store_size * total_ecu),\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n    agg_blended = sum(blended)\n    BY\n      @timestamp,\n      tier\n| WHERE agg_blended > 0"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 14,
                    "i": "5732f95c-3cc0-46c8-a8ab-14f8c6937f9f",
                    "w": 16,
                    "x": 16,
                    "y": 130
                },
                "panelIndex": "5732f95c-3cc0-46c8-a8ab-14f8c6937f9f",
                "title": "Blended value: ECU per tier per day",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "0ee24895-1496-4b23-96ec-ec09a8f49332": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_indexing",
                                                    "customLabel": true,
                                                    "fieldName": "agg_indexing",
                                                    "inMetricDimension": true,
                                                    "label": "ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "@timestamp",
                                                    "customLabel": true,
                                                    "fieldName": "@timestamp",
                                                    "label": "Date",
                                                    "meta": {
                                                        "esType": "date",
                                                        "type": "date"
                                                    }
                                                },
                                                {
                                                    "columnId": "datastream.keyword",
                                                    "customLabel": true,
                                                    "fieldName": "datastream.keyword",
                                                    "label": "Data stream",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying),\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n    @timestamp, \n    //deployment_name.keyword, deployment_id ,   \n    datastream.keyword\n//    tier \n| WHERE agg_indexing \u003e 0 //and tier == \"hot/content\"\n| SORT agg_indexing DESC"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying),\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n    @timestamp, \n    //deployment_name.keyword, deployment_id ,   \n    datastream.keyword\n//    tier \n| WHERE agg_indexing \u003e 0 //and tier == \"hot/content\"\n| SORT agg_indexing DESC"
                            },
                            "visualization": {
                                "axisTitlesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "fittingFunction": "Linear",
                                "gridlinesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "labelsOrientation": {
                                    "x": 0,
                                    "yLeft": 0,
                                    "yRight": 0
                                },
                                "layers": [
                                    {
                                        "accessors": [
                                            "agg_indexing"
                                        ],
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "0ee24895-1496-4b23-96ec-ec09a8f49332",
                                        "layerType": "data",
                                        "seriesType": "bar_stacked",
                                        "splitAccessor": "datastream.keyword",
                                        "xAccessor": "@timestamp"
                                    }
                                ],
                                "legend": {
                                    "isVisible": false,
                                    "position": "right",
                                    "showSingleSeries": false
                                },
                                "preferredSeriesType": "bar_stacked",
                                "tickLabelsVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "valueLabels": "hide"
                            }
                        },
                        "title": "agg_indexing over @timestamp",
                        "visualizationType": "lnsXY"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_datastream_contribution_lookup ON composite_key\n//| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n    indexing = CASE (deployment_sum_indexing_time \u003e 0, datastream_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, datastream_sum_query_time / deployment_sum_query_time * total_ecu),\n//    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, datastream_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n//    store = CASE (deployment_sum_store_size \u003e 0, datastream_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n//    storage = CASE (store == 0 , data_set, store),\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n    agg_indexing = sum(indexing)\n//    agg_querying = sum(querying),\n//    agg_storage = sum(storage),\n//    agg_blended = sum(blended)\n    BY \n    @timestamp, \n    //deployment_name.keyword, deployment_id ,   \n    datastream.keyword\n//    tier \n| WHERE agg_indexing \u003e 0 //and tier == \"hot/content\"\n| SORT agg_indexing DESC"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 14,
                    "i": "dafb7c36-3a1d-4cbb-9944-51beedf535f6",
                    "w": 16,
                    "x": 0,
                    "y": 78
                },
                "panelIndex": "dafb7c36-3a1d-4cbb-9944-51beedf535f6",
                "title": "Indexing: ECU per data stream per day",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "93fd5f12-463f-4e8e-a9b8-0ac77d0522a9": {
                                            "columns": [
                                                {
                                                    "columnId": "agg_storage",
                                                    "customLabel": true,
                                                    "fieldName": "agg_storage",
                                                    "inMetricDimension": true,
                                                    "label": "ECU",
                                                    "meta": {
                                                        "esType": "double",
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "@timestamp",
                                                    "customLabel": true,
                                                    "fieldName": "@timestamp",
                                                    "label": "Date",
                                                    "meta": {
                                                        "esType": "date",
                                                        "type": "date"
                                                    }
                                                },
                                                {
                                                    "columnId": "tier",
                                                    "customLabel": true,
                                                    "fieldName": "tier",
                                                    "label": "Data tier",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "type": "string"
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, tier_sum_query_time / deployment_sum_query_time * total_ecu)\n    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size \u003e 0, tier_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store)\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n //   agg_indexing = sum(indexing)\n//    agg_querying = sum(querying)\n    agg_storage = sum(storage)\n//    agg_blended = sum(blended)\n    BY \n      @timestamp ,\n      //deployment_name.keyword, deployment_id , \n      tier \n| WHERE agg_storage \u003e 0"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, tier_sum_query_time / deployment_sum_query_time * total_ecu)\n    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size \u003e 0, tier_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store)\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n //   agg_indexing = sum(indexing)\n//    agg_querying = sum(querying)\n    agg_storage = sum(storage)\n//    agg_blended = sum(blended)\n    BY \n      @timestamp ,\n      //deployment_name.keyword, deployment_id , \n      tier \n| WHERE agg_storage \u003e 0"
                            },
                            "visualization": {
                                "axisTitlesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "fittingFunction": "Linear",
                                "gridlinesVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "labelsOrientation": {
                                    "x": 0,
                                    "yLeft": 0,
                                    "yRight": 0
                                },
                                "layers": [
                                    {
                                        "accessors": [
                                            "agg_storage"
                                        ],
                                        "colorMapping": {
                                            "assignments": [],
                                            "colorMode": {
                                                "type": "categorical"
                                            },
                                            "paletteId": "default",
                                            "specialAssignments": [
                                                {
                                                    "color": {
                                                        "type": "loop"
                                                    },
                                                    "rule": {
                                                        "type": "other"
                                                    },
                                                    "touched": false
                                                }
                                            ]
                                        },
                                        "layerId": "93fd5f12-463f-4e8e-a9b8-0ac77d0522a9",
                                        "layerType": "data",
                                        "seriesType": "bar_stacked",
                                        "splitAccessor": "tier",
                                        "xAccessor": "@timestamp"
                                    }
                                ],
                                "legend": {
                                    "isVisible": false,
                                    "position": "right",
                                    "showSingleSeries": false
                                },
                                "preferredSeriesType": "bar_stacked",
                                "tickLabelsVisibilitySettings": {
                                    "x": true,
                                    "yLeft": true,
                                    "yRight": true
                                },
                                "valueLabels": "hide"
                            }
                        },
                        "title": "agg_storage over @timestamp",
                        "visualizationType": "lnsXY"
                    },
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup \n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL \n//    indexing = CASE (deployment_sum_indexing_time \u003e 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu)\n//    querying = CASE (deployment_sum_query_time \u003e 0, tier_sum_query_time / deployment_sum_query_time * total_ecu)\n    data_set = CASE (deployment_sum_data_set_store_size \u003e 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size \u003e 0, tier_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store)\n//    conf_storage_weight = 40,\n//    conf_query_weight = 20,\n//    index_weight = 20,\n//    total_weight_hot = conf_storage_weight + conf_query_weight + index_weight,\n//    total_weight_cold = conf_storage_weight + conf_query_weight,\n//    blended = CASE (\n//        tier == \"hot/content\",\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight) +\n//            (indexing * index_weight)\n//        ) / total_weight_hot,\n//        (\n//            (storage * conf_storage_weight) +\n//            (querying * conf_query_weight)\n//        ) / total_weight_cold\n//    )\n| STATS  \n //   agg_indexing = sum(indexing)\n//    agg_querying = sum(querying)\n    agg_storage = sum(storage)\n//    agg_blended = sum(blended)\n    BY \n      @timestamp ,\n      //deployment_name.keyword, deployment_id , \n      tier \n| WHERE agg_storage \u003e 0"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 15,
                    "i": "ba7efeab-de6c-4301-8e97-7adb98dae58b",
                    "w": 16,
                    "x": 16,
                    "y": 112
                },
                "panelIndex": "ba7efeab-de6c-4301-8e97-7adb98dae58b",
                "title": "Storage: ECU per tier per day",
                "type": "lens"
            },
            {
                "embeddableConfig": {
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "savedVis": {
                        "data": {
                            "aggs": [],
                            "searchSource": {
                                "filter": [],
                                "query": {
                                    "language": "kuery",
                                    "query": ""
                                }
                            }
                        },
                        "description": "",
                        "params": {
                            "fontSize": 12,
                            "markdown": "## Indexing details",
                            "openLinksInNewTab": false
                        },
                        "title": "",
                        "type": "markdown",
                        "uiState": {}
                    }
                },
                "gridData": {
                    "h": 3,
                    "i": "9cd4730b-d3f5-438e-a816-4d5aebf1eae6",
                    "w": 48,
                    "x": 0,
                    "y": 75
                },
                "panelIndex": "9cd4730b-d3f5-438e-a816-4d5aebf1eae6",
                "title": "",
                "type": "visualization"
            },
            {
                "embeddableConfig": {
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "savedVis": {
                        "data": {
                            "aggs": [],
                            "searchSource": {
                                "filter": [],
                                "query": {
                                    "language": "kuery",
                                    "query": ""
                                }
                            }
                        },
                        "description": "",
                        "params": {
                            "fontSize": 12,
                            "markdown": "## Querying details",
                            "openLinksInNewTab": false
                        },
                        "title": "",
                        "type": "markdown",
                        "uiState": {}
                    }
                },
                "gridData": {
                    "h": 3,
                    "i": "8de95af1-8e9a-424a-baaf-8cfcb2577f59",
                    "w": 48,
                    "x": 0,
                    "y": 92
                },
                "panelIndex": "8de95af1-8e9a-424a-baaf-8cfcb2577f59",
                "title": "",
                "type": "visualization"
            },
            {
                "embeddableConfig": {
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "savedVis": {
                        "data": {
                            "aggs": [],
                            "searchSource": {
                                "filter": [],
                                "query": {
                                    "language": "kuery",
                                    "query": ""
                                }
                            }
                        },
                        "description": "",
                        "params": {
                            "fontSize": 12,
                            "markdown": "## Storage details",
                            "openLinksInNewTab": false
                        },
                        "title": "",
                        "type": "markdown",
                        "uiState": {}
                    }
                },
                "gridData": {
                    "h": 3,
                    "i": "4d3f1bfb-ea89-4978-ab6f-9033a507785f",
                    "w": 48,
                    "x": 0,
                    "y": 109
                },
                "panelIndex": "4d3f1bfb-ea89-4978-ab6f-9033a507785f",
                "title": "",
                "type": "visualization"
            },
            {
                "embeddableConfig": {
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "savedVis": {
                        "data": {
                            "aggs": [],
                            "searchSource": {
                                "filter": [],
                                "query": {
                                    "language": "kuery",
                                    "query": ""
                                }
                            }
                        },
                        "description": "",
                        "params": {
                            "fontSize": 12,
                            "markdown": "## Blended details",
                            "openLinksInNewTab": false
                        },
                        "title": "",
                        "type": "markdown",
                        "uiState": {}
                    }
                },
                "gridData": {
                    "h": 3,
                    "i": "a2cb12f7-9b9e-4bf7-864e-9101107e0c3e",
                    "w": 48,
                    "x": 0,
                    "y": 127
                },
                "panelIndex": "a2cb12f7-9b9e-4bf7-864e-9101107e0c3e",
                "title": "",
                "type": "visualization"
            },
            {
                "embeddableConfig": {
                    "attributes": {
                        "references": [],
                        "state": {
                            "adHocDataViews": {
                                "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f": {
                                    "allowHidden": false,
                                    "allowNoIndex": false,
                                    "fieldFormats": {},
                                    "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                    "name": "billing_cluster_cost_lookup",
                                    "runtimeFieldMap": {},
                                    "sourceFilters": [],
                                    "timeFieldName": "@timestamp",
                                    "title": "billing_cluster_cost_lookup",
                                    "type": "esql"
                                }
                            },
                            "datasourceStates": {
                                "textBased": {
                                    "indexPatternRefs": [
                                        {
                                            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "timeField": "@timestamp",
                                            "title": "billing_cluster_cost_lookup"
                                        }
                                    ],
                                    "layers": {
                                        "9d199172-f9fa-4fc4-82af-c7e2672a3f54": {
                                            "columns": [
                                                {
                                                    "columnId": "a76076ce-f372-4a48-857d-75010bbf5970",
                                                    "fieldName": "tier",
                                                    "label": "tier",
                                                    "meta": {
                                                        "esType": "keyword",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "string"
                                                    }
                                                },
                                                {
                                                    "columnId": "6e881cac-4719-493c-95f8-e3bfa38c3219",
                                                    "customLabel": true,
                                                    "fieldName": "agg_indexing",
                                                    "label": "Indexing",
                                                    "meta": {
                                                        "esType": "double",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "97a86307-08fc-4b2d-a82a-36a2ecc9c75d",
                                                    "customLabel": true,
                                                    "fieldName": "agg_querying",
                                                    "label": "Querying",
                                                    "meta": {
                                                        "esType": "double",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "2b086331-8a38-4df2-b042-7827d3519d63",
                                                    "customLabel": true,
                                                    "fieldName": "agg_storage",
                                                    "label": "Storage",
                                                    "meta": {
                                                        "esType": "double",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                },
                                                {
                                                    "columnId": "307273f7-1b4c-450c-80cd-ef0326b38f6e",
                                                    "customLabel": true,
                                                    "fieldName": "agg_blended",
                                                    "label": "Blended",
                                                    "meta": {
                                                        "esType": "double",
                                                        "sourceParams": {
                                                            "indexPattern": "billing_cluster_cost_lookup"
                                                        },
                                                        "type": "number"
                                                    },
                                                    "params": {
                                                        "format": {
                                                            "id": "number",
                                                            "params": {
                                                                "decimals": 2
                                                            }
                                                        }
                                                    }
                                                }
                                            ],
                                            "index": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
                                            "query": {
                                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size > 0, tier_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n      agg_blended = sum(blended)\n    BY\n      //deployment_name.keyword, deployment_id ,\n      tier\n| WHERE agg_blended > 0"
                                            },
                                            "timeField": "@timestamp"
                                        }
                                    }
                                }
                            },
                            "filters": [],
                            "needsRefresh": false,
                            "query": {
                                "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size > 0, tier_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n      agg_blended = sum(blended)\n    BY\n      //deployment_name.keyword, deployment_id ,\n      tier\n| WHERE agg_blended > 0"
                            },
                            "visualization": {
                                "columns": [
                                    {
                                        "columnId": "a76076ce-f372-4a48-857d-75010bbf5970",
                                        "isMetric": false,
                                        "isTransposed": false
                                    },
                                    {
                                        "columnId": "6e881cac-4719-493c-95f8-e3bfa38c3219",
                                        "isMetric": true,
                                        "isTransposed": false
                                    },
                                    {
                                        "columnId": "97a86307-08fc-4b2d-a82a-36a2ecc9c75d",
                                        "isMetric": true,
                                        "isTransposed": false
                                    },
                                    {
                                        "columnId": "2b086331-8a38-4df2-b042-7827d3519d63",
                                        "isMetric": true,
                                        "isTransposed": false
                                    },
                                    {
                                        "columnId": "307273f7-1b4c-450c-80cd-ef0326b38f6e",
                                        "isMetric": true,
                                        "isTransposed": false
                                    }
                                ],
                                "layerId": "9d199172-f9fa-4fc4-82af-c7e2672a3f54",
                                "layerType": "data"
                            }
                        },
                        "title": "agg_indexing \u0026 agg_querying \u0026 agg_storage \u0026 agg_blended of tier",
                        "visualizationType": "lnsDatatable"
                    },
                    "description": "ECU breakdown per tier, based on Indexing, Querying, Storage and a blended ratio of all of these.",
                    "enhancements": {
                        "dynamicActions": {
                            "events": []
                        }
                    },
                    "filters": [],
                    "query": {
                        "esql": "// ECU detail by tier\nFROM billing_cluster_cost_lookup\n| EVAL config_join_key = \"chargeback_config\"\n| LOOKUP JOIN chargeback_conf_lookup ON config_join_key\n| LOOKUP JOIN cluster_deployment_contribution_lookup ON composite_key\n| LOOKUP JOIN cluster_tier_contribution_lookup ON composite_key\n| EVAL\n    indexing = CASE (deployment_sum_indexing_time > 0, tier_sum_indexing_time / deployment_sum_indexing_time * total_ecu),\n    querying = CASE (deployment_sum_query_time > 0, tier_sum_query_time / deployment_sum_query_time * total_ecu),\n    data_set = CASE (deployment_sum_data_set_store_size > 0, tier_sum_data_set_store_size / deployment_sum_data_set_store_size * total_ecu), // total data set storage\n    store = CASE (deployment_sum_store_size > 0, tier_sum_store_size / deployment_sum_store_size * total_ecu), // only primary indices\n    storage = CASE (store == 0 , data_set, store),\n    // conf_storage_weight = 40,\n    // conf_query_weight = 20,\n    // index_weight = 20,\n    total_weight_hot = conf_storage_weight + conf_query_weight + conf_indexing_weight,\n    total_weight_cold = conf_storage_weight + conf_query_weight,\n    blended = CASE (\n        tier == \"hot/content\",\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight) +\n            (indexing * conf_indexing_weight)\n        ) / total_weight_hot,\n        (\n            (storage * conf_storage_weight) +\n            (querying * conf_query_weight)\n        ) / total_weight_cold\n    )\n| STATS\n    agg_indexing = sum(indexing),\n    agg_querying = sum(querying),\n    agg_storage = sum(storage),\n      agg_blended = sum(blended)\n    BY\n      //deployment_name.keyword, deployment_id ,\n      tier\n| WHERE agg_blended > 0"
                    },
                    "searchSessionId": "48b157e3-14ff-4c71-8178-4a69f0592d85",
                    "syncColors": false,
                    "syncCursor": true,
                    "syncTooltips": false
                },
                "gridData": {
                    "h": 10,
                    "i": "18643569-92d3-4a30-aafe-6ae11acc4c58",
                    "w": 48,
                    "x": 0,
                    "y": 29
                },
                "panelIndex": "18643569-92d3-4a30-aafe-6ae11acc4c58",
                "title": "ECU per tier",
                "type": "lens"
            }
        ],
        "timeRestore": false,
        "title": "[Chargeback] Cost and Consumption breakdown",
        "version": 3
    },
    "coreMigrationVersion": "8.8.0",
    "created_at": "2025-06-06T13:26:53.339Z",
    "created_by": "u_mGBROF_q5bmFCATbLXAcCwKa0k8JvONAwSruelyKA5E_0",
    "id": "chargeback-39a39857-746c-4a29-adca-3c2fcb6bcfb6",
    "managed": false,
    "references": [
        {
            "id": "2bf6c0d816ef0a2d56d03ede549c16c08c35db2cf02d78c12756a98a33f50e4f",
            "name": "controlGroup_ad78c22a-f7b7-4810-8af5-30fbbca8e93e:optionsListDataView",
            "type": "index-pattern"
        }
    ],
    "type": "dashboard",
    "typeMigrationVersion": "10.2.0",
    "updated_by": "u_mGBROF_q5bmFCATbLXAcCwKa0k8JvONAwSruelyKA5E_0"
}