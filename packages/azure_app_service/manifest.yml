format_version: "3.0.2"
name: azure_app_service
title: "Azure App Service"
version: "1.1.0"
source:
  license: "Elastic-2.0"
description: "Collect logs from Azure App Service with Elastic Agent."
type: integration
categories:
  - azure
  - cloud
  - observability
  # Added security category as it collects audit logs and security-relevant HTTP logs
  - security
conditions:
  kibana:
    version: "^8.19.10 || ~9.1.10 || ~9.2.4 || ^9.3.0"
  elastic:
    subscription: "basic"
vars:
  - name: eventhub
    type: text
    title: Event Hub
    multi: false
    required: true
    show_user: true
    description: >-
      Elastic recommends using one event hub for each integration. Visit [Create an event hub](https://docs.elastic.co/integrations/azure#create-an-event-hub) to learn more. Use event hub names up to 30 characters long to avoid compatibility issues.
  - name: consumer_group
    type: text
    title: Consumer Group
    multi: false
    required: true
    show_user: true
    default: $Default
  - name: auth_type
    type: select
    title: Authentication Type
    multi: false
    required: true
    show_user: true
    default: connection_string
    options:
      - text: Connection String
        value: connection_string
      - text: Client Secret
        value: client_secret
    description: >-
      Authentication method to use for Event Hub and Storage Account.
      When set to **Connection String** or left blank: **Connection String** and **Storage Account Key** are required.
      When set to **Client Secret**: Microsoft Entra ID client secret authentication is used, requiring **Tenant ID**, **Client ID**, **Client Secret**, and **Event Hub Namespace**.
      Note: The same authentication type applies to both Event Hub and Storage Account for security consistency.
  - name: connection_string
    type: password
    secret: true
    title: Connection String
    multi: false
    required: false
    show_user: true
    description: >-
      (Required when **Authentication Type** is **Connection String** or left blank) The connection string required to communicate with Event Hubs.
      See [Get an Event Hubs connection string](https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-get-connection-string) to learn more.
  - name: storage_account_key
    type: password
    secret: true
    title: Storage Account Key
    multi: false
    required: false
    show_user: true
    description: >-
      (Required when **Authentication Type** is **Connection String** or left blank) The storage account key used to authorize access to data in your storage account.
      Not used when **Authentication Type** is **Client Secret**; client secret authentication is used for storage instead.
  - name: storage_account
    type: text
    title: Storage Account
    multi: false
    required: true
    show_user: true
    description: >-
      The name of the storage account where the consumer group's state/offsets will be stored and updated.
  - name: eventhub_namespace
    type: text
    title: Event Hub Namespace
    multi: false
    required: false
    show_user: true
    description: >-
      (Required when **Authentication Type** is **Client Secret**) Fully qualified Event Hub namespace (e.g., namespace.servicebus.windows.net).
      Do not use the short namespace name; use the complete FQDN.
  - name: tenant_id
    type: text
    title: Tenant ID
    multi: false
    required: false
    show_user: true
    description: >-
      (Required when **Authentication Type** is **Client Secret**) Microsoft Entra ID tenant ID.
      This is the directory/tenant where your Microsoft Entra ID application is registered.
  - name: client_id
    type: text
    title: Client ID
    multi: false
    required: false
    show_user: true
    description: >-
      (Required when **Authentication Type** is **Client Secret**) Microsoft Entra ID application (client) ID.
      The service principal must have 'Azure Event Hubs Data Receiver' role on the Event Hub and 'Storage Blob Data Contributor' role on the Storage Account.
  - name: client_secret
    type: password
    secret: true
    title: Client Secret
    multi: false
    required: false
    show_user: true
    description: >-
      (Required when **Authentication Type** is **Client Secret**) Microsoft Entra ID application client secret.
      Generate this secret in your Microsoft Entra ID app registration.
  - name: authority_host
    type: text
    title: Authority Host
    multi: false
    required: false
    show_user: false
    default: https://login.microsoftonline.com
    description: >-
      (Optional when **Authentication Type** is **Client Secret**) Microsoft Entra ID authority endpoint. Defaults to https://login.microsoftonline.com (Azure Public Cloud).
      Change for other Azure environments: Azure Government (https://login.microsoftonline.us), Azure China (https://login.chinacloudapi.cn), or Azure Germany (https://login.microsoftonline.de).
  - name: resource_manager_endpoint
    type: text
    title: Resource Manager Endpoint
    multi: false
    required: false
    show_user: false
icons:
  - src: /img/app-service-logo.svg
    title: App Service Logo
    size: 32x32
    type: image/svg+xml
screenshots:
  - src: /img/azure_app_service-overview-dashboard-screenshot.png
    title: Overview dashboard screenshot
    size: 2994x7034
    type: image/png
policy_templates:
  - name: app_service_logs
    title: Azure App Service logs
    description: Azure App Service logs integration
    fips_compatible: false
    data_streams:
      - app_service_logs
    inputs:
      - type: "azure-eventhub"
        title: "Collect Azure App Service logs from Event Hub"
        description: "Collecting App Service logs from Azure (input: azure-eventhub)"
        input_group: logs
owner:
  github: elastic/obs-infraobs-integrations
  type: elastic
