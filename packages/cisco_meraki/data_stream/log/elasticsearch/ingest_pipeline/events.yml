---
description: Pipeline for Cisco Meraki events type
processors:
- dissect:
    description: type= follows events
    field: event.original
    pattern: "%{} events %{*type}=%{&type} %{}"
- rename:
    field: type
    target_field: cisco_meraki.event_subtype
    if: ctx?.type != null

# Process dfs_event
# - dissect:
#     field: event.original
#     pattern: "%{} type=dfs_event %{*channel}='%{&channel}' %{*radio}='%{&radio}'"
#     if: ctx?.cisco_meraki?.event_subtype == 'dfs_event'

# Process wpa_deauth or wpa_auth
# - dissect:
#     field: event.original
#     pattern: "%{} type=%{?type} %{*radio}='%{&radio}' %{*vap}='%{&vap}' %{*client_mac}='%{&client_mac}' %{*aid}='%{&aid}'"
#     if: ctx?.cisco_meraki?.event_subtype == 'wpa_deauth' || ctx?.cisco_meraki?.event_subtype == 'wpa_auth'

# Process dfs_event, wpa_auth, wpa_deauth, association or disassociation
- grok:
    field: event.original
    patterns: 
      - '%{SYSLOGHDR}%{SPACE}%{NUMBER}%{SPACE}%{WORD}%{SPACE}events%{SPACE}%{GREEDYDATA:_temp.rest}'
    pattern_definitions:
      SYSLOGPRI: '<%{NONNEGINT:log.syslog.priority:long}>'
      SYSLOGVER: '\b(?:\d{1,2})\b'
      SYSLOGHDR: '%{SYSLOGPRI}%{SYSLOGVER}'
    if: ctx.event.original.startsWith('<') && (ctx?.cisco_meraki?.event_subtype == 'dfs_event' || ctx?.cisco_meraki?.event_subtype == 'association' || ctx?.cisco_meraki?.event_subtype == 'disassociation' || ctx?.cisco_meraki?.event_subtype == 'wpa_deauth' || ctx?.cisco_meraki?.event_subtype == 'wpa_auth')
- kv:
    field: _temp.rest
    field_split: " "
    value_split: "="
    target_field: cisco_meraki.association
    strip_brackets: true
    if: ctx?.cisco_meraki?.event_subtype == 'association'
- kv:
    field: _temp.rest
    field_split: " "
    value_split: "="
    target_field: cisco_meraki.disassociation
    strip_brackets: true
    if: ctx?.cisco_meraki?.event_subtype == 'disassociation'
- kv:
    field: _temp.rest
    field_split: " "
    value_split: "="
    target_field: cisco_meraki.dfs_event
    strip_brackets: true
    if: ctx?.cisco_meraki?.event_subtype == 'dfs_event'
- kv:
    field: _temp.rest
    field_split: " "
    value_split: "="
    target_field: cisco_meraki.wpa_auth
    strip_brackets: true
    if: ctx?.cisco_meraki?.event_subtype == 'wpa_auth'
- kv:
    field: _temp.rest
    field_split: " "
    value_split: "="
    target_field: cisco_meraki.wpa_deauth
    strip_brackets: true
    if: ctx?.cisco_meraki?.event_subtype == 'wpa_deauth'
