---
description: Pipeline for Cisco Meraki syslog
processors:
- set:
    field: ecs.version
    value: 1.12.0
- rename:
    field: message
    target_field: event.original
- dissect:
    description: Extract syslog words
    field: event.original
    pattern: "%{} %{_temp.ts_nano} %{observer.hostname} %{_temp.event_type} %{}"
- grok:
    description: Reduce precision from nanos to millis and set timestamp
    field: _temp.ts_nano
    patterns:
      - '%{TSMILLIS}'
    pattern_definitions:
      TSMILLIS: (?<_temp.ts_millis>\d{1,10}\.\d{1,6})(?:\d{3})
- date:
    field: _temp.ts_millis
    formats:
      - UNIX
    timezone: '{{{_conf.tz_offset}}}'
- pipeline:
    name: '{{ IngestPipeline "flows" }}'
    if: ctx._temp.event_type == 'flows'
- pipeline:
    name: '{{ IngestPipeline "ipflows" }}'
    if: ctx._temp.event_type == 'ip_flow_start' || ctx._temp.event_type == 'ip_flow_end'
- pipeline:
    name: '{{ IngestPipeline "airmarshal" }}'
    if: ctx._temp.event_type == 'airmarshal_events'
- pipeline:
    name: '{{ IngestPipeline "security" }}'
    if: ctx._temp.event_type == 'security_event'
- remove:
    field:
      - _temp
      - _conf
      - sport
      - dport
      - mac
      - src
      - dst
      - translated_src_ip
      - translated_dst_ip
      - translated_port
      - wired_mac
      - rssi
      - protocol
      - dhost
    ignore_missing: true
on_failure:
- set:
    field: error.message
    value: '{{ _ingest.on_failure_message }}'
