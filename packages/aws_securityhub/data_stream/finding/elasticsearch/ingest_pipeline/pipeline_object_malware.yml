---
description: Pipeline for processing Malware object.
# Malware object docs: https://schema.ocsf.io/1.5.0/objects/malware
processors:
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        convert:
          field: _ingest._value.classification_ids
          tag: convert_malware_classification_ids_to_string
          type: string
          ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.cves
          ignore_missing: true
          processor:
            date:
              field: _ingest._value.created_time_dt
              tag: date_malware_cves_created_time_dt
              target_field: _ingest._value.created_time_dt
              formats:
                - ISO8601
                - UNIX_MS
                - yyyy-MM-dd HH:mm:ss[.SSSSSSSSS][.SSSSSSSS][.SSSSSSS][.SSSSSS][.SSSSS][.SSSS][.SSS][.SS][.S]X
              on_failure:
                - remove:
                    field: _ingest._value.created_time_dt
                    ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.cves
          ignore_missing: true
          processor:
            date:
              field: _ingest._value.created_time
              tag: date_malware_cves_created_time
              target_field: _ingest._value.created_time
              formats:
                - UNIX_MS
              on_failure:
                - remove:
                    field: _ingest._value.created_time
                    ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.cves
          ignore_missing: true
          processor:
            foreach:
              field: _ingest._value.cvss
              ignore_missing: true
              processor:
                convert:
                  field: _ingest._value.base_score
                  tag: convert_malware_cves_cvss_base_score_to_float
                  type: float
                  ignore_missing: true
                  on_failure:
                    - remove:
                        field: _ingest._value.base_score
                    - append:
                        field: error.message
                        value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.cves
          ignore_missing: true
          processor:
            foreach:
              field: _ingest._value.cvss
              ignore_missing: true
              processor:
                convert:
                  field: _ingest._value.overall_score
                  tag: convert_malware_cves_cvss_overall_score_to_float
                  type: float
                  ignore_missing: true
                  on_failure:
                    - remove:
                        field: _ingest._value.overall_score
                    - append:
                        field: error.message
                        value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.cves
          ignore_missing: true
          processor:
            date:
              field: _ingest._value.modified_time_dt
              tag: date_malware_cves_modified_time_dt
              target_field: _ingest._value.modified_time_dt
              formats:
                - ISO8601
                - UNIX_MS
                - yyyy-MM-dd HH:mm:ss[.SSSSSSSSS][.SSSSSSSS][.SSSSSSS][.SSSSSS][.SSSSS][.SSSS][.SSS][.SS][.S]X
              on_failure:
                - remove:
                    field: _ingest._value.modified_time_dt
                    ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.cves
          ignore_missing: true
          processor:
            date:
              field: _ingest._value.modified_time
              tag: date_malware_cves_modified_time
              target_field: _ingest._value.modified_time
              formats:
                - UNIX_MS
              on_failure:
                - remove:
                    field: _ingest._value.modified_time
                    ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            date:
              field: _ingest._value.accessed_time_dt
              tag: date_malware_files_accessed_time_dt
              target_field: _ingest._value.accessed_time_dt
              formats:
                - ISO8601
                - UNIX_MS
                - yyyy-MM-dd HH:mm:ss[.SSSSSSSSS][.SSSSSSSS][.SSSSSSS][.SSSSSS][.SSSSS][.SSSS][.SSS][.SS][.S]X
              on_failure:
                - remove:
                    field: _ingest._value.accessed_time_dt
                    ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            date:
              field: _ingest._value.accessed_time
              tag: date_malware_files_accessed_time
              target_field: _ingest._value.accessed_time
              formats:
                - UNIX_MS
              on_failure:
                - remove:
                    field: _ingest._value.accessed_time
                    ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            convert:
              field: _ingest._value.attributes
              tag: convert_malware_files_attributes_to_long
              type: long
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.attributes
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            convert:
              field: _ingest._value.confidentiality_id
              tag: convert_malware_files_confidentiality_id_to_string
              type: string
              ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            date:
              field: _ingest._value.created_time_dt
              tag: date_malware_files_created_time_dt
              target_field: _ingest._value.created_time_dt
              formats:
                - ISO8601
                - UNIX_MS
                - yyyy-MM-dd HH:mm:ss[.SSSSSSSSS][.SSSSSSSS][.SSSSSSS][.SSSSSS][.SSSSS][.SSSS][.SSS][.SS][.S]X
              on_failure:
                - remove:
                    field: _ingest._value.created_time_dt
                    ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            date:
              field: _ingest._value.created_time
              tag: date_malware_files_created_time
              target_field: _ingest._value.created_time
              formats:
                - UNIX_MS
              on_failure:
                - remove:
                    field: _ingest._value.created_time
                    ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            convert:
              field: _ingest._value.drive_type_id
              tag: convert_malware_files_drive_type_id_to_string
              type: string
              ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            convert:
              field: _ingest._value.is_deleted
              tag: convert_malware_files_is_deleted_to_boolean
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.is_deleted
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            convert:
              field: _ingest._value.is_encrypted
              tag: convert_malware_files_is_encrypted_to_boolean
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.is_encrypted
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            convert:
              field: _ingest._value.is_system
              tag: convert_malware_files_is_system_to_boolean
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.is_system
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            date:
              field: _ingest._value.modified_time_dt
              tag: date_malware_files_modified_time_dt
              target_field: _ingest._value.modified_time_dt
              formats:
                - ISO8601
                - UNIX_MS
                - yyyy-MM-dd HH:mm:ss[.SSSSSSSSS][.SSSSSSSS][.SSSSSSS][.SSSSSS][.SSSSS][.SSSS][.SSS][.SS][.S]X
              on_failure:
                - remove:
                    field: _ingest._value.modified_time_dt
                    ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            date:
              field: _ingest._value.modified_time
              tag: date_malware_files_modified_time
              target_field: _ingest._value.modified_time
              formats:
                - UNIX_MS
              on_failure:
                - remove:
                    field: _ingest._value.modified_time
                    ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            convert:
              field: _ingest._value.size
              tag: convert_malware_files_size_to_long
              type: long
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.size
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        foreach:
          field: _ingest._value.files
          ignore_missing: true
          processor:
            convert:
              field: _ingest._value.type_id
              tag: convert_malware_files_type_id_to_string
              type: string
              ignore_missing: true
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        convert:
          field: _ingest._value.num_infected
          tag: convert_malware_num_infected_to_long
          type: long
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.num_infected
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: aws_securityhub.finding.malware
      if: ctx.aws_securityhub?.finding?.malware instanceof List
      processor:
        convert:
          field: _ingest._value.severity_id
          tag: convert_malware_severity_id_to_string
          type: string
          ignore_missing: true
on_failure:
  - append:
      field: error.message
      value: |-
        Processor '{{{ _ingest.on_failure_processor_type }}}'
        {{{#_ingest.on_failure_processor_tag}}}with tag '{{{ _ingest.on_failure_processor_tag }}}'
        {{{/_ingest.on_failure_processor_tag}}}failed with message '{{{ _ingest.on_failure_message }}}'
  - set:
      field: event.kind
      tag: set_pipeline_error_to_event_kind
      value: pipeline_error
  - append:
      field: tags
      value: preserve_original_event
      allow_duplicates: false
