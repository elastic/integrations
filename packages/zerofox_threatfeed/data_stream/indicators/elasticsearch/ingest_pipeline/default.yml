---
description: Pipeline for parsing zerofox alerts
processors:
  - set:
      field: event.ingested
      value: '{{_ingest.timestamp}}'
  - set:
      field: ecs.version
      value: "1.9.0"
  - set:
      field: event.original
      copy_from: message
  - json:
      field: message
      target_field: json
  - rename:
      field: json.id
      target_field: threatfeed.id
      ignore_missing: true
      ignore_failure: true
  - convert:
      field: threatfeed.id
      target_field: threatfeed.id
      type: string
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.indicator_type
      target_field: threatfeed.indicator_type
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.value
      target_field: threatfeed.value
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.network
      target_field: threatfeed.network
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.classifications
      target_field: threatfeed.classifications
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.classifications.id
      target_field: threatfeed.classifications.id
      ignore_missing: true
      ignore_failure: true
  - convert:
      field: threatfeed.classifications.id
      target_field: threatfeed.classifications.id
      type: string
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.classifications.name
      target_field: threatfeed.classifications.name
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.classifications.privacy_level
      target_field: threatfeed.classifications.privacy_level
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.classifications.created_at
      target_field: threatfeed.classifications.created_at
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.classifications.updated_at
      target_field: threatfeed.classifications.updated_at
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.campaigns
      target_field: threatfeed.campaigns
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.privacy_level
      target_field: threatfeed.privacy_level
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.created_at
      target_field: threatfeed.created_at
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.updated_at
      target_field: threatfeed.updated_at
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.threat_level
      target_field: threatfeed.threat_level
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.expired
      target_field: threatfeed.expired
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: json.ttl
      target_field: threatfeed.ttl
      ignore_missing: true
      ignore_failure: true

 ## Cleanup.
  - remove:
      field:
        - message
        - threatfeed.campaigns
      ignore_missing: true
      ignore_failure: true

on_failure:
  - set:
      field: error.message
      value: "{{ _ingest.on_failure_message }}"

