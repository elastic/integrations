version: '3.0'
services:
  coredns:
    hostname: coredns
    build: .
    ports:
      - 53/udp
    volumes:
      - ./files:/config:ro
      - ${SERVICE_LOGS_DIR}:/service_logs
    entrypoint: /bin/sh
    command:
      - -ec
      - >
        /coredns -conf /config/Corefile 2>&1 | tee /service_logs/coredns.log

  coredns-dig:
    image: wbitt/network-multitool
    command: sh -c "sleep 5s && dig @coredns google.com && dig @coredns bob.example.com && dig @coredns asdf.example.com"
    depends_on:
      - coredns
