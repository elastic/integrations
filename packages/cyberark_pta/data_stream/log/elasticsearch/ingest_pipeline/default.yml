---
description: Pipeline for CyberArk PTA

processors:
  - set:
      field: ecs.version
      value: '8.3.0'
  - append:
      field: event.action
      value: "{{cef.extensions.deviceCustomString5}}"
      allow_duplicates: false
      if: "ctx?.cef?.extensions?.deviceCustomString5 != null && ctx?.cef?.extensions?.deviceCustomString5 != ''"
  - append:
      field: event.created
      value: "{{cef.extensions.deviceCustomDate1}}"
      allow_duplicates: false
      if: "ctx?.cef?.extensions?.deviceCustomDate1 != null && ctx?.cef?.extensions?.deviceCustomDate1 != ''"
  - append:
      field: event.id
      value: "{{cef.extensions.deviceCustomString2}}"
      allow_duplicates: false
      if: "ctx?.cef?.extensions?.deviceCustomString2 != null && ctx?.cef?.extensions?.deviceCustomString2 != ''"
  - append:
      field: event.reference
      value: "{{cef.extensions.deviceCustomString3}}"
      allow_duplicates: false
      if: "ctx?.cef?.extensions?.deviceCustomString3 != null && ctx?.cef?.extensions?.deviceCustomString3 != ''"
  - append:
      field: event.url
      value: "{{cef.extensions.deviceCustomString4}}"
      allow_duplicates: false
      if: "ctx?.cef?.extensions?.deviceCustomString4 != null && ctx?.cef?.extensions?.deviceCustomString4 != ''"

on_failure:
  - remove:
      field: _tmp
      ignore_failure: true
  - append:
      field: error.message
      value: "{{ _ingest.on_failure_message }}"
  - set:
      field: event.kind
      value: pipeline_error
