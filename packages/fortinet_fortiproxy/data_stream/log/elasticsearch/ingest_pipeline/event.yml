---
description: Pipeline for processing event logs from Fortinet Fortiproxy.
processors:
# ------------------------------------------------------------------------------
# Convert fields.
  - convert:
      tag: convert_advpnsc
      field: _fields_.advpnsc
      type: long
      ignore_missing: true
  - convert:
      tag: convert_assigned
      field: _fields_.assigned
      type: ip
      ignore_missing: true
  - convert:
      tag: convert_assignip
      field: _fields_.assignip
      type: ip
      ignore_missing: true
  - convert:
      tag: convert_audittime
      field: _fields_.audittime
      type: long
      ignore_missing: true
  - convert:
      tag: convert_category
      field: _fields_.category
      type: long
      ignore_missing: true
  - convert:
      tag: convert_core
      field: _fields_.core
      type: long
      ignore_missing: true
  - convert:
      tag: convert_cpu
      field: _fields_.cpu
      type: long
      ignore_missing: true
  - convert:
      tag: convert_criticalcount
      field: _fields_.criticalcount
      type: long
      ignore_missing: true
  - convert:
      tag: convert_ddnsserver
      field: _fields_.ddnsserver
      type: ip
      ignore_missing: true
  - convert:
      tag: convert_disk
      field: _fields_.disk
      type: long
      ignore_missing: true
  - convert:
      tag: convert_disklograte
      field: _fields_.disklograte
      type: long
      ignore_missing: true
  - convert:
      tag: convert_domainctrlauthstate
      field: _fields_.domainctrlauthstate
      type: long
      ignore_missing: true
  - convert:
      tag: convert_domainctrlauthtype
      field: _fields_.domainctrlauthtype
      type: long
      ignore_missing: true
  - convert:
      tag: convert_domainctrlip
      field: _fields_.domainctrlip
      type: ip
      ignore_missing: true
  - convert:
      tag: convert_domainctrlprotocoltype
      field: _fields_.domainctrlprotocoltype
      type: long
      ignore_missing: true
  - convert:
      tag: convert_fams_pause
      field: _fields_.fams_pause
      type: long
      ignore_missing: true
  - convert:
      tag: convert_fazlograte
      field: _fields_.fazlograte
      type: long
      ignore_missing: true
  - convert:
      tag: convert_freediskstorage
      field: _fields_.freediskstorage
      type: long
      ignore_missing: true
  - convert:
      tag: convert_from_vcluster
      field: _fields_.from_vcluster
      type: long
      ignore_missing: true
  - convert:
      tag: convert_gateway
      field: _fields_.gateway
      type: ip
      ignore_missing: true
  - convert:
      tag: convert_ha-prio
      field: _fields_.ha-prio
      type: long
      ignore_missing: true
  - convert:
      tag: convert_ha_group
      field: _fields_.ha_group
      type: long
      ignore_missing: true
  - convert:
      tag: convert_highcount
      field: _fields_.highcount
      type: long
      ignore_missing: true
  - convert:
      tag: convert_httpcode
      field: _fields_.httpcode
      type: long
      ignore_missing: true
  - convert:
      tag: convert_ip
      field: _fields_.ip
      type: ip
      ignore_missing: true
  - convert:
      tag: convert_lease
      field: _fields_.lease
      type: long
      ignore_missing: true
  - convert:
      tag: convert_limit
      field: _fields_.limit
      type: long
      ignore_missing: true
  - convert:
      tag: convert_local
      field: _fields_.local
      type: ip
      ignore_missing: true
  - convert:
      tag: convert_localdevcount
      field: _fields_.localdevcount
      type: long
      ignore_missing: true
  - convert:
      tag: convert_locip
      field: _fields_.locip
      type: ip
      ignore_missing: true
  - convert:
      tag: convert_locport
      field: _fields_.locport
      type: long
      ignore_missing: true
  - convert:
      tag: convert_lowcount
      field: _fields_.lowcount
      type: long
      ignore_missing: true
  - convert:
      tag: convert_mediumcount
      field: _fields_.mediumcount
      type: long
      ignore_missing: true
  - convert:
      tag: convert_mem
      field: _fields_.mem
      type: long
      ignore_missing: true
  - convert:
      tag: convert_mtu
      field: _fields_.mtu
      type: long
      ignore_missing: true
  - convert:
      tag: convert_newchannel
      field: _fields_.newchannel
      type: long
      ignore_missing: true
  - convert:
      tag: convert_newslot
      field: _fields_.newslot
      type: long
      ignore_missing: true
  - convert:
      tag: convert_nextstat
      field: _fields_.nextstat
      type: long
      ignore_missing: true
  - convert:
      tag: convert_oldchannel
      field: _fields_.oldchannel
      type: long
      ignore_missing: true
  - convert:
      tag: convert_oldslot
      field: _fields_.oldslot
      type: long
      ignore_missing: true
  - convert:
      tag: convert_passedcount
      field: _fields_.passedcount
      type: long
      ignore_missing: true
  - convert:
      tag: convert_pid
      field: _fields_.pid
      type: long
      ignore_missing: true
  - convert:
      tag: convert_port
      field: _fields_.port
      type: long
      ignore_missing: true
  - convert:
      tag: convert_processtime
      field: _fields_.processtime
      type: long
      ignore_missing: true
  - convert:
      tag: convert_remip
      field: _fields_.remip
      type: ip
      ignore_missing: true
  - convert:
      tag: convert_remote
      field: _fields_.remote
      type: ip
      ignore_missing: true
  - convert:
      tag: convert_remport
      field: _fields_.remport
      type: long
      ignore_missing: true
  - convert:
      tag: convert_scantime
      field: _fields_.scantime
      type: long
      ignore_missing: true
  - convert:
      tag: convert_serial
      field: _fields_.serial
      type: long
      ignore_missing: true
  - convert:
      tag: convert_setuprate
      field: _fields_.setuprate
      type: long
      ignore_missing: true
  - convert:
      tag: convert_slot
      field: _fields_.slot
      type: long
      ignore_missing: true
  - convert:
      tag: convert_stage
      field: _fields_.stage
      type: long
      ignore_missing: true
  - convert:
      tag: convert_sysuptime
      field: _fields_.sysuptime
      type: long
      ignore_missing: true
  - convert:
      tag: convert_to_vcluster
      field: _fields_.to_vcluster
      type: long
      ignore_missing: true
  - convert:
      tag: convert_total
      field: _fields_.total
      type: long
      ignore_missing: true
  - convert:
      tag: convert_totalsession
      field: _fields_.totalsession
      type: long
      ignore_missing: true
  - convert:
      tag: convert_tunnelip
      field: _fields_.tunnelip
      type: ip
      ignore_missing: true
  - convert:
      tag: convert_unit
      field: _fields_.unit
      type: long
      ignore_missing: true
  - convert:
      tag: convert_used
      field: _fields_.used
      type: long
      ignore_missing: true
  - convert:
      tag: convert_used_for_type
      field: _fields_.used_for_type
      type: long
      ignore_missing: true
  - convert:
      tag: convert_vcluster
      field: _fields_.vcluster
      type: long
      ignore_missing: true
  - convert:
      tag: convert_vcluster_member
      field: _fields_.vcluster_member
      type: long
      ignore_missing: true
  - convert:
      tag: convert_wscode
      field: _fields_.wscode
      type: long
      ignore_missing: true

# ------------------------------------------------------------------------------
# Move fields to ECS.
  - rename:
      tag: rename_dst_int
      field: _fields_.dst_int
      target_field: observer.egress.interface.name
      ignore_missing: true
  - rename:
      tag: rename_logdesc
      field: _fields_.logdesc
      target_field: rule.description
      ignore_missing: true
  - rename:
      tag: rename_reason
      field: _fields_.reason
      target_field: event.reason
      ignore_missing: true
  - rename:
      tag: rename_src_int
      field: _fields_.src_int
      target_field: observer.ingress.interface.name
      ignore_missing: true

on_failure:
  - append:
      field: error.message
      value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - set:
      field: event.kind
      value: pipeline_error
