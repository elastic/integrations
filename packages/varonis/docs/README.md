# Varonis integration

[Varonis](https://www.varonis.com/) is a data security platform that helps organizations protect their sensitive data from insider threats and cyberattacks. This integration collects and analyzes security alerts from Varonis, enabling real-time threat monitoring, compliance reporting, and incident response.

## Data Streams

- **`logs`**: Provides alert data from Varonis syslog. This data stream includes information about alerts generated by Varonis, such as the alert type, severity, file permission changes, and more.

## Requirements

### Configure Varonis DatAlert for Syslog forwarding:

Users can configure the syslog server address in DatAlert so that alerts can be sent to elasticsearch integration. 
   - Login to the Varonis UI using admin credentials.
   - In Data Advantage, select `Tools > DatAlert > Select DatAlert`.
   - From the left menu, select `Configuration`.
   - In syslog message forwarding, do the following:
     - **Syslog server IP address**: Enter the IP address of the machine where the Elasticsearch integration agent is running.
     - **Port**: Enter the UDP port on which this integration will be configured (e.g., 9035).
   - Click `Apply`.

### Create Alert Template in Varonis DatAlert:

1. In DatAlert, select `Alert Templates`.
2. Click the Green Plus sign to add a new alert template.
3. **Template name**: Select `External system default template (CEF)`.
4. **Apply to alert methods**: Select `Syslog message`.
5. Click `OK`.

This integration expects to use `External system default template (CEF)` for alert forwarding in Varonis DatAlert tool. In case any custom template is used, all the fields in `External system default template (CEF)` should also be present in custom template along with the other additional fields. Additional fields will be part of `varonis.logs` object and such fields will be indexed only if dynamic mapping is enabled in Elasticsearch.

## Logs reference

### varonis.logs

Logs documents can be found by setting the following filter: 
`event.dataset : "varonis.logs"`

An example event for `logs` looks as following:

```json
{
    "@timestamp": "2024-11-22T16:19:09.000Z",
    "agent": {
        "ephemeral_id": "795c9691-25d9-48db-937d-d472191327da",
        "id": "2f1c27af-7c5f-4b98-ba2f-c7e7f9879f04",
        "name": "elastic-agent-38341",
        "type": "filebeat",
        "version": "8.15.3"
    },
    "data_stream": {
        "dataset": "varonis.logs",
        "namespace": "97194",
        "type": "logs"
    },
    "destination": {
        "domain": "10.100.20.12",
        "user": {
            "group": {
                "name": "Everyone"
            },
            "name": "zta.local\\\\Dani Lulli (ADMIN)"
        }
    },
    "ecs": {
        "version": "8.11.0"
    },
    "elastic_agent": {
        "id": "2f1c27af-7c5f-4b98-ba2f-c7e7f9879f04",
        "snapshot": false,
        "version": "8.15.3"
    },
    "event": {
        "action": "Folder permissions added",
        "agent_id_status": "verified",
        "category": [
            "configuration"
        ],
        "code": "6000",
        "dataset": "varonis.logs",
        "end": "2024-11-22T16:19:05.000Z",
        "ingested": "2025-03-26T07:29:42Z",
        "kind": "event",
        "module": "varonis",
        "outcome": "success",
        "severity": 3,
        "severity_label": "error",
        "type": [
            "info"
        ]
    },
    "file": {
        "group": "Read & Execute",
        "name": "Finance",
        "path": "E:\\\\Share\\\\Share\\\\Finance"
    },
    "host": {
        "architecture": "x86_64",
        "containerized": true,
        "hostname": "elastic-agent-38341",
        "id": "328e5cd3dfd442488a3dd49bf596f391",
        "ip": [
            "172.20.0.2",
            "172.19.0.7"
        ],
        "mac": [
            "02-42-AC-13-00-07",
            "02-42-AC-14-00-02"
        ],
        "name": "elastic-agent-38341",
        "os": {
            "codename": "focal",
            "family": "debian",
            "kernel": "5.15.167.4-microsoft-standard-WSL2",
            "name": "Ubuntu",
            "platform": "ubuntu",
            "type": "linux",
            "version": "20.04.6 LTS (Focal Fossa)"
        }
    },
    "input": {
        "type": "udp"
    },
    "message": "Read & Execute permissions for This folder, subfolders and files (not inherited) was added to  Everyone on E:\\\\Share\\\\Share\\\\Finance",
    "observer": {
        "product": "DatAdvantage",
        "vendor": "Varonis Inc.",
        "version": "8.6.51"
    },
    "varonis": {
        "logs": {
            "changed_permissions": "Read & Execute",
            "device_event_category": "Alert",
            "device_receipt_time": "2024-11-22T16:19:09.000Z",
            "old_file_permission": "None",
            "rule_id": 132,
            "rule_name": "Permissions granted to Global Access Groups"
        }
    }
}
```

    
**ECS Field Reference**

Please refer to the following [document](https://www.elastic.co/guide/en/ecs/current/ecs-field-reference.html) for detailed information on ECS fields.

The following non-ECS fields are used in events documents:

**Exported fields**

| Field | Description | Type |
|---|---|---|
| @timestamp | Event timestamp. | date |
| data_stream.dataset | Data stream dataset. | constant_keyword |
| data_stream.namespace | Data stream namespace. | constant_keyword |
| data_stream.type | Data stream type. | constant_keyword |
| event.dataset |  | constant_keyword |
| event.module |  | constant_keyword |
| event.severity_label |  | keyword |
| input.type | Input type | keyword |
| varonis.logs.attachment_name | The name of the attachment involved in the event. | keyword |
| varonis.logs.changed_permissions | The permissions that were changed. | keyword |
| varonis.logs.client_access_type | The type of client access involved in the event. | keyword |
| varonis.logs.device_event_category | The category of the device event. | keyword |
| varonis.logs.device_receipt_time | The time the device received the event. |  |
| varonis.logs.event_category | The category of the event. | keyword |
| varonis.logs.mail_recipient | The mail recipient involved in the event. | keyword |
| varonis.logs.mailbox_access_type | The type of mailbox access involved in the event. | keyword |
| varonis.logs.old_file_permission | The file permissions before the change. | keyword |
| varonis.logs.rule_id | The ID of the rule that triggered the event. | integer |
| varonis.logs.rule_name | The name of the rule that triggered the event. | keyword |

