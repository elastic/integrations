---
description: Pipeline for processing Encryption logs.
processors:
  - rename:
      field: fortinet_fortimail.log.log_details.session_id
      target_field: fortinet_fortimail.log.session_id
      ignore_missing: true
  - grok:
      field: message
      patterns:
        - '^%{DATA}[U|u]ser %{NOTSPACE:_tmp.user} %{DATA}%{IP:fortinet_fortimail.log.ip}%{GREEDYDATA:_tmp.msg}$'
        - "^%{DATA}[U|u]ser %{NOTSPACE:_tmp.user} %{GREEDYDATA:_tmp.msg},%{SPACE}sent from:%{SPACE}\\'%{DATA:fortinet_fortimail.log.sent_from}\\',%{SPACE}subject:%{SPACE}\\'%{GREEDYDATA:_tmp.subject}\\'%{SPACE}%{GREEDYDATA:_tmp.msg2}$"
        - "^%{DATA}[U|u]ser %{NOTSPACE:_tmp.user} %{GREEDYDATA:_tmp.msg},%{SPACE}sent from:%{SPACE}\\'%{DATA:fortinet_fortimail.log.sent_from}\\',%{SPACE}subject:%{SPACE}\\'%{GREEDYDATA:_tmp.subject}\\'$"
        - '^%{DATA}[U|u]ser %{NOTSPACE:_tmp.user} %{GREEDYDATA:_tmp.msg}$'
      ignore_missing: true
      ignore_failure: true
  - append:
      field: related.ip
      value: '{{{fortinet_fortimail.log.ip}}}'
      allow_duplicates: false
      if: ctx.fortinet_fortimail?.log?.ip != null
  - append:
      field: fortinet_fortimail.log.user
      value: '{{{_tmp.user}}}'
      allow_duplicates: false
      if: ctx._tmp?.user != null
  - append:
      field: user.name
      value: '{{{_tmp.user}}}'
      allow_duplicates: false
      if: ctx._tmp?.user != null
  - append:
      field: related.user
      value: '{{{_tmp.user}}}'
      allow_duplicates: false
      if: ctx._tmp?.user != null
  - append:
      field: related.user
      value: '{{{fortinet_fortimail.log.sent_from}}}'
      allow_duplicates: false
      if: ctx.fortinet_fortimail?.log?.sent_from != null
  - append:
      field: email.from.address
      value: '{{{fortinet_fortimail.log.sent_from}}}'
      allow_duplicates: false
      if: ctx.fortinet_fortimail?.log?.sent_from != null
  - append:
      field: fortinet_fortimail.log.subject
      value: '{{{_tmp.subject}}}'
      allow_duplicates: false
      if: ctx._tmp?.subject != null
  - append:
      field: email.subject
      value: '{{{_tmp.subject}}}'
      allow_duplicates: false
      if: ctx._tmp?.subject != null
