---
description: Pipeline for extracting CVE fields from alert signal.
processors:
  - script:
      lang: painless
      if: ctx.threat?.enrichments != null;
      description: Add rapid7.tc.vulnerability.* field to context from matched CVEs list.
      source: >
        if (ctx.rapid7 == null) {
          ctx.rapid7 = new HashMap();
          ctx.rapid7.tc = new HashMap();
        }
        def objArr = ctx.threat.enrichments;
        if(objArr[0].indicator!=null) {
          ctx.rapid7.tc.vulnerability = objArr[0].indicator
        }
      ignore_failure: true
on_failure:
  - set:
      field: event.kind
      value: pipeline_error
  - append:
      field: error.message
      value: '{{{ _ingest.on_failure_message }}}'
