---
description: Pipeline for parsing google_workspace logs
processors:
  - set:
      field: event.ingested
      value: "{{ _ingest.timestamp }}"
  - set:
      field: ecs.version
      value: '1.10.0'
  - append:
      field: event.category
      value: iam
  - rename:
      field: message
      target_field: event.original
      ignore_missing: true
  - json:
      field: event.original
      target_field: json
      ignore_failure: true
  - date:
      field: json.id.time
      timezone: UTC
      formats:
        - ISO8601
        - yyyy-MM-dd'T'HH:mm:ss
        - yyyy-MM-dd'T'HH:mm:ssZ
        - yyyy-MM-dd'T'HH:mm:ss.SSSZ
        - yyyy/MM/dd HH:mm:ss z
  - rename: 
      field: json.events.name
      target_field: event.action
      ignore_missing: true
  - fingerprint:
      description: Hashes the ID object and uses it as the document id to avoid duplicate events.
      fields:
        - json.id
      target_field: _id
      ignore_missing: true
      ignore_failure: true
  - rename: 
      field: json.id.applicationName
      target_field: event.provider
      ignore_missing: true
  - rename: 
      field: json.id.uniqueQualifier
      target_field: event.id
      ignore_missing: true
  - rename: 
      field: json.actor.email
      target_field: source.user.email
      ignore_missing: true
  - rename: 
      field: json.actor.profileId
      target_field: source.user.id
      ignore_missing: true
  - rename: 
      field: json.ipAddress
      target_field: source.ip
      ignore_missing: true
  - rename: 
      field: json.kind
      target_field: google_workspace.kind
      ignore_missing: true
  - rename: 
      field: json.id.customerId
      target_field: organization.id
      ignore_missing: true
  - rename: 
      field: json.actor.callerType
      target_field: google_workspace.actor.type
      ignore_missing: true
  - rename: 
      field: json.actor.key
      target_field: google_workspace.actor.key
      ignore_missing: true
  - rename: 
      field: json.ownerDomain
      target_field: google_workspace.organization.domain
      ignore_missing: true
  - rename: 
      field: json.events.type
      target_field: google_workspace.event.type
      ignore_missing: true
  - set: 
      field: user.id
      copy_from: source.user.id
      if: ctx?.source?.user?.id != null
  - append: 
      field: event.category
      value: configuration
      if: '["CHANGE_APPLICATION_SETTING","UPDATE_MANAGED_CONFIGURATION","CHANGE_CALENDAR_SETTING","CHANGE_CHAT_SETTING","CHANGE_CHROME_OS_ANDROID_APPLICATION_SETTING","GPLUS_PREMIUM_FEATURES","UPDATE_CALENDAR_RESOURCE_FEATURE","FLASHLIGHT_EDU_NON_FEATURED_SERVICES_SELECTED","MEET_INTEROP_MODIFY_GATEWAY","CHANGE_CHROME_OS_APPLICATION_SETTING","CHANGE_CHROME_OS_DEVICE_SETTING","CHANGE_CHROME_OS_PUBLIC_SESSION_SETTING","CHANGE_CHROME_OS_SETTING","CHANGE_CHROME_OS_USER_SETTING","CHANGE_CONTACTS_SETTING","CHANGE_DOCS_SETTING","CHANGE_SITES_SETTING","CHANGE_EMAIL_SETTING","CHANGE_GMAIL_SETTING","ALLOW_STRONG_AUTHENTICATION","ALLOW_SERVICE_FOR_OAUTH2_ACCESS","DISALLOW_SERVICE_FOR_OAUTH2_ACCESS","CHANGE_APP_ACCESS_SETTINGS_COLLECTION_ID","CHANGE_TWO_STEP_VERIFICATION_ENROLLMENT_PERIOD_DURATION","CHANGE_TWO_STEP_VERIFICATION_FREQUENCY","CHANGE_TWO_STEP_VERIFICATION_GRACE_PERIOD_DURATION","CHANGE_TWO_STEP_VERIFICATION_START_DATE","CHANGE_ALLOWED_TWO_STEP_VERIFICATION_METHODS","CHANGE_SITES_WEB_ADDRESS_MAPPING_UPDATES","ENABLE_NON_ADMIN_USER_PASSWORD_RECOVERY","ENFORCE_STRONG_AUTHENTICATION","UPDATE_ERROR_MSG_FOR_RESTRICTED_OAUTH2_APPS","WEAK_PROGRAMMATIC_LOGIN_SETTINGS_CHANGED","SESSION_CONTROL_SETTINGS_CHANGE","CHANGE_SESSION_LENGTH","TOGGLE_OAUTH_ACCESS_TO_ALL_APIS","TOGGLE_ALLOW_ADMIN_PASSWORD_RESET","ENABLE_API_ACCESS","CHANGE_WHITELIST_SETTING","COMMUNICATION_PREFERENCES_SETTING_CHANGE","ENABLE_FEEDBACK_SOLICITATION","TOGGLE_CONTACT_SHARING","TOGGLE_USE_CUSTOM_LOGO","CHANGE_DATA_LOCALIZATION_SETTING","TOGGLE_ENABLE_OAUTH_CONSUMER_KEY","TOGGLE_SSO_ENABLED","TOGGLE_SSL","TOGGLE_NEW_APP_FEATURES","TOGGLE_USE_NEXT_GEN_CONTROL_PANEL","TOGGLE_OPEN_ID_ENABLED","TOGGLE_OUTBOUND_RELAY","CHANGE_SSO_SETTINGS","ENABLE_SERVICE_OR_FEATURE_NOTIFICATIONS","CHANGE_MOBILE_APPLICATION_SETTINGS","CHANGE_MOBILE_SETTING","DELETE_APPLICATION_SETTING","DELETE_GMAIL_SETTING"].contains(ctx?.event?.action)'
  - append: 
      field: event.type
      value: change
      if: '["CHANGE_APPLICATION_SETTING","UPDATE_MANAGED_CONFIGURATION","CHANGE_CALENDAR_SETTING","CHANGE_CHAT_SETTING","CHANGE_CHROME_OS_ANDROID_APPLICATION_SETTING","GPLUS_PREMIUM_FEATURES","UPDATE_CALENDAR_RESOURCE_FEATURE","FLASHLIGHT_EDU_NON_FEATURED_SERVICES_SELECTED","MEET_INTEROP_MODIFY_GATEWAY","CHANGE_CHROME_OS_APPLICATION_SETTING","CHANGE_CHROME_OS_DEVICE_SETTING","CHANGE_CHROME_OS_PUBLIC_SESSION_SETTING","CHANGE_CHROME_OS_SETTING","CHANGE_CHROME_OS_USER_SETTING","CHANGE_CONTACTS_SETTING","CHANGE_DOCS_SETTING","CHANGE_SITES_SETTING","CHANGE_EMAIL_SETTING","CHANGE_GMAIL_SETTING","ALLOW_STRONG_AUTHENTICATION","ALLOW_SERVICE_FOR_OAUTH2_ACCESS","DISALLOW_SERVICE_FOR_OAUTH2_ACCESS","CHANGE_APP_ACCESS_SETTINGS_COLLECTION_ID","CHANGE_TWO_STEP_VERIFICATION_ENROLLMENT_PERIOD_DURATION","CHANGE_TWO_STEP_VERIFICATION_FREQUENCY","CHANGE_TWO_STEP_VERIFICATION_GRACE_PERIOD_DURATION","CHANGE_TWO_STEP_VERIFICATION_START_DATE","CHANGE_ALLOWED_TWO_STEP_VERIFICATION_METHODS","CHANGE_SITES_WEB_ADDRESS_MAPPING_UPDATES","ENABLE_NON_ADMIN_USER_PASSWORD_RECOVERY","ENFORCE_STRONG_AUTHENTICATION","UPDATE_ERROR_MSG_FOR_RESTRICTED_OAUTH2_APPS","WEAK_PROGRAMMATIC_LOGIN_SETTINGS_CHANGED","SESSION_CONTROL_SETTINGS_CHANGE","CHANGE_SESSION_LENGTH","TOGGLE_OAUTH_ACCESS_TO_ALL_APIS","TOGGLE_ALLOW_ADMIN_PASSWORD_RESET","ENABLE_API_ACCESS","CHANGE_WHITELIST_SETTING","COMMUNICATION_PREFERENCES_SETTING_CHANGE","ENABLE_FEEDBACK_SOLICITATION","TOGGLE_CONTACT_SHARING","TOGGLE_USE_CUSTOM_LOGO","CHANGE_DATA_LOCALIZATION_SETTING","TOGGLE_ENABLE_OAUTH_CONSUMER_KEY","TOGGLE_SSO_ENABLED","TOGGLE_SSL","TOGGLE_NEW_APP_FEATURES","TOGGLE_USE_NEXT_GEN_CONTROL_PANEL","TOGGLE_OPEN_ID_ENABLED","TOGGLE_OUTBOUND_RELAY","CHANGE_SSO_SETTINGS","ENABLE_SERVICE_OR_FEATURE_NOTIFICATIONS","CHANGE_MOBILE_APPLICATION_SETTINGS","CHANGE_MOBILE_SETTING","UPDATE_BUILDING","RENAME_CALENDAR_RESOURCE","UPDATE_CALENDAR_RESOURCE","CANCEL_CALENDAR_EVENTS","RELEASE_CALENDAR_RESOURCES","CHANGE_DEVICE_STATE","CHANGE_CHROME_OS_DEVICE_ANNOTATION","CHANGE_CHROME_OS_DEVICE_STATE","UPDATE_CHROME_OS_PRINT_SERVER","UPDATE_CHROME_OS_PRINTER","MOVE_DEVICE_TO_ORG_UNIT_DETAILED","UPDATE_DEVICE","SEND_CHROME_OS_DEVICE_COMMAND","ASSIGN_ROLE","ADD_PRIVILEGE","REMOVE_PRIVILEGE","RENAME_ROLE","UPDATE_ROLE","UNASSIGN_ROLE","TRANSFER_DOCUMENT_OWNERSHIP","ORG_USERS_LICENSE_ASSIGNMENT","ORG_ALL_USERS_LICENSE_ASSIGNMENT","USER_LICENSE_ASSIGNMENT","CHANGE_LICENSE_AUTO_ASSIGN","USER_LICENSE_REASSIGNMENT","ORG_LICENSE_REVOKE","USER_LICENSE_REVOKE","UPDATE_DYNAMIC_LICENSE","DROP_FROM_QUARANTINE","REJECT_FROM_QUARANTINE","RELEASE_FROM_QUARANTINE","CHROME_LICENSES_ENABLED","CHROME_APPLICATION_LICENSE_RESERVATION_UPDATED","ASSIGN_CUSTOM_LOGO","UNASSIGN_CUSTOM_LOGO","REVOKE_ENROLLMENT_TOKEN","CHROME_LICENSES_ALLOWED","EDIT_ORG_UNIT_DESCRIPTION","MOVE_ORG_UNIT","EDIT_ORG_UNIT_NAME","REVOKE_DEVICE_ENROLLMENT_TOKEN","TOGGLE_SERVICE_ENABLED","ADD_TO_TRUSTED_OAUTH2_APPS","REMOVE_FROM_TRUSTED_OAUTH2_APPS","BLOCK_ON_DEVICE_ACCESS","TOGGLE_CAA_ENABLEMENT","CHANGE_CAA_ERROR_MESSAGE","CHANGE_CAA_APP_ASSIGNMENTS","UNTRUST_DOMAIN_OWNED_OAUTH2_APPS","TRUST_DOMAIN_OWNED_OAUTH2_APPS","UNBLOCK_ON_DEVICE_ACCESS","CHANGE_ACCOUNT_AUTO_RENEWAL","ADD_APPLICATION","ADD_APPLICATION_TO_WHITELIST","CHANGE_ADVERTISEMENT_OPTION","CHANGE_ALERT_CRITERIA","ALERT_RECEIVERS_CHANGED","RENAME_ALERT","ALERT_STATUS_CHANGED","ADD_DOMAIN_ALIAS","REMOVE_DOMAIN_ALIAS","AUTHORIZE_API_CLIENT_ACCESS","REMOVE_API_CLIENT_ACCESS","CHROME_LICENSES_REDEEMED","TOGGLE_AUTO_ADD_NEW_SERVICE","CHANGE_PRIMARY_DOMAIN","CHANGE_CONFLICT_ACCOUNT_ACTION","CHANGE_CUSTOM_LOGO","CHANGE_DATA_LOCALIZATION_FOR_RUSSIA","CHANGE_DATA_PROTECTION_OFFICER_CONTACT_INFO","CHANGE_DOMAIN_DEFAULT_LOCALE","CHANGE_DOMAIN_DEFAULT_TIMEZONE","CHANGE_DOMAIN_NAME","TOGGLE_ENABLE_PRE_RELEASE_FEATURES","CHANGE_DOMAIN_SUPPORT_MESSAGE","ADD_TRUSTED_DOMAINS","REMOVE_TRUSTED_DOMAINS","CHANGE_EDU_TYPE","CHANGE_EU_REPRESENTATIVE_CONTACT_INFO","CHANGE_LOGIN_BACKGROUND_COLOR","CHANGE_LOGIN_BORDER_COLOR","CHANGE_LOGIN_ACTIVITY_TRACE","PLAY_FOR_WORK_ENROLL","PLAY_FOR_WORK_UNENROLL","UPDATE_DOMAIN_PRIMARY_ADMIN_EMAIL","CHANGE_ORGANIZATION_NAME","CHANGE_PASSWORD_MAX_LENGTH","CHANGE_PASSWORD_MIN_LENGTH","REMOVE_APPLICATION","REMOVE_APPLICATION_FROM_WHITELIST","CHANGE_RENEW_DOMAIN_REGISTRATION","CHANGE_RESELLER_ACCESS","RULE_ACTIONS_CHANGED","CHANGE_RULE_CRITERIA","RENAME_RULE","RULE_STATUS_CHANGED","ADD_SECONDARY_DOMAIN","REMOVE_SECONDARY_DOMAIN","UPDATE_DOMAIN_SECONDARY_EMAIL","UPDATE_RULE","ADD_MOBILE_CERTIFICATE","COMPANY_OWNED_DEVICE_BLOCKED","COMPANY_OWNED_DEVICE_UNBLOCKED","COMPANY_OWNED_DEVICE_WIPED","CHANGE_MOBILE_APPLICATION_PERMISSION_GRANT","CHANGE_MOBILE_APPLICATION_PRIORITY_ORDER","REMOVE_MOBILE_APPLICATION_FROM_WHITELIST","ADD_MOBILE_APPLICATION_TO_WHITELIST","CHANGE_ADMIN_RESTRICTIONS_PIN","CHANGE_MOBILE_WIRELESS_NETWORK","ADD_MOBILE_WIRELESS_NETWORK","REMOVE_MOBILE_WIRELESS_NETWORK","CHANGE_MOBILE_WIRELESS_NETWORK_PASSWORD","REMOVE_MOBILE_CERTIFICATE","CREATE_APPLICATION_SETTING","CREATE_GMAIL_SETTING","REORDER_GROUP_BASED_POLICIES_EVENT","CHANGE_GROUP_DESCRIPTION","ADD_GROUP_MEMBER","REMOVE_GROUP_MEMBER","UPDATE_GROUP_MEMBER","UPDATE_GROUP_MEMBER_DELIVERY_SETTINGS","UPDATE_GROUP_MEMBER_DELIVERY_SETTINGS_CAN_EMAIL_OVERRIDE","CHANGE_GROUP_NAME","CHANGE_GROUP_SETTING","GROUP_MEMBER_BULK_UPLOAD","WHITELISTED_GROUPS_UPDATED","REVOKE_3LO_DEVICE_TOKENS","REVOKE_3LO_TOKEN","ADD_RECOVERY_EMAIL","ADD_RECOVERY_PHONE","GRANT_ADMIN_PRIVILEGE","REVOKE_ADMIN_PRIVILEGE","REVOKE_ASP","TOGGLE_AUTOMATIC_CONTACT_SHARING","CANCEL_USER_INVITE","CHANGE_USER_CUSTOM_FIELD","CHANGE_USER_EXTERNAL_ID","CHANGE_USER_GENDER","CHANGE_USER_IM","ENABLE_USER_IP_WHITELIST","CHANGE_USER_KEYWORD","CHANGE_USER_LANGUAGE","CHANGE_USER_LOCATION","CHANGE_USER_ORGANIZATION","CHANGE_USER_PHONE_NUMBER","CHANGE_RECOVERY_EMAIL","CHANGE_RECOVERY_PHONE","CHANGE_USER_RELATION","CHANGE_USER_ADDRESS","GRANT_DELEGATED_ADMIN_PRIVILEGES","CHANGE_FIRST_NAME","GMAIL_RESET_USER","CHANGE_LAST_NAME","MAIL_ROUTING_DESTINATION_ADDED","MAIL_ROUTING_DESTINATION_REMOVED","ADD_NICKNAME","REMOVE_NICKNAME","CHANGE_PASSWORD","CHANGE_PASSWORD_ON_NEXT_LOGIN","REMOVE_RECOVERY_EMAIL","REMOVE_RECOVERY_PHONE","RESET_SIGNIN_COOKIES","SECURITY_KEY_REGISTERED_FOR_USER","REVOKE_SECURITY_KEY","TURN_OFF_2_STEP_VERIFICATION","UNBLOCK_USER_SESSION","UNENROLL_USER_FROM_TITANIUM","ARCHIVE_USER","UPDATE_BIRTHDATE","DOWNGRADE_USER_FROM_GPLUS","USER_ENROLLED_IN_TWO_STEP_VERIFICATION","MOVE_USER_TO_ORG_UNIT","USER_PUT_IN_TWO_STEP_VERIFICATION_GRACE_PERIOD","RENAME_USER","UNENROLL_USER_FROM_STRONG_AUTH","SUSPEND_USER","UNARCHIVE_USER","UNSUSPEND_USER","UPGRADE_USER_TO_GPLUS","MOBILE_DEVICE_APPROVE","MOBILE_DEVICE_BLOCK","MOBILE_DEVICE_WIPE","MOBILE_ACCOUNT_WIPE","MOBILE_DEVICE_CANCEL_WIPE_THEN_APPROVE","MOBILE_DEVICE_CANCEL_WIPE_THEN_BLOCK"].contains(ctx?.event?.action)'
  - append: 
      field: event.type
      value: user
      if: '["REVOKE_3LO_DEVICE_TOKENS","REVOKE_3LO_TOKEN","ADD_RECOVERY_EMAIL","ADD_RECOVERY_PHONE","GRANT_ADMIN_PRIVILEGE","REVOKE_ADMIN_PRIVILEGE","REVOKE_ASP","TOGGLE_AUTOMATIC_CONTACT_SHARING","CANCEL_USER_INVITE","CHANGE_USER_CUSTOM_FIELD","CHANGE_USER_EXTERNAL_ID","CHANGE_USER_GENDER","CHANGE_USER_IM","ENABLE_USER_IP_WHITELIST","CHANGE_USER_KEYWORD","CHANGE_USER_LANGUAGE","CHANGE_USER_LOCATION","CHANGE_USER_ORGANIZATION","CHANGE_USER_PHONE_NUMBER","CHANGE_RECOVERY_EMAIL","CHANGE_RECOVERY_PHONE","CHANGE_USER_RELATION","CHANGE_USER_ADDRESS","GRANT_DELEGATED_ADMIN_PRIVILEGES","CHANGE_FIRST_NAME","GMAIL_RESET_USER","CHANGE_LAST_NAME","MAIL_ROUTING_DESTINATION_ADDED","MAIL_ROUTING_DESTINATION_REMOVED","ADD_NICKNAME","REMOVE_NICKNAME","CHANGE_PASSWORD","CHANGE_PASSWORD_ON_NEXT_LOGIN","REMOVE_RECOVERY_EMAIL","REMOVE_RECOVERY_PHONE","RESET_SIGNIN_COOKIES","SECURITY_KEY_REGISTERED_FOR_USER","REVOKE_SECURITY_KEY","TURN_OFF_2_STEP_VERIFICATION","UNBLOCK_USER_SESSION","UNENROLL_USER_FROM_TITANIUM","ARCHIVE_USER","UPDATE_BIRTHDATE","DOWNGRADE_USER_FROM_GPLUS","USER_ENROLLED_IN_TWO_STEP_VERIFICATION","MOVE_USER_TO_ORG_UNIT","USER_PUT_IN_TWO_STEP_VERIFICATION_GRACE_PERIOD","RENAME_USER","UNENROLL_USER_FROM_STRONG_AUTH","SUSPEND_USER","UNARCHIVE_USER","UNSUSPEND_USER","UPGRADE_USER_TO_GPLUS","MOBILE_DEVICE_APPROVE","MOBILE_DEVICE_BLOCK","MOBILE_DEVICE_WIPE","MOBILE_ACCOUNT_WIPE","MOBILE_DEVICE_CANCEL_WIPE_THEN_APPROVE","MOBILE_DEVICE_CANCEL_WIPE_THEN_BLOCK","DELETE_2SV_SCRATCH_CODES","DELETE_ACCOUNT_INFO_DUMP","DELETE_EMAIL_MONITOR","DELETE_MAILBOX_DUMP","DELETE_USER","MOBILE_DEVICE_DELETE","GENERATE_2SV_SCRATCH_CODES","CREATE_EMAIL_MONITOR","CREATE_DATA_TRANSFER_REQUEST","CREATE_USER","UNDELETE_USER","REQUEST_ACCOUNT_INFO","REQUEST_MAILBOX_DUMP","RESEND_USER_INVITE","BULK_UPLOAD_NOTIFICATION_SENT","USER_INVITE","VIEW_TEMP_PASSWORD","USERS_BULK_UPLOAD_NOTIFICATION_SENT","ACTION_CANCELLED","ACTION_REQUESTED"].contains(ctx?.event?.action)'
  - append: 
      field: event.type
      value: creation
      if: '["CREATE_APPLICATION_SETTING","CREATE_GMAIL_SETTING","CREATE_MANAGED_CONFIGURATION","CREATE_BUILDING","CREATE_CALENDAR_RESOURCE","CREATE_CALENDAR_RESOURCE_FEATURE","MEET_INTEROP_CREATE_GATEWAY","INSERT_CHROME_OS_PRINT_SERVER","INSERT_CHROME_OS_PRINTER","CREATE_ROLE","ADD_WEB_ADDRESS","EMAIL_UNDELETE","CHROME_APPLICATION_LICENSE_RESERVATION_CREATED","CREATE_DEVICE_ENROLLMENT_TOKEN","CREATE_ENROLLMENT_TOKEN","CREATE_ORG_UNIT","CREATE_ALERT","CREATE_PLAY_FOR_WORK_TOKEN","GENERATE_TRANSFER_TOKEN","REGENERATE_OAUTH_CONSUMER_SECRET","CREATE_RULE","GENERATE_PIN","COMPANY_DEVICES_BULK_CREATION","CREATE_GROUP","GENERATE_2SV_SCRATCH_CODES","CREATE_EMAIL_MONITOR","CREATE_DATA_TRANSFER_REQUEST","CREATE_USER","UNDELETE_USER"].contains(ctx?.event?.action)'
  - append: 
      field: event.type
      value: deletion
      if: '["DELETE_APPLICATION_SETTING","DELETE_GMAIL_SETTING","DELETE_MANAGED_CONFIGURATION","DELETE_BUILDING","DELETE_CALENDAR_RESOURCE","DELETE_CALENDAR_RESOURCE_FEATURE","MEET_INTEROP_DELETE_GATEWAY","DELETE_CHROME_OS_PRINT_SERVER","DELETE_CHROME_OS_PRINTER","REMOVE_CHROME_OS_APPLICATION_SETTINGS","DELETE_ROLE","DELETE_WEB_ADDRESS","CHROME_APPLICATION_LICENSE_RESERVATION_DELETED","REMOVE_ORG_UNIT","DELETE_ALERT","DELETE_PLAY_FOR_WORK_TOKEN","DELETE_RULE","COMPANY_DEVICE_DELETION","DELETE_GROUP","DELETE_2SV_SCRATCH_CODES","DELETE_ACCOUNT_INFO_DUMP","DELETE_EMAIL_MONITOR","DELETE_MAILBOX_DUMP","DELETE_USER","MOBILE_DEVICE_DELETE"].contains(ctx?.event?.action)'
  - append: 
      field: event.type
      value: group
      if: '["REORDER_GROUP_BASED_POLICIES_EVENT","CHANGE_GROUP_DESCRIPTION","ADD_GROUP_MEMBER","REMOVE_GROUP_MEMBER","UPDATE_GROUP_MEMBER","UPDATE_GROUP_MEMBER_DELIVERY_SETTINGS","UPDATE_GROUP_MEMBER_DELIVERY_SETTINGS_CAN_EMAIL_OVERRIDE","CHANGE_GROUP_NAME","CHANGE_GROUP_SETTING","GROUP_MEMBER_BULK_UPLOAD","WHITELISTED_GROUPS_UPDATED","GROUP_LIST_DOWNLOAD","GROUP_MEMBERS_DOWNLOAD"].contains(ctx?.event?.action)'
  - append: 
      field: event.type
      value: info
      if: '["ISSUE_DEVICE_COMMAND","DRIVE_DATA_RESTORE","VIEW_SITE_DETAILS","EMAIL_LOG_SEARCH","SKIP_DOMAIN_ALIAS_MX","VERIFY_DOMAIN_ALIAS_MX","VERIFY_DOMAIN_ALIAS","VIEW_DNS_LOGIN_DETAILS","MX_RECORD_VERIFICATION_CLAIM","UPLOAD_OAUTH_CERTIFICATE","SKIP_SECONDARY_DOMAIN_MX","VERIFY_SECONDARY_DOMAIN_MX","VERIFY_SECONDARY_DOMAIN","BULK_UPLOAD","DOWNLOAD_PENDING_INVITES_LIST","DOWNLOAD_USERLIST_CSV","USERS_BULK_UPLOAD","ENROLL_FOR_GOOGLE_DEVICE_MANAGEMENT","USE_GOOGLE_MOBILE_MANAGEMENT","USE_GOOGLE_MOBILE_MANAGEMENT_FOR_NON_IOS","USE_GOOGLE_MOBILE_MANAGEMENT_FOR_IOS","GROUP_LIST_DOWNLOAD","GROUP_MEMBERS_DOWNLOAD","REQUEST_ACCOUNT_INFO","REQUEST_MAILBOX_DUMP","RESEND_USER_INVITE","BULK_UPLOAD_NOTIFICATION_SENT","USER_INVITE","VIEW_TEMP_PASSWORD","USERS_BULK_UPLOAD_NOTIFICATION_SENT","ACTION_CANCELLED","ACTION_REQUESTED"].contains(ctx?.event?.action)'
  - script:
      lang: painless
      if: 'ctx?.json?.events?.parameters != null && ctx?.json?.events?.parameters instanceof List'
      source: >
        if (ctx.google_workspace.admin == null) {
          ctx.google_workspace.admin = new HashMap();
        }
        for (int i = 0; i < ctx.json.events.parameters.length; ++i) {
          if (ctx["json"]["events"]["parameters"][i]["value"] != null) {
            ctx.google_workspace.admin[ctx["json"]["events"]["parameters"][i]["name"]] = ctx["json"]["events"]["parameters"][i]["value"];
            return;
          }
          if (ctx["json"]["events"]["parameters"][i]["intValue"] != null) {
            ctx.google_workspace.admin[ctx["json"]["events"]["parameters"][i]["name"]] = ctx["json"]["events"]["parameters"][i]["intValue"];
            return;
          }
          if (ctx["json"]["events"]["parameters"][i]["multiValue"] != null) {
            ctx.google_workspace.admin[ctx["json"]["events"]["parameters"][i]["name"]] = ctx["json"]["events"]["parameters"][i]["multiValue"];
            return;
          }
        }
  - remove:
      field: json.events.parameters
      ignore_missing: true
  - rename:
      field: google_workspace.admin.APPLICATION_EDITION
      target_field: google_workspace.admin.application.edition
      ignore_missing: true
  - rename:
      field: google_workspace.admin.APPLICATION_NAME
      target_field: google_workspace.admin.application.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.APPLICATION_ENABLED
      target_field: google_workspace.admin.application.enabled
      ignore_missing: true
  - rename:
      field: google_workspace.admin.APP_LICENSES_ORDER_NUMBER
      target_field: google_workspace.admin.application.licences_order_number
      ignore_missing: true
  - rename:
      field: google_workspace.admin.CHROME_NUM_LICENSES_PURCHASED
      target_field: google_workspace.admin.application.licences_purchased
      ignore_missing: true
  - rename:
      field: google_workspace.admin.REAUTH_APPLICATION
      target_field: google_workspace.admin.application.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.GROUP_EMAIL
      target_field: google_workspace.admin.group.email
      ignore_missing: true
  - rename:
      field: google_workspace.admin.GROUP_NAME
      target_field: group.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.NEW_VALUE
      target_field: google_workspace.admin.new_value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.OLD_VALUE
      target_field: google_workspace.admin.old_value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.ORG_UNIT_NAME
      target_field: google_workspace.admin.org_unit.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.SETTING_NAME
      target_field: google_workspace.admin.setting.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.SETTING_DESCRIPTION
      target_field: google_workspace.admin.setting.description
      ignore_missing: true
  - rename:
      field: google_workspace.admin.USER_DEFINED_SETTING_NAME
      target_field: google_workspace.admin.user_defined_setting.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.GROUP_PRIORITIES
      target_field: google_workspace.admin.group.priorities
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DOMAIN_NAME
      target_field: google_workspace.admin.domain.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DOMAIN_ALIAS
      target_field: google_workspace.admin.domain.alias
      ignore_missing: true
  - rename:
      field: google_workspace.admin.SECONDARY_DOMAIN_NAME
      target_field: google_workspace.admin.domain.secondary_name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.MANAGED_CONFIGURATION_NAME
      target_field: google_workspace.admin.managed_configuration
      ignore_missing: true
  - rename:
      field: google_workspace.admin.MOBILE_APP_PACKAGE_ID
      target_field: google_workspace.admin.application.package_id
      ignore_missing: true
  - rename:
      field: google_workspace.admin.FLASHLIGHT_EDU_NON_FEATURED_SERVICES_SELECTION
      target_field: google_workspace.admin.non_featured_services_selection
      ignore_missing: true
  - rename:
      field: google_workspace.admin.FIELD_NAME
      target_field: google_workspace.admin.field
      ignore_missing: true
  - rename:
      field: google_workspace.admin.RESOURCE_IDENTIFIER
      target_field: google_workspace.admin.resource.id
      ignore_missing: true
  - rename:
      field: google_workspace.admin.USER_EMAIL
      target_field: google_workspace.admin.user.email
      ignore_missing: true
  - rename:
      field: google_workspace.admin.GATEWAY_NAME
      target_field: google_workspace.admin.gateway.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.APP_ID
      target_field: google_workspace.admin.application.id
      ignore_missing: true
  - rename:
      field: google_workspace.admin.ASP_ID
      target_field: google_workspace.admin.application.asp_id
      ignore_missing: true
  - rename:
      field: google_workspace.admin.CHROME_OS_SESSION_TYPE
      target_field: google_workspace.admin.chrome_os.session_type
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DEVICE_NEW_STATE
      target_field: google_workspace.admin.new_value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DEVICE_PREVIOUS_STATE
      target_field: google_workspace.admin.old_value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DEVICE_SERIAL_NUMBER
      target_field: google_workspace.admin.device.serial_number
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DEVICE_ID
      target_field: google_workspace.admin.device.id
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DEVICE_TYPE
      target_field: google_workspace.admin.device.type
      ignore_missing: true
  - rename:
      field: google_workspace.admin.PRINT_SERVER_NAME
      target_field: google_workspace.admin.print_server.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.PRINTER_NAME
      target_field: google_workspace.admin.printer.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DEVICE_COMMAND_DETAILS
      target_field: google_workspace.admin.device.command_details
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DEVICE_NEW_ORG_UNIT
      target_field: google_workspace.admin.new_value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DEVICE_PREVIOUS_ORG_UNIT
      target_field: google_workspace.admin.old_value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.ROLE_NAME
      target_field: google_workspace.admin.role.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.ROLE_ID
      target_field: google_workspace.admin.role.id
      ignore_missing: true
  - rename:
      field: google_workspace.admin.PRIVILEGE_NAME
      target_field: google_workspace.admin.privilege.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.SITE_LOCATION
      target_field: url.path
      ignore_missing: true
  - rename:
      field: google_workspace.admin.WEB_ADDRESS
      target_field: url.full
      ignore_missing: true
  - uri_parts:
      field: url.full
      ignore_failure: true
      if: ctx?.url?.full != null
  - rename:
      field: google_workspace.admin.SITE_NAME
      target_field: google_workspace.admin.url.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.SERVICE_NAME
      target_field: google_workspace.admin.service.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.PRODUCT_NAME
      target_field: google_workspace.admin.product.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.SKU_NAME
      target_field: google_workspace.admin.product.sku
      ignore_missing: true
  - rename:
      field: google_workspace.admin.GROUP_MEMBER_BULK_UPLOAD_FAILED_NUMBER
      target_field: google_workspace.admin.bulk_upload.failed
      ignore_missing: true
  - rename:
      field: google_workspace.admin.GROUP_MEMBER_BULK_UPLOAD_TOTAL_NUMBER
      target_field: google_workspace.admin.bulk_upload.total
      ignore_missing: true
  - rename:
      field: google_workspace.admin.BULK_UPLOAD_FAIL_USERS_NUMBER
      target_field: google_workspace.admin.bulk_upload.failed
      ignore_missing: true
  - rename:
      field: google_workspace.admin.BULK_UPLOAD_TOTAL_USERS_NUMBER
      target_field: google_workspace.admin.bulk_upload.total
      ignore_missing: true
  - rename:
      field: google_workspace.admin.EMAIL_LOG_SEARCH_MSG_ID
      target_field: google_workspace.admin.email.log_search_filter.message_id
      ignore_missing: true
  - rename:
      field: google_workspace.admin.EMAIL_LOG_SEARCH_RECIPIENT
      target_field: google_workspace.admin.email.log_search_filter.recipient.value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.EMAIL_LOG_SEARCH_SENDER
      target_field: google_workspace.admin.email.log_search_filter.sender.value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.EMAIL_LOG_SEARCH_SMTP_RECIPIENT_IP
      target_field: google_workspace.admin.email.log_search_filter.recipient.ip
      ignore_missing: true
  - rename:
      field: google_workspace.admin.EMAIL_LOG_SEARCH_SMTP_SENDER_IP
      target_field: google_workspace.admin.email.log_search_filter.sender.ip
      ignore_missing: true
  - rename:
      field: google_workspace.admin.QUARANTINE_NAME
      target_field: google_workspace.admin.email.quarantine_name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.CHROME_LICENSES_ENABLED
      target_field: google_workspace.admin.chrome_licenses.enabled
      ignore_missing: true
  - rename:
      field: google_workspace.admin.CHROME_LICENSES_ALLOWED
      target_field: google_workspace.admin.chrome_licenses.allowed
      ignore_missing: true
  - rename:
      field: google_workspace.admin.FULL_ORG_UNIT_PATH
      target_field: google_workspace.admin.org_unit.full
      ignore_missing: true
  - rename:
      field: google_workspace.admin.OAUTH2_SERVICE_NAME
      target_field: google_workspace.admin.oauth2.service.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.OAUTH2_APP_ID
      target_field: google_workspace.admin.oauth2.application.id
      ignore_missing: true
  - rename:
      field: google_workspace.admin.OAUTH2_APP_NAME
      target_field: google_workspace.admin.oauth2.application.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.OAUTH2_APP_TYPE
      target_field: google_workspace.admin.oauth2.application.type
      ignore_missing: true
  - rename:
      field: google_workspace.admin.ALLOWED_TWO_STEP_VERIFICATION_METHOD
      target_field: google_workspace.admin.verification_method
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DOMAIN_VERIFICATION_METHOD
      target_field: google_workspace.admin.verification_method
      ignore_missing: true
  - rename:
      field: google_workspace.admin.CAA_ASSIGNMENTS_NEW
      target_field: google_workspace.admin.new_value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.CAA_ASSIGNMENTS_OLD
      target_field: google_workspace.admin.old_value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.REAUTH_SETTING_NEW
      target_field: google_workspace.admin.new_value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.REAUTH_SETTING_OLD
      target_field: google_workspace.admin.old_value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.ALERT_NAME
      target_field: google_workspace.admin.alert.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.API_CLIENT_NAME
      target_field: google_workspace.admin.api.client.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.API_SCOPES
      target_field: google_workspace.admin.api.scopes
      ignore_missing: true
  - rename:
      field: google_workspace.admin.PLAY_FOR_WORK_TOKEN_ID
      target_field: google_workspace.admin.mdm.token
      ignore_missing: true
  - rename:
      field: google_workspace.admin.PLAY_FOR_WORK_MDM_VENDOR_NAME
      target_field: google_workspace.admin.mdm.vendor
      ignore_missing: true
  - rename:
      field: google_workspace.admin.INFO_TYPE
      target_field: google_workspace.admin.info_type
      ignore_missing: true
  - rename:
      field: google_workspace.admin.RULE_NAME
      target_field: google_workspace.admin.rule.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.USER_CUSTOM_FIELD
      target_field: google_workspace.admin.setting.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.EMAIL_MONITOR_DEST_EMAIL
      target_field: google_workspace.admin.email_monitor.dest_email
      ignore_missing: true
  - rename:
      field: google_workspace.admin.EMAIL_MONITOR_LEVEL_CHAT
      target_field: google_workspace.admin.email_monitor.level.chat
      ignore_missing: true
  - rename:
      field: google_workspace.admin.EMAIL_MONITOR_LEVEL_DRAFT_EMAIL
      target_field: google_workspace.admin.email_monitor.level.draft
      ignore_missing: true
  - rename:
      field: google_workspace.admin.EMAIL_MONITOR_LEVEL_INCOMING_EMAIL
      target_field: google_workspace.admin.email_monitor.level.incoming
      ignore_missing: true
  - rename:
      field: google_workspace.admin.EMAIL_MONITOR_LEVEL_OUTGOING_EMAIL
      target_field: google_workspace.admin.email_monitor.level.outgoing
      ignore_missing: true
  - rename:
      field: google_workspace.admin.EMAIL_EXPORT_INCLUDE_DELETED
      target_field: google_workspace.admin.email_dump.include_deleted
      ignore_missing: true
  - rename:
      field: google_workspace.admin.EMAIL_EXPORT_PACKAGE_CONTENT
      target_field: google_workspace.admin.email_dump.package_content
      ignore_missing: true
  - rename:
      field: google_workspace.admin.SEARCH_QUERY_FOR_DUMP
      target_field: google_workspace.admin.email_dump.query
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DESTINATION_USER_EMAIL
      target_field: google_workspace.admin.new_value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.REQUEST_ID
      target_field: google_workspace.admin.request.id
      ignore_missing: true
  - rename:
      field: google_workspace.admin.GMAIL_RESET_REASON
      target_field: message
      ignore_missing: true
  - rename:
      field: google_workspace.admin.USER_NICKNAME
      target_field: google_workspace.admin.user.nickname
      ignore_missing: true
  - rename:
      field: google_workspace.admin.ACTION_ID
      target_field: google_workspace.admin.mobile.action.id
      ignore_missing: true
  - rename:
      field: google_workspace.admin.ACTION_TYPE
      target_field: google_workspace.admin.mobile.action.type
      ignore_missing: true
  - rename:
      field: google_workspace.admin.MOBILE_CERTIFICATE_COMMON_NAME
      target_field: google_workspace.admin.mobile.certificate.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.NUMBER_OF_COMPANY_OWNED_DEVICES
      target_field: google_workspace.admin.mobile.company_owned_devices
      ignore_missing: true
  - rename:
      field: google_workspace.admin.COMPANY_DEVICE_ID
      target_field: google_workspace.admin.device.id
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DISTRIBUTION_ENTITY_NAME
      target_field: google_workspace.admin.distribution.entity.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.DISTRIBUTION_ENTITY_TYPE
      target_field: google_workspace.admin.distribution.entity.type
      ignore_missing: true
  - rename:
      field: google_workspace.admin.MOBILE_APP_PACKAGE_ID
      target_field: google_workspace.admin.application.package_id
      ignore_missing: true
  - rename:
      field: google_workspace.admin.NEW_PERMISSION_GRANT_STATE
      target_field: google_workspace.admin.new_value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.OLD_PERMISSION_GRANT_STATE
      target_field: google_workspace.admin.old_value
      ignore_missing: true
  - rename:
      field: google_workspace.admin.PERMISSION_GROUP_NAME
      target_field: google_workspace.admin.setting.name
      ignore_missing: true
  - rename:
      field: google_workspace.admin.MOBILE_WIRELESS_NETWORK_NAME
      target_field: network.name
      ignore_missing: true
  - date:
      field: google_workspace.admin.EMAIL_LOG_SEARCH_END_DATE
      target_field: google_workspace.admin.email.log_search_filter.end_date
      timezone: UTC
      formats:
        - ISO8601
        - yyyy-MM-dd'T'HH:mm:ss
        - yyyy-MM-dd'T'HH:mm:ssZ
        - yyyy-MM-dd'T'HH:mm:ss.SSSZ
        - yyyy/MM/dd HH:mm:ss z
      if: ctx?.google_workspace?.admin?.EMAIL_LOG_SEARCH_END_DATE != null
  - date:
      field: google_workspace.admin.EMAIL_LOG_SEARCH_START_DATE
      target_field: google_workspace.admin.email.log_search_filter.start_date
      timezone: UTC
      formats:
        - ISO8601
        - yyyy-MM-dd'T'HH:mm:ss
        - yyyy-MM-dd'T'HH:mm:ssZ
        - yyyy-MM-dd'T'HH:mm:ss.SSSZ
        - yyyy/MM/dd HH:mm:ss z
      if: ctx?.google_workspace?.admin?.EMAIL_LOG_SEARCH_START_DATE != null
  - date:
      field: google_workspace.admin.BIRTHDATE
      target_field: google_workspace.admin.user.birthdate
      timezone: UTC
      formats:
        - ISO8601
        - yyyy-MM-dd'T'HH:mm:ss
        - yyyy-MM-dd'T'HH:mm:ssZ
        - yyyy-MM-dd'T'HH:mm:ss.SSSZ
        - yyyy/MM/dd HH:mm:ss z
      if: ctx?.google_workspace?.admin?.BIRTHDATE != null
  - date:
      field: google_workspace.admin.BEGIN_DATE_TIME
      target_field: event.start
      timezone: UTC
      formats:
        - ISO8601
        - yyyy-MM-dd'T'HH:mm:ss
        - yyyy-MM-dd'T'HH:mm:ssZ
        - yyyy-MM-dd'T'HH:mm:ss.SSSZ
        - yyyy/MM/dd HH:mm:ss z
      if: ctx?.google_workspace?.admin?.BEGIN_DATE_TIME != null
  - date:
      field: google_workspace.admin.START_DATE
      target_field: event.start
      timezone: UTC
      formats:
        - ISO8601
        - yyyy-MM-dd'T'HH:mm:ss
        - yyyy-MM-dd'T'HH:mm:ssZ
        - yyyy-MM-dd'T'HH:mm:ss.SSSZ
        - yyyy/MM/dd HH:mm:ss z
      if: ctx?.google_workspace?.admin?.START_DATE != null
  - date:
      field: google_workspace.admin.END_DATE
      target_field: event.end
      timezone: UTC
      formats:
        - ISO8601
        - yyyy-MM-dd'T'HH:mm:ss
        - yyyy-MM-dd'T'HH:mm:ssZ
        - yyyy-MM-dd'T'HH:mm:ss.SSSZ
        - yyyy/MM/dd HH:mm:ss z
      if: ctx?.google_workspace?.admin?.END_DATE != null
  - date:
      field: google_workspace.admin.END_DATE_TIME
      target_field: event.end
      timezone: UTC
      formats:
        - ISO8601
        - yyyy-MM-dd'T'HH:mm:ss
        - yyyy-MM-dd'T'HH:mm:ssZ
        - yyyy-MM-dd'T'HH:mm:ss.SSSZ
        - yyyy/MM/dd HH:mm:ss z
      if: ctx?.google_workspace?.admin?.END_DATE_TIME != null
  - script:
      lang: painless
      if: 'ctx?.source?.user?.email != null && ctx?.source?.user?.email.contains("@")'
      source: >
        String[] splitmail = ctx.source.user.email.splitOnToken('@');
        if (splitmail.length != 2) {
          return;
        }
        if (ctx.user == null) {
          ctx.user = new HashMap();
        }
        ctx.user.name = splitmail[0];
        ctx.source.user.name = splitmail[0];
        ctx.user.domain = splitmail[1];
        ctx.source.user.domain = splitmail[1];
  - script:
      lang: painless
      if: 'ctx?.google_workspace?.admin?.group?.email != null && ctx?.google_workspace?.admin?.group?.email.contains("@")'
      source: >
        String[] splitmail = ctx.google_workspace.admin.group.email.splitOnToken('@');
        if (splitmail.length != 2) {
          return;
        }
        if (ctx.group == null) {
          ctx.group = new HashMap();
        }
        ctx.group.name = splitmail[0];
        ctx.group.domain = splitmail[1];
  - script:
      lang: painless
      if: 'ctx?.google_workspace?.admin?.user?.email != null && ctx?.google_workspace?.admin?.user?.email.contains("@")'
      source: >
        String[] splitmail = ctx.google_workspace.admin.user.email.splitOnToken('@');
        if (splitmail.length != 2) {
          return;
        }
        if (ctx.related == null) {
          ctx.related = new HashMap();
        }
        if (ctx.user == null) {
          ctx.user = new HashMap();
        }
        if (ctx.user.target == null) {
          ctx.user.target = new HashMap();
        }
        ctx.user.target.name = splitmail[0];
        ctx.user.target.domain = splitmail[1];
        ctx.user.target.email = ctx.google_workspace.admin.user.email;
  - set:
      field: user.target.group.name
      copy_from: group.name
      if: ctx?.group?.name != null
  - set:
      field: user.target.group.domain
      copy_from: group.domain
      if: ctx?.group?.domain != null
  - script:
      lang: painless
      if: 'ctx?.event?.start != null && ctx?.event?.end != null'
      source: >-
        ZonedDateTime start = ZonedDateTime.parse(ctx.event.start);
        ZonedDateTime end = ZonedDateTime.parse(ctx.event.end);
        ctx.event.duration = ChronoUnit.NANOS.between(start, end);
  - convert:
      field: google_workspace.admin.bulk_upload.failed
      type: long
      ignore_missing: true
  - set:
      field: event.outcome
      value: success
      if: 'ctx?.google_workspace?.admin?.group?.bulk_upload?.failed != null && ctx?.google_workspace?.admin?.group?.bulk_upload?.failed == 0'
  - set:
      field: event.outcome
      value: failure
      if: 'ctx?.google_workspace?.admin?.group?.bulk_upload?.failed != null && ctx?.google_workspace?.admin?.group?.bulk_upload?.failed != 0'
  - split:
      field: google_workspace.admin.WHITELISTED_GROUPS
      target_field: google_workspace.admin.group.allowed_list
      separator: ','
      ignore_missing: true
  - append:
      field: related.ip
      value: "{{source.ip}}"
      if: ctx?.source?.ip != null
      allow_duplicates: false
  - append:
      field: related.user
      value: "{{source.user.name}}"
      if: ctx?.source?.user?.name != null
      allow_duplicates: false
  - append:
      field: related.user
      value: "{{user.target.name}}"
      if: ctx?.user?.target?.name != null
      allow_duplicates: false
  - geoip:
      field: source.ip
      target_field: source.geo
      ignore_missing: true
  - geoip:
      database_file: GeoLite2-ASN.mmdb
      field: source.ip
      target_field: source.as
      properties:
        - asn
        - organization_name
      ignore_missing: true
  - rename:
      field: source.as.asn
      target_field: source.as.number
      ignore_missing: true
  - rename:
      field: source.as.organization_name
      target_field: source.as.organization.name
      ignore_missing: true
  - convert:
      field: event.id
      type: string
      ignore_missing: true
  - convert:
      field: source.user.id
      type: string
      ignore_missing: true
  - convert:
      field: user.id
      type: string
      ignore_missing: true
  - remove:
      field:
        - json
        - google_workspace.admin.EMAIL_LOG_SEARCH_END_DATE
        - google_workspace.admin.EMAIL_LOG_SEARCH_START_DATE
        - google_workspace.admin.BIRTHDATE
        - google_workspace.admin.BEGIN_DATE_TIME
        - google_workspace.admin.START_DATE
        - google_workspace.admin.END_DATE
        - google_workspace.admin.END_DATE_TIME
        - google_workspace.admin.WHITELISTED_GROUPS
      ignore_missing: true
  - remove:
      field: event.original
      if: "ctx?.tags == null || !(ctx.tags.contains('preserve_original_event'))"
      ignore_failure: true
      ignore_missing: true
on_failure:
  - set:
      field: error.message
      value: "{{ _ingest.on_failure_message }}"
