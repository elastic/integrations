{{- $timestamp := generate "timestamp" }}
{{- $hostname := generate "host.name" }}
{{- $agentId := generate "agent.id" }}
{{- $fileSize := generate "filesize" }}
{{- $fileType := generate "filetype" }}
{{- $duration_start := generate "duration_start" }}
{{- $firstSeen := $timestamp | date_modify (print $duration_start) }}
{{- $virustotalPercent := generate "virustotal.percent" }}
{
  "@timestamp": "{{ $timestamp.Format "2006-01-02T15:04:05.999999Z07:00" }}",
  "_conf": {
    "ioc_expiration_duration": "5d"
  },
  "agent": {
    "id": "{{$agentId}}",
    "name": "{{$hostname}}",
    "type": "filebeat",
    "version": "8.18.0",
    "ephemeral_id": "{{$agentId}}"
  },
  "data_stream": {
    "namespace": "ep",
    "type": "logs",
    "dataset": "ti_abusech.malware"
  },
  "elastic_agent": {
    "id": "60a22c30-4c80-4e95-b5b1-87ff540d8afd",
    "snapshot": false,
    "version": "8.18.0"
  },
  "message": "{
    \"file_size\": \"{{$fileSize}}\",
    \"file_type\": \"{{$fileType}}\",
    \"firstseen\": \"{{$firstSeen}}\",
    \"imphash\": \"6ed4f5f04d62b18d96b26d6db7c18840\",
    \"magika\": \"{{$fileType}}\",
    \"md5_hash\": \"3849f30b51a5c49e8d1546960cc206c7\",
    \"sha256_hash\": \"f6c97b1e2ed02578ca1066c8235ba4f991e645f89012406c639dbccc6582eec8\",
    \"signature\": \"RunningRAT\",
    \"ssdeep\": \"3072:biMYFJvw6Yh0b1gKobtCGCmCRlrisfrYm:fYFJvwe1gKCYVl2szN\",
    \"tlsh\": \"59D31322D3130C4FC02579FA7A2BE62A39873E6A24CE449C45F5D66A2FB7084ED71753\",
    \"urlhaus_download\": \"https://urlhaus-api.abuse.ch/v1/download/f6c97b1e2ed02578ca1066c8235ba4f991e645f89012406c639dbccc6582eec8/\",
    \"virustotal\": {
        \"link\": \"https://www.virustotal.com/gui/file/f6c97b1e2ed02578ca1066c8235ba4f991e645f89012406c639dbccc6582eec8/detection/f-f6c97b1\",
        \"percent\": \"{{$virustotalPercent}}\",
        \"result\": \"47 / 64\"
    }
  }",
  "event": {
    "dataset": "ti_abusech.malware"
  },
  "input": {
    "type": "cel"
  },
  "tags": [
    "preserve_original_event",
    "forwarded",
    "abusech-malware"
  ]
}
