{{- $timestamp := generate "timestamp" }}
{{- $expireDur := generate "expire_dur" }}
{{- $hostname := generate "host.name" }}
{{- $agentId := generate "agent.id" }}
{{- $anonymous := generate "anonymous" }}
{{- $codesignSubjectCn := generate "code_sign.subject_cn" }}
{{- $codesignIssuerCn := generate "code_sign.issuer_cn" }}
{{- $codesignValidTo := $timestamp.Format "2006-01-02T15:04:05Z" }}
{{- $codesignThumbprint := sha256sum (generate "code_sign.thumbprint") }}
{{- $codesignValidFrom := $timestamp.Format "2006-01-02T15:04:05Z" }}
{{- $codesignSerialNumber := generate "code_sign.serial_number" }}
{{- $codesignThumbprintAlgorithm := generate "code_sign.thumbprint_algorithm" }}
{{- $fileName := generate "filename" }}
{{- $fileSize := generate "filesize" }}
{{- $fileType := generate "filetype" }}
{{- $fileTypeMeme := generate "filetypememe" }}
{{- $duration_start := generate "duration_start" }}
{{- $firstSeen := ($timestamp | date_modify (print $duration_start)).Format "2006-01-02 15:04:05" }}
{{- $duration_end := generate "duration_end" }}
{{- $lastSeen := ($timestamp | date_modify (print $duration_end)).Format "2006-01-02 15:04:05" }}
{{- $dhashIcon := generate "dhash_icon" }}
{{- $gimpHash := sha256sum (generate "gimphash") }}
{{- $impHash := generate "imphash" }}
{{- $md5Hash := generate "md5_hash" }}
{{- $sha1Hash := sha1sum (generate "sha1_hash") }}
{{- $sha256Hash := sha256sum (generate "sha256_hash") }}
{{- $signature := generate "signature" }}
{{- $ssdeep := generate "ssdeep" }}
{{- $telfHash := generate "telfhash" }}
{{- $tlsh := generate "tlsh" }}
{{- $intelligenceClamav := generate "intelligence.clamav" }}
{{- $intelligenceUploads := generate "intelligence.uploads" }}
{{- $intelligenceDownloads := generate "intelligence.downloads" }}
{{- $originCountry := upper (randAlpha 2) }}
{{- $reporter := generate "reporter" }}
{{ $tridPercent := printf "%.2f" (generate "trid_percent") }}
{
  "@timestamp": "{{ $timestamp.Format "2006-01-02T15:04:05.999999Z07:00" }}",
  "_conf": {
    "ioc_expiration_duration": "{{ $expireDur }}d"
  },
  "agent": {
    "id": "{{$agentId}}",
    "name": "{{$hostname}}",
    "type": "filebeat",
    "version": "8.18.0",
    "ephemeral_id": "{{$agentId}}"
  },
  "data_stream": {
    "namespace": "ep",
    "type": "logs",
    "dataset": "ti_abusech.malware"
  },
  "elastic_agent": {
    "id": "60a22c30-4c80-4e95-b5b1-87ff540d8afd",
    "snapshot": false,
    "version": "8.18.0"
  },
  "message": "{\"anonymous\": {{ $anonymous }},\"code_sign\": [{\"subject_cn\": \"{{ $codesignSubjectCn }}\",\"issuer_cn\": \"{{ $codesignIssuerCn }} Code Signing RSA4096 SHA256 2021 CA1\",\"valid_to\": \"{{ $codesignValidTo }}\",\"thumbprint\": \"{{ $codesignThumbprint }}\",\"valid_from\": \"{{ $codesignValidFrom }}\",\"serial_number\": \"{{ $codesignSerialNumber }}\",\"thumbprint_algorithm\": \"{{ $codesignThumbprintAlgorithm }}\",\"algorithm\": \"{{ $codesignThumbprintAlgorithm }}WithRSAEncryption\"}],\"dhash_icon\": \"{{ $dhashIcon }}\",\"file_name\": \"{{ $fileName }}.{{ $fileType }}\",\"file_size\": {{ $fileSize }},\"file_type\": \"{{ $fileType }}\",\"file_type_mime\": \"{{ $fileTypeMeme }}\",\"first_seen\": \"{{ $firstSeen }}\",\"gimphash\": \"{{ $gimpHash }}\",\"imphash\": \"{{ $impHash }}\",\"intelligence\": {\"clamav\": \"{{ $intelligenceClamav }}\",\"downloads\": \"{{ $intelligenceDownloads }}\",\"mail\": {\"IT\": \"low\",\"Generic\": \"low\"},\"uploads\": \"{{ $intelligenceUploads }}\"},\"last_seen\": \"{{ $lastSeen }}\",\"magika\": \"{{ $fileType }}\",\"md5_hash\": \"{{ $md5Hash }}\",\"origin_country\": \"{{ $originCountry }}\",\"reporter\": \"{{ $reporter }}\",\"sha1_hash\": \"{{ $sha1Hash }}\",\"sha256_hash\": \"{{ $sha256Hash }}\",\"sha3_384_hash\": \"{{ $sha256Hash }}098a5a10be9f6d33b888602906c0d89955\",\"signature\": \"{{ $signature }}\",\"ssdeep\": \"{{ $ssdeep }}\",\"tags\": [\"{{ $fileType }}\",\"{{ $reporter }}\"],\"telfhash\": \"{{ $telfHash }}\",\"tlsh\": \"{{ $tlsh }}\",\"trid\": [\"{{ $tridPercent }}% (.EXE) Win64 Executable (generic) (10522/11/4)\",\"{{ $tridPercent }}% (.EXE) OS/2 Executable (generic) (2029/13)\",\"{{ $tridPercent }}% (.EXE) Generic Win/DOS Executable (2002/3)\",\"{{ $tridPercent }}% (.EXE) DOS Executable Generic (2000/1)\"]}",
  "event": {
    "dataset": "ti_abusech.malware"
  },
  "input": {
    "type": "cel"
  },
  "tags": [
    "preserve_original_event",
    "forwarded",
    "abusech-malware"
  ]
}
