# Service Info

## Common use cases

Collect and monitor network security events, firewall traffic, and audit logs from Check Point Security Gateways and Management Servers to:

- Gain centralized visibility into security policies, blocked connections, accepted connections, and VPN activity.
- Facilitate compliance auditing and reporting by centralizing Check Point logs.
- Enhance threat detection and incident response capabilities through real-time log analysis.
- Monitor system health and administrator actions on Check Point appliances.

## Data types collected

This integration can collect the following types of data:

- Check Point Security Gateway and Management Server logs in Syslog format (firewall connections, VPN, audit, system events).
- Check Point firewall connection logs (accept, drop, reject, etc.).
- VPN logs.
- SmartConsole audit logs (administrator actions on the Management Server).
- Gaia OS system-level logs (e.g., `/var/log/messages`, `/var/log/secure`, `/var/log/dmesg`) for appliance health and activity.

## Compatibility

- **Check Point**: This integration is compatible with Check Point Security Gateways and Management Servers running R81.x versions.

## Scaling and Performance

- Check Point's Log Exporter allows for flexible log forwarding, including the ability to send logs to multiple targets, enabling distributed log collection setups.
- The performance of log collection largely depends on the volume of logs generated by your Check Point devices and the network capacity between the Check Point devices and the Elastic Agent.
- For high-volume environments, consider deploying multiple Elastic Agents to distribute the log collection load. Refer to Check Point's documentation for sizing guidelines related to log generation and forwarding.

# Set Up Instructions

## Vendor prerequisites

- Administrative access to Check Point SmartConsole.
- SSH access to Check Point Security Gateways or Management Servers (required for logfile collection and potentially for advanced troubleshooting).
- Knowledge of your Check Point environment, including IP addresses of Gateways/Management Servers.
- Ensure network connectivity and open ports (e.g., UDP/TCP 514 or a custom port) between your Check Point devices and the Elastic Agent acting as the log collector.

## Elastic prerequisites

- An active Elastic Stack deployment (Elasticsearch and Kibana) compatible with the integration (Kibana 8.11.0+ or 9.0.0+).
- An Elastic Agent deployed and enrolled in Fleet, configured to receive logs from Check Point devices.
- Network connectivity between the Elastic Agent and the Check Point devices.

## Vendor set up steps

### For UDP/TCP (Syslog) Collection:

1.  **Configure Log Exporter in SmartConsole:**
    - For each Check Point Security Gateway or Management Server you wish to monitor, create a new [Log Exporter/SIEM object](https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_LoggingAndMonitoring_AdminGuide/Topics-LMG/Log-Exporter-Configuration-in-SmartConsole.htm?tocpath=Log%20Exporter%7C%5F%5F%5F%5F%5F2) in Check Point SmartConsole.
    - Navigate to **Objects > More object types > Server > Log Exporter/SIEM**.
    - **Name:** Provide a descriptive name for the Log Exporter (e.g., `Elastic_Agent_Syslog_Export`).
    - **Target Server:** Set this to the IP address or hostname of your log collector (e.g., Elastic Agent).
    - **Target Port:** Specify the port number on which your log collector is listening (e.g., `514` for standard Syslog UDP/TCP, or a custom port like `9001` as often used by Elastic Agent).
    - **Protocol:** Select either **UDP** or **TCP**. The Check Point integration supports both.
    - **Format:** Choose **Syslog**.
    - **Export additional log fields:** (Optional) Select any additional fields you wish to export.
    - **Filter (Optional):** Define a filter if you only want to send specific log types or severities.
    - Click **OK** to save the Log Exporter configuration.
2.  **Install Policy:**
    - After configuring the Log Exporter, install the updated policy on the relevant Security Gateways or Management Server for the changes to take effect.

### For Logfile Collection:

_Note: Check Point's raw security event logs are typically stored in a proprietary binary format and are not directly consumable by generic log file collectors without specific parsing tools. The recommended method for third-party integrations requiring security events is via the Log Exporter (Syslog) as described above. Direct logfile collection is generally suitable for system-level logs or specific audit trails of the Check Point appliance itself._

1.  **Access the Check Point Appliance:**
    - Connect to the Check Point Security Gateway or Management Server via SSH.
2.  **Identify Log File Locations:**
    - **Security Gateway Raw Logs:** The primary directory for raw security logs is `$FWDIR/log/`. These files (e.g., `fw.log`, `vpn.log`, `audit.log`) are in a proprietary binary format.
      - Example path for standard Gaia OS system logs: `/var/log/messages`.
    - **Management Server Logs:**
      - `$MDS_FWDIR/log/` (for Multi-Domain Security Management environments).
      - `$CPDIR/log/` (general Check Point process logs).
      - `$FWDIR/log/` (Management Server's own logs, including `cpm.elg` for SmartConsole audit events, which can be useful for auditing administrator actions and is typically human-readable).
    - **Gaia OS System Logs:** Standard Linux system logs are located in `/var/log/`. These include:
      - `/var/log/messages`: General system messages.
      - `/var/log/secure`: Authentication and authorization messages.
      - `/var/log/dmesg`: Kernel ring buffer messages.
3.  **Configure your Log Collector:**
    - Point your log file collector (Elastic Agent) to the desired log file paths on the Check Point appliance. Ensure the collector has appropriate permissions to read these files.
    - **Important Consideration:** For proprietary binary logs (e.g., `$FWDIR/log/fw.log`), a generic log collector will not be able to parse the content effectively. If security events are required, strongly consider using the Log Exporter (Syslog) method. For standard text-based system logs (e.g., `/var/log/messages`), direct collection is viable.

## Kibana set up steps

1.  In Kibana, navigate to **Integrations** > **Check Point**.
2.  Click **Add Check Point**.
3.  Follow the prompts to add the integration to an existing Elastic Agent policy or create a new one.
4.  Configure the input types based on your vendor setup:
    - **For UDP/TCP (Syslog)**:
      - Select the **Collect Check Point firewall logs (input: tcp)** or **(input: udp)**.
      - Specify the `Syslog Host` (The IP address or hostname for the Elastic Agent to listen on. Use `0.0.0.0` to listen on all available network interfaces.).
      - Specify the `Syslog Port` (e.g., `9001` or `514`), ensuring it matches the `Target Port` configured in your Check Point Log Exporter.
    - **For Logfile Collection**:
      - Select the **Collect Check Point firewall logs (input: logfile)**.
      - Provide the `Paths` to the desired log files on the Check Point appliance (e.g., `/var/log/messages`, `$FWDIR/log/cpm.elg`).
5.  Review any additional settings, such as `internal_zones` or `external_zones` if needed for your environment.
6.  Save the integration. The Elastic Agent will automatically update its configuration and begin ingesting data.

# Validation Steps

After configuring both the Check Point Log Exporter and the Elastic Agent integration:

1.  **Trigger Data Flow on Check Point:**
    - **For firewall logs**: On a Check Point Security Gateway, generate some network traffic (e.g., browse the internet, attempt to access a blocked resource) to ensure firewall logs are generated.
    - **For audit logs**: Perform an action in SmartConsole (e.g., install policy, create an object, modify a rule) to generate audit logs on the Management Server.
    - **For system logs**: Log in/out of the Check Point appliance via SSH or perform routine system commands.
2.  **Check Data in Kibana:**
    - Navigate to **Discover** in Kibana and select the relevant data view.
    - Filter by `data_stream.dataset : checkpoint.firewall` or `data_stream.namespace : checkpoint`.
    - Verify that logs are being ingested and parsed correctly, looking for recent timestamps.
    - Explore the provided Check Point dashboards (e.g., Overview, Addresses and Ports) to see if data populates as expected.
    - Look for specific fields like `checkpoint.log_type`, `source.ip`, `destination.ip`, `event.action`, `event.outcome`.

# Troubleshooting

## Common Configuration Issues

- **No data collected in Kibana**:
  - **Network Connectivity**: Verify network connectivity between your Check Point device and the Elastic Agent. Check any intermediate firewalls or security groups that might block Syslog traffic (UDP/TCP on the configured port).
  - **Policy Installation**: Ensure the Log Exporter policy has been successfully installed on the relevant Check Point Security Gateway or Management Server.
  - **Port/IP Mismatch**: Double-check that the `Target Server` IP and `Target Port` configured in SmartConsole's Log Exporter match the `Syslog Host` and `Syslog Port` configured in the Elastic Agent integration.
  - **Elastic Agent Status**: Confirm the Elastic Agent is running and healthy. Check its logs for any errors related to input listeners.
  - **Logfile Permissions**: For logfile collection, ensure the Elastic Agent has appropriate read permissions on the specified log file paths on the Check Point appliance.
- **Data collected, but parsing issues or missing fields**:
  - **Syslog Format**: Ensure the `Format` in Check Point Log Exporter is explicitly set to `Syslog`.
  - **Input Type Mismatch**: Verify that the correct input type (UDP, TCP, or Logfile) is selected and configured in the Elastic Agent integration, matching how Check Point is sending logs.

## Ingestion Errors

- Check the Elastic Agent logs for any specific error messages related to log processing, parsing failures, or communication with Elasticsearch.
- In Kibana Discover, look for documents with an `error.message` field set, which can indicate issues during ingestion or processing.
- In some instances firewall events may have the same Checkpoint `loguid` and arrive during the same timestamp resulting in a fingerprint collision. To avoid this [enable semi-unified logging](https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_LoggingAndMonitoring_AdminGuide/Topics-LMG/Log-Exporter-Appendix.htm?TocPath=Log%20Exporter%7C_____9) in the Checkpoint dashboard.

## API Authentication Errors

(Not directly applicable to Syslog or Logfile collection, but included for completeness in general integration troubleshooting)

- If any API-based collection were part of this integration, verify API keys, access tokens, and their associated permissions within the Check Point system.

## Vendor Resources

- [Check Point R81 Logging and Monitoring Administration Guide - Log Exporter Configuration](https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_LoggingAndMonitoring_AdminGuide/Topics-LMG/Log-Exporter-Configuration-in-SmartConsole.htm?tocpath=Log%20Exporter%7C%5F%5F%5F%5F%5F2)
- [Check Point R81 Logging and Monitoring Administration Guide - Log Exporter Overview](https://sc1.checkpoint.com/documents/R81/WebAdminGuides/EN/CP_R81_LoggingAndMonitoring_AdminGuide/Topics-LMG/Log-Exporter.htm)
- [Check Point sk122323: R80.x / R81.x Log Exporter command line utility](https://support.checkpoint.com/results/sk/sk122323)

# Documentation sites
