rules:
  - path: /ratings/v2/threats
    methods: ['GET']
    query_params:
      category_slug: vulnerability
      first_seen_date_gte: "{date:.*}"
      limit: "{lim:.*}"
      sort: "{s:.*}"
    responses:
      - status_code: 200
        headers:
          Content-Type: [application/json]
        body: |
          {
            "count": 18569,
            "links": { "previous": null, "next": "http://bitsight-vulnerability:8090/ratings/v2/threats?page=2" },
            "results": [
              {
                "guid": "11111111-aaaa-bbbb-cccc-222222222222",
                "name": "CVE-2023-12345",
                "first_seen_date": "2025-02-03",
                "last_seen_date": "2025-03-01",
                "severity": { "level": "Moderate", "details": "CVSS 6.1" },
                "category": { "name": "vulnerability", "slug": "vulnerability" },
                "support_started_date": "2023-07-28",
                "exposed_count": 0,
                "mitigated_count": 1,
                "exposure_trend": -1,
                "questionnaires_sent": null,
                "epss": {
                  "score": 1.6,
                  "percentile": 80.9
                },
                "dve": {
                  "score": 0.76,
                  "highest_score": 1.5,
                  "highest_score_date": "2022-06-12T00:00:00",
                  "cti_attributes": []
                },
                "evidence_certainty": "LIKELY"
              }
            ]
          }
  - path: /ratings/v2/threats
    methods: ['GET']
    query_params:
      page: "2"
    responses:
      - status_code: 200
        headers:
          Content-Type: [application/json]
        body: |
          {
            "count": 18569,
            "links": { "previous": "http://bitsight-vulnerability:8090/ratings/v2/threats", "next": null },
            "results": [
              {
                "guid": "22222222-aaaa-bbbb-cccc-333333333333",
                "name": "CVE-2024-98765",
                "first_seen_date": "2025-02-10",
                "last_seen_date": "2025-03-02",
                "severity": { "level": "Minor", "details": "CVSS 4.0" },
                "category": { "name": "vulnerability", "slug": "vulnerability" },
                "support_started_date": "2023-08-15",
                "exposed_count": 2,
                "mitigated_count": 0,
                "exposure_trend": 1,
                "questionnaires_sent": null,
                "epss": {
                  "score": 0.2,
                  "percentile": 20.1
                },
                "dve": {
                  "score": 0.15,
                  "highest_score": 0.9,
                  "highest_score_date": "2023-02-10T00:00:00",
                  "cti_attributes": []
                },
                "evidence_certainty": "POSSIBLE"
              }
            ]
          }
  - path: /ratings/v2/threats/11111111-aaaa-bbbb-cccc-222222222222/companies
    methods: ['GET']
    query_params:
      limit: "{lim:.*}"
    responses:
      - status_code: 200
        headers:
          Content-Type: [application/json]
        body: |
          {
            "count": 1,
            "links": { "previous": null, "next": null },
            "summaries": {
              "exposed_count": 0,
              "mitigated_count": 1,
              "total_count": 1,
              "entity_group_size": 188
            },
            "results": [
              {
                "company_name": "ExampleTech AG",
                "evidence_certainty": "LIKELY",
                "exposure_detection": "MITIGATED",
                "first_seen_date": "2025-02-03",
                "last_seen_date": "2025-03-01",
                "company_guid": "aaaa0000-bbbb-cccc-dddd-eeeeeeeeeeee",
                "tier": null,
                "tier_name": null,
                "logo": "https://service.bitsighttech.com/customer-api/ratings/v1/companies/aaaa0000-bbbb-cccc-dddd-eeeeeeeeeeee/logo-image",
                "detection_types": ["standard"],
                "evidence_tags": [
                  { "name": "Long time since last detection", "slug": "LONG_TIME_SINCE_LAST_DETECTION" }
                ]
              }
            ]
          }
  - path: /ratings/v2/threats/11111111-aaaa-bbbb-cccc-222222222222/companies/aaaa0000-bbbb-cccc-dddd-eeeeeeeeeeee/evidence
    methods: ['GET']
    query_params:
      limit: "{lim:.*}"
    responses:
      - status_code: 200
        headers:
          Content-Type: [application/json]
        body: |
          {
            "count": 1,
            "links": { "previous": null, "next": null },
            "results": [
              {
                "identifier": "203.0.113.42:443",
                "certainty": "LIKELY",
                "exposure_detection": "MITIGATED",
                "detection_type": "standard",
                "first_seen_date": "2025-02-03",
                "last_seen_date": "2025-03-01",
                "evidence_tag": {
                  "name": "Long time since last detection",
                  "slug": "LONG_TIME_SINCE_LAST_DETECTION"
                }
              }
            ]
          }
  - path: /ratings/v2/threats/22222222-aaaa-bbbb-cccc-333333333333/companies
    methods: ['GET']
    query_params:
      limit: "{lim:.*}"
    responses:
      - status_code: 200
        headers:
          Content-Type: [application/json]
        body: |
          {
            "count": 1,
            "links": { "previous": null, "next": null },
            "summaries": {
              "exposed_count": 2,
              "mitigated_count": 0,
              "total_count": 1,
              "entity_group_size": 10
            },
            "results": [
              {
                "company_name": "ExampleTech AG",
                "evidence_certainty": "POSSIBLE",
                "exposure_detection": "EXPOSED",
                "first_seen_date": "2025-02-10",
                "last_seen_date": "2025-03-02",
                "company_guid": "bbbb0000-bbbb-cccc-dddd-eeeeeeeeeeee",
                "tier": null,
                "tier_name": null,
                "logo": "https://service.bitsighttech.com/customer-api/ratings/v1/companies/bbbb0000-bbbb-cccc-dddd-eeeeeeeeeeee/logo-image",
                "detection_types": ["standard"],
                "evidence_tags": [
                  { "name": "New detection", "slug": "NEW_DETECTION" }
                ]
              }
            ]
          }
  - path: /ratings/v2/threats/22222222-aaaa-bbbb-cccc-333333333333/companies/bbbb0000-bbbb-cccc-dddd-eeeeeeeeeeee/evidence
    methods: ['GET']
    query_params:
      limit: "{lim:.*}"
    responses:
      - status_code: 200
        headers:
          Content-Type: [application/json]
        body: |
          {
            "count": 1,
            "links": { "previous": null, "next": null },
            "results": [
              {
                "identifier": "198.51.100.77:22",
                "certainty": "POSSIBLE",
                "exposure_detection": "EXPOSED",
                "detection_type": "standard",
                "first_seen_date": "2025-02-10",
                "last_seen_date": "2025-03-02",
                "evidence_tag": {
                  "name": "New detection",
                  "slug": "NEW_DETECTION"
                }
              }
            ]
          }
