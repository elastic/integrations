---
description: Pipeline for processing MongoDB Atlas metrics logs.
processors:
  - set:
      field: ecs.version
      value: 8.11.0
  - set:
      field: event.kind
      value: event
  - set:
      field: event.module
      value: mongodb_atlas
  - set:
      field: label.assert_type
      value: "REGULAR"
      if: ctx.assert_type_regular != null
      ignore_empty_value: true
  - set:
      field: label.assert_type
      value: "MSG"
      if: ctx.assert_type_msg != null
      ignore_empty_value: true
  - set:
      field: label.assert_type
      value: "WARNING"
      if: ctx.assert_type_warning != null
      ignore_empty_value: true
  - set:
      field: label.cache_direction
      value: "READ_INTO"
      if: ctx.cache_direction_read_into != null
      ignore_empty_value: true
  - set:
      field: label.assert_type
      value: "USER"
      if: ctx.assert_type_user != null
      ignore_empty_value: true
  - set:
      field: label.cache_status
      value: "DIRTY"
      if: ctx.cache_status_dirty != null
      ignore_empty_value: true
  - set:
      field: label.cache_direction
      value: "WRITTEN_FROM"
      if: ctx.cache_direction_written_from != null
      ignore_empty_value: true
  - set:
      field: label.cpu_state
      value: "KERNEL"
      if: ctx.cpu_state_kernel != null
      ignore_empty_value: true
  - set:
      field: label.cache_status
      value: "USED"
      if: ctx.cache_status_used != null
      ignore_empty_value: true
  - set:
      field: label.cursor_state
      value: "TIMED_OUT"
      if: ctx.cursor_state_timed_out != null
      ignore_empty_value: true
  - set:
      field: label.cpu_state
      value: "USER"
      if: ctx.cpu_state_user != null
      ignore_empty_value: true
  - set:
      field: label.document_status
      value: "UPDATED"
      if: ctx.document_status_updated != null
      ignore_empty_value: true
  - set:
      field: label.cursor_state
      value: "OPEN"
      if: ctx.cursor_state_open != null
      ignore_empty_value: true
  - set:
      field: label.document_status
      value: "RETURNED"
      if: ctx.document_status_returned != null
      ignore_empty_value: true
  - set:
      field: label.document_status
      value: "DELETED"
      if: ctx.document_status_deleted != null
      ignore_empty_value: true
  - set:
      field: label.execution_type
      value: "WRITES"
      if: ctx.execution_type_writes != null
      ignore_empty_value: true
  - set:
      field: label.document_status
      value: "INSERTED"
      if: ctx.document_status_inserted != null
      ignore_empty_value: true
  - set:
      field: label.execution_type
      value: "COMMANDS"
      if: ctx.execution_type_commands != null
      ignore_empty_value: true
  - set:
      field: label.execution_type
      value: "READS"
      if: ctx.execution_type_reads != null
      ignore_empty_value: true
  - set:
      field: label.scanned_type
      value: "OBJECTS"
      if: ctx.scanned_type_objects != null
      ignore_empty_value: true
  - set:
      field: label.scanned_type
      value: "INDEX_ITEMS"
      if: ctx.scanned_type_index_items != null
      ignore_empty_value: true
  - set:
      field: label.storage_status
      value: "DATA_SIZE"
      if: ctx.storage_status_data_size != null
      ignore_empty_value: true
  - set:
      field: label.storage_status
      value: "TOTAL"
      if: ctx.storage_status_total != null
      ignore_empty_value: true
  - set:
      field: label.global_lock_state
      value: "CURRENT_QUEUE_READERS"
      if: ctx.global_lock_state_current_queue_readers != null
      ignore_empty_value: true
  - set:
      field: label.global_lock_state
      value: "CURRENT_QUEUE_WRITERS"
      if: ctx.global_lock_state_current_queue_writers != null
      ignore_empty_value: true
  - set:
      field: label.btree_counter_type
      value: "MISSES"
      if: ctx.btree_counter_type_misses != null
      ignore_empty_value: true
  - set:
      field: label.global_lock_state
      value: "CURRENT_QUEUE_TOTAL"
      if: ctx.global_lock_state_current_queue_total != null
      ignore_empty_value: true
  - set:
      field: label.btree_counter_type
      value: "HITS"
      if: ctx.btree_counter_type_hits != null
      ignore_empty_value: true
  - set:
      field: label.btree_counter_type
      value: "ACCESSES"
      if: ctx.btree_counter_type_accesses != null
      ignore_empty_value: true
  - set:
      field: label.cluster_role
      value: "PRIMARY"
      if: ctx.cluster_role_primary_operation_scan_and_order != null || ctx.cluster_role_primary_operation_getmore != null || ctx.cluster_role_primary_operation_cmd != null || ctx.cluster_role_primary_operation_update != null || ctx.cluster_role_primary_operation_query != null || ctx.cluster_role_primary_operation_delete != null || ctx.cluster_role_primary_operation_insert != null
      ignore_empty_value: true
  - set:
      field: label.cluster_role
      value: "REPLICA"
      if: ctx.cluster_role_replica_operation_update != null || ctx.cluster_role_replica_operation_cmd != null || ctx.cluster_role_replica_operation_delete != null || ctx.cluster_role_replica_operation_insert != null
      ignore_empty_value: true
  - set:
      field: label.operation
      value: "CMD"
      if: ctx.cluster_role_primary_operation_cmd != null || ctx.cluster_role_replica_operation_cmd != null
      ignore_empty_value: true
  - set:
      field: label.operation
      value: "UPDATE"
      if: ctx.cluster_role_primary_operation_update != null || ctx.cluster_role_replica_operation_update != null 
      ignore_empty_value: true
  - set:
      field: label.operation
      value: "DELETE"
      if: ctx.cluster_role_primary_operation_delete != null || ctx.cluster_role_replica_operation_delete != null
      ignore_empty_value: true
  - set:
      field: label.operation
      value: "INSERT"
      if: ctx.cluster_role_primary_operation_insert != null || ctx.cluster_role_replica_operation_insert != null
      ignore_empty_value: true
  - set:
      field: label.operation
      value: "SCAN_AND_ORDER"
      if: ctx.cluster_role_primary_operation_scan_and_order != null
      ignore_empty_value: true
  - set:
      field: label.operation
      value: "GETMORE"
      if: ctx.cluster_role_primary_operation_getmore != null
      ignore_empty_value: true
  - set:
      field: label.operation
      value: "QUERY"
      if: ctx.cluster_role_primary_operation_query != null
      ignore_empty_value: true
  - set:
      field: label.memory_state
      value: "MAPPED"
      if: ctx.memory_state_mapped != null
      ignore_empty_value: true
  - set:
      field: label.memory_state
      value: "COMPUTED"
      if: ctx.memory_state_computed != null
      ignore_empty_value: true
  - set:
      field: label.memory_state
      value: "VIRTUAL"
      if: ctx.memory_state_virtual != null
      ignore_empty_value: true
  - set:
      field: label.direction
      value: "RECEIVE"
      if: ctx.direction_receive != null
      ignore_empty_value: true
  - set:
      field: label.memory_state
      value: "RESIDENT"
      if: ctx.memory_state_resident != null
      ignore_empty_value: true
  - set:
      field: label.oplog_type
      value: "MASTER_TIME"
      if: ctx.oplog_type_master_time != null
      ignore_empty_value: true
  - set:
      field: label.direction
      value: "TRANSMIT"
      if: ctx.direction_transmit != null
      ignore_empty_value: true
  - set:
      field: label.oplog_type
      value: "MASTER_LAG_TIME_DIFF"
      if: ctx.oplog_type_master_lag_time_diff != null
      ignore_empty_value: true
  - set:
      field: label.oplog_type
      value: "SLAVE_LAG_MASTER_TIME"
      if: ctx.oplog_type_slave_lag_master_time != null
      ignore_empty_value: true
  - set:
      field: label.memory_issue_type
      value: "EXTRA_INFO"
      if: ctx.memory_issue_type_extra_info != null
      ignore_empty_value: true
  - set:
      field: label.memory_issue_type
      value: "EXCEPTIONS_THROWN"
      if: ctx.memory_issue_type_exceptions_thrown != null
      ignore_empty_value: true
  - set:
      field: label.ticket_type
      value: "AVAILABLE_READS"
      if: ctx.ticket_type_available_reads != null
      ignore_empty_value: true
  - set:
      field: label.memory_issue_type
      value: "GLOBAL_ACCESSES_NOT_IN_MEMORY"
      if: ctx.memory_issue_type_global_accesses_not_in_memory != null
      ignore_empty_value: true
  - set:
      field: label.cpu_state
      value: "IOWAIT"
      if: ctx.cpu_state_iowait != null
      ignore_empty_value: true
  - set:
      field: label.ticket_type
      value: "AVAILABLE_WRITES"
      if: ctx.ticket_type_available_writes != null
      ignore_empty_value: true
  - set:
      field: label.cpu_state
      value: "IRQ"
      if: ctx.cpu_state_irq != null
      ignore_empty_value: true
  - set:
      field: label.cpu_state
      value: "GUEST"
      if: ctx.cpu_state_guest != null
      ignore_empty_value: true
  - set:
      field: label.cpu_state
      value: "STEAL"
      if: ctx.cpu_state_steal != null
      ignore_empty_value: true
  - set:
      field: label.cpu_state
      value: "KERNEL"
      if: ctx.cpu_state_KERNEL != null
      ignore_empty_value: true
  - set:
      field: label.cpu_state
      value: "NICE"
      if: ctx.cpu_state_nice != null
      ignore_empty_value: true
  - set:
      field: label.cpu_state
      value: "SOFTIRQ"
      if: ctx.cpu_state_softirq != null
      ignore_empty_value: true
  - set:
      field: label.cpu_state
      value: "USER"
      if: ctx.cpu_state_user != null
      ignore_empty_value: true
  - set:
      field: label.memory_state
      value: "AVAILABLE"
      if: ctx.memory_state_available != null
      ignore_empty_value: true
  - set:
      field: label.memory_state
      value: "USED"
      if: ctx.memory_state_used != null
      ignore_empty_value: true
  - set:
      field: label.memory_state
      value: "FREE"
      if: ctx.memory_state_free != null
      ignore_empty_value: true
  - rename:
      field: cpu_state_kernel.MAX_PROCESS_NORMALIZED_CPU_CHILDREN_KERNEL
      target_field: mongodbatlas.process.cpu.children.normalized.usage.max
      if: ctx.cpu_state_kernel?.MAX_PROCESS_NORMALIZED_CPU_CHILDREN_KERNEL != null
      ignore_missing: true
  - rename:
      field: cpu_state_kernel.PROCESS_NORMALIZED_CPU_CHILDREN_KERNEL
      target_field: mongodbatlas.process.cpu.children.normalized.usage.avrage
      if: ctx.cpu_state_kernel?.PROCESS_NORMALIZED_CPU_CHILDREN_KERNEL != null
      ignore_missing: true
  - set:
      field: label.cpu_state
      value: "USER"
      if: ctx.cpu_state_user != null
      ignore_empty_value: true
  - rename:
      field: assert_type_regular.ASSERT_REGULAR
      target_field: mongodbatlas.process.asserts
      if: ctx.assert_type_regular?.ASSERT_REGULAR != null
      ignore_missing: true
  - rename:
      field: assert_type_msg.ASSERT_MSG
      target_field: mongodbatlas.process.asserts
      if: ctx.assert_type_msg?.ASSERT_MSG != null
      ignore_missing: true
  - rename:
      field: assert_type_warning.ASSERT_WARNING
      target_field: mongodbatlas.process.asserts
      if: ctx.assert_type_warning?.ASSERT_WARNING != null
      ignore_missing: true
  - rename:
      field: assert_type_user.ASSERT_USER
      target_field: mongodbatlas.process.asserts
      if: ctx.assert_type_user?.ASSERT_USER != null
      ignore_missing: true
  - rename:
      field: cache_direction_read_into.CACHE_BYTES_READ_INTO
      target_field: mongodbatlas.process.cache.io
      if: ctx.cache_direction_read_into?.CACHE_BYTES_READ_INTO != null
      ignore_missing: true
  - rename:
      field: cache_status_dirty.CACHE_DIRTY_BYTES
      target_field: mongodbatlas.process.cache.size
      if: ctx.cache_status_dirty?.CACHE_DIRTY_BYTES != null
      ignore_missing: true
  - rename:
      field: cache_direction_written_from.CACHE_BYTES_WRITTEN_FROM
      target_field: mongodbatlas.process.cache.io
      if: ctx.cache_direction_written_from?.CACHE_BYTES_WRITTEN_FROM != null
      ignore_missing: true
  - rename:
      field: cpu_state_kernel.PROCESS_NORMALIZED_CPU_CHILDREN_KERNEL
      target_field: mongodbatlas.process.cpu.children.normalized.usage.average
      if: ctx.cpu_state_kernel?.PROCESS_NORMALIZED_CPU_CHILDREN_KERNEL != null
      ignore_missing: true
  - rename:
      field: cpu_state_kernel.MAX_PROCESS_NORMALIZED_CPU_CHILDREN_KERNEL
      target_field: mongodbatlas.process.cpu.children.normalized.usage.max
      if: ctx.cpu_state_kernel?.MAX_PROCESS_NORMALIZED_CPU_CHILDREN_KERNEL != null
      ignore_missing: true
  - rename:
      field: cpu_state_kernel.PROCESS_CPU_CHILDREN_KERNEL
      target_field: mongodbatlas.process.cpu.children.usage.average
      if: ctx.cpu_state_kernel?.PROCESS_CPU_CHILDREN_KERNEL != null
      ignore_missing: true
  - rename:
      field: cpu_state_kernel.MAX_PROCESS_CPU_CHILDREN_USER
      target_field: mongodbatlas.process.cpu.children.usage.max
      if: ctx.cpu_state_kernel?.MAX_PROCESS_CPU_CHILDREN_USER != null
      ignore_missing: true
  - rename:
      field: cpu_state_kernel.PROCESS_NORMALIZED_CPU_KERNEL
      target_field: mongodbatlas.process.cpu.normalized.usage.average
      if: ctx.cpu_state_kernel?.PROCESS_NORMALIZED_CPU_KERNEL != null
      ignore_missing: true
  - rename:
      field: cpu_state_kernel.MAX_PROCESS_NORMALIZED_CPU_KERNEL
      target_field: mongodbatlas.process.cpu.normalized.usage.max
      if: ctx.cpu_state_kernel?.MAX_PROCESS_NORMALIZED_CPU_KERNEL != null
      ignore_missing: true
  - rename:
      field: cpu_state_kernel.PROCESS_CPU_KERNEL
      target_field: mongodbatlas.process.cpu.usage.average
      if: ctx.cpu_state_kernel?.PROCESS_CPU_KERNEL != null
      ignore_missing: true
  - rename:
      field: cpu_state_kernel.MAX_PROCESS_CPU_KERNEL
      target_field: mongodbatlas.process.cpu.usage.max
      if: ctx.cpu_state_kernel?.MAX_PROCESS_CPU_KERNEL != null
      ignore_missing: true
  - rename:
      field: cache_status_used.CACHE_USED_BYTES
      target_field: mongodbatlas.process.cache.size
      if: ctx.cache_status_used?.CACHE_USED_BYTES != null
      ignore_missing: true
  - rename:
      field: cursor_state_timed_out.CURSORS_TOTAL_TIMED_OUT
      target_field: mongodbatlas.process.cursors
      if: ctx.cursor_state_timed_out?.CURSORS_TOTAL_TIMED_OUT != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.PROCESS_NORMALIZED_CPU_CHILDREN_USER
      target_field: mongodbatlas.process.cpu.children.normalized.usage.average
      if: ctx.cpu_state_user?.PROCESS_NORMALIZED_CPU_CHILDREN_USER != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.MAX_PROCESS_NORMALIZED_CPU_CHILDREN_USER
      target_field: mongodbatlas.process.cpu.children.normalized.usage.max
      if: ctx.cpu_state_user?.MAX_PROCESS_NORMALIZED_CPU_CHILDREN_USER != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.PROCESS_CPU_CHILDREN_USER
      target_field: mongodbatlas.process.cpu.children.usage.average
      if: ctx.cpu_state_user?.PROCESS_CPU_CHILDREN_USER != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.MAX_PROCESS_CPU_CHILDREN_USER
      target_field: mongodbatlas.process.cpu.children.usage.max
      if: ctx.cpu_state_user?.MAX_PROCESS_CPU_CHILDREN_USER != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.PROCESS_NORMALIZED_CPU_USER
      target_field: mongodbatlas.process.cpu.normalized.usage.average
      if: ctx.cpu_state_user?.PROCESS_NORMALIZED_CPU_USER != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.MAX_PROCESS_NORMALIZED_CPU_USER
      target_field: mongodbatlas.process.cpu.normalized.usage.max
      if: ctx.cpu_state_user?.MAX_PROCESS_NORMALIZED_CPU_USER != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.PROCESS_CPU_USER
      target_field: mongodbatlas.process.cpu.usage.average
      if: ctx.cpu_state_user?.PROCESS_CPU_USER != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.MAX_PROCESS_CPU_USER
      target_field: mongodbatlas.process.cpu.usage.max
      if: ctx.cpu_state_user?.MAX_PROCESS_CPU_USER != null
      ignore_missing: true
  - rename:
      field: document_status_updated.DOCUMENT_METRICS_UPDATED
      target_field: mongodbatlas.process.db.document.rate
      if: ctx.document_status_updated?.DOCUMENT_METRICS_UPDATED != null
      ignore_missing: true
  - rename:
      field: cursor_state_open.CURSORS_TOTAL_OPEN
      target_field: mongodbatlas.process.cursors
      if: ctx.cursor_state_open?.CURSORS_TOTAL_OPEN != null
      ignore_missing: true
  - rename:
      field: document_status_returned.DOCUMENT_METRICS_RETURNED
      target_field: mongodbatlas.process.db.document.rate
      if: ctx.document_status_returned?.DOCUMENT_METRICS_RETURNED != null
      ignore_missing: true
  - rename:
      field: document_status_deleted.DOCUMENT_METRICS_DELETED
      target_field: mongodbatlas.process.db.document.rate
      if: ctx.document_status_deleted?.DOCUMENT_METRICS_DELETED != null
      ignore_missing: true
  - rename:
      field: execution_type_writes.OP_EXECUTION_TIME_WRITES
      target_field: OP_EXECUTION_TIME_WRITES
      if: ctx.execution_type_writes?.OP_EXECUTION_TIME_WRITES != null
      ignore_missing: true
  - rename:
      field: document_status_inserted.DOCUMENT_METRICS_INSERTED
      target_field: mongodbatlas.process.db.document.rate
      if: ctx.document_status_inserted?.DOCUMENT_METRICS_INSERTED != null
      ignore_missing: true
  - rename:
      field: execution_type_commands.OP_EXECUTION_TIME_COMMANDS
      target_field: mongodbatlas.process.db.operations.time
      if: ctx.execution_type_commands?.OP_EXECUTION_TIME_COMMANDS != null
      ignore_missing: true
  - rename:
      field: execution_type_reads.OP_EXECUTION_TIME_READS
      target_field: mongodbatlas.process.db.operations.time
      if: ctx.execution_type_reads?.OP_EXECUTION_TIME_READS != null
      ignore_missing: true
  - rename:
      field: scanned_type_objects.QUERY_EXECUTOR_SCANNED_OBJECTS
      target_field: mongodbatlas.process.db.query_executor.scanned
      if: ctx.scanned_type_objects?.QUERY_EXECUTOR_SCANNED_OBJECTS != null
      ignore_missing: true
  - rename:
      field: scanned_type_objects.QUERY_TARGETING_SCANNED_OBJECTS_PER_RETURNED
      target_field: mongodbatlas.process.db.query_targeting.scanned_per_returned
      if: ctx.scanned_type_objects?.QUERY_TARGETING_SCANNED_OBJECTS_PER_RETURNED != null
      ignore_missing: true
  - rename:
      field: scanned_type_index_items.QUERY_EXECUTOR_SCANNED
      target_field: mongodbatlas.process.db.query_executor.scanned
      if: ctx.scanned_type_index_items?.QUERY_EXECUTOR_SCANNED != null
      ignore_missing: true
  - rename:
      field: scanned_type_index_items.QUERY_TARGETING_SCANNED_OBJECTS_PER_RETURNED
      target_field: mongodbatlas.process.db.query_targeting.scanned_per_returned
      if: ctx.scanned_type_index_items?.QUERY_TARGETING_SCANNED_OBJECTS_PER_RETURNED != null
      ignore_missing: true
  - rename:
      field: storage_status_data_size.DB_DATA_SIZE_TOTAL
      target_field: mongodbatlas.process.db.storage
      if: ctx.storage_status_data_size?.DB_DATA_SIZE_TOTAL != null
      ignore_missing: true
  - rename:
      field: storage_status_total.DB_STORAGE_TOTAL
      target_field: mongodbatlas.process.db.storage
      if: ctx.storage_status_total?.DB_STORAGE_TOTAL != null
      ignore_missing: true
  - rename:
      field: global_lock_state_current_queue_readers.GLOBAL_LOCK_CURRENT_QUEUE_READERS
      target_field: mongodbatlas.process.global_lock
      if: ctx.global_lock_state_current_queue_readers?.GLOBAL_LOCK_CURRENT_QUEUE_READERS != null
      ignore_missing: true
  - rename:
      field: global_lock_state_current_queue_writers.GLOBAL_LOCK_CURRENT_QUEUE_WRITERS
      target_field: mongodbatlas.process.global_lock
      if: ctx.global_lock_state_current_queue_writers?.GLOBAL_LOCK_CURRENT_QUEUE_WRITERS != null
      ignore_missing: true
  - rename:
      field: btree_counter_type_misses.INDEX_COUNTERS_BTREE_MISSES
      target_field: mongodbatlas.process.index.counters
      if: ctx.btree_counter_type_misses?.INDEX_COUNTERS_BTREE_MISSES != null
      ignore_missing: true
  - rename:
      field: global_lock_state_current_queue_total.GLOBAL_LOCK_CURRENT_QUEUE_TOTAL
      target_field: mongodbatlas.process.global_lock
      if: ctx.global_lock_state_current_queue_total?.GLOBAL_LOCK_CURRENT_QUEUE_TOTAL != null
      ignore_missing: true
  - rename:
      field: btree_counter_type_hits.INDEX_COUNTERS_BTREE_HITS
      target_field: mongodbatlas.process.index.counters
      if: ctx.btree_counter_type_hits?.INDEX_COUNTERS_BTREE_HITS != null
      ignore_missing: true
  - rename:
      field: btree_counter_type_accesses.INDEX_COUNTERS_BTREE_ACCESSES
      target_field: mongodbatlas.process.index.counters
      if: ctx.btree_counter_type_accesses?.INDEX_COUNTERS_BTREE_ACCESSES != null
      ignore_missing: true
  - rename:
      field: cluster_role_primary_operation_scan_and_order.OPERATIONS_SCAN_AND_ORDER
      target_field: mongodbatlas.process.db.operations.rate
      if: ctx.cluster_role_primary_operation_scan_and_order?.OPERATIONS_SCAN_AND_ORDER != null
      ignore_missing: true
  - rename:
      field: cluster_role_primary_operation_getmore.OPCOUNTER_GETMORE
      target_field: mongodbatlas.process.db.operations.rate
      if: ctx.cluster_role_primary_operation_getmore?.OPCOUNTER_GETMORE != null
      ignore_missing: true
  - rename:
      field: cluster_role_primary_operation_cmd.OPCOUNTER_CMD
      target_field: mongodbatlas.process.db.operations.rate
      if: ctx.cluster_role_primary_operation_cmd?.OPCOUNTER_CMD != null
      ignore_missing: true
  - rename:
      field: cluster_role_primary_operation_update.OPCOUNTER_UPDATE
      target_field: mongodbatlas.process.db.operations.rate
      if: ctx.cluster_role_primary_operation_update?.OPCOUNTER_UPDATE != null
      ignore_missing: true
  - rename:
      field: cluster_role_primary_operation_query.OPCOUNTER_QUERY
      target_field: mongodbatlas.process.db.operations.rate
      if: ctx.cluster_role_primary_operation_query?.OPCOUNTER_QUERY != null
      ignore_missing: true
  - rename:
      field: cluster_role_primary_operation_delete.OPCOUNTER_DELETE
      target_field: mongodbatlas.process.db.operations.rate
      if: ctx.cluster_role_primary_operation_delete?.OPCOUNTER_DELETE != null
      ignore_missing: true
  - rename:
      field: cluster_role_replica_operation_update.OPCOUNTER_REPL_UPDATE
      target_field: mongodbatlas.process.db.operations.rate
      if: ctx.cluster_role_replica_operation_update?.OPCOUNTER_REPL_UPDATE != null
      ignore_missing: true
  - rename:
      field: cluster_role_primary_operation_insert.OPCOUNTER_INSERT
      target_field: mongodbatlas.process.db.operations.rate
      if: ctx.cluster_role_primary_operation_insert?.OPCOUNTER_INSERT != null
      ignore_missing: true
  - rename:
      field: cluster_role_replica_operation_cmd.OPCOUNTER_REPL_CMD
      target_field: mongodbatlas.process.db.operations.rate
      if: ctx.cluster_role_replica_operation_cmd?.OPCOUNTER_REPL_CMD != null
      ignore_missing: true
  - rename:
      field: cluster_role_replica_operation_delete.OPCOUNTER_REPL_DELETE
      target_field: mongodbatlas.process.db.operations.rate
      if: ctx.cluster_role_replica_operation_delete?.OPCOUNTER_REPL_DELETE != null
      ignore_missing: true
  - rename:
      field: memory_state_mapped.MEMORY_MAPPED
      target_field: mongodbatlas.process.memory.usage
      if: ctx.memory_state_mapped?.MEMORY_MAPPED != null
      ignore_missing: true
  - rename:
      field: cluster_role_replica_operation_insert.OPCOUNTER_REPL_INSERT
      target_field: mongodbatlas.process.db.operations.rate
      if: ctx.cluster_role_replica_operation_insert?.OPCOUNTER_REPL_INSERT != null
      ignore_missing: true
  - rename:
      field: memory_state_computed.COMPUTED_MEMORY
      target_field: mongodbatlas.process.memory.usage
      if: ctx.memory_state_computed?.COMPUTED_MEMORY != null
      ignore_missing: true
  - rename:
      field: memory_state_virtual.MEMORY_VIRTUAL
      target_field: mongodbatlas.process.memory.usage
      if: ctx.memory_state_virtual?.MEMORY_VIRTUAL != null
      ignore_missing: true
  - rename:
      field: direction_receive.NETWORK_BYTES_IN
      target_field: mongodbatlas.process.network.io
      if: ctx.direction_receive?.NETWORK_BYTES_IN != null
      ignore_missing: true
  - rename:
      field: direction_receive.SYSTEM_NETWORK_IN
      target_field: mongodbatlas.system.network.io.average
      if: ctx.direction_receive?.SYSTEM_NETWORK_IN != null
      ignore_missing: true
  - rename:
      field: direction_receive.MAX_SYSTEM_NETWORK_IN
      target_field: mongodbatlas.system.network.io.max
      if: ctx.direction_receive?.MAX_SYSTEM_NETWORK_IN != null
      ignore_missing: true
  - rename:
      field: memory_state_resident.MEMORY_RESIDENT
      target_field: mongodbatlas.process.memory.usage
      if: ctx.memory_state_resident?.MEMORY_RESIDENT != null
      ignore_missing: true
  - rename:
      field: oplog_type_master_time.OPLOG_MASTER_TIME
      target_field: mongodbatlas.process.oplog.time
      if: ctx.oplog_type_master_time?.OPLOG_MASTER_TIME != null
      ignore_missing: true
  - rename:
      field: direction_transmit.NETWORK_BYTES_OUT
      target_field: mongodbatlas.process.network.io
      if: ctx.direction_transmit?.NETWORK_BYTES_OUT != null
      ignore_missing: true
  - rename:
      field: direction_transmit.SYSTEM_NETWORK_OUT
      target_field: mongodbatlas.system.network.io.average
      if: ctx.direction_transmit?.SYSTEM_NETWORK_OUT != null
      ignore_missing: true
  - rename:
      field: direction_transmit.MAX_SYSTEM_NETWORK_OUT
      target_field: mongodbatlas.system.network.io.max
      if: ctx.direction_transmit?.MAX_SYSTEM_NETWORK_OUT != null
      ignore_missing: true
  - rename:
      field: oplog_type_master_lag_time_diff.OPLOG_MASTER_LAG_TIME_DIFF
      target_field: mongodbatlas.process.oplog.time
      if: ctx.oplog_type_master_lag_time_diff?.OPLOG_MASTER_LAG_TIME_DIFF != null
      ignore_missing: true
  - rename:
      field: oplog_type_slave_lag_master_time.OPLOG_SLAVE_LAG_MASTER_TIME
      target_field: mongodbatlas.process.oplog.time
      if: ctx.oplog_type_slave_lag_master_time?.OPLOG_SLAVE_LAG_MASTER_TIME != null
      ignore_missing: true
  - rename:
      field: memory_issue_type_extra_info.EXTRA_INFO_PAGE_FAULTS
      target_field: mongodbatlas.process.page_faults
      if: ctx.memory_issue_type_extra_info?.EXTRA_INFO_PAGE_FAULTS != null
      ignore_missing: true
  - rename:
      field: memory_issue_type_exceptions_thrown.GLOBAL_PAGE_FAULT_EXCEPTIONS_THROWN
      target_field: mongodbatlas.process.page_faults
      if: ctx.memory_issue_type_exceptions_thrown?.GLOBAL_PAGE_FAULT_EXCEPTIONS_THROWN != null
      ignore_missing: true
  - rename:
      field: ticket_type_available_reads.TICKETS_AVAILABLE_READS
      target_field: mongodbatlas.process.tickets
      if: ctx.ticket_type_available_reads?.TICKETS_AVAILABLE_READS != null
      ignore_missing: true
  - rename:
      field: memory_issue_type_global_accesses_not_in_memory.GLOBAL_ACCESSES_NOT_IN_MEMORY
      target_field: mongodbatlas.process.page_faults
      if: ctx.memory_issue_type_global_accesses_not_in_memory?.GLOBAL_ACCESSES_NOT_IN_MEMORY != null
      ignore_missing: true
  - rename:
      field: cpu_state_iowait.SYSTEM_NORMALIZED_CPU_IOWAIT
      target_field: mongodbatlas.system.cpu.normalized.usage.average
      if: ctx.cpu_state_iowait?.SYSTEM_NORMALIZED_CPU_IOWAIT != null
      ignore_missing: true
  - rename:
      field: cpu_state_iowait.MAX_SYSTEM_NORMALIZED_CPU_IOWAIT
      target_field: mongodbatlas.system.cpu.normalized.usage.max
      if: ctx.cpu_state_iowait?.MAX_SYSTEM_NORMALIZED_CPU_IOWAIT != null
      ignore_missing: true
  - rename:
      field: cpu_state_iowait.SYSTEM_CPU_IOWAIT
      target_field: mongodbatlas.system.cpu.usage.average
      if: ctx.cpu_state_iowait?.SYSTEM_CPU_IOWAIT != null
      ignore_missing: true
  - rename:
      field: cpu_state_iowait.MAX_SYSTEM_CPU_IOWAIT
      target_field: mongodbatlas.system.cpu.usage.max
      if: ctx.cpu_state_iowait?.MAX_SYSTEM_CPU_IOWAIT != null
      ignore_missing: true
  - rename:
      field: ticket_type_available_writes.TICKETS_AVAILABLE_WRITE
      target_field: mongodbatlas.process.tickets
      if: ctx.ticket_type_available_writes?.TICKETS_AVAILABLE_WRITE != null
      ignore_missing: true
  - rename:
      field: cpu_state_irq.SYSTEM_NORMALIZED_CPU_IRQ
      target_field: mongodbatlas.system.cpu.normalized.usage.average
      if: ctx.cpu_state_irq?.SYSTEM_NORMALIZED_CPU_IRQ != null
      ignore_missing: true
  - rename:
      field: cpu_state_irq.MAX_SYSTEM_NORMALIZED_CPU_IRQ
      target_field: mongodbatlas.system.cpu.normalized.usage.max
      if: ctx.cpu_state_irq?.MAX_SYSTEM_NORMALIZED_CPU_IRQ != null
      ignore_missing: true
  - rename:
      field: cpu_state_irq.SYSTEM_CPU_IRQ
      target_field: mongodbatlas.system.cpu.usage.average
      if: ctx.cpu_state_irq?.SYSTEM_CPU_IRQ != null
      ignore_missing: true
  - rename:
      field: cpu_state_irq.MAX_SYSTEM_CPU_IRQ
      target_field: mongodbatlas.system.cpu.usage.max
      if: ctx.cpu_state_irq?.MAX_SYSTEM_CPU_IRQ != null
      ignore_missing: true
  - rename:
      field: cpu_state_guest.SYSTEM_NORMALIZED_CPU_GUEST
      target_field: mongodbatlas.system.cpu.normalized.usage.average
      if: ctx.cpu_state_guest?.SYSTEM_NORMALIZED_CPU_GUEST != null
      ignore_missing: true
  - rename:
      field: cpu_state_guest.MAX_SYSTEM_NORMALIZED_CPU_GUEST
      target_field: mongodbatlas.system.cpu.normalized.usage.max
      if: ctx.cpu_state_guest?.MAX_SYSTEM_NORMALIZED_CPU_GUEST != null
      ignore_missing: true
  - rename:
      field: cpu_state_guest.SYSTEM_CPU_GUEST
      target_field: mongodbatlas.system.cpu.usage.average
      if: ctx.cpu_state_guest?.SYSTEM_CPU_GUEST != null
      ignore_missing: true
  - rename:
      field: cpu_state_guest.MAX_SYSTEM_CPU_GUEST
      target_field: mongodbatlas.system.cpu.usage.max
      if: ctx.cpu_state_guest?.MAX_SYSTEM_CPU_GUEST != null
      ignore_missing: true
  - rename:
      field: cpu_state_steal.SYSTEM_NORMALIZED_CPU_STEAL
      target_field: mongodbatlas.system.cpu.normalized.usage.average
      if: ctx.cpu_state_steal?.SYSTEM_NORMALIZED_CPU_STEAL != null
      ignore_missing: true
  - rename:
      field: cpu_state_steal.MAX_SYSTEM_NORMALIZED_CPU_STEAL
      target_field: mongodbatlas.system.cpu.normalized.usage.max
      if: ctx.cpu_state_steal?.MAX_SYSTEM_NORMALIZED_CPU_STEAL != null
      ignore_missing: true
  - rename:
      field: cpu_state_steal.SYSTEM_CPU_STEAL
      target_field: mongodbatlas.system.cpu.usage.average
      if: ctx.cpu_state_steal?.SYSTEM_CPU_STEAL != null
      ignore_missing: true
  - rename:
      field: cpu_state_steal.MAX_SYSTEM_CPU_STEAL
      target_field: mongodbatlas.system.cpu.usage.max
      if: ctx.cpu_state_steal?.MAX_SYSTEM_CPU_STEAL != null
      ignore_missing: true
  - rename:
      field: cpu_state_KERNEL.SYSTEM_NORMALIZED_CPU_KERNEL
      target_field: mongodbatlas.system.cpu.normalized.usage.average
      if: ctx.cpu_state_KERNEL?.SYSTEM_NORMALIZED_CPU_KERNEL != null
      ignore_missing: true
  - rename:
      field: cpu_state_KERNEL.MAX_SYSTEM_NORMALIZED_CPU_KERNEL
      target_field: mongodbatlas.system.cpu.normalized.usage.max
      if: ctx.cpu_state_KERNEL?.MAX_SYSTEM_NORMALIZED_CPU_KERNEL != null
      ignore_missing: true
  - rename:
      field: cpu_state_KERNEL.SYSTEM_CPU_KERNEL
      target_field: mongodbatlas.system.cpu.usage.average
      if: ctx.cpu_state_KERNEL?.SYSTEM_CPU_KERNEL != null
      ignore_missing: true
  - rename:
      field: cpu_state_KERNEL.MAX_SYSTEM_CPU_KERNEL
      target_field: mongodbatlas.system.cpu.usage.max
      if: ctx.cpu_state_KERNEL?.MAX_SYSTEM_CPU_KERNEL != null
      ignore_missing: true
  - rename:
      field: cpu_state_KERNEL.FTS_PROCESS_NORMALIZED_CPU_KERNEL
      target_field: mongodbatlas.system.fts.cpu.normalized.usage
      if: ctx.cpu_state_KERNEL?.FTS_PROCESS_NORMALIZED_CPU_KERNEL != null
      ignore_missing: true
  - rename:
      field: cpu_state_KERNEL.FTS_PROCESS_CPU_KERNEL
      target_field: mongodbatlas.system.fts.cpu.usage
      if: ctx.cpu_state_KERNEL?.FTS_PROCESS_CPU_KERNEL != null
      ignore_missing: true
  - rename:
      field: cpu_state_nice.SYSTEM_NORMALIZED_CPU_NICE
      target_field: mongodbatlas.system.cpu.normalized.usage.average
      if: ctx.cpu_state_nice?.SYSTEM_NORMALIZED_CPU_NICE != null
      ignore_missing: true
  - rename:
      field: cpu_state_nice.MAX_SYSTEM_NORMALIZED_CPU_NICE
      target_field: mongodbatlas.system.cpu.normalized.usage.max
      if: ctx.cpu_state_nice?.MAX_SYSTEM_NORMALIZED_CPU_NICE != null
      ignore_missing: true
  - rename:
      field: cpu_state_nice.SYSTEM_CPU_NICE
      target_field: mongodbatlas.system.cpu.usage.average
      if: ctx.cpu_state_nice?.SYSTEM_CPU_NICE != null
      ignore_missing: true
  - rename:
      field: cpu_state_softirq.SYSTEM_NORMALIZED_CPU_SOFTIRQ
      target_field: mongodbatlas.system.cpu.normalized.usage.average
      if: ctx.cpu_state_softirq?.SYSTEM_NORMALIZED_CPU_SOFTIRQ != null
      ignore_missing: true
  - rename:
      field: cpu_state_softirq.MAX_SYSTEM_NORMALIZED_CPU_SOFTIRQ
      target_field: mongodbatlas.system.cpu.normalized.usage.max
      if: ctx.cpu_state_softirq?.MAX_SYSTEM_NORMALIZED_CPU_SOFTIRQ != null
      ignore_missing: true
  - rename:
      field: cpu_state_softirq.SYSTEM_CPU_SOFTIRQ
      target_field: mongodbatlas.system.cpu.usage.average
      if: ctx.cpu_state_softirq?.SYSTEM_CPU_SOFTIRQ != null
      ignore_missing: true
  - rename:
      field: cpu_state_softirq.MAX_SYSTEM_CPU_SOFTIRQ
      target_field: mongodbatlas.system.cpu.usage.max
      if: ctx.cpu_state_softirq?.MAX_SYSTEM_CPU_SOFTIRQ != null
      ignore_missing: true
  - rename:
      field: memory_state_mapped.FTS_MEMORY_MAPPED
      target_field: mongodbatlas.system.fts.memory.usage
      if: ctx.memory_state_mapped?.FTS_MEMORY_MAPPED != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.SYSTEM_NORMALIZED_CPU_USER
      target_field: mongodbatlas.system.cpu.normalized.usage.average
      if: ctx.cpu_state_user?.SYSTEM_NORMALIZED_CPU_USER != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.MAX_SYSTEM_NORMALIZED_CPU_USER
      target_field: mongodbatlas.system.cpu.normalized.usage.max
      if: ctx.cpu_state_user?.MAX_SYSTEM_NORMALIZED_CPU_USER != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.SYSTEM_CPU_USER
      target_field: mongodbatlas.system.cpu.usage.average
      if: ctx.cpu_state_user?.SYSTEM_CPU_USER != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.MAX_SYSTEM_CPU_USER
      target_field: mongodbatlas.system.cpu.usage.max
      if: ctx.cpu_state_user?.MAX_SYSTEM_CPU_USER != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.FTS_PROCESS_NORMALIZED_CPU_USER
      target_field: mongodbatlas.system.fts.cpu.normalized.usage
      if: ctx.cpu_state_user?.FTS_PROCESS_NORMALIZED_CPU_USER != null
      ignore_missing: true
  - rename:
      field: cpu_state_user.FTS_PROCESS_CPU_USER
      target_field: mongodbatlas.system.fts.cpu.usage
      if: ctx.cpu_state_user?.FTS_PROCESS_CPU_USER != null
      ignore_missing: true
  - rename:
      field: memory_state_available.SYSTEM_MEMORY_AVAILABLE
      target_field: mongodbatlas.system.memory.usage.average
      if: ctx.memory_state_available?.SYSTEM_MEMORY_AVAILABLE != null
      ignore_missing: true
  - rename:
      field: memory_state_available.MAX_SYSTEM_MEMORY_AVAILABLE
      target_field: mongodbatlas.system.memory.usage.max
      if: ctx.memory_state_available?.MAX_SYSTEM_MEMORY_AVAILABLE != null
      ignore_missing: true
  - rename:
      field: memory_state_used.SYSTEM_MEMORY_USED
      target_field: mongodbatlas.system.memory.usage.max
      if: ctx.memory_state_used?.SYSTEM_MEMORY_USED != null
      ignore_missing: true
  - rename:
      field: memory_state_used.MAX_SYSTEM_MEMORY_USED
      target_field: mongodbatlas.system.memory.usage.max
      if: ctx.memory_state_used?.MAX_SYSTEM_MEMORY_USED != null
      ignore_missing: true
  - rename:
      field: memory_state_used.SWAP_USAGE_USED
      target_field: mongodbatlas.system.paging.usage.average
      if: ctx.memory_state_used?.SWAP_USAGE_USED != null
      ignore_missing: true
  - rename:
      field: memory_state_used.MAX_SWAP_USAGE_USED
      target_field: mongodbatlas.system.paging.usage.max
      if: ctx.memory_state_used?.MAX_SWAP_USAGE_USED != null
      ignore_missing: true
  - rename:
      field: memory_state_free.SYSTEM_MEMORY_FREE
      target_field: mongodbatlas.system.memory.usage.average
      if: ctx.memory_state_free?.SYSTEM_MEMORY_FREE != null
      ignore_missing: true
  - rename:
      field: memory_state_free.MAX_SYSTEM_MEMORY_FREE
      target_field: mongodbatlas.system.memory.usage.max
      if: ctx.memory_state_free?.MAX_SYSTEM_MEMORY_FREE != null
      ignore_missing: true
  - rename:
      field: memory_state_free.SWAP_USAGE_FREE
      target_field: mongodbatlas.system.paging.usage.average
      if: ctx.memory_state_free?.SWAP_USAGE_FREE != null
      ignore_missing: true
  - rename:
      field: memory_state_free.MAX_SWAP_USAGE_FREE
      target_field: mongodbatlas.system.paging.usage.max
      if: ctx.memory_state_free?.MAX_SWAP_USAGE_FREE != null
      ignore_missing: true
  - script:
      lang: painless
      source: |-
        boolean drop(Object o) {
          if (o == null || o == '') {
            return true;
          } else if (o instanceof Map) {
            ((Map) o).values().removeIf(v -> drop(v));
            return (((Map) o).size() == 0);
          } else if (o instanceof List) {
            ((List) o).removeIf(v -> drop(v));
            return (((List) o).length == 0);
          }
          return false;
        }
        drop(ctx);
      description: Drops null/empty values recursively.
  - remove:
      field:
        - event.original
      ignore_missing: true
      if: ctx.tags == null || !(ctx.tags.contains('preserve_original_event'))
  - remove:
      field:
        - json
      ignore_missing: true
  - set:
      field: event.kind
      value: pipeline_error
      if: ctx.error?.message != null
on_failure:
  - append:
      field: error.message
      value: '{{{_ingest.on_failure_message}}}'
  - append:
      field: event.kind
      value: pipeline_error
      allow_duplicates: false