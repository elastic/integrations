---
description: Pipeline for processing MongoDB Atlas process metrics.
processors:
  - set:
      field: ecs.version
      value: 8.11.0
  - set:
      field: event.kind
      value: event
  - set:
      field: event.module
      value: mongodb_atlas
  - set:
      field: event.category
      value: ["process"]
  - set:
      field: event.type
      value: ["info"]
  - rename:
      field: groupId
      target_field: mongodb_atlas.group_id
      ignore_missing: true
  - set:
      field: group.id
      value: "{{mongodb_atlas.group_id}}"
      ignore_empty_value: true
  - rename:
      field: response.ASSERT_MSG
      target_field: mongodb_atlas.process.assert.msg
      ignore_missing: true
  - rename:
      field: response.ASSERT_REGULAR
      target_field: mongodb_atlas.process.assert.regular
      ignore_missing: true
  - rename:
      field: response.ASSERT_USER
      target_field: mongodb_atlas.process.assert.user
      ignore_missing: true
  - rename:
      field: response.ASSERT_WARNING
      target_field: mongodb_atlas.process.assert.warning
      ignore_missing: true
  - rename:
      field: response.BACKGROUND_FLUSH_AVG
      target_field: mongodb_atlas.process.background_flush.avg
      ignore_missing: true
  - rename:
      field: response.CACHE_DIRTY_BYTES
      target_field: mongodb_atlas.process.cache.dirty.bytes
      ignore_missing: true
  - rename:
      field: response.CACHE_BYTES_READ_INTO
      target_field: mongodb_atlas.process.cache.read.bytes
      ignore_missing: true
  - rename:
      field: response.CACHE_USED_BYTES
      target_field: mongodb_atlas.process.cache.used.total.bytes
      ignore_missing: true
  - rename:
      field: response.CACHE_BYTES_WRITTEN_FROM
      target_field: mongodb_atlas.process.cache.write.bytes
      ignore_missing: true
  - rename:
      field: response.CONNECTIONS
      target_field: mongodb_atlas.process.connections
      ignore_missing: true
  - rename:
      field: response.MAX_PROCESS_NORMALIZED_CPU_CHILDREN_KERNEL
      target_field: mongodb_atlas.process.cpu.normalized.children.kernel.max.pct
      ignore_missing: true
  - rename:
      field: response.MAX_PROCESS_CPU_CHILDREN_KERNEL
      target_field: mongodb_atlas.process.cpu.children.kernel.max.pct
      ignore_missing: true
  - rename:
      field: response.PROCESS_CPU_CHILDREN_KERNEL
      target_field: mongodb_atlas.process.cpu.children.kernel.pct
      ignore_missing: true
  - rename:
      field: response.MAX_PROCESS_CPU_CHILDREN_USER
      target_field: mongodb_atlas.process.cpu.children.user.max.pct
      ignore_missing: true
  - rename:
      field: response.PROCESS_CPU_CHILDREN_USER
      target_field: mongodb_atlas.process.cpu.children.user.pct
      ignore_missing: true
  - rename:
      field: response.MAX_PROCESS_CPU_KERNEL
      target_field: mongodb_atlas.process.cpu.kernel.max.pct
      ignore_missing: true
  - rename:
      field: response.PROCESS_CPU_KERNEL
      target_field: mongodb_atlas.process.cpu.kernel.pct
      ignore_missing: true
  - rename:
      field: response.PROCESS_NORMALIZED_CPU_CHILDREN_KERNEL
      target_field: mongodb_atlas.process.cpu.normalized.children.kernel.pct
      ignore_missing: true
  - rename:
      field: response.MAX_PROCESS_NORMALIZED_CPU_CHILDREN_USER
      target_field: mongodb_atlas.process.cpu.normalized.children.user.max.pct
      ignore_missing: true
  - rename:
      field: response.PROCESS_NORMALIZED_CPU_CHILDREN_USER
      target_field: mongodb_atlas.process.cpu.normalized.children.user.pct
      ignore_missing: true
  - rename:
      field: response.MAX_PROCESS_NORMALIZED_CPU_KERNEL
      target_field: mongodb_atlas.process.cpu.normalized.kernel.max.pct
      ignore_missing: true
  - rename:
      field: response.PROCESS_NORMALIZED_CPU_KERNEL
      target_field: mongodb_atlas.process.cpu.normalized.kernel.pct
      ignore_missing: true
  - rename:
      field: response.MAX_PROCESS_NORMALIZED_CPU_USER
      target_field: mongodb_atlas.process.cpu.normalized.user.max.pct
      ignore_missing: true
  - rename:
      field: response.PROCESS_NORMALIZED_CPU_USER
      target_field: mongodb_atlas.process.cpu.normalized.user.pct
      ignore_missing: true
  - rename:
      field: response.MAX_PROCESS_CPU_USER
      target_field: mongodb_atlas.process.cpu.user.max.pct
      ignore_missing: true
  - rename:
      field: response.PROCESS_CPU_USER
      target_field: mongodb_atlas.process.cpu.user.pct
      ignore_missing: true
  - rename:
      field: response.CURSORS_TOTAL_OPEN
      target_field: mongodb_atlas.process.cursor.open.total
      ignore_missing: true
  - rename:
      field: response.CURSORS_TOTAL_TIMED_OUT
      target_field: mongodb_atlas.process.cursor.timed_out.total
      ignore_missing: true
  - rename:
      field: response.DB_DATA_SIZE_TOTAL
      target_field: mongodb_atlas.process.database.size.total.bytes
      ignore_missing: true
  - rename:
      field: response.DB_STORAGE_TOTAL
      target_field: mongodb_atlas.process.database.storage.total.bytes
      ignore_missing: true
  - rename:
      field: response.DOCUMENT_METRICS_DELETED
      target_field: mongodb_atlas.process.document.deleted
      ignore_missing: true
  - rename:
      field: response.DOCUMENT_METRICS_INSERTED
      target_field: mongodb_atlas.process.document.inserted
      ignore_missing: true
  - rename:
      field: response.DOCUMENT_METRICS_RETURNED
      target_field: mongodb_atlas.process.document.returned
      ignore_missing: true
  - rename:
      field: response.DOCUMENT_METRICS_UPDATED
      target_field: mongodb_atlas.process.document.updated
      ignore_missing: true
  - rename:
      field: response.FTS_PROCESS_CPU_KERNEL
      target_field: mongodb_atlas.process.fts.cpu.kernel.pct
      ignore_missing: true
  - rename:
      field: response.FTS_PROCESS_NORMALIZED_CPU_KERNEL
      target_field: mongodb_atlas.process.fts.cpu.normalized.kernel.pct
      ignore_missing: true
  - rename:
      field: response.FTS_PROCESS_NORMALIZED_CPU_USER
      target_field: mongodb_atlas.process.fts.cpu.normalized.user.pct
      ignore_missing: true
  - rename:
      field: response.FTS_PROCESS_CPU_USER
      target_field: mongodb_atlas.process.fts.cpu.user.pct
      ignore_missing: true
  - rename:
      field: response.FTS_DISK_UTILIZATION
      target_field: mongodb_atlas.process.fts.disk.utilization.total.bytes
      ignore_missing: true
  - rename:
      field: response.FTS_MEMORY_MAPPED
      target_field: mongodb_atlas.process.fts.memory.mapped.total.bytes
      ignore_missing: true
  - rename:
      field: response.FTS_MEMORY_RESIDENT
      target_field: mongodb_atlas.process.fts.memory.resident.total.bytes
      ignore_missing: true
  - rename:
      field: response.FTS_MEMORY_VIRTUAL
      target_field: mongodb_atlas.process.fts.memory.virtual.total.bytes
      ignore_missing: true
  - rename:
      field: response.GLOBAL_ACCESSES_NOT_IN_MEMORY
      target_field: mongodb_atlas.process.global.access.not_in_memory
      ignore_missing: true
  - rename:
      field: response.GLOBAL_LOCK_CURRENT_QUEUE_READERS
      target_field: mongodb_atlas.process.global.lock.current_queue.reader.count
      ignore_missing: true
  - rename:
      field: response.GLOBAL_LOCK_CURRENT_QUEUE_TOTAL
      target_field: mongodb_atlas.process.global.lock.current_queue.total
      ignore_missing: true
  - rename:
      field: response.GLOBAL_LOCK_CURRENT_QUEUE_WRITERS
      target_field: mongodb_atlas.process.global.lock.current_queue.writer.count
      ignore_missing: true
  - rename:
      field: response.GLOBAL_PAGE_FAULT_EXCEPTIONS_THROWN
      target_field: mongodb_atlas.process.global.page_fault.exception_thrown
      ignore_missing: true
  - rename:
      field: response.EXTRA_INFO_PAGE_FAULTS
      target_field: mongodb_atlas.process.host.page_faults
      ignore_missing: true
  - rename:
      field: response.INDEX_COUNTERS_BTREE_ACCESSES
      target_field: mongodb_atlas.process.index.btree.access.count
      ignore_missing: true
  - rename:
      field: response.INDEX_COUNTERS_BTREE_HITS
      target_field: mongodb_atlas.process.index.btree.hits.count
      ignore_missing: true
  - rename:
      field: response.INDEX_COUNTERS_BTREE_MISS_RATIO
      target_field: mongodb_atlas.process.index.btree.miss_ratio.count
      ignore_missing: true
  - rename:
      field: response.INDEX_COUNTERS_BTREE_MISSES
      target_field: mongodb_atlas.process.index.btree.miss.count
      ignore_missing: true
  - rename:
      field: response.JOURNALING_COMMITS_IN_WRITE_LOCK
      target_field: mongodb_atlas.process.journaling.commits.write_lock
      ignore_missing: true
  - rename:
      field: response.JOURNALING_MB
      target_field: mongodb_atlas.process.journaling.mb
      ignore_missing: true
  - rename:
      field: response.JOURNALING_WRITE_DATA_FILES_MB
      target_field: mongodb_atlas.process.journaling.write.data_files.mb
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_NORMALIZED_CPU_USER
      target_field: mongodb_atlas.process.system.normalized.cpu.user.max.pct
      ignore_missing: true
  - rename:
      field: response.COMPUTED_MEMORY
      target_field: mongodb_atlas.process.memory.computed.mb
      ignore_missing: true
  - rename:
      field: response.MEMORY_MAPPED
      target_field: mongodb_atlas.process.memory.mapped.mb
      ignore_missing: true
  - rename:
      field: response.MEMORY_RESIDENT
      target_field: mongodb_atlas.process.memory.resident.mb
      ignore_missing: true
  - rename:
      field: response.MEMORY_VIRTUAL
      target_field: mongodb_atlas.process.memory.virtual.mb
      ignore_missing: true
  - rename:
      field: response.NETWORK_BYTES_IN
      target_field: mongodb_atlas.process.network.in
      ignore_missing: true
  - rename:
      field: response.NETWORK_BYTES_OUT
      target_field: mongodb_atlas.process.network.out
      ignore_missing: true
  - rename:
      field: response.NETWORK_NUM_REQUESTS
      target_field: mongodb_atlas.process.network.request.total
      ignore_missing: true
  - rename:
      field: response.OPCOUNTER_CMD
      target_field: mongodb_atlas.process.opcounter.cmd
      ignore_missing: true
  - rename:
      field: response.OPCOUNTER_DELETE
      target_field: mongodb_atlas.process.opcounter.delete
      ignore_missing: true
  - rename:
      field: response.OPCOUNTER_GETMORE
      target_field: mongodb_atlas.process.opcounter.getmore
      ignore_missing: true
  - rename:
      field: response.OPCOUNTER_INSERT
      target_field: mongodb_atlas.process.opcounter.insert
      ignore_missing: true
  - rename:
      field: response.OPCOUNTER_QUERY
      target_field: mongodb_atlas.process.opcounter.query
      ignore_missing: true
  - rename:
      field: response.OPCOUNTER_REPL_CMD
      target_field: mongodb_atlas.process.opcounter.repl.cmd
      ignore_missing: true
  - rename:
      field: response.OPCOUNTER_REPL_DELETE
      target_field: mongodb_atlas.process.opcounter.repl.delete
      ignore_missing: true
  - rename:
      field: response.OPCOUNTER_REPL_INSERT
      target_field: mongodb_atlas.process.opcounter.repl.insert
      ignore_missing: true
  - rename:
      field: response.OPCOUNTER_REPL_UPDATE
      target_field: mongodb_atlas.process.opcounter.repl.update
      ignore_missing: true
  - rename:
      field: response.OPCOUNTER_UPDATE
      target_field: mongodb_atlas.process.opcounter.update
      ignore_missing: true
  - rename:
      field: response.OP_EXECUTION_TIME_COMMANDS
      target_field: mongodb_atlas.process.operation.execution.time.cmd.avg.ms
      ignore_missing: true
  - rename:
      field: response.OP_EXECUTION_TIME_READS
      target_field: mongodb_atlas.process.operation.execution.time.read.avg.ms
      ignore_missing: true
  - rename:
      field: response.OP_EXECUTION_TIME_WRITES
      target_field: mongodb_atlas.process.operation.execution.time.write.avg.ms
      ignore_missing: true
  - rename:
      field: response.OPERATIONS_SCAN_AND_ORDER
      target_field: mongodb_atlas.process.operation.scan_and_order
      ignore_missing: true
  - rename:
      field: response.OPLOG_MASTER_LAG_TIME_DIFF
      target_field: mongodb_atlas.process.oplog.master.lag.time_diff.s
      ignore_missing: true
  - rename:
      field: response.OPLOG_MASTER_TIME
      target_field: mongodb_atlas.process.oplog.master.time.s
      ignore_missing: true
  - rename:
      field: response.OPLOG_RATE_GB_PER_HOUR
      target_field: mongodb_atlas.process.oplog.rate.gb_per_hour
      ignore_missing: true
  - rename:
      field: response.OPLOG_REPLICATION_LAG
      target_field: mongodb_atlas.process.oplog.repl_lag.s
      ignore_missing: true
  - rename:
      field: response.OPLOG_SLAVE_LAG_MASTER_TIME
      target_field: mongodb_atlas.process.oplog.slave.lag.master.time.s
      ignore_missing: true
  - rename:
      field: response.QUERY_EXECUTOR_SCANNED
      target_field: mongodb_atlas.process.query.executor.scanned
      ignore_missing: true
  - rename:
      field: response.QUERY_EXECUTOR_SCANNED_OBJECTS
      target_field: mongodb_atlas.process.query.executor.scanned_objects
      ignore_missing: true
  - rename:
      field: response.QUERY_TARGETING_SCANNED_OBJECTS_PER_RETURNED
      target_field: mongodb_atlas.process.query.targeting.scanned_objects_per_returned
      ignore_missing: true
  - rename:
      field: response.QUERY_TARGETING_SCANNED_PER_RETURNED
      target_field: mongodb_atlas.process.query.targeting.scanned_per_returned
      ignore_missing: true
  - rename:
      field: response.RESTARTS_IN_LAST_HOUR
      target_field: mongodb_atlas.process.restart.in_last_hour
      ignore_missing: true
  - rename:
      field: response.MAX_SWAP_USAGE_FREE
      target_field: mongodb_atlas.process.swap.usage.free.max.kb
      ignore_missing: true
  - rename:
      field: response.SWAP_USAGE_FREE
      target_field: mongodb_atlas.process.swap.usage.total.free
      ignore_missing: true
  - rename:
      field: response.SWAP_USAGE_USED
      target_field: mongodb_atlas.process.swap.usage.total.used
      ignore_missing: true
  - rename:
      field: response.MAX_SWAP_USAGE_USED
      target_field: mongodb_atlas.process.swap.usage.used.max.kb
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_CPU_GUEST
      target_field: mongodb_atlas.process.system.cpu.guest.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_CPU_GUEST
      target_field: mongodb_atlas.process.system.cpu.guest.pct
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_CPU_IOWAIT
      target_field: mongodb_atlas.process.system.cpu.iowait.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_CPU_IOWAIT
      target_field: mongodb_atlas.process.system.cpu.iowait.pct
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_CPU_IRQ
      target_field: mongodb_atlas.process.system.cpu.irq.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_CPU_IRQ
      target_field: mongodb_atlas.process.system.cpu.irq.pct
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_CPU_KERNEL
      target_field: mongodb_atlas.process.system.cpu.kernel.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_CPU_KERNEL
      target_field: mongodb_atlas.process.system.cpu.kernel.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_CPU_NICE
      target_field: mongodb_atlas.process.system.cpu.nice.pct
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_CPU_SOFTIRQ
      target_field: mongodb_atlas.process.system.cpu.softirq.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_CPU_SOFTIRQ
      target_field: mongodb_atlas.process.system.cpu.softirq.pct
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_CPU_STEAL
      target_field: mongodb_atlas.process.system.cpu.steal.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_CPU_STEAL
      target_field: mongodb_atlas.process.system.cpu.steal.pct
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_CPU_USER
      target_field: mongodb_atlas.process.system.cpu.user.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_CPU_USER
      target_field: mongodb_atlas.process.system.cpu.user.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_MEMORY_AVAILABLE
      target_field: mongodb_atlas.process.system.memory.available.kb
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_MEMORY_AVAILABLE
      target_field: mongodb_atlas.process.system.memory.available.max.kb
      ignore_missing: true
  - rename:
      field: response.SYSTEM_MEMORY_FREE
      target_field: mongodb_atlas.process.system.memory.free.kb
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_MEMORY_FREE
      target_field: mongodb_atlas.process.system.memory.free.max.kb
      ignore_missing: true
  - rename:
      field: response.SYSTEM_MEMORY_USED
      target_field: mongodb_atlas.process.system.memory.used.kb
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_MEMORY_USED
      target_field: mongodb_atlas.process.system.memory.used.max.kb
      ignore_missing: true
  - rename:
      field: response.SYSTEM_NETWORK_IN
      target_field: mongodb_atlas.process.system.network.in
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_NETWORK_IN
      target_field: mongodb_atlas.process.system.network.max.in
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_NETWORK_OUT
      target_field: mongodb_atlas.process.system.network.max.out
      ignore_missing: true
  - rename:
      field: response.SYSTEM_NETWORK_OUT
      target_field: mongodb_atlas.process.system.network.out
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_NORMALIZED_CPU_GUEST
      target_field: mongodb_atlas.process.system.normalized.cpu.guest.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_NORMALIZED_CPU_GUEST
      target_field: mongodb_atlas.process.system.normalized.cpu.guest.pct
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_NORMALIZED_CPU_IOWAIT
      target_field: mongodb_atlas.process.system.normalized.cpu.iowait.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_NORMALIZED_CPU_IOWAIT
      target_field: mongodb_atlas.process.system.normalized.cpu.iowait.pct
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_NORMALIZED_CPU_IRQ
      target_field: mongodb_atlas.process.system.normalized.cpu.irq.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_NORMALIZED_CPU_IRQ
      target_field: mongodb_atlas.process.system.normalized.cpu.irq.pct
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_NORMALIZED_CPU_KERNEL
      target_field: mongodb_atlas.process.system.normalized.cpu.kernel.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_NORMALIZED_CPU_KERNEL
      target_field: mongodb_atlas.process.system.normalized.cpu.kernel.pct
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_NORMALIZED_CPU_NICE
      target_field: mongodb_atlas.process.system.normalized.cpu.nice.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_NORMALIZED_CPU_NICE
      target_field: mongodb_atlas.process.system.normalized.cpu.nice.pct
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_NORMALIZED_CPU_SOFTIRQ
      target_field: mongodb_atlas.process.system.normalized.cpu.softirq.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_NORMALIZED_CPU_SOFTIRQ
      target_field: mongodb_atlas.process.system.normalized.cpu.softirq.pct
      ignore_missing: true
  - rename:
      field: response.MAX_SYSTEM_NORMALIZED_CPU_STEAL
      target_field: mongodb_atlas.process.system.normalized.cpu.steal.max.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_NORMALIZED_CPU_STEAL
      target_field: mongodb_atlas.process.system.normalized.cpu.steal.pct
      ignore_missing: true
  - rename:
      field: response.SYSTEM_NORMALIZED_CPU_USER
      target_field: mongodb_atlas.process.system.normalized.cpu.user.pct
      ignore_missing: true
  - rename:
      field: response.TICKETS_AVAILABLE_READS
      target_field: mongodb_atlas.process.ticket.available.read.count
      ignore_missing: true
  - rename:
      field: response.TICKETS_AVAILABLE_WRITE
      target_field: mongodb_atlas.process.ticket.available.write.count
      ignore_missing: true
  - rename:
      field: groupId
      target_field: mongodb_atlas.group_id
      ignore_missing: true
  - rename:
      field: processId
      target_field: mongodb_atlas.process_id
      ignore_missing: true
  - rename:
      field: hostId
      target_field: mongodb_atlas.host_id
      ignore_missing: true
  - remove:
      field:
      - response
      - start
      - granularity
      - end
      - databaseName
      ignore_missing: true
  - script:
      description: "Drops null/empty values recursively."
      lang: painless
      source: |
        boolean drop(Object o) {
          if (o == null || o == "") {
            return true;
          } else if (o instanceof Map) {
            ((Map) o).values().removeIf(v -> drop(v));
            return (((Map) o).size() == 0);
          } else if (o instanceof List) {
            ((List) o).removeIf(v -> drop(v));
            return (((List) o).size() == 0);
          }
          return false;
        }
        drop(ctx);
  - set:
      field: event.kind
      value: pipeline_error
      if: ctx.error?.message != null
on_failure:
  - append:
      field: error.message
      value: '{{{_ingest.on_failure_message}}}'
  - append:
      field: event.kind
      value: pipeline_error
      allow_duplicates: false