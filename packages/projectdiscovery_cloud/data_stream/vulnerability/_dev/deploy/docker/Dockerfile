FROM golang:1.21-alpine AS builder

WORKDIR /app

# Copy Go source
COPY main.go .

# Initialize Go module and build
RUN go mod init mock-pd-api && \
    go build -o mock-server main.go

# Final stage
FROM alpine:latest

WORKDIR /app

# Copy binary and mock data
COPY --from=builder /app/mock-server .
COPY mock_data.json .

EXPOSE 8080

HEALTHCHECK --interval=5s --timeout=3s --start-period=5s --retries=3 \
    CMD wget --quiet --tries=1 --spider http://localhost:8080/health || exit 1

CMD ["./mock-server"]
