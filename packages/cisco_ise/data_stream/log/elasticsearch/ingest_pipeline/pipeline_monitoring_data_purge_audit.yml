---
processors:
- set:
    field: "event.kind"
    value: "event"
- grok:
    field: "message"
    patterns:
    - "^%{TIMESTAMP_ISO8601:_tmp.timestamp} %{ISO8601_TIMEZONE:event.timezone} %{DATA:cisco_ise.log.message.code}\
      \ %{DATA:log.syslog.severity.name} %{DATA:cisco_ise.log.message.description},\
      \ %{GREEDYDATA:cisco_ise.log.log_details_raw},"
- grok:
    field: "cisco_ise.log.message.description"
    if: "ctx.cisco_ise?.log?.message?.description != null && ctx.cisco_ise.log.message.description\
      \ != ''"
    patterns:
    - "^%{DATA:event.action}:"
    ignore_failure: true
- kv:
    field: "cisco_ise.log.log_details_raw"
    target_field: "cisco_ise.log.log_details"
    field_split: ", "
    value_split: "="
    ignore_failure: true
- dissect:
    field: "cisco_ise.log.log_details.MESSAGE"
    pattern: "Total Data threshold_space = %{cisco_ise.log.log_details.threshold_space}"
    ignore_missing: true
    ignore_failure: true
- date:
    field: "_tmp.timestamp"
    formats:
    - "yyyy-MM-dd HH:mm:ss.SSS"
    - "yyyy-MM-dd HH:mm:ss.SSSSSS"
    - "MMM  d HH:mm:ss"
    - "MMM dd HH:mm:ss"
    - "MMM d HH:mm:ss"
    on_failure:
    - remove:
        field: "_tmp.timestamp"
        ignore_missing: true
    - append:
        field: "error.message"
        value: "{{{_ingest.on_failure_message}}}"
- date:
    if: "ctx.event?.timezone != null && ctx.event.timezone != ''"
    field: "_tmp.timestamp"
    formats:
    - "yyyy-MM-dd HH:mm:ss.SSS"
    - "yyyy-MM-dd HH:mm:ss.SSSSSS"
    - "MMM  d HH:mm:ss"
    - "MMM dd HH:mm:ss"
    - "MMM d HH:mm:ss"
    timezone: "{{{event.timezone}}}"
    on_failure:
    - remove:
        field: "_tmp.timestamp"
        ignore_missing: true
    - append:
        field: "error.message"
        value: "{{{_ingest.on_failure_message}}}"
- set:
    field: "event.action"
    value: "data_purge"
    if: "ctx?.event?.action == 'null'"
- append:
    field: "event.category"
    value: "process"
    ignore_failure: true
- append:
    field: "event.type"
    value:
      - "info"
- lowercase:
    field: "log.syslog.severity.name"
- set:
    field: "log.level"
    copy_from: "log.syslog.severity.name"
    if: ctx.log?.syslog?.severity?.name != null
- rename:
    field: "cisco_ise.log.log_details.used_space "
    target_field: "cisco_ise.log.log_details.used_space"
    ignore_missing: true
- trim:
    field: "cisco_ise.log.log_details.used_space"
    ignore_missing: true
- remove:
    field: "cisco_ise.log.log_details.MESSAGE"
    if: "ctx?.cisco_ise?.log?.log_details?.threshold_space != null"
    ignore_failure: true
- rename:
    field: "cisco_ise.log.log_details.MESSAGE"
    target_field: "cisco_ise.log.log_details.message"
    ignore_missing: true
on_failure:
  - set:
      field: event.kind
      value: pipeline_error
  - append:
      field: error.message
      value: '{{{ _ingest.on_failure_message }}}'