{{- $id := generate "id" }}
{{- $providerAlertId := generate "providerAlertId" }}
{{- $incidentId := generate "incidentId" }}
{{- $status := generate "status" }}
{{- $severity := generate "severity" }}
{{- $classification := generate "classification" }}
{{- $determination := generate "determination" }}
{{- $serviceSource := generate "serviceSource" }}
{{- $detectionSource := generate "detectionSource" }}
{{- $productName := generate "productName" }}
{{- $detectorId := generate "detectorId" }}
{{- $tenantId := generate "tenantId" }}
{{- $title := generate "title" }}
{{- $description := generate "description" }}
{{- $recommendedActions := generate "recommendedActions" }}
{{- $category := generate "category" }}
{{- $assignedTo := generate "assignedTo" }}
{{- $alertWebUrl := generate "alertWebUrl" }}
{{- $incidentWebUrl := generate "incidentWebUrl" }}
{{- $actorDisplayName := generate "actorDisplayName" }}
{{- $threatDisplayName := generate "threatDisplayName" }}
{{- $threatFamilyName := generate "threatFamilyName" }}
{{- $mitreTechniques := generate "mitreTechniques" }}
{{- $createdDateTime := generate "createdDateTime" | date "2006-01-02T15:04:05.000000Z" }}
{{- $lastUpdateDateTime := generate "lastUpdateDateTime" | date "2006-01-02T15:04:05.000000Z" }}
{{- $resolvedDateTime := generate "resolvedDateTime" | date "2006-01-02T15:04:05.000000Z" }}
{{- $firstActivityDateTime := generate "firstActivityDateTime" | date "2006-01-02T15:04:05.000000Z" }}
{{- $lastActivityDateTime := generate "lastActivityDateTime" | date "2006-01-02T15:04:05.000000Z" }}
{{- $alertPolicyId := generate "alertPolicyId" }}
{{- $additionalData := generate "additionalData" }}
{{- $comments := generate "comments" }}
{{- $evidenceInternetmessageid := generate "evidence.internetMessageId" }}
{{- $evidenceNetworkmessageid := generate "evidence.networkMessageId" }}
{{- $evidenceSenderip := generate "evidence.senderIp" }}
{{- $evidenceCreateddatetime := generate "evidence.createdDateTime" | date "2006-01-02T15:04:05.000000Z" }}
{{- $evidenceVerdict := generate "evidence.verdict" }}
{{- $evidenceRemediationstatus := generate "evidence.remediationStatus" }}
{{- $evidenceRemediationstatusdetails := generate "evidence.remediationStatusDetails" }}
{{- $evidenceRoles := generate "evidence.roles" }}
{{- $evidenceDetailedroles := generate "evidence.detailedRoles" }}
{{- $evidenceTags := generate "evidence.tags" }}
{{- $evidenceFirstseendatetime := generate "evidence.firstSeenDateTime" | date "2006-01-02T15:04:05.000000Z" }}
{{- $evidenceMdedeviceid := generate "evidence.mdeDeviceId" }}
{{- $evidenceAzureaddeviceid := generate "evidence.azureAdDeviceId" }}
{{- $evidenceDevicednsname := generate "evidence.deviceDnsName" }}
{{- $evidenceOsplatform := generate "evidence.osPlatform" }}
{{- $evidenceOsbuild := generate "evidence.osBuild" }}
{{- $evidenceVersion := generate "evidence.version" }}
{{- $evidenceHealthstatus := generate "evidence.healthStatus" }}
{{- $evidenceRiskscore := generate "evidence.riskScore" }}
{{- $evidenceRbacgroupid := generate "evidence.rbacGroupId" }}
{{- $evidenceRbacgroupname := generate "evidence.rbacGroupName" }}
{{- $evidenceOnboardingstatus := generate "evidence.onboardingStatus" }}
{{- $evidenceDefenderavstatus := generate "evidence.defenderAvStatus" }}
{{- $evidenceIpinterfaces := generate "evidence.ipInterfaces" }}
{{- $evidenceVmmetadata := generate "evidence.vmMetadata" }}
{{- $evidenceLoggedonusersAccountname := generate "evidence.loggedOnUsers.accountName" }}
{{- $evidenceLoggedonusersDomainname := generate "evidence.loggedOnUsers.domainName" }}
{{- /*
{
  "id": "{{$id}}",
  "providerAlertId": "{{$providerAlertId}}",
  "incidentId": "{{$incidentId}}",
  "status": "{{$status}}",
  "severity": "{{$severity}}",
  "classification": "{{$classification}}",
  "determination": "{{$determination}}",
  "serviceSource": "{{$serviceSource}}",
  "detectionSource": "{{$detectionSource}}",
  "productName": "{{$productName}}",
  "detectorId": "{{$detectorId}}",
  "tenantId": "{{$tenantId}}",
  "title": "{{$title}}",
  "description": "{{$description}}",
  "recommendedActions": "{{$recommendedActions}}",
  "category": "{{$category}}",
  "assignedTo": "{{$assignedTo}}",
  "alertWebUrl": "{{$alertWebUrl}}",
  "incidentWebUrl": "{{$incidentWebUrl}}",
  "actorDisplayName": "{{$actorDisplayName}}",
  "threatDisplayName": "{{$threatDisplayName}}",
  "threatFamilyName": "{{$threatFamilyName}}",
  "mitreTechniques": [ "{{$mitreTechniques}}" ],
  "createdDateTime": "{{$createdDateTime}}",
  "lastUpdateDateTime": "{{$lastUpdateDateTime}}",
  "resolvedDateTime": "{{$resolvedDateTime}}",
  "firstActivityDateTime": "{{$firstActivityDateTime}}",
  "lastActivityDateTime": "{{$lastActivityDateTime}}",
  "alertPolicyId": "{{$alertPolicyId}}",
  "additionalData": "{{$additionalData}}",
  "comments": [ "{{$comments}}" ],
  "evidence": [
    {
      "internetMessageId": "{{$evidenceInternetmessageid}}",
      "networkMessageId": "{{$evidenceNetworkmessageid}}",
      "senderIp": "{{$evidenceSenderip}}",
      "createdDateTime": "{{$evidenceCreateddatetime}}",
      "verdict": "{{$evidenceVerdict}}",
      "remediationStatus": "{{$evidenceRemediationstatus}}",
      "remediationStatusDetails": "{{$evidenceRemediationstatusdetails}}",
      "roles": [ "{{$evidenceRoles}}" ],
      "detailedRoles": [ "{{$evidenceDetailedroles}}" ],
      "tags": [ "{{$evidenceTags}}" ],
      "firstSeenDateTime": "{{$evidenceFirstseendatetime}}",
      "mdeDeviceId": "{{$evidenceMdedeviceid}}",
      "azureAdDeviceId": "{{$evidenceAzureaddeviceid}}",
      "deviceDnsName": "{{$evidenceDevicednsname}}",
      "osPlatform": "{{$evidenceOsplatform}}",
      "osBuild": "{{$evidenceOsbuild}}",
      "version": "{{$evidenceVersion}}",
      "healthStatus": "{{$evidenceHealthstatus}}",
      "riskScore": "{{$evidenceRiskscore}}",
      "rbacGroupId": "{{$evidenceRbacgroupid}}",
      "rbacGroupName": "{{$evidenceRbacgroupname}}",
      "onboardingStatus": "{{$evidenceOnboardingstatus}}",
      "defenderAvStatus": "{{$evidenceDefenderavstatus}}",
      "ipInterfaces": [ "{{$evidenceIpinterfaces}}" ],
      "vmMetadata": "{{$evidenceVmmetadata}}",
      "loggedOnUsers": [
        {
          "accountName": "{{$evidenceLoggedonusersAccountname}}",
          "domainName": "{{$evidenceLoggedonusersDomainname}}"
        }
      ]
    }
  ]
}
*/ -}}
{
    "agent": {
        "ephemeral_id": "cdaaaabb-be7e-432f-816b-bda019fd7c15",
        "id": "da6cb4c8-c84c-4c5f-97c7-f8586a098af4",
        "name": "docker-fleet-agent",
        "type": "filebeat",
        "version": "8.18.0"
    },
    "data_stream": {
        "dataset": "m365_defender.alert",
        "namespace": "93724",
        "type": "logs"
    },
    "elastic_agent": {
        "id": "da6cb4c8-c84c-4c5f-97c7-f8586a098af4",
        "snapshot": false,
        "version": "8.18.0"
    },
    "message": "{\"id\":\"{{$id}}\",\"providerAlertId\":\"{{$providerAlertId}}\",\"incidentId\":\"{{$incidentId}}\",\"status\":\"{{$status}}\",\"severity\":\"{{$severity}}\",\"classification\":\"{{$classification}}\",\"determination\":\"{{$determination}}\",\"serviceSource\":\"{{$serviceSource}}\",\"detectionSource\":\"{{$detectionSource}}\",\"productName\":\"{{$productName}}\",\"detectorId\":\"{{$detectorId}}\",\"tenantId\":\"{{$tenantId}}\",\"title\":\"{{$title}}\",\"description\":\"{{$description}}\",\"recommendedActions\":\"{{$recommendedActions}}\",\"category\":\"{{$category}}\",\"assignedTo\":\"{{$assignedTo}}\",\"alertWebUrl\":\"{{$alertWebUrl}}\",\"incidentWebUrl\":\"{{$incidentWebUrl}}\",\"actorDisplayName\":\"{{$actorDisplayName}}\",\"threatDisplayName\":\"{{$threatDisplayName}}\",\"threatFamilyName\":\"{{$threatFamilyName}}\",\"mitreTechniques\":[\"{{$mitreTechniques}}\"],\"createdDateTime\":\"{{$createdDateTime}}\",\"lastUpdateDateTime\":\"{{$lastUpdateDateTime}}\",\"resolvedDateTime\":\"{{$resolvedDateTime}}\",\"firstActivityDateTime\":\"{{$firstActivityDateTime}}\",\"lastActivityDateTime\":\"{{$lastActivityDateTime}}\",\"alertPolicyId\":\"{{$alertPolicyId}}\",\"additionalData\":\"{{$additionalData}}\",\"comments\":[\"{{$comments}}\"],\"evidence\":[{\"internetMessageId\":\"{{$evidenceInternetmessageid}}\",\"networkMessageId\":\"{{$evidenceNetworkmessageid}}\",\"senderIp\":\"{{$evidenceSenderip}}\",\"createdDateTime\":\"{{$evidenceCreateddatetime}}\",\"verdict\":\"{{$evidenceVerdict}}\",\"remediationStatus\":\"{{$evidenceRemediationstatus}}\",\"remediationStatusDetails\":\"{{$evidenceRemediationstatusdetails}}\",\"roles\":[\"{{$evidenceRoles}}\"],\"detailedRoles\":[\"{{$evidenceDetailedroles}}\"],\"tags\":[\"{{$evidenceTags}}\"],\"firstSeenDateTime\":\"{{$evidenceFirstseendatetime}}\",\"mdeDeviceId\":\"{{$evidenceMdedeviceid}}\",\"azureAdDeviceId\":\"{{$evidenceAzureaddeviceid}}\",\"deviceDnsName\":\"{{$evidenceDevicednsname}}\",\"osPlatform\":\"{{$evidenceOsplatform}}\",\"osBuild\":\"{{$evidenceOsbuild}}\",\"version\":\"{{$evidenceVersion}}\",\"healthStatus\":\"{{$evidenceHealthstatus}}\",\"riskScore\":\"{{$evidenceRiskscore}}\",\"rbacGroupId\":\"{{$evidenceRbacgroupid}}\",\"rbacGroupName\":\"{{$evidenceRbacgroupname}}\",\"onboardingStatus\":\"{{$evidenceOnboardingstatus}}\",\"defenderAvStatus\":\"{{$evidenceDefenderavstatus}}\",\"ipInterfaces\":[\"{{$evidenceIpinterfaces}}\"],\"vmMetadata\":\"{{$evidenceVmmetadata}}\",\"loggedOnUsers\":[{\"accountName\":\"{{$evidenceLoggedonusersAccountname}}\",\"domainName\":\"{{$evidenceLoggedonusersDomainname}}\"}]}]}",
    "event": {
        "dataset": "m365_defender.alert"
    },
    "input": {
        "type": "httpjson"
    },
    "tags": [
        "preserve_original_event",
        "forwarded",
        "m365_defender-alert"
    ]
}
