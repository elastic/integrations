---
description: Pipeline for parsing Snort JSON logs
processors:
  - json:
      field: event.original
      target_field: json
  - remove:
      field: json.b64_data
      ignore_missing: true
  - rename:
      field: json.timestamp
      target_field: _tmp.timestamp
      ignore_missing: true
  - rename:
      field: json.timestamp
      target_field: _tmp.timestamp
      ignore_missing: true
  - convert:
      field: json.src_port
      target_field: source.port
      type: long
      ignore_missing: true
  - convert:
      field: json.dst_port
      target_field: destination.port
      type: long
      ignore_missing: true
  - rename:
      field: json.dst_addr
      target_field: destination.address
      ignore_missing: true
  - rename:
      field: json.src_addr
      target_field: source.address
      ignore_missing: true
  - rename:
      field: json.eth_dst
      target_field: destination.mac
      ignore_missing: true
  - rename:
      field: json.eth_src
      target_field: source.mac
      ignore_missing: true
  - convert:
      field: json.eth_len
      target_field: snort.eth.length
      type: long
      ignore_missing: true
## Rule
  - rename:
      field: json.class
      target_field: rule.category
      ignore_missing: true
  - rename:
      field: json.msg
      target_field: rule.description
      ignore_missing: true
  - convert:
      field: json.rev
      target_field: rule.version
      type: string
      ignore_missing: true
  - convert:
      field: json.sid
      target_field: rule.id
      type: string
      ignore_missing: true
  - convert:
      field: json.gid
      target_field: snort.gid
      type: long
      ignore_missing: true
## ICMP
  - convert:
      field: json.icmp_type
      target_field: snort.icmp.type
      type: long
      ignore_missing: true
  - convert:
      field: json.icmp_code
      target_field: snort.icmp.code
      type: long
      ignore_missing: true
  - convert:
      field: json.icmp_id
      target_field: snort.icmp.id
      type: long
      ignore_missing: true
  - convert:
      field: json.icmp_seq
      target_field: snort.icmp.seq
      type: long
      ignore_missing: true
## TCP
  - rename:
      field: json.tcp_flags
      target_field: snort.tcp.flags
      ignore_missing: true
  - rename:
      field: json.tcp_len
      target_field: snort.tcp.length
      ignore_missing: true
  - rename:
      field: json.tcp_seq
      target_field: snort.tcp.seq
      ignore_missing: true
  - rename:
      field: json.tcp_ack
      target_field: snort.tcp.ack
      ignore_missing: true
  - rename:
      field: json.tcp_win
      target_field: snort.tcp.window
      ignore_missing: true
## UDP
  - rename:
      field: json.udp_len
      target_field: snort.udp.length
      ignore_missing: true
## IP
  - convert:
      field: json.ip_id
      target_field: snort.ip.id
      type: long
      ignore_missing: true
  - convert:
      field: json.tos
      target_field: snort.ip.tos
      type: long
      ignore_missing: true
  - convert:
      field: json.ttl
      target_field: snort.ip.ttl
      type: long
      ignore_missing: true
## Network
  - convert:
      field: json.pkt_num
      target_field: network.packets
      type: long
      ignore_missing: true
  - convert:
      field: json.pkt_len
      target_field: network.bytes
      type: long
      ignore_missing: true
  - rename:
      field: json.proto
      target_field: network.transport
      ignore_missing: true
  - rename:
      field: json.service
      target_field: network.protocol
      ignore_missing: true
      if: ctx.json?.service != 'unknown'
  - convert:
      field: json.vlan
      target_field: network.vlan.id
      type: string
      ignore_missing: true
      if: ctx.json?.vlan != 0
## Other
  - convert:
      field: json.priority
      target_field: event.severity
      type: long
      ignore_missing: true
  - rename:
      field: json.action
      target_field: _tmp.action
      ignore_missing: true
  - rename:
      field: json.iface
      target_field: observer.ingress.interface.name
      ignore_missing: true

on_failure:
  - set:
      field: error.message
      value: '{{ _ingest.on_failure_message }}'
