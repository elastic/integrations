version: '3'
services:
  apache_tomcat:
    image: tomcat:${TOMCAT_VERSION:-10.1.5}-jre17
    environment:
      - JAVA_OPTS=-javaagent:/usr/local/tomcat/webapps/jmx_prometheus_javaagent-0.17.2.jar=9090:/usr/local/tomcat/webapps/config.yaml
    volumes:
      - ./setup/:/usr/local/tomcat/webapps/
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9090/metrics"]
      interval: 30s
      timeout: 30s
      retries: 5
    ports:
      - 9090
