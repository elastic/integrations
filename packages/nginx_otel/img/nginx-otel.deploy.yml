extensions:
  file_integrations:
    path: "./templates"
  file_storage:
    directory: "./data"

receivers:
  integration/nginx_otel:
    name: "nginx_otel"
    # pipelines: ["metrics", "logs/access", "logs/error"]
    pipelines: ["metrics"]
    parameters:
      endpoint: http://localhost:8088/nginx-status
      access_paths:
        - ${env:NGINX_LOGS_DIR}/access.log
      error_paths:
        - ${env:NGINX_LOGS_DIR}/error.log
      log_storage: "./data"
      storage_resource: file_storage

exporters:
  debug:
    verbosity: detailed
    # verbosity: normal
    use_internal_logger: false
  logging:
    # verbosity: normal
    verbosity: detailed
    sampling_initial: 5
    sampling_thereafter: 200
  elasticsearch:
    endpoint: http://localhost:9200
    flush:
      interval: 100ms
    mapping:
      mode: otel
    password: changeme
    user: elastic
    logs_dynamic_index:
      enabled: true
    metrics_dynamic_index:
      enabled: true

service:
  extensions:
    - file_storage
    - file_integrations
  pipelines:
    metrics:
      receivers: [integration/nginx_otel]
      exporters: [logging, elasticsearch]
    # logs/access:
    #   receivers:
    #     - filelog/access
    #   exporters:
    #     - debug
    #     - logging
    #     - elasticsearch
    #   processors:
    #     - resourcedetection/system
    #     - transform/parse_access_nginx/log
    # logs/error:
    #   receivers:
    #     - filelog/error
    #   exporters:
    #     - debug
    #     - logging
    #     - elasticsearch
    #   processors:
    #     - resourcedetection/system
    #     - transform/parse_error_nginx/log
