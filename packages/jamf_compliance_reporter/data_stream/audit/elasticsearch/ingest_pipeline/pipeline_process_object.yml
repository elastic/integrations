---
description: Pipeline for JAMF process_object audit logs.
processors:
  - rename:
      field: json.process.audit_user_name
      target_field: jamf_compliance_reporter.audit.process.audit_user_name
      ignore_missing: true       
  - convert:
      field: json.process.audit_id
      target_field: jamf_compliance_reporter.audit.process.audit_id
      type: string
      ignore_failure: true
  - convert:
      field: json.process.effective_group_id
      target_field: jamf_compliance_reporter.audit.process.effective.group.id
      type: string
      ignore_failure: true
  - rename:
      field: json.process.effective_group_name
      target_field: jamf_compliance_reporter.audit.process.effective.group.name
      ignore_missing: true
  - convert:
      field: json.process.effective_user_id
      target_field: jamf_compliance_reporter.audit.process.effective.user.id
      type: string
      ignore_failure: true
  - append:
      field: user.name
      value: '{{{json.process.effective_user_name}}}'
      if: ctx?.json?.process?.effective?.user_name != null
      allow_duplicates: false
      ignore_failure: true
  - append:
      field: related.user
      value: '{{{json.process.effective_user_name}}}'
      if: ctx?.json?.process?.effective?.user_name != null
      allow_duplicates: false
      ignore_failure: true
  - convert:
      field: json.process.group_id
      target_field: jamf_compliance_reporter.audit.process.group.id
      type: string
      ignore_failure: true
  - rename:
      field: json.process.group_name
      target_field: jamf_compliance_reporter.audit.process.group.name
      ignore_missing: true
  - append:
      field: process.hash.sha1
      value: '{{{json.process.process_hash}}}'
      if: ctx?.json?.process?.process_hash != null
      allow_duplicates: false
      ignore_failure: true
  - append:
      field: related.hash
      value: '{{{json.process.process_hash}}}'
      if: ctx?.json?.process?.process_hash != null
      allow_duplicates: false
      ignore_failure: true
  - convert:
      field: json.process.process_id
      target_field: jamf_compliance_reporter.audit.process.pid
      type: long
      ignore_failure: true
  - rename:
      field: json.process.process_name
      target_field: jamf_compliance_reporter.audit.process.name
      ignore_missing: true
  - convert:
      field: json.process.session_id
      target_field: jamf_compliance_reporter.audit.process.session.id
      type: string
      ignore_failure: true
  - convert:
      field: json.process.terminal_id.addr
      target_field: jamf_compliance_reporter.audit.process.terminal_id.addr
      type: string
      ignore_failure: true
  - convert:
      field: json.process.terminal_id.ip_address
      target_field: jamf_compliance_reporter.audit.process.terminal_id.ip_address
      type: ip
      ignore_failure: true
  - append:
      field: related.ip
      value: '{{{jamf_compliance_reporter.audit.process.terminal_id.ip_address}}}'
      if: ctx?.jamf_compliance_reporter?.audit?.process?.terminal_id?.ip_address != null
      allow_duplicates: false
      ignore_failure: true
  - convert:
      field: json.process.terminal_id.port
      target_field: jamf_compliance_reporter.audit.process.terminal_id.port
      type: long
      ignore_failure: true
  - convert:
      field: json.process.terminal_id.type
      target_field: jamf_compliance_reporter.audit.process.terminal_id.type
      type: string
      ignore_failure: true
  - convert:
      field: json.process.user_id
      target_field: jamf_compliance_reporter.audit.process.user.id
      type: string
      ignore_failure: true
  - rename:
      field: json.process.user_name
      target_field: jamf_compliance_reporter.audit.process.user.name
      ignore_missing: true
