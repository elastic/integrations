rules:
  - path: /oauth2/token
    methods: ['POST']
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |
          {"access_token":"xxxx","expires_in":1799,"token_type":"bearer"}
  - path: /spotlight/queries/vulnerabilities/v1
    methods: ['GET']
    query_params:
      filter: "{filter:.*}"
      sort: "updated_timestamp|asc"
      limit: 1
      after: "ey2"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - application/json
        body: |
          {"meta":{"query_time":0.023104156,"pagination":{"limit":1,"total":0,"after":""},"powered_by":"spapi","trace_id":"568cen2e-bd97-453e-94b3-a69af245bdce"},"resources":[]}
  - path: /spotlight/queries/vulnerabilities/v1
    methods: ['GET']
    query_params:
      filter: "{filter:.*}"
      sort: "updated_timestamp|asc"
      limit: 1
      after: "ey1"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - application/json
        body: |
          {"meta":{"query_time":0.123204156,"pagination":{"limit":1,"total":2,"after":"ey2"},"powered_by":"spapi","trace_id":"568cen2e-bd97-453e-94b3-a69af245bdce"},"resources":["def"]}
  - path: /spotlight/queries/vulnerabilities/v1
    methods: ['GET']
    query_params:
      filter: "{filter:.*}"
      sort: "updated_timestamp|asc"
      limit: 1
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - application/json
        body: |
          {"meta":{"query_time":0.123104193,"pagination":{"limit":1,"total":2,"after":"ey1"},"powered_by":"spapi","trace_id":"558ceb2e-bd97-453e-94b3-a69af245bdce"},"resources":["abc"]}
  - path: /spotlight/entities/vulnerabilities/v2
    methods: ['GET']
    query_params:
      ids: "def"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - application/json
        body: |-
          {{ minify_json `
          {
            "meta": {
              "query_time": 0.013642188,
              "powered_by": "spapi",
              "trace_id": "20f000f8-6614-47e8-a94a-af3611d37ddb"
            },
            "resources": [
              {
                "id": "897580adb4ab4540a457536faa42de18_eda961728a22320da280bd9d181a798b",
                "cid": "2cd98db1a47b4c98b913c94d43bfab70",
                "aid": "897580adb4ab4540a357536faa41de18",
                "vulnerability_id": "CVE-2025-26465",
                "data_providers": [
                  {
                    "provider": "Falcon sensor",
                    "ports": [22, 80],
                    "rating": "high",
                    "scan_id": "scan-123456",
                    "scan_time": "2025-02-20T12:00:00Z",
                    "scanner_id": "scanner-xyz"
                  }
                ],
                "created_timestamp": "2025-02-20T10:10:24Z",
                "updated_timestamp": "2025-02-25T13:33:23Z",
                "closed_timestamp": "2025-02-26T10:00:00Z",
                "status": "open",
                "apps": [
                  {
                    "vendor_normalized": "Ubuntu",
                    "product_name_version": "openssh 1:9.6p1-3ubuntu13.4",
                    "product_name_normalized": "openssh",
                    "sub_status": "open",
                    "remediation": {
                      "ids": ["4688299d204b35a192828bdaf556ecf8"]
                    },
                    "evaluation_logic": {
                      "id": "138bd6a67791327ab367838079b4d786",
                      "aid": "897580adb4ab4540a357536faa41de18",
                      "cid": "2cd98db1a47b4c98b913c94d43bfab70",
                      "complex_check_operator": "AND",
                      "created_timestamp": "2025-02-20T10:15:30Z",
                      "logic": [
                        {
                          "comparison_check": "equals",
                          "comparisons": {
                            "state_comparisons": [
                              {
                                "entity_comparisons": [
                                  {
                                    "actual_value_field": "version",
                                    "operation": "equals",
                                    "value_datatype": "string"
                                  }
                                ],
                                "entity_operator": "AND"
                              }
                            ],
                            "state_operator": "OR"
                          },
                          "determined_by_comparison": true,
                          "existence_check": "Yes",
                          "id": "logic-12345",
                          "negate": false,
                          "status": "active",
                          "title": "Evaluation Logic for OpenSSH",
                          "type": "comparison"
                        }
                      ],
                      "updated_timestamp": "2025-02-25T13:33:23Z"
                    },
                    "remediation_info": {
                      "recommended_id": "4688299d207b35a192828bdaf556ecf8",
                      "minimum_id": "df1af7df1d33382398fb0dc268109a4d",
                      "patch_publication_date": "2025-02-19T00:00:00Z"
                    },
                    "patch_publication_date": "2025-02-19T00:00:00Z"
                  }
                ],
                "suppression_info": {
                  "is_suppressed": false,
                  "reason": "Not applicable"
                },
                "confidence": "confirmed",
                "app": {
                  "vendor_normalized": "Ubuntu",
                  "product_name_version": "openssh 1:9.6p1-3ubuntu13.4",
                  "product_name_normalized": "openssh"
                },
                "cve": {
                  "id": "CVE-2025-26465",
                  "base_score": 6.8,
                  "severity": "MEDIUM",
                  "exploit_status": 30,
                  "exprt_rating": "MEDIUM",
                  "remediation_level": "O",
                  "cisa_info": {
                    "is_cisa_kev": false,
                    "due_date": "2025-03-01"
                  },
                  "spotlight_published_date": "2025-02-19T05:32:00Z",
                  "types": ["Vulnerability"],
                  "cwes": ["CWE-123"],
                  "description": "A vulnerability was found in OpenSSH...",
                  "published_date": "2025-02-18T19:15:00Z",
                  "references": ["https://ubuntu.com/security/CVE-2025-26465"],
                  "exploitability_score": 1.6,
                  "impact_score": 5.2,
                  "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:N"
                },
                "host_info": {
                  "hostname": "ub24-50-10-154",
                  "local_ip": "1.128.0.0",
                  "os_version": "Ubuntu 24.04",
                  "platform": "Linux",
                  "product_type_desc": "Server",
                  "asset_criticality": "Critical",
                  "internet_exposure": "No",
                  "managed_by": "Falcon sensor",
                  "host_last_seen_timestamp": "2025-02-18T00:00:00Z",
                  "tags": ["production", "security"],
                  "has_run_container": false,
                  "machine_domain": "example.local",
                  "service_provider": "AWS",
                  "service_provider_account_id": "123456789012",
                  "system_manufacturer": "Dell",
                  "groups": [
                    {
                      "id": "group-123",
                      "name": "Production"
                    }
                  ]
                },
                "remediation": {
                  "ids": [
                    "4688299d207b35a192828bdaf556ecf8",
                    "df1af7df1d33382398fb0dc268109a4d"
                  ],
                  "entities": [
                    {
                      "id": "4688299d207b35a192828bdaf556ecf8",
                      "reference": "1:9.6p1-3ubuntu13.8",
                      "title": "Update ubuntu openssh",
                      "action": "Update ubuntu openssh to version 1:9.6p1-3ubuntu13.8 or newer",
                      "link": "https://ubuntu.com/security/CVE-2025-26465",
                      "vendor_url": "https://www.openssh.com",
                      "recommendation_type": "recommended"
                    }
                  ]
                }
              }
            ]
          }
          `}}
  - path: /spotlight/entities/vulnerabilities/v2
    methods: ['GET']
    query_params:
      ids: "abc"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - application/json
        body: |-
          {{ minify_json `
          {
            "meta": {
              "query_time": 0.013642188,
              "powered_by": "spapi",
              "trace_id": "20f099f8-6614-47e8-a94a-af3611d37ddb"
            },
            "resources": [
              {
                "updated_timestamp": "2025-02-28T09:04:38Z",
                "id": "vuln-1234567890abcdef",
                "host_info": {
                  "local_ip": "1.128.0.0",
                  "hostname": "DESKTOP-EXAMPLE",
                  "platform": "Windows",
                  "os_version": "10.0.19042",
                  "asset_criticality": "High",
                  "asset_roles": [
                    "Web Server",
                    "Database Server"
                  ],
                  "confidence_label": "Confirmed",
                  "groups": [
                    {
                      "id": "group-001",
                      "name": "Production Servers"
                    }
                  ],
                  "has_run_container": false,
                  "host_last_seen_timestamp": "2025-02-27T15:30:00Z",
                  "instance_id": "i-0abcdef1234567890",
                  "internet_exposure": "Public",
                  "machine_domain": "example.com",
                  "managed_by": "IT Department",
                  "os_build": "19042.1237",
                  "ou": "IT/Servers",
                  "product_type_desc": "Server",
                  "service_provider": "AWS",
                  "service_provider_account_id": "123456789012",
                  "site_name": "Main Data Center",
                  "subsidiaries": [
                    "Subsidiary A",
                    "Subsidiary B"
                  ],
                  "system_manufacturer": "Dell Inc.",
                  "tags": [
                    "Critical",
                    "Production"
                  ],
                  "third_party_asset_ids": [
                    "asset-12345",
                    "asset-67890"
                  ]
                },
                "data_providers": [
                  {
                    "provider": "Nessus",
                    "ports": [
                      80,
                      443
                    ],
                    "rating": "High",
                    "scan_id": "scan-001",
                    "scan_time": "2025-02-26T12:00:00Z",
                    "scanner_id": "scanner-01"
                  }
                ],
                "cve": {
                  "vendor_advisory": [
                    "https://vendor.com/advisory/CVE-2025-1234"
                  ],
                  "description": "A vulnerability in the XYZ component allows remote attackers to execute arbitrary code.",
                  "references": [
                    "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-1234"
                  ],
                  "base_score": 9.8,
                  "severity": "Critical",
                  "actors": [
                    "APT28",
                    "Fancy Bear"
                  ],
                  "cisa_info": {
                    "due_date": "2025-03-15",
                    "is_cisa_kev": true
                  },
                  "cwes": [
                    "CWE-79",
                    "CWE-89"
                  ],
                  "exploit_status": 0,
                  "exploitability_score": 10,
                  "exprt_rating": "High",
                  "id": "CVE-2025-1234",
                  "impact_score": 9,
                  "name": "XYZ Component Remote Code Execution",
                  "published_date": "2025-02-25",
                  "remediation_level": "Official Fix",
                  "spotlight_published_date": "2025-02-26",
                  "types": [
                    "Remote Code Execution",
                    "Privilege Escalation"
                  ],
                  "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H"
                },
                "vulnerability_id": "vuln-2025-1234",
                "app": {
                  "product_name_normalized": "XYZ Application",
                  "product_name_version": "1.2.3",
                  "vendor_normalized": "XYZ Corp"
                },
                "apps": [
                  {
                    "evaluation_logic": {
                      "aid": "app-001",
                      "cid": "cid-001",
                      "complex_check_operator": "AND",
                      "created_timestamp": "2025-02-20T08:00:00Z",
                      "id": "eval-logic-001",
                      "logic": [
                        {
                          "comparison_check": "EQUALS",
                          "comparisons": {
                            "state_comparisons": [
                              {
                                "entity_comparisons": [
                                  {
                                    "actual_value_field": "version",
                                    "operation": "LESS_THAN",
                                    "value_datatype": "string"
                                  }
                                ],
                                "entity_operator": "AND"
                              }
                            ],
                            "state_operator": "OR"
                          },
                          "determined_by_comparison": true,
                          "existence_check": "Yes",
                          "id": "logic-001",
                          "negate": false,
                          "status": "Active",
                          "title": "Check for vulnerable version",
                          "type": "Version Check"
                        }
                      ]
                    },
                    "patch_publication_date": "2025-02-25",
                    "product_name_normalized": "XYZ Application",
                    "product_name_version": "1.2.3",
                    "remediation_info": {
                      "minimum_id": "patch-001",
                      "patch_publication_date": "2025-02-25",
                      "recommended_id": "patch-002"
                    },
                    "remediation": {
                      "ids": [
                        "rem-001",
                        "rem-002"
                      ]
                    },
                    "sub_status": "Pending",
                    "vendor_normalized": "XYZ Corp"
                  }
                ],
                "cid": "cid-123456",
                "closed_timestamp": "2025-02-28T10:00:00Z",
                "confidence": "High",
                "created_timestamp": "2025-02-25T08:00:00Z",
                "network_scan": [
                  {
                    "network_scan_info": [
                      {
                        "scan_id": "net-scan-001",
                        "scan_time": "2025-02-26T14:00:00Z"
                      }
                    ]
                  }
                ],
                "remediation": {
                  "entities": [
                    {
                      "action": "Apply Patch",
                      "id": "rem-001",
                      "link": "https://vendor.com/patches/patch-001",
                      "patch_publication_date": "2025-02-25",
                      "recommendation_type": "Official",
                      "reference": "PATCH-2025-001",
                      "title": "Security Patch for XYZ Component",
                      "vendor_url": "https://vendor.com/patches"
                    }
                  ],
                  "ids": [
                    "rem-001",
                    "rem-002"
                  ]
                },
                "services": [
                  {
                    "port": 80,
                    "protocol": "HTTP",
                    "transport": "TCP"
                  },
                  {
                    "port": 443,
                    "protocol": "HTTPS",
                    "transport": "TCP"
                  }
                ],
                "status": "Open",
                "suppression_info": {
                  "is_suppressed": false,
                  "reason": ""
                }
              }
            ]
          }
          `}}

