rules:
  - path: /oauth2/token
    methods: ['POST']
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |
          {"access_token":"xxxx","expires_in":1799,"token_type":"bearer"}
  - path: /spotlight/combined/vulnerabilities/v1
    methods: ['GET']
    query_params:
      limit: 1
      after: page-3
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - application/json
        body: |-
          {{ minify_json `
          {
            "meta": {
              "query_time": 0.467386633,
              "pagination": {
                "limit": 1,
                "total": 3,
                "after": ""
              },
              "powered_by": "spapi",
              "trace_id": "810254d8-a768-4def-a2a4-192ad762dbcd"
            },
            "resources": [
              {
                "id": "897580adb4ab4540a457536faa42de18_eda961728a22320da280bd9d181a798b",
                "cid": "2cd98db1a47b4c98b913c94d43bfab70",
                "aid": "897580adb4ab4540a357536faa41de18",
                "vulnerability_id": "CVE-2024-26719",
                "data_providers": [
                  {
                    "provider": "Falcon sensor"
                  }
                ],
                "created_timestamp": "2025-07-24T13:42:05Z",
                "updated_timestamp": "2025-07-29T00:53:18Z",
                "status": "open",
                "apps": [
                  {
                    "vendor_normalized": "Debian",
                    "product_name_version": "linux 6.1.140+1",
                    "product_name_normalized": "linux",
                    "sub_status": "open",
                    "remediation": {
                      "ids": [
                        "d5befca2cc3a33918f15acae966804fe"
                      ]
                    },
                    "evaluation_logic": {
                      "id": "e52ad4411f913b76b24866b9ad33c36a",
                      "cid": "2cd98db1a47b4c98b913c94d43bfab70",
                      "aid": "897580adb4ab4540a357536faa41de18",
                      "data_provider": "Falcon sensor",
                      "created_timestamp": "2025-07-24T13:40:28Z",
                      "updated_timestamp": "2025-07-24T13:40:28Z",
                      "logic": [
                        {
                          "id": 11529734357680297657,
                          "title": "Debian 12 is installed",
                          "type": "inventory",
                          "description": "",
                          "negate": false,
                          "existence_check": "at_least_one_exists",
                          "comparison_check": "at least one",
                          "determined_by_comparison": true,
                          "comparisons": {
                            "state_operator": "AND",
                            "state_comparisons": [
                              {
                                "entity_operator": "AND",
                                "entity_comparisons": [
                                  {
                                    "actual_value_field": "subexpression",
                                    "expected_value": "12",
                                    "operation": "equals",
                                    "value_datatype": "string"
                                  }
                                ]
                              }
                            ]
                          },
                          "items": [
                            {
                              "comparison_result": "true",
                              "filepath": "/etc/debian_version",
                              "item_type": "textfilecontent_item",
                              "subexpression": [
                                "12"
                              ]
                            }
                          ]
                        },
                        {
                          "id": 5378633537652057925,
                          "title": "linux is installed",
                          "type": "inventory",
                          "description": "",
                          "negate": false,
                          "existence_check": "at_least_one_exists",
                          "comparison_check": "",
                          "determined_by_comparison": false,
                          "items": [
                            {
                              "arch": "amd64",
                              "comparison_result": "not evaluated",
                              "epoch": "0",
                              "evr": "6.1.140-1",
                              "item_type": "dpkginfo_item",
                              "name": "linux-image-cloud-amd64",
                              "release": "1",
                              "version": "6.1.140"
                            },
                            {
                              "arch": "amd64",
                              "comparison_result": "not evaluated",
                              "epoch": "0",
                              "evr": "6.1.140-1",
                              "item_type": "dpkginfo_item",
                              "name": "linux-image-6.1.0-37-cloud-amd64",
                              "release": "1",
                              "version": "6.1.140"
                            }
                          ]
                        }
                      ],
                      "simplified_logic": [
                        {
                          "id": 11529734357680297657,
                          "title": "Debian 12 is installed",
                          "checks": "(subexpression equals 12)",
                          "match_required": "All comparisons must pass",
                          "found": [
                            "subexpression: [12]"
                          ],
                          "data": [
                            "filepath: /etc/debian_version"
                          ]
                        },
                        {
                          "id": 5378633537652057925,
                          "title": "linux is installed",
                          "checks": "No comparisons available : Existence check",
                          "found": [
                            "Item was found"
                          ],
                          "data": [
                            "package: linux-image-cloud-amd64-6.1.140-1.amd64",
                            "package: linux-image-6.1.0-37-cloud-amd64-6.1.140-1.amd64"
                          ]
                        }
                      ],
                      "host_info": {
                        "entities_matched": [
                          {
                            "asset_id": "ab87facab3de4911a15af6fe385db2bf"
                          }
                        ]
                      }
                    },
                    "remediation_info": {
                      "recommended_id": "d5befca2cc3a33918f15acae966804fe"
                    }
                  }
                ],
                "suppression_info": {
                  "is_suppressed": false
                },
                "confidence": "confirmed",
                "host_info": {
                  "hostname": "ub24-50-10-154",
                  "local_ip": "1.128.0.0",
                  "machine_domain": "",
                  "os_version": "Debian GNU 12",
                  "ou": "",
                  "site_name": "",
                  "system_manufacturer": "Google",
                  "groups": [
                    {
                      "id": "group-123",
                      "name": "Production"
                    }
                  ],
                  "tags": [],
                  "platform": "Linux",
                  "instance_id": "9165043901540429889",
                  "service_provider_account_id": "126499441333",
                  "service_provider": "GCP",
                  "product_type_desc": "Server",
                  "asset_criticality": "Unassigned",
                  "internet_exposure": "No",
                  "managed_by": "Falcon sensor",
                  "host_last_seen_timestamp": "2025-07-26T00:00:00Z"
                },
                "remediation": {
                  "entities": [
                    {
                      "id": "d5befca2cc3a33918f15acae966804fe",
                      "reference": "Debian linux",
                      "title": "No fix or vendor remediation available for Debian linux",
                      "action": "No fix or vendor remediation available for linux on Debian GNU 12. Alternatives might include software removal, OS upgrade, or other mitigating controls",
                      "link": "",
                      "vendor_url": ""
                    }
                  ]
                },
                "cve": {
                  "id": "CVE-2024-26719",
                  "base_score": 5.5,
                  "severity": "MEDIUM",
                  "exploit_status": 0,
                  "exprt_rating": "LOW",
                  "remediation_level": "U",
                  "cisa_info": {
                    "is_cisa_kev": false
                  },
                  "spotlight_published_date": "2024-04-04T12:46:00Z",
                  "types": [
                    "Vulnerability"
                  ],
                  "cwes": [
                    ""
                  ],
                  "description": "In the Linux kernel, the following vulnerability has been resolved:\n\nnouveau: offload fence uevents work to workqueue\n\nThis should break the deadlock between the fctx lock and the irq lock.\n\nThis offloads the processing off the work from the irq into a workqueue.\n",
                  "published_date": "2024-04-03T00:00:00Z",
                  "references": [
                    "https://git.kernel.org/stable/c/39126abc5e20611579602f03b66627d7cd1422f0",
                    "https://git.kernel.org/stable/c/985d053f7633d8b539ab1531738d538efac678a9",
                    "https://git.kernel.org/stable/c/cc0037fa592d56e4abb9c7d1c52c4d2dc25cd906",
                    "https://lore.kernel.org/linux-cve-announce/2024040344-CVE-2024-26719-b66e@gregkh/T",
                    "https://nvd.nist.gov/vuln/detail/CVE-2024-26719",
                    "https://security-tracker.debian.org/tracker/CVE-2024-26719",
                    "https://www.cve.org/CVERecord?id=CVE-2024-26719"
                  ],
                  "exploitability_score": 1.8,
                  "impact_score": 3.6,
                  "vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H"
                }
              }
            ]
          }
          `}}
  - path: /spotlight/combined/vulnerabilities/v1
    methods: ['GET']
    query_params:
      limit: 1
      after: page-2
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - application/json
        body: |-
          {{ minify_json `
          {
            "meta": {
              "query_time": 0.013642188,
              "pagination": {
                "limit": 1,
                "total": 3,
                "after": "page-3"
              },
              "powered_by": "spapi",
              "trace_id": "20f000f8-6614-47e8-a94a-af3611d37ddb"
            },
            "resources": [
              {
                "id": "897580adb4ab4540a457536faa42de18_eda961728a22320da280bd9d181a798b",
                "cid": "2cd98db1a47b4c98b913c94d43bfab70",
                "aid": "897580adb4ab4540a357536faa41de18",
                "vulnerability_id": "CVE-2025-26465",
                "data_providers": [
                  {
                    "provider": "Falcon sensor",
                    "ports": [22, 80],
                    "rating": "high",
                    "scan_id": "scan-123456",
                    "scan_time": "2025-02-20T12:00:00Z",
                    "scanner_id": "scanner-xyz"
                  }
                ],
                "created_timestamp": "2025-02-20T10:10:24Z",
                "updated_timestamp": "2025-02-25T13:33:23Z",
                "closed_timestamp": "2025-02-26T10:00:00Z",
                "status": "open",
                "apps": [
                  {
                    "vendor_normalized": "Ubuntu",
                    "product_name_version": "openssh 1:9.6p1-3ubuntu13.4",
                    "product_name_normalized": "openssh",
                    "sub_status": "open",
                    "remediation": {
                      "ids": ["4688299d204b35a192828bdaf556ecf8"]
                    },
                    "evaluation_logic": {
                      "id": "138bd6a67791327ab367838079b4d786",
                      "aid": "897580adb4ab4540a357536faa41de18",
                      "cid": "2cd98db1a47b4c98b913c94d43bfab70",
                      "complex_check_operator": "AND",
                      "created_timestamp": "2025-02-20T10:15:30Z",
                      "logic": [
                        {
                          "comparison_check": "equals",
                          "comparisons": {
                            "state_comparisons": [
                              {
                                "entity_comparisons": [
                                  {
                                    "actual_value_field": "version",
                                    "operation": "equals",
                                    "value_datatype": "string"
                                  }
                                ],
                                "entity_operator": "AND"
                              }
                            ],
                            "state_operator": "OR"
                          },
                          "determined_by_comparison": true,
                          "existence_check": "Yes",
                          "id": "logic-12345",
                          "negate": false,
                          "status": "active",
                          "title": "Evaluation Logic for OpenSSH",
                          "type": "comparison"
                        }
                      ],
                      "updated_timestamp": "2025-02-25T13:33:23Z"
                    },
                    "remediation_info": {
                      "recommended_id": "4688299d207b35a192828bdaf556ecf8",
                      "minimum_id": "df1af7df1d33382398fb0dc268109a4d",
                      "patch_publication_date": "2025-02-19T00:00:00Z"
                    },
                    "patch_publication_date": "2025-02-19T00:00:00Z"
                  }
                ],
                "suppression_info": {
                  "is_suppressed": false,
                  "reason": "Not applicable"
                },
                "confidence": "confirmed",
                "app": {
                  "vendor_normalized": "Ubuntu",
                  "product_name_version": "openssh 1:9.6p1-3ubuntu13.4",
                  "product_name_normalized": "openssh"
                },
                "cve": {
                  "id": "CVE-2025-26465",
                  "base_score": 6.8,
                  "severity": "MEDIUM",
                  "exploit_status": 30,
                  "exprt_rating": "MEDIUM",
                  "remediation_level": "O",
                  "cisa_info": {
                    "is_cisa_kev": false,
                    "due_date": "2025-03-01"
                  },
                  "spotlight_published_date": "2025-02-19T05:32:00Z",
                  "types": ["Vulnerability"],
                  "cwes": ["CWE-123"],
                  "description": "A vulnerability was found in OpenSSH...",
                  "published_date": "2025-02-18T19:15:00Z",
                  "references": ["https://ubuntu.com/security/CVE-2025-26465"],
                  "exploitability_score": 1.6,
                  "impact_score": 5.2,
                  "vector": "CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:N"
                },
                "host_info": {
                  "hostname": "ub24-50-10-154",
                  "local_ip": "1.128.0.0",
                  "os_version": "Ubuntu 24.04",
                  "platform": "Linux",
                  "product_type_desc": "Server",
                  "asset_criticality": "Critical",
                  "internet_exposure": "No",
                  "managed_by": "Falcon sensor",
                  "host_last_seen_timestamp": "2025-02-18T00:00:00Z",
                  "tags": ["production", "security"],
                  "has_run_container": false,
                  "machine_domain": "example.local",
                  "service_provider": "AWS",
                  "service_provider_account_id": "123456789012",
                  "system_manufacturer": "Dell",
                  "groups": [
                    {
                      "id": "group-123",
                      "name": "Production"
                    }
                  ]
                },
                "remediation": {
                  "ids": [
                    "4688299d207b35a192828bdaf556ecf8",
                    "df1af7df1d33382398fb0dc268109a4d"
                  ],
                  "entities": [
                    {
                      "id": "4688299d207b35a192828bdaf556ecf8",
                      "reference": "1:9.6p1-3ubuntu13.8",
                      "title": "Update ubuntu openssh",
                      "action": "Update ubuntu openssh to version 1:9.6p1-3ubuntu13.8 or newer",
                      "link": "https://ubuntu.com/security/CVE-2025-26465",
                      "vendor_url": "https://www.openssh.com",
                      "recommendation_type": "recommended"
                    }
                  ]
                }
              }
            ]
          }
          `}}
  - path: /spotlight/combined/vulnerabilities/v1
    methods: ['GET']
    query_params:
      limit: 1
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - application/json
        body: |-
          {{ minify_json `
          {
            "meta": {
              "query_time": 0.013642188,
              "pagination": {
                "limit": 1,
                "total": 3,
                "after": "page-2"
              },
              "powered_by": "spapi",
              "trace_id": "20f099f8-6614-47e8-a94a-af3611d37ddb"
            },
            "resources": [
              {
                "updated_timestamp": "2025-02-28T09:04:38Z",
                "id": "vuln-1234567890abcdef",
                "host_info": {
                  "local_ip": "1.128.0.0",
                  "hostname": "DESKTOP-EXAMPLE",
                  "platform": "Windows",
                  "os_version": "10.0.19042",
                  "asset_criticality": "High",
                  "asset_roles": [
                    "Web Server",
                    "Database Server"
                  ],
                  "confidence_label": "Confirmed",
                  "groups": [
                    {
                      "id": "group-001",
                      "name": "Production Servers"
                    }
                  ],
                  "has_run_container": false,
                  "host_last_seen_timestamp": "2025-02-27T15:30:00Z",
                  "instance_id": "i-0abcdef1234567890",
                  "internet_exposure": "Public",
                  "machine_domain": "example.com",
                  "managed_by": "IT Department",
                  "os_build": "19042.1237",
                  "ou": "IT/Servers",
                  "product_type_desc": "Server",
                  "service_provider": "AWS",
                  "service_provider_account_id": "123456789012",
                  "site_name": "Main Data Center",
                  "subsidiaries": [
                    "Subsidiary A",
                    "Subsidiary B"
                  ],
                  "system_manufacturer": "Dell Inc.",
                  "tags": [
                    "Critical",
                    "Production"
                  ],
                  "third_party_asset_ids": [
                    "asset-12345",
                    "asset-67890"
                  ]
                },
                "data_providers": [
                  {
                    "provider": "Nessus",
                    "ports": [
                      80,
                      443
                    ],
                    "rating": "High",
                    "scan_id": "scan-001",
                    "scan_time": "2025-02-26T12:00:00Z",
                    "scanner_id": "scanner-01"
                  }
                ],
                "cve": {
                  "vendor_advisory": [
                    "https://vendor.com/advisory/CVE-2025-1234"
                  ],
                  "description": "A vulnerability in the XYZ component allows remote attackers to execute arbitrary code.",
                  "references": [
                    "https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-1234"
                  ],
                  "base_score": 9.8,
                  "severity": "Critical",
                  "actors": [
                    "APT28",
                    "Fancy Bear"
                  ],
                  "cisa_info": {
                    "due_date": "2025-03-15",
                    "is_cisa_kev": true
                  },
                  "cwes": [
                    "CWE-79",
                    "CWE-89"
                  ],
                  "exploit_status": 0,
                  "exploitability_score": 10,
                  "exprt_rating": "High",
                  "id": "CVE-2025-1234",
                  "impact_score": 9,
                  "name": "XYZ Component Remote Code Execution",
                  "published_date": "2025-02-25",
                  "remediation_level": "Official Fix",
                  "spotlight_published_date": "2025-02-26",
                  "types": [
                    "Remote Code Execution",
                    "Privilege Escalation"
                  ],
                  "vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H"
                },
                "vulnerability_id": "vuln-2025-1234",
                "app": {
                  "product_name_normalized": "XYZ Application",
                  "product_name_version": "1.2.3",
                  "vendor_normalized": "XYZ Corp"
                },
                "apps": [
                  {
                    "evaluation_logic": {
                      "aid": "app-001",
                      "cid": "cid-001",
                      "complex_check_operator": "AND",
                      "created_timestamp": "2025-02-20T08:00:00Z",
                      "id": "eval-logic-001",
                      "logic": [
                        {
                          "comparison_check": "EQUALS",
                          "comparisons": {
                            "state_comparisons": [
                              {
                                "entity_comparisons": [
                                  {
                                    "actual_value_field": "version",
                                    "operation": "LESS_THAN",
                                    "value_datatype": "string"
                                  }
                                ],
                                "entity_operator": "AND"
                              }
                            ],
                            "state_operator": "OR"
                          },
                          "determined_by_comparison": true,
                          "existence_check": "Yes",
                          "id": "logic-001",
                          "negate": false,
                          "status": "Active",
                          "title": "Check for vulnerable version",
                          "type": "Version Check"
                        }
                      ]
                    },
                    "patch_publication_date": "2025-02-25",
                    "product_name_normalized": "XYZ Application",
                    "product_name_version": "1.2.3",
                    "remediation_info": {
                      "minimum_id": "patch-001",
                      "patch_publication_date": "2025-02-25",
                      "recommended_id": "patch-002"
                    },
                    "remediation": {
                      "ids": [
                        "rem-001",
                        "rem-002"
                      ]
                    },
                    "sub_status": "Pending",
                    "vendor_normalized": "XYZ Corp"
                  }
                ],
                "cid": "cid-123456",
                "closed_timestamp": "2025-02-28T10:00:00Z",
                "confidence": "High",
                "created_timestamp": "2025-02-25T08:00:00Z",
                "remediation": {
                  "entities": [
                    {
                      "action": "Apply Patch",
                      "id": "rem-001",
                      "link": "https://vendor.com/patches/patch-001",
                      "patch_publication_date": "2025-02-25",
                      "recommendation_type": "Official",
                      "reference": "PATCH-2025-001",
                      "title": "Security Patch for XYZ Component",
                      "vendor_url": "https://vendor.com/patches"
                    }
                  ],
                  "ids": [
                    "rem-001",
                    "rem-002"
                  ]
                },
                "services": [
                  {
                    "port": 80,
                    "protocol": "HTTP",
                    "transport": "TCP"
                  },
                  {
                    "port": 443,
                    "protocol": "HTTPS",
                    "transport": "TCP"
                  }
                ],
                "status": "Open",
                "suppression_info": {
                  "is_suppressed": false,
                  "reason": ""
                }
              }
            ]
          }
          `}}
