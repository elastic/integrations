{{- $id := generate "id" }}
{{- $cid := generate "cid" }}
{{- $aid := generate "aid" }}
{{- $vulnerability_id := generate "vulnerability_id" }}
{{- $data_provider := generate "data_providers.provider" }}
{{- $created_timestamp := generate "created_timestamp" | date "2006-01-02T15:04:05.00Z" }}
{{- $updated_timestamp := generate "updated_timestamp" | date "2006-01-02T15:04:05.00Z" }}
{{- $status := generate "status" }}
{{- $vendor_normalized := generate "apps.vendor_normalized" }}
{{- $product_name_version := generate "apps.product_name_version" }}
{{- $product_name_normalized := generate "apps.product_name_normalized" }}
{{- $sub_status := generate "apps.sub_status" }}
{{- $ids := generate "apps.remediation.ids" }}
{{- $title := generate "apps.evaluation_logic.logic.title" }}
{{- $type := generate "apps.evaluation_logic.logic.type" }}
{{- $description := generate "apps.evaluation_logic.logic.description" }}
{{- $negate := generate "apps.evaluation_logic.logic.negate" }}
{{- $existence_check := generate "apps.evaluation_logic.logic.existence_check" }}
{{- $comparison_check := generate "apps.evaluation_logic.logic.comparison_check" }}
{{- $determined_by_comparison := generate "apps.evaluation_logic.logic.determined_by_comparison" }}
{{- $evaluation_logic_operator := generate "apps.evaluation_logic.logic.comparisons.operator" }}
{{- $actual_value_field := generate "apps.evaluation_logic.logic.comparisons.state_comparisons.entity_comparisons.actual_value_field" }}
{{- $expected_value := generate "apps.evaluation_logic.logic.comparisons.state_comparisons.entity_comparisons.expected_value" }}
{{- $operation := generate "apps.evaluation_logic.logic.comparisons.state_comparisons.entity_comparisons.operation" }}
{{- $value_datatype := generate "apps.evaluation_logic.logic.comparisons.state_comparisons.entity_comparisons.value_datatype" }}
{{- $comparison_result := generate "apps.evaluation_logic.logic.items.comparison_result" }}
{{- $filepath := generate "apps.evaluation_logic.logic.items.filepath" }}
{{- $item_type := generate "apps.evaluation_logic.logic.items.item_type" }}
{{- $subexpression := generate "apps.evaluation_logic.logic.items.subexpression" }}
{{- $checks := generate "apps.evaluation_logic.simplified_logic.checks" }}
{{- $match_required := generate "apps.evaluation_logic.simplified_logic.match_required" }}
{{- $found := generate "apps.evaluation_logic.simplified_logic.found" }}
{{- $data := generate "apps.evaluation_logic.simplified_logic.data" }}
{{- $asset_id := generate "apps.evaluation_logic.host_info.entities_matched.asset_id" }}
{{- $recommended_id := generate "apps.remediation_info.recommended_id" }}
{{- $is_suppressed := generate "suppression_info.is_suppressed" }}
{{- $confidence := generate "confidence" }}
{{- $hostname := generate "host_info.hostname" }}
{{- $local_ip := generate "host_info.local_ip" }}
{{- $machine_domain := generate "host_info.machine_domain" }}
{{- $os_version := generate "host_info.os_version" }}
{{- $ou := generate "host_info.ou" }}
{{- $site_name := generate "host_info.site_name" }}
{{- $system_manufacturer := generate "host_info.system_manufacturer" }}
{{- $name := generate "host_info.groups.name" }}
{{- $platform := generate "host_info.platform" }}
{{- $instance_id := generate "host_info.instance_id" }}
{{- $service_provider_account_id := generate "host_info.service_provider_account_id" }}
{{- $service_provider := generate "host_info.service_provider" }}
{{- $product_type_desc := generate "host_info.product_type_desc" }}
{{- $asset_criticality := generate "host_info.asset_criticality" }}
{{- $internet_exposure := generate "host_info.internet_exposure" }}
{{- $managed_by := generate "host_info.managed_by" }}
{{- $host_last_seen_timestamp := generate "host_info.host_last_seen_timestamp" | date "2006-01-02T15:04:05.00Z" }}
{{- $confidence_level := generate "host_info.confidence_level" }}
{{- $reference := generate "remediation.entities.reference" }}
{{- $action := generate "remediation.entities.action" }}
{{- $link := generate "remediation.entities.link" }}
{{- $vendor_url := generate "remediation.entities.vendor_url" }}
{{- $base_score := generate "cve.base_score" }}
{{- $severity := generate "cve.severity" }}
{{- $exploit_status := generate "cve.exploit_status" }}
{{- $exprt_rating := generate "cve.exprt_rating" }}
{{- $remediation_level := generate "cve.remediation_level" }}
{{- $is_cisa_kev := generate "cve.cisa_info.is_cisa_kev" }}
{{- $spotlight_published_date := generate "cve.spotlight_published_date" | date "2006-01-02T15:04:05.00Z" }}
{{- $types := generate "cve.types" }}
{{- $cwes := generate "cve.cwes" }}
{{- $published_date := generate "cve.published_date" | date "2006-01-02T15:04:05.00Z" }}
{{- $due_date := generate "cve.due_date" | date "2006-01-02T15:04:05.00Z" }}
{{- $references := generate "cve.references" }}
{{- $exploitability_score := generate "cve.exploitability_score" }}
{{- $impact_score := generate "cve.impact_score" }}
{{- $vector := generate "cve.vector" }}
{{- $scanner_id := generate "data_providers.scanner_id" }}
{{- $scan_id := generate "data_providers.scan_id" }}
{{- $rating := generate "data_providers.rating" }}
{{- $scan_time := generate "data_providers.scan_time" | date "2006-01-02T15:04:05.00Z" }}
{{- $ports := generate "data_providers.ports" }}
{{- $evaluation_logic_id := generate "apps.evaluation_logic.logic.id" }}
{{- $timestamp := generate "timestamp" }}
{{- /*
{
  "id": "{{ $id }}",
  "cid": "{{ $cid }}",
  "aid": "{{ $aid }}",
  "vulnerability_id": "{{ $vulnerability_id }}",
  "data_providers": [
    {
        "provider": "{{ $data_provider }}",
        "scanner_id": "{{ $scanner_id }}",
        "scan_id": "{{ $scan_id }}",
        "rating": "{{ $rating }}",
        "scan_time": "{{ $scan_time }}",
        "ports": [{{ $ports }}]
    }
  ],
  "created_timestamp": "{{ $created_timestamp }}",
  "updated_timestamp": "{{ $updated_timestamp }}",
  "status": "{{ $status }}",
  "apps": [
    {
      "vendor_normalized": "{{ $vendor_normalized }}",
      "product_name_version": "{{ $product_name_version }}",
      "product_name_normalized": "{{ $product_name_normalized }}",
      "sub_status": "{{ $sub_status }}",
      "remediation": {
        "ids": [
          "{{ $ids }}"
        ]
      },
      "evaluation_logic": {
        "id": "{{ $id }}",
        "cid": "{{ $cid }}",
        "aid": "{{ $aid }}",
        "data_provider": "{{ $data_provider }}",
        "created_timestamp": "{{ $created_timestamp }}",
        "updated_timestamp": "{{ $updated_timestamp }}",
        "logic": [
          {
            "id": {{ $evaluation_logic_id }},
            "title": "{{ $title }}",
            "type": "{{ $type }}",
            "description": "{{ $description }}",
            "negate": {{ $negate }},
            "existence_check": "{{ $existence_check }}",
            "comparison_check": "{{ $comparison_check }}",
            "determined_by_comparison": {{ $determined_by_comparison }},
            "comparisons": {
              "state_operator": "{{ $evaluation_logic_operator }}",
              "state_comparisons": [
                {
                  "entity_operator": "{{ $evaluation_logic_operator }}",
                  "entity_comparisons": [
                    {
                      "actual_value_field": "{{ $actual_value_field }}",
                      "expected_value": "{{ $expected_value }}",
                      "operation": "{{ $operation }}",
                      "value_datatype": "{{ $value_datatype }}"
                    }
                  ]
                }
              ]
            },
            "items": [
              {
                "comparison_result": "{{ $comparison_result }}",
                "filepath": "{{ $filepath }}",
                "item_type": "{{ $item_type }}",
                "subexpression": [
                  "{{ $subexpression }}"
                ]
              }
            ]
          }
        ],
        "simplified_logic": [
          {
            "id": {{ $evaluation_logic_id }},
            "title": "{{ $title }}",
            "checks": "{{ $checks }}",
            "match_required": "{{ $match_required }}",
            "found": [
              "{{ $found }}"
            ],
            "data": [
              "{{ $data }}"
            ]
          }
        ],
        "host_info": {
          "entities_matched": [
            {
              "asset_id": "{{ $asset_id }}"
            }
          ]
        }
      },
      "remediation_info": {
        "recommended_id": "{{ $recommended_id }}"
      }
    }
  ],
  "suppression_info": {
    "is_suppressed": {{ $is_suppressed }}
  },
  "confidence": "{{ $confidence }}",
  "host_info": {
    "hostname": "{{ $hostname }}",
    "local_ip": "{{ $local_ip }}",
    "machine_domain": "{{ $machine_domain }}",
    "os_version": "{{ $os_version }}",
    "ou": "{{ $ou }}",
    "site_name": "{{ $site_name }}",
    "system_manufacturer": "{{ $system_manufacturer }}",
    "groups": [
      {
        "id": "{{ $id }}",
        "name": "{{ $name }}"
      }
    ],
    "platform": "{{ $platform }}",
    "instance_id": "{{ $instance_id }}",
    "service_provider_account_id": "{{ $service_provider_account_id }}",
    "service_provider": "{{ $service_provider }}",
    "product_type_desc": "{{ $product_type_desc }}",
    "asset_criticality": "{{ $asset_criticality }}",
    "internet_exposure": "{{ $internet_exposure }}",
    "managed_by": "{{ $managed_by }}",
    "host_last_seen_timestamp": "{{ $host_last_seen_timestamp }}",
    "confidence_level": "{{ $confidence_level }}"
  },
  "remediation": {
    "entities": [
      {
        "id": "{{ $id }}",
        "reference": "{{ $reference }}",
        "title": "{{ $title }}",
        "action": "{{ $action }}",
        "link": "{{ $link }}",
        "vendor_url": "{{ $vendor_url }}"
      }
    ]
  },
  "cve": {
    "id": "{{ $id }}",
    "base_score": {{ printf "%.1f" $base_score }},
    "severity": "{{ $severity }}",
    "exploit_status": {{ $exploit_status }},
    "exprt_rating": "{{ $exprt_rating }}",
    "remediation_level": "{{ $remediation_level }}",
    "cisa_info": {
      "is_cisa_kev": {{ $is_cisa_kev }},
      "due_date": "{{ $due_date }}"
    },
    "spotlight_published_date": "{{ $spotlight_published_date }}",
    "types": [
      "{{ $types }}"
    ],
    "cwes": [
      "{{ $cwes }}"
    ],
    "description": "{{ $description }}",
    "published_date": "{{ $published_date }}",
    "references": [
      "{{ $references }}"
    ],
    "exploitability_score": {{ printf "%.1f" $exploitability_score }},
    "impact_score": {{ printf "%.1f" $impact_score }},
    "vector": "{{ $vector }}"
  }
}
*/ -}}
{
    "@timestamp": "{{ $timestamp.Format "2006-01-02T15:04:05.999999Z07:00" }}",
    "agent": {
        "ephemeral_id": "cdaaaabb-be7e-432f-816b-bda019fd7c15",
        "id": "da6cb4c8-c84c-4c5f-97c7-f8586a098af4",
        "name": "docker-fleet-agent",
        "type": "filebeat",
        "version": "8.18.0"
    },
    "data_stream": {
        "dataset": "crowdstrike.vulnerability",
        "namespace": "93724",
        "type": "logs"
    },
    "elastic_agent": {
        "id": "da6cb4c8-c84c-4c5f-97c7-f8586a098af4",
        "snapshot": false,
        "version": "8.18.0"
    },
    "message": "{\"id\":\"{{ $id }}\",\"cid\":\"{{ $cid }}\",\"aid\":\"{{ $aid }}\",\"vulnerability_id\":\"{{ $vulnerability_id }}\",\"data_providers\":[{\"provider\":\"{{ $data_provider }}\",\"scanner_id\":\"{{ $scanner_id }}\",\"scan_id\":\"{{ $scan_id }}\",\"rating\":\"{{ $rating }}\",\"scan_time\":\"{{ $scan_time }}\",\"ports\":[{{ $ports }}]}],\"created_timestamp\":\"{{ $created_timestamp }}\",\"updated_timestamp\":\"{{ $updated_timestamp }}\",\"status\":\"{{ $status }}\",\"apps\":[{\"vendor_normalized\":\"{{ $vendor_normalized }}\",\"product_name_version\":\"{{ $product_name_version }}\",\"product_name_normalized\":\"{{ $product_name_normalized }}\",\"sub_status\":\"{{ $sub_status }}\",\"remediation\":{\"ids\":[\"{{ $ids }}\"]},\"evaluation_logic\":{\"id\":\"{{ $id }}\",\"cid\":\"{{ $cid }}\",\"aid\":\"{{ $aid }}\",\"data_provider\":\"{{ $data_provider }}\",\"created_timestamp\":\"{{ $created_timestamp }}\",\"updated_timestamp\":\"{{ $updated_timestamp }}\",\"logic\":[{\"id\":{{ $evaluation_logic_id }},\"title\":\"{{ $title }}\",\"type\":\"{{ $type }}\",\"description\":\"{{ $description }}\",\"negate\":{{ $negate }},\"existence_check\":\"{{ $existence_check }}\",\"comparison_check\":\"{{ $comparison_check }}\",\"determined_by_comparison\":{{ $determined_by_comparison }},\"comparisons\":{\"state_operator\":\"{{ $evaluation_logic_operator }}\",\"state_comparisons\":[{\"entity_operator\":\"{{ $evaluation_logic_operator }}\",\"entity_comparisons\":[{\"actual_value_field\":\"{{ $actual_value_field }}\",\"expected_value\":\"{{ $expected_value }}\",\"operation\":\"{{ $operation }}\",\"value_datatype\":\"{{ $value_datatype }}\"}]}]},\"items\":[{\"comparison_result\":\"{{ $comparison_result }}\",\"filepath\":\"{{ $filepath }}\",\"item_type\":\"{{ $item_type }}\",\"subexpression\":[\"{{ $subexpression }}\"]}]}],\"simplified_logic\":[{\"id\":{{ $evaluation_logic_id }},\"title\":\"{{ $title }}\",\"checks\":\"{{ $checks }}\",\"match_required\":\"{{ $match_required }}\",\"found\":[\"{{ $found }}\"],\"data\":[\"{{ $data }}\"]}],\"host_info\":{\"entities_matched\":[{\"asset_id\":\"{{ $asset_id }}\"}]}},\"remediation_info\":{\"recommended_id\":\"{{ $recommended_id }}\"}}],\"suppression_info\":{\"is_suppressed\":{{ $is_suppressed }}},\"confidence\":\"{{ $confidence }}\",\"host_info\":{\"hostname\":\"{{ $hostname }}\",\"local_ip\":\"{{ $local_ip }}\",\"machine_domain\":\"{{ $machine_domain }}\",\"os_version\":\"{{ $os_version }}\",\"ou\":\"{{ $ou }}\",\"site_name\":\"{{ $site_name }}\",\"system_manufacturer\":\"{{ $system_manufacturer }}\",\"groups\":[{\"id\":\"{{ $id }}\",\"name\":\"{{ $name }}\"}],\"platform\":\"{{ $platform }}\",\"instance_id\":\"{{ $instance_id }}\",\"service_provider_account_id\":\"{{ $service_provider_account_id }}\",\"service_provider\":\"{{ $service_provider }}\",\"product_type_desc\":\"{{ $product_type_desc }}\",\"asset_criticality\":\"{{ $asset_criticality }}\",\"internet_exposure\":\"{{ $internet_exposure }}\",\"managed_by\":\"{{ $managed_by }}\",\"host_last_seen_timestamp\":\"{{ $host_last_seen_timestamp }}\",\"confidence_level\":\"{{ $confidence_level }}\"},\"remediation\":{\"entities\":[{\"id\":\"{{ $id }}\",\"reference\":\"{{ $reference }}\",\"title\":\"{{ $title }}\",\"action\":\"{{ $action }}\",\"link\":\"{{ $link }}\",\"vendor_url\":\"{{ $vendor_url }}\"}]},\"cve\":{\"id\":\"{{ $id }}\",\"base_score\":{{ printf "%.1f" $base_score }},\"severity\":\"{{ $severity }}\",\"exploit_status\":{{ $exploit_status }},\"exprt_rating\":\"{{ $exprt_rating }}\",\"remediation_level\":\"{{ $remediation_level }}\",\"cisa_info\":{\"is_cisa_kev\":{{ $is_cisa_kev }},\"due_date\":\"{{ $due_date }}\"},\"spotlight_published_date\":\"{{ $spotlight_published_date }}\",\"types\":[\"{{ $types }}\"],\"cwes\":[\"{{ $cwes }}\"],\"description\":\"{{ $description }}\",\"published_date\":\"{{ $published_date }}\",\"references\":[\"{{ $references }}\"],\"exploitability_score\":{{ printf "%.1f" $exploitability_score }},\"impact_score\":{{ printf "%.1f" $impact_score }},\"vector\":\"{{ $vector }}\"}}",
    "event": {
        "dataset": "crowdstrike.vulnerability"
    },
    "input": {
        "type": "cel"
    },
    "tags": [
        "preserve_original_event",
        "forwarded",
        "crowdstrike-vulnerability"
    ]
}
