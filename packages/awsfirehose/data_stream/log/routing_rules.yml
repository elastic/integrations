- source_dataset: awsfirehose.log
  rules:
    - target_dataset: aws.cloudtrail
      if: ctx['aws.cloudwatch.log_stream'].contains('CloudTrail')
      namespace:
        - "{{labels.data_stream.namespace}}"
        - default
- source_dataset: awsfirehose.log
  rules:
    - target_dataset: aws.route53_public_logs
      if: >-
        def split_log_stream_name=ctx['aws.cloudwatch.log_stream'].splitOnToken('/');
        if (split_log_stream_name.length!=2) {
          return false;
        }
        def hosted_zone_id=split_log_stream_name[0];
        def edge_location_id=split_log_stream_name[1];
        if (ctx.message.contains(hosted_zone_id) && ctx.message.contains(edge_location_id)){
            return true;
        }
        return false;
      namespace:
        - "{{labels.data_stream.namespace}}"
        - default
- source_dataset: awsfirehose.log
  rules:
    - target_dataset: aws.firewall_logs
      if: ctx.message.contains('firewall_name') && ctx.message.contains('availability_zone') && ctx.message.contains('event_timestamp') && ctx.message.contains('event')
      namespace:
        - "{{labels.data_stream.namespace}}"
        - default
