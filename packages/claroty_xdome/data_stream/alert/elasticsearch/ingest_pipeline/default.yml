---
description: Pipeline for processing alert logs.
processors:
  - set:
      field: ecs.version
      tag: set_ecs_version
      value: 8.17.0
  - fail:
      tag: data_collection_error
      if: ctx.error?.message != null && ctx.message == null && ctx.event?.original == null
      message: error message set and no data to process.
  - remove:
      field:
        - organization
        - division
        - team
      ignore_missing: true
      if: ctx.organization instanceof String && ctx.division instanceof String && ctx.team instanceof String
      tag: remove_agentless_tags
      description: >-
        Removes the fields added by Agentless as metadata,
        as they can collide with ECS fields.
  - rename:
      field: message
      tag: rename_message_to_event_original
      target_field: event.original
      ignore_missing: true
      description: Renames the original `message` field to `event.original` to store a copy of the original message. The `event.original` field is not touched if the document already has one; it may happen when Logstash sends the document.
      if: ctx.event?.original == null
  - remove:
      field: message
      tag: remove_message
      ignore_missing: true
      description: The `message` field is no longer required if the document has an `event.original` field.
      if: ctx.event?.original != null
  - json:
      field: event.original
      tag: json_event_original
      target_field: json
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - set:
      field: event.kind
      tag: set_event_kind
      value: alert
  - set:
      field: observer.vendor
      tag: set_observer_vendor
      value: Claroty
  - set:
      field: observer.product
      tag: set_observer_product
      value: xDome
  - rename:
      field: json.alert_info.category
      tag: rename_alert_info_category
      target_field: claroty_xdome.alert.category
      ignore_missing: true
  - rename:
      field: json.alert_info.alert_class
      tag: rename_alert_info_alert_class
      target_field: claroty_xdome.alert.class
      ignore_missing: true
  - rename:
      field: json.alert_info.description
      tag: rename_alert_info_description
      target_field: claroty_xdome.alert.description
      ignore_missing: true
  - set:
      field: message
      tag: set_message_from_alert_description
      copy_from: claroty_xdome.alert.description
      ignore_empty_value: true
  - date:
      field: json.alert_info.detected_time
      tag: date_alert_info_detected_time
      target_field: claroty_xdome.alert.detected_time
      formats:
        - ISO8601
      if: ctx.json?.alert_info?.detected_time != null && ctx.json.alert_info.detected_time != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.active_queries_seen_reported_from
      tag: rename_active_queries_seen_reported_from
      target_field: claroty_xdome.alert.device.active_queries_seen_reported_from
      ignore_missing: true
  - convert:
      field: json.activity_rate
      tag: convert_activity_rate_to_double
      target_field: claroty_xdome.alert.device.activity_rate
      type: double
      ignore_missing: true
      if: ctx.json?.activity_rate != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.ad_description
      tag: rename_ad_description
      target_field: claroty_xdome.alert.device.ad.description
      ignore_missing: true
  - rename:
      field: json.ad_distinguished_name
      tag: rename_ad_distinguished_name
      target_field: claroty_xdome.alert.device.ad.distinguished_name
      ignore_missing: true
  - rename:
      field: json.ae_titles
      tag: rename_ae_titles
      target_field: claroty_xdome.alert.device.ae_titles
      ignore_missing: true
  - rename:
      field: json.ap_location_list
      tag: rename_ap_location_list
      target_field: claroty_xdome.alert.device.ap.location_list
      ignore_missing: true
  - rename:
      field: json.ap_name_list
      tag: rename_ap_name_list
      target_field: claroty_xdome.alert.device.ap.name_list
      ignore_missing: true
  - rename:
      field: json.applied_acl_list
      tag: rename_applied_acl_list
      target_field: claroty_xdome.alert.device.applied_acl.list
      ignore_missing: true
  - rename:
      field: json.applied_acl_type_list
      tag: rename_applied_acl_type_list
      target_field: claroty_xdome.alert.device.applied_acl.type_list
      ignore_missing: true
  - rename:
      field: json.asset_id
      tag: rename_asset_id
      target_field: claroty_xdome.alert.device.asset_id
      ignore_missing: true
  - rename:
      field: json.assignees
      tag: rename_assignees
      target_field: claroty_xdome.alert.device.assignees
      ignore_missing: true
  - foreach:
      field: claroty_xdome.alert.device.assignees
      tag: foreach_add_assignees_into_related_user
      if: ctx.claroty_xdome?.alert?.device?.assignees instanceof List
      processor:
        append:
          field: related.user
          tag: append_assignees_into_related_user
          value: '{{{_ingest._value}}}'
          allow_duplicates: false
  - foreach:
      field: json.assignees_data
      tag: foreach_convert_assignees_data_to_string
      if: ctx.json?.assignees_data instanceof List
      processor:
        convert:
          field: _ingest._value.id
          tag: convert_assignees_data_to_string
          type: string
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.id
                tag: remove_convert_assignees_Data_id
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: json.assignees_data
      tag: foreach_add_assignees_data_id_into_related_user
      if: ctx.json.assignees_data instanceof List
      processor:
        append:
          field: related.user
          tag: append_assignees_data_id_into_related_user
          value: '{{{_ingest._value.id}}}'
          allow_duplicates: false
  - foreach:
      field: json.assignees_data
      tag: foreach_add_assignees_data_display_name_into_related_user
      if: ctx.json.assignees_data instanceof List
      processor:
        append:
          field: related.user
          tag: append_assignees_data_display_name_into_related_user
          value: '{{{_ingest._value.display_name}}}'
          allow_duplicates: false
  - foreach:
      field: json.assignees_data
      tag: foreach_convert_assignees_data_to_string
      if: ctx.json?.assignees_data instanceof List
      processor:
        convert:
          field: _ingest._value.is_active
          tag: convert_assignees_data_is_Active_to_boolean
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.assignees_data
      tag: rename_assignees_data
      target_field: claroty_xdome.alert.device.assignees_data
      ignore_missing: true
  - rename:
      field: json.authentication_user_list
      tag: rename_authentication_user_list
      target_field: claroty_xdome.alert.device.authentication_user_list
      ignore_missing: true
  - convert:
      field: json.avg_examinations_per_day
      tag: convert_avg_examinations_per_day_to_double
      target_field: claroty_xdome.alert.device.avg.examinations_per_day
      type: double
      ignore_missing: true
      if: ctx.json?.avg_examinations_per_day != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.avg_in_use_per_day
      tag: convert_avg_in_use_per_day_to_double
      target_field: claroty_xdome.alert.device.avg.in_use_per_day
      type: double
      ignore_missing: true
      if: ctx.json?.avg_in_use_per_day != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.avg_online_per_day
      tag: convert_avg_online_per_day_to_double
      target_field: claroty_xdome.alert.device.avg.online_per_day
      type: double
      ignore_missing: true
      if: ctx.json?.avg_online_per_day != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.battery_level
      tag: rename_battery_level
      target_field: claroty_xdome.alert.device.battery_level
      ignore_missing: true
  - rename:
      field: json.bssid_list
      tag: rename_bssid_list
      target_field: claroty_xdome.alert.device.bssid_list
      ignore_missing: true
  - rename:
      field: json.device_category
      tag: rename_device_category
      target_field: claroty_xdome.alert.device.category
      ignore_missing: true
  - convert:
      field: json.cmms_asset_purchase_cost
      tag: convert_cmms_asset_purchase_cost_to_double
      target_field: claroty_xdome.alert.device.cmms.asset.purchase_cost
      type: double
      ignore_missing: true
      if: ctx.json?.cmms_asset_purchase_cost != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.cmms_asset_tag
      tag: rename_cmms_asset_tag
      target_field: claroty_xdome.alert.device.cmms.asset.tag
      ignore_missing: true
  - rename:
      field: json.cmms_building
      tag: rename_cmms_building
      target_field: claroty_xdome.alert.device.cmms.building
      ignore_missing: true
  - rename:
      field: json.cmms_campus
      tag: rename_cmms_campus
      target_field: claroty_xdome.alert.device.cmms.campus
      ignore_missing: true
  - rename:
      field: json.cmms_department
      tag: rename_cmms_department
      target_field: claroty_xdome.alert.device.cmms.department
      ignore_missing: true
  - convert:
      field: json.cmms_financial_cost
      tag: convert_cmms_financial_cost_to_double
      target_field: claroty_xdome.alert.device.cmms.financial_cost
      type: double
      ignore_missing: true
      if: ctx.json?.cmms_financial_cost != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.cmms_floor
      tag: rename_cmms_floor
      target_field: claroty_xdome.alert.device.cmms.floor
      ignore_missing: true
  - rename:
      field: json.cmms_last_pm
      tag: rename_cmms_last_pm
      target_field: claroty_xdome.alert.device.cmms.last_pm
      ignore_missing: true
  - rename:
      field: json.cmms_location
      tag: rename_cmms_location
      target_field: claroty_xdome.alert.device.cmms.location
      ignore_missing: true
  - rename:
      field: json.cmms_manufacturer
      tag: rename_cmms_manufacturer
      target_field: claroty_xdome.alert.device.cmms.manufacturer
      ignore_missing: true
  - rename:
      field: json.cmms_model
      tag: rename_cmms_model
      target_field: claroty_xdome.alert.device.cmms.model
      ignore_missing: true
  - rename:
      field: json.cmms_ownership
      tag: rename_cmms_ownership
      target_field: claroty_xdome.alert.device.cmms.ownership
      ignore_missing: true
  - rename:
      field: json.cmms_owning_cost_center
      tag: rename_cmms_owning_cost_center
      target_field: claroty_xdome.alert.device.cmms.owning_cost_center
      ignore_missing: true
  - rename:
      field: json.cmms_room
      tag: rename_cmms_room
      target_field: claroty_xdome.alert.device.cmms.room
      ignore_missing: true
  - rename:
      field: json.cmms_serial_number
      tag: rename_cmms_serial_number
      target_field: claroty_xdome.alert.device.cmms.serial_number
      ignore_missing: true
  - rename:
      field: json.cmms_state
      tag: rename_cmms_state
      target_field: claroty_xdome.alert.device.cmms.state
      ignore_missing: true
  - rename:
      field: json.cmms_technician
      tag: rename_cmms_technician
      target_field: claroty_xdome.alert.device.cmms.technician
      ignore_missing: true
  - rename:
      field: json.collection_interfaces_seen_reported_from
      tag: rename_collection_interfaces_seen_reported_from
      target_field: claroty_xdome.alert.device.collection.interfaces.seen_reported_from
      ignore_missing: true
  - rename:
      field: json.collection_interfaces
      tag: rename_collection_interfaces
      target_field: claroty_xdome.alert.device.collection.interfaces.value
      ignore_missing: true
  - rename:
      field: json.collection_servers_seen_reported_from
      tag: rename_collection_servers_seen_reported_from
      target_field: claroty_xdome.alert.device.collection.servers.seen_reported_from
      ignore_missing: true
  - rename:
      field: json.collection_servers
      tag: rename_collection_servers
      target_field: claroty_xdome.alert.device.collection.servers.value
      ignore_missing: true
  - rename:
      field: json.combined_os
      tag: rename_combined_os
      target_field: claroty_xdome.alert.device.combined_os
      ignore_missing: true
  - set:
      field: host.os.full
      tag: set_host_os_full_from_alert_device_combined_os
      copy_from: claroty_xdome.alert.device.combined_os
      ignore_empty_value: true
  - append:
      field: related.hosts
      tag: append_related_hosts_from_combined_os
      value: '{{{claroty_xdome.alert.device.combined_os}}}'
      allow_duplicates: false
      if: ctx.claroty_xdome?.alert?.device?.combined_os != null
  - rename:
      field: json.connection_paths
      tag: rename_connection_paths
      target_field: claroty_xdome.alert.device.connection.paths
      ignore_missing: true
  - rename:
      field: json.connection_type_list
      tag: rename_connection_type_list
      target_field: claroty_xdome.alert.device.connection.type_list
      ignore_missing: true
  - rename:
      field: json.consequence_of_failure
      tag: rename_consequence_of_failure
      target_field: claroty_xdome.alert.device.consequence_of_failure
      ignore_missing: true
  - rename:
      field: json.cppm_authentication_status_list
      tag: rename_cppm_authentication_status_list
      target_field: claroty_xdome.alert.device.cppm.authentication_status_list
      ignore_missing: true
  - rename:
      field: json.cppm_roles_list
      tag: rename_cppm_roles_list
      target_field: claroty_xdome.alert.device.cppm.roles_list
      ignore_missing: true
  - rename:
      field: json.cppm_service_list
      tag: rename_cppm_service_list
      target_field: claroty_xdome.alert.device.cppm.service_list
      ignore_missing: true
  - rename:
      field: json.data_sources_seen_reported_from
      tag: rename_data_sources_seen_reported_from
      target_field: claroty_xdome.alert.device.data_sources_seen_reported_from
      ignore_missing: true
  - rename:
      field: json.dhcp_fingerprint
      tag: rename_dhcp_fingerprint
      target_field: claroty_xdome.alert.device.dhcp.fingerprint
      ignore_missing: true
  - foreach:
      field: json.dhcp_hostnames
      tag: foreach_dhcp_hostnames
      if: ctx.json?.dhcp_hostnames instanceof List
      processor:
        append:
          field: related.hosts
          tag: append_dhcp_hostnames_into_related_hosts
          value: '{{{_ingest._value}}}'
          allow_duplicates: false
  - rename:
      field: json.dhcp_hostnames
      tag: rename_dhcp_hostnames
      target_field: claroty_xdome.alert.device.dhcp.hostnames
      ignore_missing: true
  - rename:
      field: json.dhcp_last_seen_hostname
      tag: rename_dhcp_last_seen_hostname
      target_field: claroty_xdome.alert.device.dhcp.last_seen_hostname
      ignore_missing: true
  - append:
      field: related.hosts
      tag: append_related_hosts_from_dhcp_last_seen_hostname
      value: '{{{claroty_xdome.alert.device.dhcp.last_seen_hostname}}}'
      allow_duplicates: false
      if: ctx.claroty_xdome?.alert?.device?.dhcp?.last_seen_hostname != null
  - foreach:
      field: json.domains
      tag: foreach_domains_append_to_host_domain
      if: ctx.json?.domains instanceof List
      processor:
        append:
          field: host.domain
          tag: append_domains_into_host_domain
          value: '{{{_ingest._value}}}'
          allow_duplicates: false
  - foreach:
      field: json.domains
      tag: foreach_domains_append_to_related_hosts
      if: ctx.json?.domains instanceof List
      processor:
        append:
          field: related.hosts
          tag: append_domains_into_related_hosts
          value: '{{{_ingest._value}}}'
          allow_duplicates: false
  - rename:
      field: json.domains
      tag: rename_domains
      target_field: claroty_xdome.alert.device.domains
      ignore_missing: true
  - rename:
      field: json.edge_hosts_seen_reported_from
      tag: rename_edge_hosts_seen_reported_from
      target_field: claroty_xdome.alert.device.edge.hosts_seen_reported_from
      ignore_missing: true
  - rename:
      field: json.edge_locations
      tag: rename_edge_locations
      target_field: claroty_xdome.alert.device.edge.locations
      ignore_missing: true
  - rename:
      field: json.edge_locations_seen_reported_from
      tag: rename_edge_locations_seen_reported_from
      target_field: claroty_xdome.alert.device.edge.locations_seen_reported_from
      ignore_missing: true
  - rename:
      field: json.edr_is_up_to_date_text
      tag: rename_edr_is_up_to_date_text
      target_field: claroty_xdome.alert.device.edr.is_up_to_date_text
      ignore_missing: true
  - date:
      field: json.edr_last_scan_time
      tag: date_edr_last_scan_time
      target_field: claroty_xdome.alert.device.edr.last_scan_time
      formats:
        - ISO8601
      if: ctx.json?.edr_last_scan_time != null && ctx.json.edr_last_scan_time != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.effective_likelihood_subscore_points
      tag: convert_effective_likelihood_subscore_points_to_double
      target_field: claroty_xdome.alert.device.effective_likelihood_subscore.points
      type: double
      ignore_missing: true
      if: ctx.json?.effective_likelihood_subscore_points != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.effective_likelihood_subscore
      tag: rename_effective_likelihood_subscore
      target_field: claroty_xdome.alert.device.effective_likelihood_subscore.value
      ignore_missing: true
  - date:
      field: json.end_of_life_date
      tag: date_end_of_life_date
      target_field: claroty_xdome.alert.device.end_of.life.date
      formats:
        - ISO8601
      if: ctx.json?.end_of_life_date != null && ctx.json.end_of_life_date != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.end_of_life_state
      tag: rename_end_of_life_state
      target_field: claroty_xdome.alert.device.end_of.life.state
      ignore_missing: true
  - date:
      field: json.end_of_sale_date
      tag: date_end_of_sale_date
      target_field: claroty_xdome.alert.device.end_of.sale_date
      formats:
        - ISO8601
      if: ctx.json?.end_of_sale_date != null && ctx.json.end_of_sale_date != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.endpoint_security_names
      tag: rename_endpoint_security_names
      target_field: claroty_xdome.alert.device.endpoint_security_names
      ignore_missing: true
  - rename:
      field: json.enforcement_or_authorization_profiles_list
      tag: rename_enforcement_or_authorization_profiles_list
      target_field: claroty_xdome.alert.device.enforcement_or_authorization_profiles_list
      ignore_missing: true
  - rename:
      field: json.equipment_class
      tag: rename_equipment_class
      target_field: claroty_xdome.alert.device.equipment_class
      ignore_missing: true
  - rename:
      field: json.fda_class
      tag: rename_fda_class
      target_field: claroty_xdome.alert.device.fda_class
      ignore_missing: true
  - rename:
      field: json.financial_cost
      tag: rename_financial_cost
      target_field: claroty_xdome.alert.device.financial_cost
      ignore_missing: true
  - foreach:
      field: json.first_seen_list
      tag: foreach_first_seen_list
      if: ctx.json?.first_seen_list instanceof List
      processor:
        date:
          field: _ingest._value
          tag: date_first_seen_list
          target_field: _ingest._value
          formats:
            - ISO8601
          on_failure:
            - remove:
                field: _ingest._value
                ignore_missing: true
  - rename:
      field: json.first_seen_list
      tag: rename_first_seen_list
      target_field: claroty_xdome.alert.device.first_seen_list
      ignore_missing: true
  - rename:
      field: json.handles_pii
      tag: rename_handles_pii
      target_field: claroty_xdome.alert.device.handles_pii
      ignore_missing: true
  - rename:
      field: json.http_hostnames
      tag: rename_http_hostnames
      target_field: claroty_xdome.alert.device.http.hostnames
      ignore_missing: true
  - foreach:
      field: claroty_xdome.alert.device.http.hostnames
      tag: foreach_http_hostnames_into_related_hosts
      if: ctx.claroty_xdome?.alert?.device?.http?.hostnames instanceof List
      processor:
        append:
          field: related.hosts
          tag: append_http_hostnames_into_related_hosts
          value: '{{{_ingest._value}}}'
          allow_duplicates: false
  - rename:
      field: json.http_last_seen_hostname
      tag: rename_http_last_seen_hostname
      target_field: claroty_xdome.alert.device.http.last_seen_hostname
      ignore_missing: true
  - set:
      field: host.hostname
      tag: set_host_hostname
      copy_from: claroty_xdome.alert.device.http.last_seen_hostname
      ignore_empty_value: true
  - append:
      field: related.hosts
      tag: append_related_hosts_from_http_last_seen_hostname
      value: '{{{claroty_xdome.alert.device.http.last_seen_hostname}}}'
      allow_duplicates: false
      if: ctx.claroty_xdome?.alert?.device?.http?.last_seen_hostname != null
  - rename:
      field: json.hw_version
      tag: rename_hw_version
      target_field: claroty_xdome.alert.device.hw_version
      ignore_missing: true
  - convert:
      field: json.impact_subscore_points
      tag: convert_impact_subscore_points_to_double
      target_field: claroty_xdome.alert.device.impact_subscore.points
      type: double
      ignore_missing: true
      if: ctx.json?.impact_subscore_points != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.impact_subscore
      tag: rename_impact_subscore
      target_field: claroty_xdome.alert.device.impact_subscore.value
      ignore_missing: true
  - convert:
      field: json.insecure_protocols_points
      tag: convert_insecure_protocols_points_to_double
      target_field: claroty_xdome.alert.device.insecure_protocols.points
      type: double
      ignore_missing: true
      if: ctx.json?.insecure_protocols_points != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.insecure_protocols
      tag: rename_insecure_protocols
      target_field: claroty_xdome.alert.device.insecure_protocols.value
      ignore_missing: true
  - rename:
      field: json.integration_types_reported_from
      tag: rename_integration_types_reported_from
      target_field: claroty_xdome.alert.device.integration_types_reported_from
      ignore_missing: true
  - rename:
      field: json.integrations_reported_from
      tag: rename_integrations_reported_from
      target_field: claroty_xdome.alert.device.integrations_reported_from
      ignore_missing: true
  - convert:
      field: json.internet_communication
      tag: convert_internet_communication_to_keyword
      target_field: claroty_xdome.alert.device.internet_communication
      type: string
      ignore_missing: true
  - rename:
      field: json.ip_assignment_list
      tag: rename_ip_assignment_list
      target_field: claroty_xdome.alert.device.ip.assignment_list
      ignore_missing: true
  - rename:
      field: json.ip_list
      tag: rename_ip_list
      target_field: claroty_xdome.alert.device.ip.list
      ignore_missing: true
  - foreach:
      field: claroty_xdome.alert.device.ip.list
      tag: foreach_convert_ip_list_to_ip
      if: ctx.claroty_xdome?.alert?.device?.ip?.list instanceof List
      processor:
        convert:
          field: _ingest._value
          tag: convert_ip_list_to_ip
          type: ip
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value
                ignore_missing: true
  - foreach:
      field: claroty_xdome.alert.device.ip.list
      tag: foreach_ip_list
      if: ctx.claroty_xdome?.alert?.device?.ip?.list instanceof List
      processor:
        append:
          field: related.ip
          tag: append_ip_list_into_related.ip
          value: '{{{_ingest._value}}}'
          allow_duplicates: false
  - convert:
      field: json.device_name
      tag: convert_device_name_to_ip
      target_field: claroty_xdome.alert.device.ip.value
      type: ip
      ignore_missing: true
      if: ctx.json?.device_name != ''
      on_failure:
        - rename:
            field: json.device_name
            tag: rename_device_name
            target_field: claroty_xdome.alert.device.name
            ignore_missing: true
  - append:
      field: related.ip
      tag: append_related_ip_from_device_ip
      value: '{{{claroty_xdome.alert.device.ip.value}}}'
      allow_duplicates: false
      if: ctx.claroty_xdome?.alert?.device?.ip?.value != null
  - append:
      field: related.hosts
      tag: append_related_hosts_from_dest_device_name
      value: '{{{claroty_xdome.alert.device.name}}}'
      allow_duplicates: false
      if: ctx.claroty_xdome?.alert?.device?.name != null
  - set:
      field: host.name
      tag: set_host_name_from_alert_device_name
      copy_from: claroty_xdome.alert.device.name
      ignore_empty_value: true
  - append:
      field: host.ip
      tag: append_host_ip_from_alert_device_ip
      value: '{{{claroty_xdome.alert.device.ip.value}}}'
      allow_duplicates: false
      if: ctx.claroty_xdome?.alert?.device?.ip?.value != null
  - geoip:
      field: host.ip
      target_field: host.geo
      ignore_missing: true
  - convert:
      field: json.is_online
      tag: convert_is_online_to_boolean
      target_field: claroty_xdome.alert.device.is_online
      type: boolean
      ignore_missing: true
      if: ctx.json?.is_online != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.is_resolved
      tag: convert_is_resolved_to_boolean
      target_field: claroty_xdome.alert.device.is_resolved
      type: boolean
      ignore_missing: true
      if: ctx.json?.is_resolved != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.ise_authentication_method_list
      tag: rename_ise_authentication_method_list
      target_field: claroty_xdome.alert.device.ise.authentication_method_list
      ignore_missing: true
  - rename:
      field: json.ise_endpoint_profile_list
      tag: rename_ise_endpoint_profile_list
      target_field: claroty_xdome.alert.device.ise.endpoint_profile_list
      ignore_missing: true
  - rename:
      field: json.ise_identity_group_list
      tag: rename_ise_identity_group_list
      target_field: claroty_xdome.alert.device.ise.identity_group_list
      ignore_missing: true
  - rename:
      field: json.ise_logical_profile_list
      tag: rename_ise_logical_profile_list
      target_field: claroty_xdome.alert.device.ise.logical_profile_list
      ignore_missing: true
  - rename:
      field: json.ise_security_group_description_list
      tag: rename_ise_security_group_description_list
      target_field: claroty_xdome.alert.device.ise.security_group.description_list
      ignore_missing: true
  - rename:
      field: json.ise_security_group_name_list
      tag: rename_ise_security_group_name_list
      target_field: claroty_xdome.alert.device.ise.security_group.name_list
      ignore_missing: true
  - foreach:
      field: json.ise_security_group_tag_list
      tag: convert_foreach_ise_security_group_tag_list
      if: ctx.json?.ise_security_group_tag_list instanceof List
      processor:
        convert:
          field: _ingest._value
          tag: convert_device_ise_security_group_tag_list_to_string
          type: string
          ignore_missing: true
  - rename:
      field: json.ise_security_group_tag_list
      tag: rename_ise_security_group_tag_list
      target_field: claroty_xdome.alert.device.ise.security_group.tag_list
      ignore_missing: true
  - convert:
      field: json.known_vulnerabilities_points
      tag: convert_known_vulnerabilities_points_to_double
      target_field: claroty_xdome.alert.device.known_vulnerabilities.points
      type: double
      ignore_missing: true
      if: ctx.json?.known_vulnerabilities_points != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.known_vulnerabilities
      tag: rename_known_vulnerabilities
      target_field: claroty_xdome.alert.device.known_vulnerabilities.value
      ignore_missing: true
  - rename:
      field: json.labels
      tag: rename_labels
      target_field: claroty_xdome.alert.device.labels
      ignore_missing: true
  - date:
      field: json.last_scan_time
      tag: date_last_scan_time
      target_field: claroty_xdome.alert.device.last.scan_time
      formats:
        - ISO8601
      if: ctx.json?.last_scan_time != null && ctx.json.last_scan_time != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: json.last_seen_list
      tag: foreach_date_last_seen_list
      if: ctx.json?.last_seen_list instanceof List
      processor:
        date:
          field: _ingest._value
          tag: date_last_seen_list
          target_field: _ingest._value
          formats:
            - ISO8601
          on_failure:
            - remove:
                field: _ingest._value
                ignore_missing: true
  - rename:
      field: json.last_seen_list
      tag: rename_last_seen_list
      target_field: claroty_xdome.alert.device.last.seen.list
      ignore_missing: true
  - foreach:
      field: json.last_seen_on_switch_list
      tag: foreach_date_last_seen_on_switch_list
      if: ctx.json?.last_seen_on_switch_list instanceof List
      processor:
        date:
          field: _ingest._value
          tag: date_last_seen_on_switch_list
          target_field: _ingest._value
          formats:
            - ISO8601
          on_failure:
            - remove:
                field: _ingest._value
                ignore_missing: true
  - rename:
      field: json.last_seen_on_switch_list
      tag: rename_last_seen_on_switch_list
      target_field: claroty_xdome.alert.device.last.seen.on_switch_list
      ignore_missing: true
  - date:
      field: json.last_seen_reported
      tag: date_last_seen_reported
      target_field: claroty_xdome.alert.device.last.seen.reported
      formats:
        - ISO8601
      if: ctx.json?.last_seen_reported != null && ctx.json.last_seen_reported != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - date:
      field: json.last_domain_user_activity
      tag: date_last_domain_user_activity
      target_field: claroty_xdome.alert.device.last_domain_user.activity
      formats:
        - ISO8601
      if: ctx.json?.last_domain_user_activity != null && ctx.json.last_domain_user_activity != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.last_domain_user
      tag: rename_last_domain_user
      target_field: claroty_xdome.alert.device.last_domain_user.name
      ignore_missing: true
  - append:
      field: related.user
      tag: append_related_user_from_last_domain_user
      value: '{{{claroty_xdome.alert.device.last_domain_user.name}}}'
      allow_duplicates: false
      if: ctx.claroty_xdome?.alert?.device?.last_domain_user?.name != null
  - convert:
      field: json.likelihood_subscore_points
      tag: convert_likelihood_subscore_points_to_double
      target_field: claroty_xdome.alert.device.likelihood_subscore.points
      type: double
      ignore_missing: true
      if: ctx.json?.likelihood_subscore_points != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.likelihood_subscore
      tag: rename_likelihood_subscore
      target_field: claroty_xdome.alert.device.likelihood_subscore.value
      ignore_missing: true
  - rename:
      field: json.local_name
      tag: rename_local_name
      target_field: claroty_xdome.alert.device.local_name
      ignore_missing: true
  - append:
      field: related.hosts
      tag: append_related_hosts_from_local_name
      value: '{{{claroty_xdome.alert.device.local_name}}}'
      allow_duplicates: false
      if: ctx.claroty_xdome?.alert?.device?.local_name != null
  - foreach:
      field: json.mac_list
      tag: foreach_mac_list
      if: ctx.json?.mac_list instanceof List
      processor:
        append:
          field: host.mac
          tag: append_mac_list_into_host_mac
          value: '{{{_ingest._value}}}'
          allow_duplicates: false
  - gsub:
      field: host.mac
      tag: gsub_host_mac
      target_field: host.mac
      pattern: '[-:.]'
      replacement: '-'
      ignore_missing: true
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - uppercase:
      field: host.mac
      tag: uppercase_host_mac
      ignore_missing: true
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.mac_list
      tag: rename_mac_list
      target_field: claroty_xdome.alert.device.mac.list
      ignore_missing: true
  - rename:
      field: json.mac_oui_list
      tag: rename_mac_oui_list
      target_field: claroty_xdome.alert.device.mac.oui_list
      ignore_missing: true
  - rename:
      field: json.machine_type
      tag: rename_machine_type
      target_field: claroty_xdome.alert.device.machine_type
      ignore_missing: true
  - rename:
      field: json.managed_by
      tag: rename_managed_by
      target_field: claroty_xdome.alert.device.managed_by
      ignore_missing: true
  - rename:
      field: json.management_services
      tag: rename_management_services
      target_field: claroty_xdome.alert.device.management_services
      ignore_missing: true
  - rename:
      field: json.manufacturer
      tag: rename_manufacturer
      target_field: claroty_xdome.alert.device.manufacturer
      ignore_missing: true
  - set:
      field: device.manufacturer
      tag: set_device_manufacturer_from_alert_device_manufacturer
      copy_from: claroty_xdome.alert.device.manufacturer
      ignore_empty_value: true
  - rename:
      field: json.mdm_compliance_status
      tag: rename_mdm_compliance_status
      target_field: claroty_xdome.alert.device.mdm.compliance_status
      ignore_missing: true
  - rename:
      field: json.mdm_enrollment_status
      tag: rename_mdm_enrollment_status
      target_field: claroty_xdome.alert.device.mdm.enrollment_status
      ignore_missing: true
  - rename:
      field: json.mdm_ownership
      tag: rename_mdm_ownership
      target_field: claroty_xdome.alert.device.mdm.ownership
      ignore_missing: true
  - rename:
      field: json.mobility
      tag: rename_mobility
      target_field: claroty_xdome.alert.device.mobility
      ignore_missing: true
  - rename:
      field: json.model_family
      tag: rename_model_family
      target_field: claroty_xdome.alert.device.model.family
      ignore_missing: true
  - set:
      field: device.model.name
      tag: set_device_model_name_from_alert_device_model_family
      copy_from: claroty_xdome.alert.device.model.family
      ignore_empty_value: true
  - rename:
      field: json.model
      tag: rename_model
      target_field: claroty_xdome.alert.device.model.name
      ignore_missing: true
  - set:
      field: device.model.identifier
      tag: set_device_model_identifier_from_alert_device_model_name
      copy_from: claroty_xdome.alert.device.model.name
      ignore_empty_value: true
  - rename:
      field: json.network_scope_list
      tag: rename_network_scope_list
      target_field: claroty_xdome.alert.device.network.scope_list
      ignore_missing: true
  - rename:
      field: json.network_list
      tag: rename_network_list
      target_field: claroty_xdome.alert.device.network_list
      ignore_missing: true
  - rename:
      field: json.note
      tag: rename_note
      target_field: claroty_xdome.alert.device.note
      ignore_missing: true
  - convert:
      field: json.number_of_nics
      tag: convert_number_of_nics_to_long
      target_field: claroty_xdome.alert.device.number_of_nics
      type: long
      ignore_missing: true
      if: ctx.json?.number_of_nics != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.operating_hours_pattern_name
      tag: rename_operating_hours_pattern_name
      target_field: claroty_xdome.alert.device.operating_hours_pattern_name
      ignore_missing: true
  - rename:
      field: json.organization_firewall_group_name
      tag: rename_organization_firewall_group_name
      target_field: claroty_xdome.alert.device.organization.firewall_group_name
      ignore_missing: true
  - rename:
      field: json.organization_zone_name
      tag: rename_organization_zone_name
      target_field: claroty_xdome.alert.device.organization.zone_name
      ignore_missing: true
  - rename:
      field: json.os_category
      tag: rename_os_category
      target_field: claroty_xdome.alert.device.os.category
      ignore_missing: true
  - set:
      field: host.os.family
      tag: set_host_os_family_from_alert_device_os_category
      copy_from: claroty_xdome.alert.device.os.category
      ignore_empty_value: true
  - date:
      field: json.os_eol_date
      tag: date_os_eol_date
      target_field: claroty_xdome.alert.device.os.eol_date
      formats:
        - ISO8601
      if: ctx.json?.os_eol_date != null && ctx.json.os_eol_date != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.os_name
      tag: rename_os_name
      target_field: claroty_xdome.alert.device.os.name
      ignore_missing: true
  - set:
      field: host.os.name
      tag: set_host_os_name_from_alert_device_os_name
      copy_from: claroty_xdome.alert.device.os.name
      ignore_empty_value: true
  - append:
      field: related.hosts
      tag: append_related_hosts_from_alert_device_os_name
      value: '{{{claroty_xdome.alert.device.os.name}}}'
      allow_duplicates: false
      if: ctx.claroty_xdome?.alert?.device?.os?.name != null
  - rename:
      field: json.os_revision
      tag: rename_os_revision
      target_field: claroty_xdome.alert.device.os.revision
      ignore_missing: true
  - rename:
      field: json.os_subcategory
      tag: rename_os_subcategory
      target_field: claroty_xdome.alert.device.os.subcategory
      ignore_missing: true
  - rename:
      field: json.os_version
      tag: rename_os_version
      target_field: claroty_xdome.alert.device.os.version
      ignore_missing: true
  - set:
      field: host.os.version
      tag: set_host_os_version_from_alert_device_os_version
      copy_from: claroty_xdome.alert.device.os.version
      ignore_empty_value: true
  - rename:
      field: json.other_hostnames
      tag: rename_other_hostnames
      target_field: claroty_xdome.alert.device.other_hostnames
      ignore_missing: true
  - foreach:
      field: claroty_xdome.alert.device.other_hostnames
      tag: foreach_append_other_hostnames_into_related_hosts
      if: ctx.claroty_xdome?.alert?.device?.other_hostnames instanceof List
      processor:
        append:
          field: related.hosts
          tag: append_other_hostnames_into_related_hosts
          value: '{{{_ingest._value}}}'
          allow_duplicates: false
  - rename:
      field: json.phi
      tag: rename_phi
      target_field: claroty_xdome.alert.device.phi
      ignore_missing: true
  - rename:
      field: json.product_code
      tag: rename_product_code
      target_field: claroty_xdome.alert.device.product.code
      ignore_missing: true
  - rename:
      field: json.protocol_location_list
      tag: rename_protocol_location_list
      target_field: claroty_xdome.alert.device.protocol.location_list
      ignore_missing: true
  - rename:
      field: json.purdue_level_source
      tag: rename_purdue_level_source
      target_field: claroty_xdome.alert.device.purdue_level.source
      ignore_missing: true
  - rename:
      field: json.purdue_level
      tag: rename_purdue_level
      target_field: claroty_xdome.alert.device.purdue_level.value
      ignore_missing: true
  - rename:
      field: json.recommended_firewall_group_name
      tag: rename_recommended_firewall_group_name
      target_field: claroty_xdome.alert.device.recommended.firewall_group_name
      ignore_missing: true
  - rename:
      field: json.recommended_zone_name
      tag: rename_recommended_zone_name
      target_field: claroty_xdome.alert.device.recommended.zone_name
      ignore_missing: true
  - date:
      field: json.retired_since
      tag: date_retired_since
      target_field: claroty_xdome.alert.device.retired.since
      formats:
        - ISO8601
      if: ctx.json?.retired_since != null && ctx.json.retired_since != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.retired
      tag: convert_retired_to_boolean
      target_field: claroty_xdome.alert.device.retired.value
      type: boolean
      ignore_missing: true
      if: ctx.json?.retired != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.risk_score_points
      tag: convert_risk_score_points_to_float
      target_field: claroty_xdome.alert.device.risk_score.points
      type: float
      ignore_missing: true
      if: ctx.json?.risk_score_points != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - set:
      field: event.risk_score
      tag: set_event_risk_score_from_alert_device_risk_score_points
      copy_from: claroty_xdome.alert.device.risk_score.points
      ignore_empty_value: true
  - rename:
      field: json.risk_score
      tag: rename_risk_score
      target_field: claroty_xdome.alert.device.risk_score.value
      ignore_missing: true
  - script:
      lang: painless
      description: Script to set event.severity.
      tag: set_event_severity
      if: ctx.claroty_xdome?.alert?.device?.risk_score?.value instanceof String
      source: |-
        ctx.event = ctx.event ?: [:];
        String risk_score_value = ctx.claroty_xdome.alert.device.risk_score.value;
        if (risk_score_value.equalsIgnoreCase("low") || risk_score_value.equalsIgnoreCase("very low")) {
          ctx.event.severity = 21;
        } else if (risk_score_value.equalsIgnoreCase("medium")) {
          ctx.event.severity = 47;
        } else if (risk_score_value.equalsIgnoreCase("high")) {
          ctx.event.severity = 73;
        } else if (risk_score_value.equalsIgnoreCase("critical")) {
          ctx.event.severity = 99;
        }
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.serial_number
      tag: rename_serial_number
      target_field: claroty_xdome.alert.device.serial_number
      ignore_missing: true
  - set:
      field: device.serial_number
      tag: set_device_serial_number_from_alert_device_serial_number
      copy_from: claroty_xdome.alert.device.serial_number
      ignore_empty_value: true
  - rename:
      field: json.site_group_name
      tag: rename_site_group_name
      target_field: claroty_xdome.alert.device.site.group_name
      ignore_missing: true
  - rename:
      field: json.site_name
      tag: rename_site_name
      target_field: claroty_xdome.alert.device.site.name
      ignore_missing: true
  - append:
      field: related.hosts
      tag: append_related_hosts_from_site_name
      value: '{{{claroty_xdome.alert.device.site.name}}}'
      allow_duplicates: false
      if: ctx.claroty_xdome?.alert?.device?.site?.name != null
  - rename:
      field: json.slot_cards
      tag: rename_slot_cards
      target_field: claroty_xdome.alert.device.slot_cards
      ignore_missing: true
  - convert:
      field: claroty_xdome.alert.device.slot_cards.cards_count
      tag: convert_device_slot_cards_cards_count_to_long
      target_field: claroty_xdome.alert.device.slot_cards.count
      type: long
      ignore_missing: true
      if: ctx.claroty_xdome?.alert?.device?.slot_cards?.cards_count != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: claroty_xdome.alert.device.slot_cards.racks
      tag: convert_foreach_slot_cards_racks
      if: ctx.claroty_xdome?.alert?.device?.slot_cards?.racks instanceof List
      processor:
        convert:
          field: _ingest._value.number_of_slots
          tag: convert_device_slot_cards_number_of_slots
          type: long
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.number_of_slots
                ignore_missing: true
  - foreach:
      field: claroty_xdome.alert.device.slot_cards.racks
      tag: convert_foreach_slot_cards_racks_cards_slot_number
      if: ctx.claroty_xdome?.alert?.device?.slot_cards?.racks instanceof List
      processor:
        foreach:
          field: _ingest._value.cards
          tag: foreach_cards_slot_number
          processor:
            convert:
              field: _ingest._value.slot_number
              tag: convert_device_slot_cards_slot_number
              type: long
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value
                    ignore_missing: true
  - foreach:
      field: claroty_xdome.alert.device.slot_cards.racks
      tag: convert_foreach_slot_cards_racks_cards_ip
      if: ctx.claroty_xdome?.alert?.device?.slot_cards?.racks instanceof List
      processor:
        foreach:
          field: _ingest._value.cards
          tag: foreach_cards_ip
          processor:
            convert:
              field: _ingest._value.ip
              tag: convert_device_slot_cards_ip
              type: ip
              ignore_missing: true
              on_failure:
                  - append:
                      field: error.message
                      value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.snmp_hostnames
      tag: rename_snmp_hostnames
      target_field: claroty_xdome.alert.device.snmp.hostnames
      ignore_missing: true
  - foreach:
      field: claroty_xdome.alert.device.snmp.hostnames
      tag: foreach_append_snmp_hostnames_into_related_hosts
      if: ctx.claroty_xdome?.alert?.device?.snmp?.hostnames instanceof List
      processor:
        append:
          field: related.hosts
          tag: append_snmp_hostnames_into_related_hosts
          value: '{{{_ingest._value}}}'
          allow_duplicates: false
  - rename:
      field: json.snmp_last_seen_hostname
      tag: rename_snmp_last_seen_hostname
      target_field: claroty_xdome.alert.device.snmp.last_seen_hostname
      ignore_missing: true
  - append:
      field: related.hosts
      tag: append_related_hosts_from_snmp_last_seen_hostname
      value: '{{{claroty_xdome.alert.device.snmp.last_seen_hostname}}}'
      allow_duplicates: false
      if: ctx.claroty_xdome?.alert?.device?.snmp?.last_seen_hostname != null
  - rename:
      field: json.software_or_firmware_version
      tag: rename_software_or_firmware_version
      target_field: claroty_xdome.alert.device.software_or_firmware_version
      ignore_missing: true
  - rename:
      field: json.ssid_list
      tag: rename_ssid_list
      target_field: claroty_xdome.alert.device.ssid_list
      ignore_missing: true
  - rename:
      field: json.device_subcategory
      tag: rename_device_subcategory
      target_field: claroty_xdome.alert.device.subcategory
      ignore_missing: true
  - rename:
      field: json.suspicious
      tag: rename_suspicious
      target_field: claroty_xdome.alert.device.suspicious
      ignore_missing: true
  - rename:
      field: json.switch_group_name_list
      tag: rename_switch_group_name_list
      target_field: claroty_xdome.alert.device.switch.group_name_list
      ignore_missing: true
  - rename:
      field: json.switch_ip_list
      tag: rename_switch_ip_list
      target_field: claroty_xdome.alert.device.switch.ip_list
      ignore_missing: true
  - foreach:
      field: claroty_xdome.alert.device.switch.ip_list
      tag: convert_foreach_switch_ip_list
      if: ctx.claroty_xdome?.alert?.device?.switch?.ip_list instanceof List
      processor:
        convert:
          field: _ingest._value
          tag: convert_device_switch_ip_list_to_ip
          type: ip
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value
                ignore_missing: true
  - foreach:
      field: claroty_xdome.alert.device.switch.ip_list
      tag: foreach_append_ip_list_into_related_ip
      if: ctx.claroty_xdome?.alert?.device?.switch?.ip_list instanceof List
      processor:
        append:
          field: related.ip
          tag: append_ip_list_into_related_ip
          value: '{{{_ingest._value}}}'
          allow_duplicates: false
  - rename:
      field: json.switch_location_list
      tag: rename_switch_location_list
      target_field: claroty_xdome.alert.device.switch.location_list
      ignore_missing: true
  - rename:
      field: json.switch_mac_list
      tag: rename_switch_mac_list
      target_field: claroty_xdome.alert.device.switch.mac_list
      ignore_missing: true
  - rename:
      field: json.switch_name_list
      tag: rename_switch_name_list
      target_field: claroty_xdome.alert.device.switch.name_list
      ignore_missing: true
  - rename:
      field: json.switch_port_description_list
      tag: rename_switch_port_description_list
      target_field: claroty_xdome.alert.device.switch.port_description_list
      ignore_missing: true
  - rename:
      field: json.switch_port_list
      tag: rename_switch_port_list
      target_field: claroty_xdome.alert.device.switch.port_list
      ignore_missing: true
  - rename:
      field: json.device_type_family
      tag: rename_device_type_family
      target_field: claroty_xdome.alert.device.type.family
      ignore_missing: true
  - rename:
      field: json.device_type
      tag: rename_device_type
      target_field: claroty_xdome.alert.device.type.value
      ignore_missing: true
  - set:
      field: host.type
      tag: set_host_type_from_alert_device_type_value
      copy_from: claroty_xdome.alert.device.type.value
      ignore_empty_value: true
  - rename:
      field: json.uid
      tag: rename_uid
      target_field: claroty_xdome.alert.device.uid
      ignore_missing: true
  - set:
      field: host.id
      tag: set_host_id_from_alert_device_uid
      copy_from: claroty_xdome.alert.device.uid
      ignore_empty_value: true
  - append:
      field: related.hosts
      tag: append_related_hosts_from_device_uid
      value: '{{{claroty_xdome.alert.device.uid}}}'
      allow_duplicates: false
      if: ctx.claroty_xdome?.alert?.device?.uid != null
  - convert:
      field: json.utilization_rate
      tag: convert_utilization_rate_to_double
      target_field: claroty_xdome.alert.device.utilization_rate
      type: double
      ignore_missing: true
      if: ctx.json?.utilization_rate != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.visibility_score_level
      tag: rename_visibility_score_level
      target_field: claroty_xdome.alert.device.visibility_score.level
      ignore_missing: true
  - convert:
      field: json.visibility_score
      tag: convert_visibility_score_to_long
      target_field: claroty_xdome.alert.device.visibility_score.value
      type: long
      ignore_missing: true
      if: ctx.json?.visibility_score != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.vlan_description_list
      tag: rename_vlan_description_list
      target_field: claroty_xdome.alert.device.vlan.description_list
      ignore_missing: true
  - foreach:
      field: json.vlan_list
      tag: convert_foreach_vlan_list
      if: ctx.json?.vlan_list instanceof List
      processor:
        convert:
          field: _ingest._value
          tag: convert_device_vlan_list_to_string
          type: string
          ignore_missing: true
  - foreach:
      field: json.vlan_list
      tag: append_foreach_vlan_list
      if: ctx.json?.vlan_list instanceof List
      processor:
        append:
          field: observer.ingress.vlan.id
          tag: append_to_observer_vlan_id
          value: '{{{_ingest._value}}}'
          allow_duplicates: false
  - rename:
      field: json.vlan_list
      tag: rename_vlan_list
      target_field: claroty_xdome.alert.device.vlan.list
      ignore_missing: true
  - foreach:
      field: json.vlan_name_list
      tag: convert_foreach_vlan_name_list
      if: ctx.json?.vlan_name_list instanceof List
      processor:
        append:
          field: observer.ingress.vlan.name
          tag: append_to_observer_vlan_name
          value: '{{{_ingest._value}}}'
          allow_duplicates: false
  - rename:
      field: json.vlan_name_list
      tag: rename_vlan_name_list
      target_field: claroty_xdome.alert.device.vlan.name_list
      ignore_missing: true
  - foreach:
      field: json.wifi_last_seen_list
      tag: foreach_date_wifi_last_seen_list
      if: ctx.json?.wifi_last_seen_list instanceof List
      processor:
        date:
          field: _ingest._value
          tag: date_wifi_last_seen_list
          target_field: _ingest._value
          formats:
            - ISO8601
          on_failure:
            - remove:
                field: _ingest._value
                ignore_missing: true
  - rename:
      field: json.wifi_last_seen_list
      tag: rename_wifi_last_seen_list
      target_field: claroty_xdome.alert.device.wifi_last_seen_list
      ignore_missing: true
  - rename:
      field: json.windows_hostnames
      tag: rename_windows_hostnames
      target_field: claroty_xdome.alert.device.windows.hostnames
      ignore_missing: true
  - foreach:
      field: claroty_xdome.alert.device.windows.hostnames
      tag: foreach_append_windows_hostnames_into_related_hosts
      if: ctx.claroty_xdome?.alert?.device?.windows?.hostnames instanceof List
      processor:
        append:
          field: related.hosts
          tag: append_windows_hostnames_into_related_hosts
          value: '{{{_ingest._value}}}'
          allow_duplicates: false
  - rename:
      field: json.windows_last_seen_hostname
      tag: rename_windows_last_seen_hostname
      target_field: claroty_xdome.alert.device.windows.last_seen_hostname
      ignore_missing: true
  - append:
      field: related.hosts
      tag: append_related_hosts_from_windows_last_seen_hostname
      value: '{{{claroty_xdome.alert.device.windows.last_seen_hostname}}}'
      allow_duplicates: false
      if: ctx.claroty_xdome?.alert?.device?.windows?.last_seen_hostname != null
  - rename:
      field: json.wireless_encryption_type_list
      tag: rename_wireless_encryption_type_list
      target_field: claroty_xdome.alert.device.wireless_encryption_type_list
      ignore_missing: true
  - rename:
      field: json.wlc_location_list
      tag: rename_wlc_location_list
      target_field: claroty_xdome.alert.device.wlc.location_list
      ignore_missing: true
  - rename:
      field: json.wlc_name_list
      tag: rename_wlc_name_list
      target_field: claroty_xdome.alert.device.wlc.name_list
      ignore_missing: true
  - convert:
      field: json.alert_info.devices_count
      tag: convert_alert_info_devices_count_to_long
      target_field: claroty_xdome.alert.devices_count
      type: long
      ignore_missing: true
      if: ctx.json?.alert_info?.devices_count != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.alert_info.id
      tag: convert_alert_info_id_to_string
      type: string
      target_field: claroty_xdome.alert.id
      ignore_missing: true
  - convert:
      field: json.alert_info.iot_devices_count
      tag: convert_alert_info_iot_devices_count_to_long
      target_field: claroty_xdome.alert.iot_devices_count
      type: long
      ignore_missing: true
      if: ctx.json?.alert_info?.iot_devices_count != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.alert_info.it_devices_count
      tag: convert_alert_info_it_devices_count_to_long
      target_field: claroty_xdome.alert.it_devices_count
      type: long
      ignore_missing: true
      if: ctx.json?.alert_info?.it_devices_count != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.alert_info.malicious_ip_tags_list
      tag: rename_alert_info_malicious_ip_tags_list
      target_field: claroty_xdome.alert.malicious_ip_tags_list
      ignore_missing: true
  - convert:
      field: json.alert_info.medical_devices_count
      tag: convert_alert_info_medical_devices_count_to_long
      target_field: claroty_xdome.alert.medical_devices_count
      type: long
      ignore_missing: true
      if: ctx.json?.alert_info?.medical_devices_count != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.alert_info.mitre_technique_enterprise_ids
      tag: rename_alert_info_mitre_technique_enterprise_ids
      target_field: claroty_xdome.alert.mitre_technique.enterprise.ids
      ignore_missing: true
  - rename:
      field: json.alert_info.mitre_technique_enterprise_names
      tag: rename_alert_info_mitre_technique_enterprise_names
      target_field: claroty_xdome.alert.mitre_technique.enterprise.names
      ignore_missing: true
  - rename:
      field: json.alert_info.mitre_technique_ics_ids
      tag: rename_alert_info_mitre_technique_ics_ids
      target_field: claroty_xdome.alert.mitre_technique.ics.ids
      ignore_missing: true
  - rename:
      field: json.alert_info.mitre_technique_ics_names
      tag: rename_alert_info_mitre_technique_ics_names
      target_field: claroty_xdome.alert.mitre_technique.ics.names
      ignore_missing: true
  - rename:
      field: json.alert_info.alert_name
      tag: rename_alert_info_alert_name
      target_field: claroty_xdome.alert.name
      ignore_missing: true
  - set:
      field: claroty_xdome.alert.friendly_name
      tag: set_friendly_name_from_alert_name
      copy_from: claroty_xdome.alert.name
      ignore_empty_value: true
  - set:
      field: event.action
      tag: set_event_action_from_alert_name
      copy_from: claroty_xdome.alert.name
      ignore_empty_value: true
  - gsub:
      field: event.action
      tag: gsub_event_action
      target_field: event.action
      pattern: '[/:-]'
      replacement: ''
      ignore_missing: true
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - lowercase:
      field: event.action
      tag: lowercase_event_action
      ignore_missing: true
  - split:
      field: event.action
      tag: split_event_action
      separator: \s+
      ignore_missing: true
      if: ctx.event?.action != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - join:
      field: event.action
      tag: join_event_action
      separator: '-'
      if: ctx.event?.action instanceof List
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.alert_info.ot_devices_count
      tag: convert_alert_info_ot_devices_count_to_long
      target_field: claroty_xdome.alert.ot_devices_count
      type: long
      ignore_missing: true
      if: ctx.json?.alert_info?.ot_devices_count != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.alert_info.status
      tag: rename_alert_info_status
      target_field: claroty_xdome.alert.status
      ignore_missing: true
  - rename:
      field: json.alert_info.alert_type_name
      tag: rename_alert_info_alert_type_name
      target_field: claroty_xdome.alert.type_name
      ignore_missing: true
  - convert:
      field: json.alert_info.unresolved_devices_count
      tag: convert_alert_info_unresolved_devices_count_to_long
      target_field: claroty_xdome.alert.unresolved_devices_count
      type: long
      ignore_missing: true
      if: ctx.json?.alert_info?.unresolved_devices_count != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - date:
      field: json.alert_info.updated_time
      tag: date_alert_info_updated_time
      target_field: claroty_xdome.alert.updated_time
      formats:
        - ISO8601
      if: ctx.json?.alert_info?.updated_time != null && ctx.json.alert_info.updated_time != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - set:
      field: '@timestamp'
      tag: set_@timestamp_from_alert_updated_time
      copy_from: claroty_xdome.alert.updated_time
      ignore_empty_value: true
  - remove:
      field:
        - claroty_xdome.alert.description
        - claroty_xdome.alert.device.domains
        - claroty_xdome.alert.device.combined_os
        - claroty_xdome.alert.device.manufacturer
        - claroty_xdome.alert.device.model.family
        - claroty_xdome.alert.device.model.name
        - claroty_xdome.alert.device.os.category
        - claroty_xdome.alert.device.os.name
        - claroty_xdome.alert.device.os.version
        - claroty_xdome.alert.device.risk_score.points
        - claroty_xdome.alert.device.serial_number
        - claroty_xdome.alert.device.type.value
        - claroty_xdome.alert.device.uid
        - claroty_xdome.alert.updated_time
        - claroty_xdome.alert.device.vlan.list
        - claroty_xdome.alert.device.vlan.name_list
        - claroty_xdome.alert.device.http.last_seen_hostname
      tag: remove_custom_duplicate_fields
      ignore_missing: true
      if: ctx.tags == null || !ctx.tags.contains('preserve_duplicate_custom_fields')
  - remove:
      field:
        - json
        - claroty_xdome.alert.device.slot_cards.cards_count
      tag: remove_json
      ignore_missing: true
  - script:
      tag: script_to_drop_null_values
      lang: painless
      description: Drops null/empty values recursively.
      source: |-
        boolean drop(Object object) {
          if (object == null || object == '') {
            return true;
          } else if (object instanceof Map) {
            ((Map) object).values().removeIf(v -> drop(v));
            return (((Map) object).size() == 0);
          } else if (object instanceof List) {
            ((List) object).removeIf(v -> drop(v));
            return (((List) object).length == 0);
          }
          return false;
        }
        drop(ctx);
  - set:
      field: event.kind
      tag: set_pipeline_error_into_event_kind
      value: pipeline_error
      if: ctx.error?.message != null
  - append:
      field: tags
      value: preserve_original_event
      allow_duplicates: false
      if: ctx.error?.message != null
on_failure:
  - append:
      field: error.message
      value: >-
        Processor '{{{ _ingest.on_failure_processor_type }}}'
        {{{#_ingest.on_failure_processor_tag}}}with tag '{{{ _ingest.on_failure_processor_tag }}}'
        {{{/_ingest.on_failure_processor_tag}}}failed with message '{{{ _ingest.on_failure_message }}}'
  - set:
      field: event.kind
      tag: set_pipeline_error_to_event_kind
      value: pipeline_error
  - append:
      field: tags
      value: preserve_original_event
      allow_duplicates: false
