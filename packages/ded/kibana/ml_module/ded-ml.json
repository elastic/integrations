{
  "attributes": {
    "id": "ded-ml",
    "title": "Data Exfiltration Detection",
    "description": "Detects data exfiltration activity in your network and file data.",
    "type": "ded",
    "logo": {
      "icon": "machineLearningApp"
    },
    "query": {
      "bool": {
        "should": [
          {
            "term": {
              "event.category": "file"
            }
          },
          {
            "bool": {
              "filter": [
                {
                  "term": {
                    "event.category": "network"
                  }
                },
                {
                  "exists": {
                    "field": "source.bytes"
                  }
                },
                {
                  "exists": {
                    "field": "destination"
                  }
                }
              ]
            }
          }
        ],
        "must_not": {
          "terms": {
            "_tier": [
              "data_frozen",
              "data_cold"
            ]
          }
        }
      }
    },
    "jobs": [
      {
        "id": "ded_high_sent_bytes_destination_geo_country_iso_code_euid",
        "config": {
          "groups": [
            "security",
            "data_exfiltration"
          ],
          "description": "Detects data exfiltration to an unusual geo-location (by country iso code).",
          "analysis_config": {
            "bucket_span": "3h",
            "detectors": [
              {
                "detector_description": "High bytes sent to an unusual country iso code",
                "function": "high_sum",
                "field_name": "source.bytes",
                "over_field_name": "destination.geo.country_iso_code",
                "detector_index": 0
              }
            ],
            "influencers": [
              "host.entity.id_computed",
              "user.entity.id_computed",
              "process.name",
              "source.ip",
              "destination.ip",
              "destination.geo.continent_name",
              "destination.geo.country_name",
              "destination.geo.country_iso_code",
              "user.name",
              "host.name"
            ]
          },
          "data_description": {
            "time_field": "@timestamp",
            "time_format": "epoch_ms"
          },
          "custom_settings": {
            "created_by": "ml-module-ded"
          }
        }
      },
      {
        "id": "ded_high_sent_bytes_destination_ip_euid",
        "config": {
          "groups": [
            "security",
            "data_exfiltration"
          ],
          "description": "Detects data exfiltration to an unusual geo-location (by IP address).",
          "analysis_config": {
            "bucket_span": "3h",
            "detectors": [
              {
                "detector_description": "High bytes sent to an unusual IP address",
                "function": "high_sum",
                "field_name": "source.bytes",
                "over_field_name": "destination.ip",
                "detector_index": 0
              }
            ],
            "influencers": [
              "host.entity.id_computed",
              "user.entity.id_computed",
              "process.name",
              "source.ip",
              "destination.ip",
              "user.name",
              "host.name"
            ]
          },
          "data_description": {
            "time_field": "@timestamp",
            "time_format": "epoch_ms"
          },
          "custom_settings": {
            "created_by": "ml-module-ded"
          }
        }
      },
      {
        "id": "ded_high_sent_bytes_destination_port_euid",
        "config": {
          "groups": [
            "security",
            "data_exfiltration"
          ],
          "description": "Detects data exfiltration to an unusual destination port.",
          "analysis_config": {
            "bucket_span": "3h",
            "detectors": [
              {
                "detector_description": "High bytes sent to an unusual destination port",
                "function": "high_sum",
                "field_name": "source.bytes",
                "over_field_name": "destination.port",
                "detector_index": 0
              }
            ],
            "influencers": [
              "host.entity.id_computed",
              "user.entity.id_computed",
              "process.name",
              "source.ip",
              "destination.ip",
              "destination.port",
              "user.name",
              "host.name"
            ]
          },
          "data_description": {
            "time_field": "@timestamp",
            "time_format": "epoch_ms"
          },
          "custom_settings": {
            "created_by": "ml-module-ded"
          }
        }
      },
      {
        "id": "ded_high_sent_bytes_destination_region_name_euid",
        "config": {
          "groups": [
            "security",
            "data_exfiltration"
          ],
          "description": "Detects data exfiltration to an unusual geo-location (by region name).",
          "analysis_config": {
            "bucket_span": "3h",
            "detectors": [
              {
                "detector_description": "High bytes sent to an unusual region",
                "function": "high_sum",
                "field_name": "source.bytes",
                "over_field_name": "destination.geo.region_name",
                "detector_index": 0
              }
            ],
            "influencers": [
              "host.entity.id_computed",
              "user.entity.id_computed",
              "process.name",
              "source.ip",
              "destination.ip",
              "destination.geo.city_name",
              "destination.geo.region_name",
              "user.name",
              "host.name"
            ]
          },
          "data_description": {
            "time_field": "@timestamp",
            "time_format": "epoch_ms"
          },
          "custom_settings": {
            "created_by": "ml-module-ded"
          }
        }
      },
      {
        "id": "ded_high_bytes_written_to_external_device_euid",
        "config": {
          "groups": [
            "security",
            "data_exfiltration"
          ],
          "description": "Detects data exfiltration activity by identifying high bytes written to an external device.",
          "analysis_config": {
            "bucket_span": "1h",
            "detectors": [
              {
                "detector_description": "High bytes written to an external device",
                "function": "high_sum",
                "field_name": "file.size",
                "partition_field_name": "host.entity.id_computed",
                "detector_index": 0
              }
            ],
            "influencers": [
              "host.entity.id_computed",
              "user.entity.id_computed",
              "file.name",
              "file.path",
              "file.Ext.device.bus_type",
              "process.name",
              "user.name",
              "host.name"
            ]
          },
          "data_description": {
            "time_field": "@timestamp",
            "time_format": "epoch_ms"
          },
          "custom_settings": {
            "created_by": "ml-module-ded"
          }
        }
      },
      {
        "id": "ded_rare_process_writing_to_external_device_euid",
        "config": {
          "groups": [
            "security",
            "data_exfiltration"
          ],
          "description": "Detects data exfiltration activity by identifying a file write started by a rare process to an external device.",
          "analysis_config": {
            "bucket_span": "1h",
            "detectors": [
              {
                "detector_description": "Rare process writing to an external device",
                "function": "rare",
                "by_field_name": "process.name",
                "partition_field_name": "host.entity.id_computed",
                "detector_index": 0
              }
            ],
            "influencers": [
              "host.entity.id_computed",
              "user.entity.id_computed",
              "file.name",
              "file.path",
              "file.Ext.device.bus_type",
              "process.name",
              "user.name",
              "host.name"
            ]
          },
          "data_description": {
            "time_field": "@timestamp",
            "time_format": "epoch_ms"
          },
          "custom_settings": {
            "created_by": "ml-module-ded"
          }
        }
      },
      {
        "id": "ded_high_bytes_written_to_external_device_airdrop_euid",
        "config": {
          "groups": [
            "security",
            "data_exfiltration"
          ],
          "description": "Detects data exfiltration activity by identifying high bytes written to an external device via Airdrop.",
          "analysis_config": {
            "bucket_span": "1h",
            "detectors": [
              {
                "detector_description": "High bytes written to an external device using Airdrop",
                "function": "high_sum",
                "field_name": "file.size",
                "partition_field_name": "host.entity.id_computed",
                "detector_index": 0
              }
            ],
            "influencers": [
              "host.entity.id_computed",
              "user.entity.id_computed",
              "file.name",
              "file.path",
              "process.name",
              "user.name",
              "host.name"
            ]
          },
          "data_description": {
            "time_field": "@timestamp",
            "time_format": "epoch_ms"
          },
          "custom_settings": {
            "created_by": "ml-module-ded"
          }
        }
      }
    ],
    "datafeeds": [
      {
        "id": "datafeed-ded_high_sent_bytes_destination_geo_country_iso_code_euid",
        "job_id": "ded_high_sent_bytes_destination_geo_country_iso_code_euid",
        "config": {
          "indices": [
            "INDEX_PATTERN_NAME"
          ],
          "job_id": "ded_high_sent_bytes_destination_geo_country_iso_code_euid",
          "query": {
            "bool": {
              "filter": [
                {
                  "term": {
                    "event.category": "network"
                  }
                },
                {
                  "exists": {
                    "field": "source.bytes"
                  }
                },
                {
                  "exists": {
                    "field": "destination.port"
                  }
                }
              ]
            }
          }
        }
      },
      {
        "id": "datafeed-ded_high_sent_bytes_destination_ip_euid",
        "job_id": "ded_high_sent_bytes_destination_ip_euid",
        "config": {
          "indices": [
            "INDEX_PATTERN_NAME"
          ],
          "job_id": "ded_high_sent_bytes_destination_ip_euid",
          "query": {
            "bool": {
              "filter": [
                {
                  "term": {
                    "event.category": "network"
                  }
                },
                {
                  "exists": {
                    "field": "source.bytes"
                  }
                },
                {
                  "exists": {
                    "field": "destination.port"
                  }
                }
              ]
            }
          }
        }
      },
      {
        "id": "datafeed-ded_high_sent_bytes_destination_port_euid",
        "job_id": "ded_high_sent_bytes_destination_port_euid",
        "config": {
          "indices": [
            "INDEX_PATTERN_NAME"
          ],
          "job_id": "ded_high_sent_bytes_destination_port_euid",
          "query": {
            "bool": {
              "filter": [
                {
                  "term": {
                    "event.category": "network"
                  }
                },
                {
                  "exists": {
                    "field": "source.bytes"
                  }
                },
                {
                  "exists": {
                    "field": "destination.port"
                  }
                }
              ]
            }
          }
        }
      },
      {
        "id": "datafeed-ded_high_sent_bytes_destination_region_name_euid",
        "job_id": "ded_high_sent_bytes_destination_region_name_euid",
        "config": {
          "indices": [
            "INDEX_PATTERN_NAME"
          ],
          "job_id": "ded_high_sent_bytes_destination_region_name_euid",
          "query": {
            "bool": {
              "filter": [
                {
                  "term": {
                    "event.category": "network"
                  }
                },
                {
                  "exists": {
                    "field": "source.bytes"
                  }
                },
                {
                  "exists": {
                    "field": "destination.port"
                  }
                }
              ]
            }
          }
        }
      },
      {
        "id": "datafeed-ded_high_bytes_written_to_external_device_euid",
        "job_id": "ded_high_bytes_written_to_external_device_euid",
        "config": {
          "indices": [
            "INDEX_PATTERN_NAME"
          ],
          "job_id": "ded_high_bytes_written_to_external_device_euid",
          "query": {
            "bool": {
              "filter": [
                {
                  "term": {
                    "event.category": "file"
                  }
                },
                {
                  "term": {
                    "host.os.type": "windows"
                  }
                },
                {
                  "exists": {
                    "field": "file.Ext.device.bus_type"
                  }
                },
                {
                  "terms": {
                    "event.action": [
                      "creation",
                      "overwrite",
                      "modification"
                    ]
                  }
                }
              ]
            }
          },
          "script_fields": {
            "user.entity.id_computed": {
              "script": {
                "id": "euid_user_entity"
              }
            },
            "host.entity.id_computed": {
              "script": {
                "id": "euid_host_entity"
              }
            }
          }
        }
      },
      {
        "id": "datafeed-ded_rare_process_writing_to_external_device_euid",
        "job_id": "ded_rare_process_writing_to_external_device_euid",
        "config": {
          "indices": [
            "INDEX_PATTERN_NAME"
          ],
          "job_id": "ded_rare_process_writing_to_external_device_euid",
          "query": {
            "bool": {
              "filter": [
                {
                  "term": {
                    "event.category": "file"
                  }
                },
                {
                  "term": {
                    "host.os.type": "windows"
                  }
                },
                {
                  "exists": {
                    "field": "file.Ext.device.bus_type"
                  }
                },
                {
                  "terms": {
                    "event.action": [
                      "creation",
                      "overwrite",
                      "modification"
                    ]
                  }
                }
              ]
            }
          },
          "script_fields": {
            "user.entity.id_computed": {
              "script": {
                "id": "euid_user_entity"
              }
            },
            "host.entity.id_computed": {
              "script": {
                "id": "euid_host_entity"
              }
            }
          }
        }
      },
      {
        "id": "datafeed-ded_high_bytes_written_to_external_device_airdrop_euid",
        "job_id": "ded_high_bytes_written_to_external_device_airdrop_euid",
        "config": {
          "indices": [
            "INDEX_PATTERN_NAME"
          ],
          "job_id": "ded_high_bytes_written_to_external_device_airdrop_euid",
          "query": {
            "bool": {
              "filter": [
                {
                  "term": {
                    "event.category": "file"
                  }
                },
                {
                  "term": {
                    "process.name": "sharingd"
                  }
                },
                {
                  "term": {
                    "host.os.type": "macos"
                  }
                },
                {
                  "terms": {
                    "event.action": [
                      "creation",
                      "overwrite",
                      "modification"
                    ]
                  }
                }
              ]
            }
          },
          "script_fields": {
            "user.entity.id_computed": {
              "script": {
                "id": "euid_user_entity"
              }
            },
            "host.entity.id_computed": {
              "script": {
                "id": "euid_host_entity"
              }
            }
          }
        }
      }
    ]
  },
  "id": "ded-ml",
  "migrationVersion": {
    "search": "7.16.0"
  },
  "references": [],
  "type": "ml-module"
}
