---
description: Pipeline for Elastic Agent status change logs.
processors:
  - script:
      description: Derive health_status from status field
      if: ctx.status != null
      lang: painless
      source: |
        String status = ctx.status;
        String healthStatus;

        switch (status) {
          case 'online':
            healthStatus = 'healthy';
            break;
          case 'error':
          case 'degraded':
            healthStatus = 'unhealthy';
            break;
          case 'updating':
          case 'enrolling':
          case 'unenrolling':
            healthStatus = 'updating';
            break;
          default:
            healthStatus = status;
        }

        ctx.health_status = healthStatus;
      ignore_failure: true
