{
    "attributes": {
      "id": "privileged_access-ml",
      "title": "Privilege Access Detection",
      "description": "",
      "type": "privileged_access",
      "logo": {
        "icon": "machineLearningApp"
      },
      "query": {
        "bool": {
          "should": [
            {
              "bool": {
                "must": [
                  {
                    "terms": {
                      "host.os.type": [
                        "windows",
                        "Windows"
                      ]
                    }
                  },
                  {
                    "exists": {
                      "field": "winlog.event_id"
                    }
                  }
                ]
              }
            },
            {
              "bool": {
                "must": [
                  {
                    "terms": {
                      "host.os.type": [
                        "linux",
                        "Linux"
                      ]
                    }
                  },
                  {
                    "term": {
                      "event.category": "process"
                    }
                  }
                ]
              }
            },
            {
              "exists": {
                "field": "privilege_type"
              }
            },
            {
              "term": {
                "data_stream.dataset": "okta.system"
              }
            },
            {
              "exists": {
                "field": "okta.user.name"
              }
            }
          ],
          "must_not": {
            "terms": {
              "_tier": [
                "data_frozen",
                "data_cold"
              ]
            }
          }
        }
      },
      "jobs": [
        {
          "id": "privileged_access_windows_high_count_special_logon_events",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects unusually high special logon events initiated by an user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "High count of special logon events",
                  "function": "high_count",
                  "by_field_name": "event.action",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "host.name",
                "user.name",
                "winlog.event_data.SubjectUserName",
                "winlog.event_data.PrivilegeList",
                "winlog.event_data.TargetUserName",
                "process.name"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_windows_high_count_special_privilege_use_events",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects unusually high special privilege use events initiated by an user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "High count of special privilege use events",
                  "function": "high_count",
                  "by_field_name": "event.action",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "host.name",
                "user.name",
                "winlog.event_data.SubjectUserName",
                "winlog.event_data.PrivilegeList",
                "process.name"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_windows_high_count_group_management_events",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects unusually high security group management events initiated by an user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "High count of security group management events",
                  "function": "high_count",
                  "by_field_name": "event.action",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "host.name",
                "user.name",
                "winlog.event_data.SubjectUserName",
                "group.name",
                "winlog.event_data.TargetUserName",
                "winlog.event_data.MemberSid"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_windows_high_count_user_account_management_events",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects unusually high security user account management events initiated by an user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "High count of security user account management events",
                  "function": "high_count",
                  "by_field_name": "event.action",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "host.name",
                "user.name",
                "winlog.event_data.SubjectUserName",
                "winlog.event_data.TargetUserName"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_windows_rare_privilege_assigned_to_user",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects an unusual privilege type assigned to an user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "Rare privilege type by user name",
                  "function": "rare",
                  "by_field_name": "privilege_type",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "host.name",
                "user.name",
                "privilege_type",
                "event.action"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_windows_rare_group_name_by_user",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects an unusual group name accessed by an user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "Rare group name by user name",
                  "function": "rare",
                  "by_field_name": "group.name",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "host.name",
                "user.name",
                "group.name",
                "winlog.event_data.TargetUserName",
                "event.action"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_windows_rare_device_by_user",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects an unusual device accessed by an user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "Rare device name by user name",
                  "function": "rare",
                  "by_field_name": "host.name",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "host.name",
                "user.name",
                "group.name",
                "winlog.event_data.PrivilegeList",
                "event.action"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_windows_rare_source_ip_by_user",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects an unusual source IP address accessed by the user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "Rare source IP by user name",
                  "function": "rare",
                  "by_field_name": "source.ip",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "host.name",
                "user.name",
                "source.ip",
                "winlog.event_data.PrivilegeList",
                "event.action"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_windows_rare_region_name_by_user",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects an unusual region name for the user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "Rare region name by user",
                  "function": "rare",
                  "by_field_name": "source.geo.region_name",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "host.name",
                "user.name",
                "source.geo.city_name",
                "source.geo.country_name",
                "winlog.event_data.PrivilegeList",
                "event.action"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_linux_high_count_privileged_process_events_by_user",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects a spike in privileged commands executed by an user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "High count of privileged processes by user name",
                  "function": "high_count",
                  "by_field_name": "process.name",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "host.name",
                "user.name",
                "process.name",
                "process.command_line",
                "process.working_directory"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_linux_rare_process_executed_by_user",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects a rare process executed by an user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "Rare process by user name",
                  "function": "rare",
                  "by_field_name": "process.name",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "host.name",
                "user.name",
                "process.name",
                "process.command_line",
                "process.working_directory"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_linux_high_info_content_command_line_by_user",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects high information content in command lines that are executed by an user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "High info content in command line by user name",
                  "function": "high_info_content",
                  "field_name": "process.command_line",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "host.name",
                "user.name",
                "process.name",
                "process.command_line",
                "process.working_directory"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_okta_spike_in_group_membership_changes",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects spike in group membership change events by an user",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "High count of group membership okta events by user name",
                  "function": "high_count",
                  "by_field_name": "okta.event_type",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                  "agent.name",
                  "user.name",
                  "source.user.full_name",
                  "user.target.full_name",
                  "user.target.group.name"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_okta_spike_in_user_account_management_changes",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects spike in user account management change events by an user",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "High count of user management okta events by user name",
                  "function": "high_count",
                  "by_field_name": "okta.event_type",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                  "agent.name",
                  "user.name",
                  "source.user.full_name",
                  "user.target.full_name",
                  "user.target.group.name"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_okta_spike_in_group_privilege_changes",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects spike in group privilege change events by an user",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "High count of group privilege okta events by user name",
                  "function": "high_count",
                  "by_field_name": "okta.event_type",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                  "agent.name",
                  "user.name",
                  "source.user.full_name",
                  "user.target.full_name",
                  "user.target.group.name",
                  "okta.debug_context.debug_data.privilegeGranted"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_okta_spike_in_group_application_assignment_changes",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects spike in group application assignment change events by an user",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "High count of group application assignment okta events by user name",
                  "function": "high_count",
                  "by_field_name": "okta.event_type",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                  "agent.name",
                  "user.name",
                  "source.user.full_name",
                  "user.target.group.name"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_okta_spike_in_group_lifecycle_changes",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects spike in group lifecycle change events by an user",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "High count of group lifecycle okta events by user name",
                  "function": "high_count",
                  "by_field_name": "okta.event_type",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                  "agent.name",
                  "user.name",
                  "source.user.full_name",
                  "user.target.group.name"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_okta_high_sum_distinct_active_sessions_by_user",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects an unusual sum of active sessions started by a user",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "High sum of distinct source ips by user name",
                  "function": "high_sum",
                  "by_field_name": "okta_distinct_ips",
                  "partition_field_name": "okta.user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                  "okta.user.name",
                  "okta_session_info.ips",
                  "okta.user.full_name",
                  "okta_session_info.locations"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_okta_rare_ip_by_user",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects an unusual source IP address accessed by the user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "Rare source ip by user name",
                  "function": "rare",
                  "by_field_name": "source.ip",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "agent.name",
                "source.user.full_name",
                "user.target.group.name",
                "okta.event_type",
                "okta.debug_context.debug_data.privilegeGranted"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_okta_region_name_by_user",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects an unusual region name  for the user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "Rare region name by user name",
                  "function": "rare",
                  "by_field_name": "source.geo.region_name",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "agent.name",
                "source.user.full_name",
                "user.target.group.name",
                "okta.event_type",
                "okta.debug_context.debug_data.privilegeGranted",
                "source.geo.country_name"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        },
        {
          "id": "privileged_access_okta_host_name_by_user",
          "config": {
            "groups": [
              "security",
              "privileged_access"
            ],
            "description": "Detects an unusual host name  for the user.",
            "analysis_config": {
              "bucket_span": "3h",
              "detectors": [
                {
                  "detector_description": "Rare host name by user name",
                  "function": "rare",
                  "by_field_name": "agent.name",
                  "partition_field_name": "user.name",
                  "detector_index": 0
                }
              ],
              "influencers": [
                "agent.name",
                "source.user.full_name",
                "user.target.group.name",
                "okta.event_type",
                "okta.debug_context.debug_data.privilegeGranted"
              ]
            },
            "data_description": {
              "time_field": "@timestamp",
              "time_format": "epoch_ms"
            },
            "custom_settings": {
              "created_by": "ml-module-lmd"
            }
          }
        }
      ],
      "datafeeds": [
        {
          "id": "datafeed-privileged_access_windows_high_count_special_logon_events",
          "job_id": "privileged_access_windows_high_count_special_logon_events",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_windows_high_count_special_logon_events",
            "query": {
              "bool": {
                "filter": [
                  {
                    "terms": {
                      "host.os.type": [
                        "windows",
                        "Windows"
                      ]
                    }
                  },
                  {
                    "terms": {
                      "event.action": [
                        "logged-in-special",
                        "logged-in-explicit"
                      ]
                    }
                  },
                  {
                    "terms": {
                      "event.code": [
                        "4672",
                        "4648"
                      ]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_windows_high_count_special_privilege_use_events",
          "job_id": "privileged_access_windows_high_count_special_privilege_use_events",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_windows_high_count_special_privilege_use_events",
            "query": {
              "bool": {
                "filter": [
                  {
                    "terms": {
                      "host.os.type": [
                        "windows",
                        "Windows"
                      ]
                    }
                  },
                  {
                    "terms": {
                      "event.action": [
                        "privileged-operation",
                        "privileged-service-called"
                      ]
                    }
                  },
                  {
                    "terms": {
                      "event.code": [
                        "4673",
                        "4674"
                      ]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_windows_high_count_group_management_events",
          "job_id": "privileged_access_windows_high_count_group_management_events",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_windows_high_count_group_management_events",
            "query": {
              "bool": {
                "filter": [
                  {
                    "terms": {
                      "host.os.type": [
                        "windows",
                        "Windows"
                      ]
                    }
                  },
                  {
                    "terms": {
                      "event.action": [
                        "added-member-to-group",
                        "removed-member-from-group"
                      ]
                    }
                  },
                  {
                    "terms": {
                      "event.code": [
                        "4732",
                        "4728",
                        "4756",
                        "4733",
                        "4729"
                      ]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_windows_high_count_user_account_management_events",
          "job_id": "privileged_access_windows_high_count_user_account_management_events",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_windows_high_count_user_account_management_events",
            "query": {
              "bool": {
                "filter": [
                  {
                    "terms": {
                      "host.os.type": [
                        "windows",
                        "Windows"
                      ]
                    }
                  },
                  {
                    "terms": {
                      "event.action": [
                        "enabled-user-account",
                        "added-user-account",
                        "deleted-user-account",
                        "disabled-user-account"
                      ]
                    }
                  },
                  {
                    "terms": {
                      "event.code": [
                        "4722",
                        "4720",
                        "4726",
                        "4725"
                      ]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_windows_rare_privilege_assigned_to_user",
          "job_id": "privileged_access_windows_rare_privilege_assigned_to_user",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_windows_rare_privilege_assigned_to_user",
            "query": {
              "bool": {
                "filter": [
                  {
                    "exists": {
                      "field": "privilege_type"
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_windows_rare_group_name_by_user",
          "job_id": "privileged_access_windows_rare_group_name_by_user",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_windows_rare_group_name_by_user",
            "query": {
              "bool": {
                "filter": [
                  {
                    "terms": {
                      "host.os.type": [
                        "windows",
                        "Windows"
                      ]
                    }
                  },
                  {
                    "terms": {
                      "event.action": [
                        "added-member-to-group",
                        "removed-member-from-group"
                      ]
                    }
                  },
                  {
                    "terms": {
                      "event.code": [
                        "4732",
                        "4728",
                        "4756",
                        "4733",
                        "4729"
                      ]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_windows_rare_device_by_user",
          "job_id": "privileged_access_windows_rare_device_by_user",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_windows_rare_device_by_user",
            "query": {
              "bool": {
                "filter": [
                  {
                    "terms": {
                      "host.os.type": [
                        "windows",
                        "Windows"
                      ]
                    }
                  },
                  {
                    "exists": {
                      "field": "host.name"
                    }
                  },
                  {
                    "exists": {
                      "field": "user.name"
                    }
                  },
                  {
                    "terms": {
                      "event.code": [
                        "4720",
                        "4726",
                        "4722",
                        "4756",
                        "4672",
                        "4673",
                        "4674",
                        "4720",
                        "4728",
                        "4732",
                        "4756",
                        "624",
                        "632",
                        "636",
                        "660",
                        "4725",
                        "4723",
                        "4648",
                        "4688",
                        "4729",
                        "4733",
                        "4757",
                        "637",
                        "661"
                      ]
                    }
                  }
                ],
              "must_not": [
                {
                  "terms": {
                    "event.action": [
                      "log_on",
                      "created_process"
                    ]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_windows_rare_source_ip_by_user",
          "job_id": "privileged_access_windows_rare_source_ip_by_user",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_windows_rare_source_ip_by_user",
            "query": {
              "bool": {
                "filter": [
                  {
                    "terms": {
                      "host.os.type": [
                        "windows",
                        "Windows"
                      ]
                    }
                  },
                  {
                    "exists": {
                      "field": "source.ip"
                    }
                  },
                  {
                    "exists": {
                      "field": "user.name"
                    }
                  },
                  {
                    "terms": {
                      "event.code": [
                        "4720",
                        "4726",
                        "4722",
                        "4756",
                        "4672",
                        "4673",
                        "4674",
                        "4720",
                        "4728",
                        "4732",
                        "4756",
                        "624",
                        "632",
                        "636",
                        "660",
                        "4725",
                        "4723",
                        "4648",
                        "4688",
                        "4729",
                        "4733",
                        "4757",
                        "637",
                        "661"
                      ]
                    }
                  }
                ],
                "must_not": [
                {
                  "terms": {
                    "event.action": [
                      "log_on",
                      "created_process"
                    ]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_windows_rare_region_name_by_user",
          "job_id": "privileged_access_windows_rare_region_name_by_user",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_windows_rare_region_name_by_user",
            "query": {
              "bool": {
                "filter": [
                  {
                    "terms": {
                      "host.os.type": [
                        "windows",
                        "Windows"
                      ]
                    }
                  },
                  {
                    "exists": {
                      "field": "source.geo.region_name"
                    }
                  },
                  {
                    "exists": {
                      "field": "user.name"
                    }
                  },
                  {
                    "terms": {
                      "event.code": [
                        "4720",
                        "4726",
                        "4722",
                        "4756",
                        "4672",
                        "4673",
                        "4674",
                        "4720",
                        "4728",
                        "4732",
                        "4756",
                        "624",
                        "632",
                        "636",
                        "660",
                        "4725",
                        "4723",
                        "4648",
                        "4688",
                        "4729",
                        "4733",
                        "4757",
                        "637",
                        "661"
                      ]
                    }
                  }
                ],
                "must_not": [
                {
                  "terms": {
                    "event.action": [
                      "log_on",
                      "created_process"
                    ]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_linux_high_count_privileged_process_events_by_user",
          "job_id": "privileged_access_linux_high_count_privileged_process_events_by_user",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_linux_high_count_privileged_process_events_by_user",
            "query": {
              "bool": {
                "must_not": [
                  {
                    "terms": {
                      "process.name": [
                        "elastic-agent",
                        "elasticsearch-users"
                      ]
                    }
                  }
                ],
                "must": [
                  {
                    "terms": {
                      "host.os.name": [
                        "linux",
                        "Linux"
                      ]
                    }
                  },
                  {
                    "term": {
                      "event.category": "process"
                    }
                  },
                  {
                    "terms": {
                      "event.type": [
                        "start",
                        "change"
                      ]
                    }
                  },
                  {
                    "bool": {
                      "should": [
                        {
                          "wildcard": {
                            "process.command_line": "* sudo */root/*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* sudo *etc/sudoers*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* sudo * visudo *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* timestamp_timeout=-1 *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* tty_tickets *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*etc/cron.*/"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*var/spool/cron*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* trap * SIGINT *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* trap * EXIT *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* LD_PRELOAD *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*/etc/ld.so.preload*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*chmod*u+s*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*chmod*g+s*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*setcap*setuid*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*setcap*setgid*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*find*perm*4000*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*find*perm*2000*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*/root/.ssh/authorized_keys*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*insmod*.*.ko"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*systemctl* start *timer*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*systemctl* enable *timer"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/.bash_profile*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/.bashrc*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/.shrc*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/etc/profile*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/.bash_logout*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/etc/rc.*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*systemctl* daemon-reload *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* echo * at *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* useradd *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* pw mod user *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* pw unlock *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* usermod *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* sudo * nobody *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* su * nobody *"
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_linux_rare_process_executed_by_user",
          "job_id": "privileged_access_linux_rare_process_executed_by_user",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_linux_rare_process_executed_by_user",
            "query": {
              "bool": {
                "must_not": [
                  {
                    "terms": {
                      "process.name": [
                        "elastic-agent",
                        "elasticsearch-users"
                      ]
                    }
                  }
                ],
                "must": [
                  {
                    "terms": {
                      "host.os.name": [
                        "linux",
                        "Linux"
                      ]
                    }
                  },
                  {
                    "term": {
                      "event.category": "process"
                    }
                  },
                  {
                    "terms": {
                      "event.type": [
                        "start",
                        "change"
                      ]
                    }
                  },
                  {
                    "bool": {
                      "should": [
                        {
                          "wildcard": {
                            "process.command_line": "* sudo */root/*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* sudo *etc/sudoers*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* sudo * visudo *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* timestamp_timeout=-1 *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* tty_tickets *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*etc/cron.*/"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*var/spool/cron*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* trap * SIGINT *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* trap * EXIT *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* LD_PRELOAD *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*/etc/ld.so.preload*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*chmod*u+s*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*chmod*g+s*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*setcap*setuid*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*setcap*setgid*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*find*perm*4000*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*find*perm*2000*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*/root/.ssh/authorized_keys*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*insmod*.*.ko"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*systemctl* start *timer*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*systemctl* enable *timer"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/.bash_profile*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/.bashrc*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/.shrc*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/etc/profile*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/.bash_logout*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/etc/rc.*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*systemctl* daemon-reload *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* echo * at *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* useradd *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* pw mod user *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* pw unlock *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* usermod *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* sudo * nobody *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* su * nobody *"
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_linux_high_info_content_in_command_line_by_user",
          "job_id": "privileged_access_linux_high_info_content_in_command_line_by_user",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_linux_high_info_content_in_command_line_by_user",
            "query": {
              "bool": {
                "must_not": [
                  {
                    "terms": {
                      "process.name": [
                        "elastic-agent",
                        "elasticsearch-users"
                      ]
                    }
                  }
                ],
                "must": [
                  {
                    "terms": {
                      "host.os.name": [
                        "linux",
                        "Linux"
                      ]
                    }
                  },
                  {
                    "term": {
                      "event.category": "process"
                    }
                  },
                  {
                    "terms": {
                      "event.type": [
                        "start",
                        "change"
                      ]
                    }
                  },
                  {
                    "bool": {
                      "should": [
                        {
                          "wildcard": {
                            "process.command_line": "* sudo */root/*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* sudo *etc/sudoers*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* sudo * visudo *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* timestamp_timeout=-1 *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* tty_tickets *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*etc/cron.*/"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*var/spool/cron*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* trap * SIGINT *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* trap * EXIT *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* LD_PRELOAD *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*/etc/ld.so.preload*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*chmod*u+s*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*chmod*g+s*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*setcap*setuid*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*setcap*setgid*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*find*perm*4000*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*find*perm*2000*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*/root/.ssh/authorized_keys*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*insmod*.*.ko"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*systemctl* start *timer*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*systemctl* enable *timer"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/.bash_profile*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/.bashrc*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/.shrc*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/etc/profile*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/.bash_logout*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*echo*/etc/rc.*"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "*systemctl* daemon-reload *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* echo * at *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* useradd *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* pw mod user *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* pw unlock *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* usermod *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* sudo * nobody *"
                          }
                        },
                        {
                          "wildcard": {
                            "process.command_line": "* su * nobody *"
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_okta_spike_in_group_membership_changes",
          "job_id": "privileged_access_okta_spike_in_group_membership_changes",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_okta_spike_in_group_membership_changes",
            "query": {
              "bool": {
                "filter": [
                  {
                    "term": {
                      "data_stream.dataset": "okta.system"
                    }
                  },
                  {
                    "terms": {
                      "okta.event_type": ["group.user_membership.add", "group.user_membership.remove"]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_okta_spike_in_user_account_management_changes",
          "job_id": "privileged_access_okta_spike_in_user_account_management_changes",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_okta_spike_in_user_account_management_changes",
            "query": {
              "bool": {
                "filter": [
                  {
                    "term": {
                      "data_stream.dataset": "okta.system"
                    }
                  },
                  {
                    "terms": {
                      "okta.event_type": [
                        "user.lifecycle.activate",
                        "user.lifecycle.deactivate",
                        "user.lifecycle.suspend",
                        "user.lifecycle.unsuspend",
                        "user.lifecycle.create",
                        "user.lifecycle.update"
                      ]
                    }
                  }
                ]
              }
            }
          }
        },
                {
          "id": "datafeed-privileged_access_okta_spike_in_group_privilege_changes",
          "job_id": "privileged_access_okta_spike_in_group_privilege_changes",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_okta_spike_in_group_privilege_changes",
            "query": {
              "bool": {
                "filter": [
                  {
                    "term": {
                      "data_stream.dataset": "okta.system"
                    }
                  },
                  {
                    "terms": {
                      "okta.event_type": ["group.privilege.grant", "group.privilege.revoke"]
                    }
                  }
                ]
              }
            }
          }
        },
                {
          "id": "datafeed-privileged_access_okta_spike_in_group_application_assignment_changes",
          "job_id": "privileged_access_okta_spike_in_group_application_assignment_changes",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_okta_spike_in_group_application_assignment_changes",
            "query": {
              "bool": {
                "filter": [
                  {
                    "term": {
                      "data_stream.dataset": "okta.system"
                    }
                  },
                  {
                    "terms": {
                      "okta.event_type": ["group.application_assignment.add", "group.application_assignment.remove"]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_okta_spike_in_group_lifecycle_changes",
          "job_id": "privileged_access_okta_spike_in_group_lifecycle_changes",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_okta_spike_in_group_lifecycle_changes",
            "query": {
              "bool": {
                "filter": [
                  {
                    "term": {
                      "data_stream.dataset": "okta.system"
                    }
                  },
                  {
                    "terms": {
                      "okta.event_type": ["group.lifecycle.create", "group.lifecycle.delete"]
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_okta_high_sum_distinct_active_sessions_by_user",
          "job_id": "privileged_access_okta_high_sum_distinct_active_sessions_by_user",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_okta_high_sum_distinct_active_sessions_by_user",
            "query": {
              "bool": {
                "filter": [
                  {
                    "exists": {
                      "field": "okta.user.name"
                    }
                  },
                  {
                    "exists": {
                      "field": "okta_session_info.*"
                    }
                  },
                  {
                  "range": {
                    "okta_distinct_ips": {
                      "gte": 2
                      }
                    }
                  },
                  {
                    "range": {
                      "okta_distinct_countries": {
                        "gte": 2
                      }
                    }
                  },
                  {
                    "term": {
                      "okta_session_info.has_end_event": 0
                    }
                  }
                ]
              }
            }
          }
        },
        {
          "id": "datafeed-privileged_access_okta_rare_ip_by_user",
          "job_id": "privileged_access_okta_rare_ip_by_user",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_okta_rare_ip_by_user",
            "query": {
              "bool": {
                "filter": [
                  {
                    "term": {
                      "data_stream.dataset": "okta.system"
                    }
                  },
                  {
                    "exists": {
                      "field": "source.ip"
                    }
                  },
                  {
                    "terms": {
                      "okta.event_type": [
                        "group.lifecycle.create",
                        "group.lifecycle.delete",
                        "group.user_membership.add",
                        "group.user_membership.remove",
                        "user.lifecycle.activate",
                        "user.lifecycle.deactivate",
                        "user.lifecycle.suspend",
                        "user.lifecycle.unsuspend",
                        "user.lifecycle.create",
                        "user.lifecycle.update",
                        "group.privilege.grant",
                        "group.privilege.revoke",
                        "group.application_assignment.add",
                        "group.application_assignment.remove"]
                    }
                  }
                ]
              }
            }
          }
        },
                {
          "id": "datafeed-privileged_access_okta_region_name_by_user",
          "job_id": "privileged_access_okta_region_name_by_user",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_okta_region_name_by_user",
            "query": {
              "bool": {
                "filter": [
                  {
                    "term": {
                      "data_stream.dataset": "okta.system"
                    }
                  },
                  {
                    "exists": {
                      "field": "source.geo.region_name"
                    }
                  },
                  {
                    "terms": {
                      "okta.event_type": [
                        "group.lifecycle.create",
                        "group.lifecycle.delete",
                        "group.user_membership.add",
                        "group.user_membership.remove",
                        "user.lifecycle.activate",
                        "user.lifecycle.deactivate",
                        "user.lifecycle.suspend",
                        "user.lifecycle.unsuspend",
                        "user.lifecycle.create",
                        "user.lifecycle.update",
                        "group.privilege.grant",
                        "group.privilege.revoke",
                        "group.application_assignment.add",
                        "group.application_assignment.remove"]
                    }
                  }
                ]
              }
            }
          }
        },
                {
          "id": "datafeed-privileged_access_okta_host_name_by_user",
          "job_id": "privileged_access_okta_host_name_by_user",
          "config": {
            "indices": [
              "INDEX_PATTERN_NAME"
            ],
            "job_id": "privileged_access_okta_host_name_by_user",
            "query": {
              "bool": {
                "filter": [
                  {
                    "term": {
                      "data_stream.dataset": "okta.system"
                    }
                  },
                  {
                    "exists": {
                      "field": "source.geo.region_name"
                    }
                  },
                  {
                    "terms": {
                      "okta.event_type": [
                        "group.lifecycle.create",
                        "group.lifecycle.delete",
                        "group.user_membership.add",
                        "group.user_membership.remove",
                        "user.lifecycle.activate",
                        "user.lifecycle.deactivate",
                        "user.lifecycle.suspend",
                        "user.lifecycle.unsuspend",
                        "user.lifecycle.create",
                        "user.lifecycle.update",
                        "group.privilege.grant",
                        "group.privilege.revoke",
                        "group.application_assignment.add",
                        "group.application_assignment.remove"]
                    }
                  }
                ]
              }
            }
          }
        }
      ]
    },
    "id": "privileged_access-ml",
    "migrationVersion": {
        "search": "7.16.0"
    },
    "references": [],
    "type": "ml-module"
}