{
    "attributes": {
        "author": [
            "Elastic"
        ],
        "description": "This rule detects the first observed successful login of a user with the Administrator role to the FortiGate management interface within the last 5 days. First-time administrator logins can indicate newly provisioned accounts, misconfigurations, or unauthorized access using valid credentials and should be reviewed promptly.",
        "from": "now-7205m",
        "interval": "5m",
        "language": "esql",
        "license": "Elastic License v2",
        "name": "First-Time FortiGate Administrator Login",
        "note": "## Triage and Analysis\n\n### Investigating First-Time FortiGate Administrator Login\n\nThis alert indicates that a user with the **Administrator** role has successfully logged in to the FortiGate management interface for the first time within the last 5 days of observed data.\n\nBecause administrator access provides full control over network security devices, any newly observed admin login should be validated to confirm it is expected and authorized.\n\n### Investigation Steps\n\n- **Identify the account**\n  - Review `source.user.name` and confirm whether the account is known and officially provisioned.\n  - Determine whether this is a newly created administrator or an existing account logging in for the first time.\n\n- **Validate the source**\n  - Review `source.ip` and confirm whether it originates from a trusted management network, VPN, or jump host.\n  - Investigate geolocation or ASN if the source IP is external or unusual.\n\n- **Review login context**\n  - Examine associated FortiGate log messages for details such as login method, interface, or authentication source.\n  - Check for additional administrative actions following the login (policy changes, user creation, configuration exports).\n\n- **Correlate with recent changes**\n  - Verify whether there were recent change requests, onboarding activities, or maintenance windows that explain the login.\n  - Look for other authentication attempts (failed or successful) from the same source or user.\n\n### False Positive Considerations\n\n- Newly onboarded administrators or service accounts.\n- First-time logins after log retention changes or data source onboarding.\n- Automation, backup, or monitoring tools introduced recently.\n- Lab, development, or test FortiGate devices.\n\n### Response and Remediation\n\n- **If authorized**\n  - Document the activity and consider adding an exception if the behavior is expected.\n  - Ensure the account follows least-privilege and MFA best practices.\n\n- **If suspicious or unauthorized**\n  - Disable or restrict the administrator account immediately.\n  - Rotate credentials and review authentication sources.\n  - Audit recent FortiGate configuration changes.\n  - Review surrounding network activity for lateral movement or persistence attempts.",
        "query": "FROM logs-fortinet_fortigate.*, filebeat-* metadata _id\n\n| WHERE event.dataset == \"fortinet_fortigate.log\" and\n        event.category == \"authentication\" and event.action == \"login\" and\n        event.outcome == \"success\" and source.user.roles == \"Administrator\" and source.user.name is not null\n| stats Esql.logon_count = count(*),\n        Esql.first_time_seen = MIN(@timestamp),\n        Esql.source_ip_values = VALUES(source.ip),\n        Esql.message_values = VALUES(message) by source.user.name\n\n// first time seen is within 6m of the rule execution time and for the last 5d of events history\n| eval Esql.recent = DATE_DIFF(\"minute\", Esql.first_time_seen, now())\n| where Esql.recent <= 6 and Esql.logon_count == 1\n\n// move dynamic fields to ECS equivalent for rule exceptions\n| eval source.ip = MV_FIRST(Esql.source_ip_values)\n\n| keep source.ip, source.user.name, Esql.*\n",
        "references": [
            "https://www.elastic.co/docs/reference/integrations/fortinet_fortigate",
            "https://www.cisa.gov/news-events/alerts/2026/01/28/fortinet-releases-guidance-address-ongoing-exploitation-authentication-bypass-vulnerability-cve-2026"
        ],
        "related_integrations": [
            {
                "package": "fortinet_fortigate",
                "version": "^1.31.0"
            }
        ],
        "required_fields": [
            {
                "ecs": false,
                "name": "Esql.first_time_seen",
                "type": "date"
            },
            {
                "ecs": false,
                "name": "Esql.logon_count",
                "type": "long"
            },
            {
                "ecs": false,
                "name": "Esql.message_values",
                "type": "keyword"
            },
            {
                "ecs": false,
                "name": "Esql.recent",
                "type": "integer"
            },
            {
                "ecs": false,
                "name": "Esql.source_ip_values",
                "type": "ip"
            },
            {
                "ecs": true,
                "name": "source.ip",
                "type": "ip"
            },
            {
                "ecs": true,
                "name": "source.user.name",
                "type": "keyword"
            }
        ],
        "risk_score": 73,
        "rule_id": "55a372b9-f5b6-4069-a089-8637c00609a2",
        "severity": "high",
        "tags": [
            "Use Case: Threat Detection",
            "Tactic: Initial Access",
            "Resources: Investigation Guide",
            "Domain: Network",
            "Domain: Identity",
            "Data Source: Fortinet",
            "Data Source: Fortinet FortiGate"
        ],
        "threat": [
            {
                "framework": "MITRE ATT&CK",
                "tactic": {
                    "id": "TA0001",
                    "name": "Initial Access",
                    "reference": "https://attack.mitre.org/tactics/TA0001/"
                },
                "technique": [
                    {
                        "id": "T1078",
                        "name": "Valid Accounts",
                        "reference": "https://attack.mitre.org/techniques/T1078/"
                    }
                ]
            }
        ],
        "timestamp_override": "event.ingested",
        "type": "esql",
        "version": 1
    },
    "id": "55a372b9-f5b6-4069-a089-8637c00609a2_1",
    "type": "security-rule"
}