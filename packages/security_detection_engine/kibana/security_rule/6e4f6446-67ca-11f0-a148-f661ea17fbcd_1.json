{
    "attributes": {
        "author": [
            "Elastic"
        ],
        "building_block_type": "default",
        "description": "Identifies potential exploitation of CVE-2025-53770 and CVE-2025-53771 in IIS web servers on SharePoint sites. Toolshell is an exploit chain that leverages vulnerabilities in SharePoint/IIS to gain unauthorized access and execute commands. This rule detects HTTP requests that match specific patterns indicative of the exploit attempt.",
        "from": "now-119m",
        "index": [
            "logs-network_traffic.http*"
        ],
        "interval": "60m",
        "language": "kuery",
        "license": "Elastic License v2",
        "max_signals": 100,
        "name": "Potential Toolshell Initial Exploit (CVE-2025-53770 & CVE-2025-53771)",
        "query": "data_stream.dataset : \"network_traffic.http\" and\n    url.path: (/_layouts*ToolPane.aspx* or /_layouts*toolpane.aspx*) and\n    http.request.referrer: *SignOut.aspx and\n    network.direction: \"ingress\" and\n    http.request.method: \"POST\" and\n    request: (*MSOTlPn_Uri* and *DisplayMode*) and\n    http.request.body.bytes >  2000\n",
        "references": [
            "https://research.eye.security/sharepoint-under-siege/",
            "https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-53771",
            "https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-53770",
            "https://msrc.microsoft.com/blog/2025/07/customer-guidance-for-sharepoint-vulnerability-cve-2025-53770/"
        ],
        "related_integrations": [
            {
                "package": "network_traffic",
                "version": "^1.33.0"
            }
        ],
        "required_fields": [
            {
                "ecs": true,
                "name": "data_stream.dataset",
                "type": "constant_keyword"
            },
            {
                "ecs": true,
                "name": "http.request.body.bytes",
                "type": "long"
            },
            {
                "ecs": true,
                "name": "http.request.method",
                "type": "keyword"
            },
            {
                "ecs": true,
                "name": "http.request.referrer",
                "type": "keyword"
            },
            {
                "ecs": true,
                "name": "network.direction",
                "type": "keyword"
            },
            {
                "ecs": false,
                "name": "request",
                "type": "text"
            },
            {
                "ecs": true,
                "name": "url.path",
                "type": "wildcard"
            }
        ],
        "risk_score": 21,
        "rule_id": "6e4f6446-67ca-11f0-a148-f661ea17fbcd",
        "setup": "### Network Traffic Setup\n\nThis rule requires network traffic logs to be collected from HTTP endpoints, specifically focusing on IIS web servers. Ensure that your network traffic logging is configured to capture HTTP request and response details, including request and response headers. Additionally, request bodies are necessary for content-type `application/x-www-form-urlencoded` to detect potential exploit attempts.\n",
        "severity": "low",
        "tags": [
            "Domain: Network",
            "Tactic: Initial Access",
            "Use Case: Exploit Detection",
            "Data Source: Network Traffic",
            "Data Source: Network Traffic HTTP Logs",
            "Rule Type: BBR"
        ],
        "threat": [
            {
                "framework": "MITRE ATT&CK",
                "tactic": {
                    "id": "TA0001",
                    "name": "Initial Access",
                    "reference": "https://attack.mitre.org/tactics/TA0001/"
                },
                "technique": [
                    {
                        "id": "T1190",
                        "name": "Exploit Public-Facing Application",
                        "reference": "https://attack.mitre.org/techniques/T1190/"
                    }
                ]
            }
        ],
        "timestamp_override": "event.ingested",
        "type": "query",
        "version": 1
    },
    "id": "6e4f6446-67ca-11f0-a148-f661ea17fbcd_1",
    "type": "security-rule"
}