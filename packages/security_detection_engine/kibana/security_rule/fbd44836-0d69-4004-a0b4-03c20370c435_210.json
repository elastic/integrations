{
    "attributes": {
        "author": [
            "Elastic"
        ],
        "description": "Identifies when an AWS Config configuration recorder is stopped. AWS Config recorders continuously track and record configuration changes across supported AWS resources. Stopping the recorder immediately reduces visibility into infrastructure changes and can be abused by adversaries to evade detection, obscure follow-on activity, or weaken compliance and security monitoring controls.",
        "false_positives": [
            "Authorized administrators may temporarily stop the AWS Config recorder during planned maintenance, account restructuring, or controlled configuration changes. Automated infrastructure or compliance tooling may also stop and restart the recorder as part of setup or teardown workflows. Activity outside of documented change windows or from unexpected identities should be investigated."
        ],
        "from": "now-6m",
        "index": [
            "filebeat-*",
            "logs-aws.cloudtrail-*"
        ],
        "investigation_fields": {
            "field_names": [
                "@timestamp",
                "user.name",
                "user_agent.original",
                "source.ip",
                "aws.cloudtrail.user_identity.arn",
                "aws.cloudtrail.user_identity.type",
                "aws.cloudtrail.user_identity.access_key_id",
                "target.entity.id",
                "event.action",
                "event.outcome",
                "cloud.account.id",
                "cloud.region",
                "aws.cloudtrail.request_parameters"
            ]
        },
        "language": "kuery",
        "license": "Elastic License v2",
        "name": "AWS Configuration Recorder Stopped",
        "note": "## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating AWS Configuration Recorder Stopped\n\nAWS Config provides continuous visibility into resource configuration changes and underpins many security, compliance,\nand audit workflows. Stopping the configuration recorder prevents new changes from being captured and can create blind\nspots in detection and forensic timelines.\n\nThis behavior is uncommon in steady-state production environments and should be carefully reviewed, especially when\nperformed outside approved maintenance windows or by unexpected principals.\n\n### Possible investigation steps\n\n**Identify the actor**\n- Review `aws.cloudtrail.user_identity.arn` and `aws.cloudtrail.user_identity.access_key_id`\n  to determine who initiated the `StopConfigurationRecorder` action. Confirm whether this principal typically administers AWS Config or performs security and compliance operations.\n\n**Examine the request context**\n- Review `user_agent.original` to determine whether the request originated from the AWS Console, CLI, SDK, or automation tooling.\n- Inspect `source.ip` and any available geo context to assess whether the request originated from an expected network or region.\n\n**Determine scope and impact**\n- Identify which configuration recorder was stopped and which regions or resources were affected.\n- Determine how long the recorder remained disabled and whether any configuration changes occurred during that window.\n- Assess whether AWS Config rules, Security Hub controls, or downstream monitoring systems were impacted.\n\n**Correlate with related activity**\n- Look for surrounding CloudTrail activity from the same principal, including:\n  - Deletion or modification of Config rules, delivery channels, or conformance packs.\n  - IAM changes, credential activity, or other security control modifications.\n- Check for signs of follow-on activity that may have relied on reduced visibility, such as resource creation, policy changes,\n  or network reconfiguration.\n\n**Validate intent**\n- Confirm with the platform, security, or compliance teams whether the recorder stoppage was intentional and approved.\n- Compare the timing against change management records, infrastructure deployments, or account bootstrapping workflows.\n\n### False positive analysis\n\n- Planned maintenance or controlled configuration changes may require temporarily stopping the recorder.\n- Automated account provisioning, teardown, or remediation tooling may stop and restart the recorder as part of normal workflows.\n\n### Response and remediation\n\n- Immediately restart the AWS Config recorder to restore configuration visibility.\n- Review CloudTrail logs for activity that occurred while the recorder was stopped and assess potential security or compliance impact.\n- If the action was unauthorized, rotate or disable credentials associated with the initiating principal and investigate for compromise.\n- Review IAM permissions to ensure only a minimal set of trusted roles can stop or modify AWS Config components.\n- Implement guardrails such as AWS Config rules, SCPs, or automated remediation to detect and respond to recorder stoppage.\n- Update monitoring, alerting, and incident response runbooks to explicitly cover AWS Config visibility loss scenarios.\n\n### Additional information\n- **[AWS IR Playbooks](https://github.com/aws-samples/aws-incident-response-playbooks/blob/c151b0dc091755fffd4d662a8f29e2f6794da52c/playbooks/)** \n- **[AWS Customer Playbook Framework](https://github.com/aws-samples/aws-customer-playbook-framework/tree/a8c7b313636b406a375952ac00b2d68e89a991f2/docs)** \n- **[AWS Knowledge Center \u2013 Security Best Practices](https://aws.amazon.com/premiumsupport/knowledge-center/security-best-practices/)**\n",
        "query": "event.dataset: aws.cloudtrail \n    and event.provider: config.amazonaws.com \n    and event.action: StopConfigurationRecorder \n    and event.outcome: success\n",
        "references": [
            "https://awscli.amazonaws.com/v2/documentation/api/latest/reference/configservice/stop-configuration-recorder.html",
            "https://docs.aws.amazon.com/config/latest/APIReference/API_StopConfigurationRecorder.html"
        ],
        "related_integrations": [
            {
                "integration": "cloudtrail",
                "package": "aws",
                "version": "^4.0.0"
            }
        ],
        "required_fields": [
            {
                "ecs": true,
                "name": "event.action",
                "type": "keyword"
            },
            {
                "ecs": true,
                "name": "event.dataset",
                "type": "keyword"
            },
            {
                "ecs": true,
                "name": "event.outcome",
                "type": "keyword"
            },
            {
                "ecs": true,
                "name": "event.provider",
                "type": "keyword"
            }
        ],
        "risk_score": 73,
        "rule_id": "fbd44836-0d69-4004-a0b4-03c20370c435",
        "severity": "high",
        "tags": [
            "Domain: Cloud",
            "Data Source: AWS",
            "Data Source: Amazon Web Services",
            "Data Source: AWS Config",
            "Tactic: Defense Evasion",
            "Resources: Investigation Guide"
        ],
        "threat": [
            {
                "framework": "MITRE ATT&CK",
                "tactic": {
                    "id": "TA0005",
                    "name": "Defense Evasion",
                    "reference": "https://attack.mitre.org/tactics/TA0005/"
                },
                "technique": [
                    {
                        "id": "T1562",
                        "name": "Impair Defenses",
                        "reference": "https://attack.mitre.org/techniques/T1562/",
                        "subtechnique": [
                            {
                                "id": "T1562.001",
                                "name": "Disable or Modify Tools",
                                "reference": "https://attack.mitre.org/techniques/T1562/001/"
                            },
                            {
                                "id": "T1562.008",
                                "name": "Disable or Modify Cloud Logs",
                                "reference": "https://attack.mitre.org/techniques/T1562/008/"
                            }
                        ]
                    }
                ]
            }
        ],
        "timestamp_override": "event.ingested",
        "type": "query",
        "version": 210
    },
    "id": "fbd44836-0d69-4004-a0b4-03c20370c435_210",
    "type": "security-rule"
}