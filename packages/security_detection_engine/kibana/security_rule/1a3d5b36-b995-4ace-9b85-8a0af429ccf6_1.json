{
    "attributes": {
        "author": [
            "Elastic"
        ],
        "description": "This rule detects Elastic SIEM high severity detection alerts that are observed for the first time in the previous 5 days of alert history. It highlights low-volume, newly observed alerts tied to a specific detection rule, analysts can use this to prioritize triage and response.",
        "from": "now-7205m",
        "interval": "5m",
        "language": "esql",
        "license": "Elastic License v2",
        "name": "Newly Observed High Severity Detection Alert",
        "note": "## Triage and analysis\n\n### Investigating Newly Observed High Severity Detection Alert\n\nThis rule surfaces newly observed, low-frequency behavior high severity alerts affecting a single agent within the current day.\n\nBecause the alert has not been seen previously for this rule and host, it should be prioritized for validation to determine\nwhether it represents a true compromise or rare benign activity.\n\n### Investigation Steps\n\n- Identify the affected host, user and review the associated rule name to understand the behavior that triggered the alert.\n- Validate the user context under which the activity occurred and assess whether it aligns with normal behavior for that account.\n- Refer to the specific rule investiguation guide for further actions.\n\n### False Positive Considerations\n\n- Newly deployed or updated software may introduce behavior not previously observed on the host.\n- Administrative scripts or automation tools can trigger behavior-based detections when first introduced.\n- Security tooling, IT management agents, or EDR integrations may generate new behavior alerts during updates or configuration changes.\n- Development or testing environments may produce one-off behaviors that resemble malicious techniques.\n\n### Response and Remediation\n\n- If the activity is confirmed malicious, isolate the affected host to prevent further execution or lateral movement.\n- Terminate malicious processes and remove any dropped files or persistence mechanisms.\n- Collect forensic artifacts to understand initial access and execution flow.\n- Patch or remediate any vulnerabilities or misconfigurations that enabled the behavior.\n- If benign, document the finding and consider tuning or exception handling to reduce future noise.\n- Continue monitoring the host and environment for recurrence of the behavior or related alerts.",
        "query": "FROM .alerts-security.*\n| where kibana.alert.rule.name is not null and kibana.alert.risk_score >= 73  and\n  not kibana.alert.rule.type in (\"threat_match\", \"machine_learning\", \"new_terms\") and\n  not kibana.alert.rule.name like \"Deprecated - *\" and kibana.alert.rule.name != \"My First Rule\" and\n  // covered by 7306ce7d-5c90-4f42-aa6c-12b0dc2fe3b8\n  event.dataset != \"endpoint.alerts\"\n| STATS Esql.alerts_count = count(*),\n        Esql.first_time_seen = MIN(@timestamp),\n        Esql.last_time_seen = MAX(@timestamp),\n        Esql.process_executable = VALUES(process.executable),\n        Esql.cmd_line = VALUES(process.command_line),\n        Esql.parent_executable = VALUES(process.parent.executable),\n        Esql.file_path_values = VALUES(file.path),\n        Esql.file_path_values = VALUES(file.path),\n        Esql.dll_path_values = VALUES(dll.path),\n        Esql.user_id_values = VALUES(user.id),\n        Esql.user_name_values = VALUES(user.name),\n        Esql.agent_id_values = VALUES(agent.id),\n        Esql.host_id_values = VALUES(host.id),\n        Esql.event_module_values = VALUES(event.module),\n        Esql.source_ip_values = VALUES(source.ip),\n        Esql.agents_distinct_count = COUNT_DISTINCT(agent.id) by kibana.alert.rule.name\n// fist time seen in the last 5 days - defined in the rule schedule Additional look-back time\n| eval Esql.recent = DATE_DIFF(\"minute\", Esql.first_time_seen, now())\n// first time seen is within 10m of the rule execution time\n| where Esql.recent <= 10 and Esql.agents_distinct_count == 1 and Esql.alerts_count <= 10 and (Esql.last_time_seen == Esql.first_time_seen)\n| keep kibana.alert.rule.name, Esql.*\n",
        "references": [
            "https://www.elastic.co/docs/solutions/security/detect-and-alert/about-detection-rules"
        ],
        "required_fields": [
            {
                "ecs": false,
                "name": "Esql.agent_id_values",
                "type": "keyword"
            },
            {
                "ecs": false,
                "name": "Esql.agents_distinct_count",
                "type": "long"
            },
            {
                "ecs": false,
                "name": "Esql.alerts_count",
                "type": "long"
            },
            {
                "ecs": false,
                "name": "Esql.cmd_line",
                "type": "keyword"
            },
            {
                "ecs": false,
                "name": "Esql.dll_path_values",
                "type": "keyword"
            },
            {
                "ecs": false,
                "name": "Esql.event_module_values",
                "type": "keyword"
            },
            {
                "ecs": false,
                "name": "Esql.file_path_values",
                "type": "keyword"
            },
            {
                "ecs": false,
                "name": "Esql.first_time_seen",
                "type": "date"
            },
            {
                "ecs": false,
                "name": "Esql.host_id_values",
                "type": "keyword"
            },
            {
                "ecs": false,
                "name": "Esql.last_time_seen",
                "type": "date"
            },
            {
                "ecs": false,
                "name": "Esql.parent_executable",
                "type": "keyword"
            },
            {
                "ecs": false,
                "name": "Esql.process_executable",
                "type": "keyword"
            },
            {
                "ecs": false,
                "name": "Esql.recent",
                "type": "integer"
            },
            {
                "ecs": false,
                "name": "Esql.source_ip_values",
                "type": "ip"
            },
            {
                "ecs": false,
                "name": "Esql.user_id_values",
                "type": "keyword"
            },
            {
                "ecs": false,
                "name": "Esql.user_name_values",
                "type": "keyword"
            },
            {
                "ecs": false,
                "name": "kibana.alert.rule.name",
                "type": "keyword"
            }
        ],
        "risk_score": 73,
        "rule_id": "1a3d5b36-b995-4ace-9b85-8a0af429ccf6",
        "severity": "high",
        "tags": [
            "Use Case: Threat Detection",
            "Rule Type: Higher-Order Rule",
            "Resources: Investigation Guide"
        ],
        "timestamp_override": "event.ingested",
        "type": "esql",
        "version": 1
    },
    "id": "1a3d5b36-b995-4ace-9b85-8a0af429ccf6_1",
    "type": "security-rule"
}