{
    "attributes": {
        "author": [
            "Elastic"
        ],
        "description": "This rule detects the creation of a self-hosted Github runner from a first time seen user.name in the last 5 days. Adversaries may abuse self-hosted runners to execute workflow jobs on customer infrastructure.",
        "false_positives": [
            "Authorized self-hosted GitHub actions runner."
        ],
        "from": "now-9m",
        "history_window_start": "now-5d",
        "index": [
            "logs-github.audit-*"
        ],
        "language": "kuery",
        "license": "Elastic License v2",
        "name": "New GitHub Self Hosted Action Runner",
        "new_terms_fields": [
            "user.name",
            "github.actor_ip"
        ],
        "note": "## Triage and analysis\n\n### Investigating New GitHub Self Hosted Action Runner\n\nAdversaries who gain the ability to modify or trigger workflows in a linked GitHub repository can execute arbitrary commands on the runner host.\n\n### Possible investigation steps\n\n- Validate the user is authoried to perform this change\n- Review the purpose of the self-hosted action runner and what actions will be executed.\n- Verify if there is any adjascent  sensitive file access or collection.\n- Correlate with other alerts and investiguate if this activity is related to a supply chain attack.\n\n### False positive analysis\n\n- Authorized github self-hosted actions runner.\n\n### Response and remediation\n\n- Immediately isolate the affected system from the network to prevent further unauthorized command execution and potential lateral movement.\n- Terminate any suspicious child processes that were initiated by the Github actions runner.\n- Conduct a thorough review of the affected system's logs and configurations to identify any unauthorized changes or additional indicators of compromise.\n- Restore the system from a known good backup if any unauthorized changes or malicious activities are confirmed.\n- Implement application whitelisting to prevent unauthorized execution.\n- Escalate the incident to the security operations center (SOC) or incident response team for further investigation and to assess the potential impact on the broader network.",
        "query": "event.dataset:\"github.audit\" and\n    event.category:\"configuration\" and\n    event.action: (\n        \"repo.register_self_hosted_runner\" or\n        \"org.register_self_hosted_runner\" or\n        \"enterprise.register_self_hosted_runner\"\n    )\n",
        "references": [
            "https://www.elastic.co/blog/shai-hulud-worm-npm-supply-chain-compromise",
            "https://socket.dev/blog/shai-hulud-strikes-again-v2",
            "https://www.wiz.io/blog/shai-hulud-2-0-ongoing-supply-chain-attack"
        ],
        "related_integrations": [
            {
                "package": "github",
                "version": "^2.0.0"
            }
        ],
        "required_fields": [
            {
                "ecs": true,
                "name": "event.action",
                "type": "keyword"
            },
            {
                "ecs": true,
                "name": "event.category",
                "type": "keyword"
            },
            {
                "ecs": true,
                "name": "event.dataset",
                "type": "keyword"
            }
        ],
        "risk_score": 47,
        "rule_id": "40c34c8a-b0bc-43bc-83aa-d2b76bf129e1",
        "severity": "medium",
        "tags": [
            "Domain: Cloud",
            "Use Case: Threat Detection",
            "Tactic: Initial Access",
            "Data Source: Github",
            "Resources: Investigation Guide"
        ],
        "threat": [
            {
                "framework": "MITRE ATT&CK",
                "tactic": {
                    "id": "TA0001",
                    "name": "Initial Access",
                    "reference": "https://attack.mitre.org/tactics/TA0001/"
                },
                "technique": [
                    {
                        "id": "T1195",
                        "name": "Supply Chain Compromise",
                        "reference": "https://attack.mitre.org/techniques/T1195/",
                        "subtechnique": [
                            {
                                "id": "T1195.002",
                                "name": "Compromise Software Supply Chain",
                                "reference": "https://attack.mitre.org/techniques/T1195/002/"
                            }
                        ]
                    }
                ]
            }
        ],
        "timestamp_override": "event.ingested",
        "type": "new_terms",
        "version": 2
    },
    "id": "40c34c8a-b0bc-43bc-83aa-d2b76bf129e1_2",
    "type": "security-rule"
}