{
    "attributes": {
        "author": [
            "Elastic"
        ],
        "building_block_type": "default",
        "description": "Detects potential remote code execution (RCE) attempts targeting IIS web servers running SharePoint via malicious VIEWSTATE payloads in HTTP POST requests. Attackers may exploit insecure deserialization in the VIEWSTATE parameter to execute arbitrary code. This rule identifies suspicious requests containing VIEWSTATE data and other indicators of exploitation, specifically those associated with the Toolshell exploit chain. Toolshell leverages vulnerabilities (CVE-2025-53770 and CVE-2025-53771) for initial access, enabling adversaries to deploy a webshell, steal machine keys, sign VIEWSTATE payloads offline, and subsequently send signed payloads to the server to achieve code execution.",
        "from": "now-119m",
        "index": [
            "logs-network_traffic.http*"
        ],
        "interval": "60m",
        "language": "kuery",
        "license": "Elastic License v2",
        "max_signals": 100,
        "name": "Potential VIEWSTATE RCE Attempt on SharePoint/IIS",
        "query": "data_stream.dataset : \"network_traffic.http\" and\n    network.direction: \"ingress\" and\n    http.request.method: \"POST\" and\n    http.request.referrer: *SignOut.aspx and\n    http.request.body.content: *__VIEWSTATE=* and\n    http.request.body.bytes >= 500 and\n    http.response.headers.server: Microsoft-IIS*\n",
        "references": [
            "https://research.eye.security/sharepoint-under-siege/",
            "https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-53771",
            "https://msrc.microsoft.com/update-guide/vulnerability/CVE-2025-53770",
            "https://msrc.microsoft.com/blog/2025/07/customer-guidance-for-sharepoint-vulnerability-cve-2025-53770/"
        ],
        "related_integrations": [
            {
                "package": "network_traffic",
                "version": "^1.33.0"
            }
        ],
        "required_fields": [
            {
                "ecs": true,
                "name": "data_stream.dataset",
                "type": "constant_keyword"
            },
            {
                "ecs": true,
                "name": "http.request.body.bytes",
                "type": "long"
            },
            {
                "ecs": true,
                "name": "http.request.body.content",
                "type": "wildcard"
            },
            {
                "ecs": true,
                "name": "http.request.method",
                "type": "keyword"
            },
            {
                "ecs": true,
                "name": "http.request.referrer",
                "type": "keyword"
            },
            {
                "ecs": false,
                "name": "http.response.headers.server",
                "type": "unknown"
            },
            {
                "ecs": true,
                "name": "network.direction",
                "type": "keyword"
            }
        ],
        "risk_score": 47,
        "rule_id": "99c9af5a-67cf-11f0-b69e-f661ea17fbcd",
        "setup": "### Network Traffic Setup\n\nThis rule requires network traffic logs to be collected from HTTP endpoints, focusing on IIS web servers and SharePoint sites. Ensure logging captures HTTP request and response details, including headers and request bodies for POST requests. Monitoring VIEWSTATE content is critical for detecting deserialization attacks.\n",
        "severity": "medium",
        "tags": [
            "Domain: Network",
            "Tactic: Initial Access",
            "Use Case: Exploit Detection",
            "Data Source: Network Traffic",
            "Data Source: Network Traffic HTTP Logs",
            "Rule Type: BBR"
        ],
        "threat": [
            {
                "framework": "MITRE ATT&CK",
                "tactic": {
                    "id": "TA0001",
                    "name": "Initial Access",
                    "reference": "https://attack.mitre.org/tactics/TA0001/"
                },
                "technique": [
                    {
                        "id": "T1190",
                        "name": "Exploit Public-Facing Application",
                        "reference": "https://attack.mitre.org/techniques/T1190/"
                    }
                ]
            }
        ],
        "timestamp_override": "event.ingested",
        "type": "query",
        "version": 1
    },
    "id": "99c9af5a-67cf-11f0-b69e-f661ea17fbcd_1",
    "type": "security-rule"
}