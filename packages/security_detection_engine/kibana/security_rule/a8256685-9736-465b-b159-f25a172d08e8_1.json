{
    "attributes": {
        "author": [
            "Elastic"
        ],
        "description": "Detects curl requests to JAMF Pro endpoints from suspicious processes like unsigned binaries or scripting interpreters. This indicates potential abuse of stolen JAMF credentials for lateral movement in enterprise macOS environments.",
        "from": "now-9m",
        "index": [
            "logs-endpoint.events.process-*"
        ],
        "language": "eql",
        "license": "Elastic License v2",
        "name": "Suspicious Curl to Jamf Endpoint",
        "note": "## Triage and analysis\n\n> **Disclaimer**:\n> This investigation guide was created using generative AI technology and has been reviewed to improve its accuracy and relevance. While every effort has been made to ensure its quality, we recommend validating the content and adapting it to suit your specific environment and operational needs.\n\n### Investigating Suspicious Curl to Jamf Endpoint\n\nJamf Pro is a widely-used enterprise Apple device management platform that controls software deployment, security policies, and device configurations across macOS fleets. Threat actors who compromise Jamf credentials can leverage this access for devastating lateral movement, deploying malicious payloads to all managed devices or exfiltrating sensitive device inventory data. This detection rule identifies curl requests to Jamf endpoints originating from suspicious processes like unsigned binaries or scripting interpreters, which is inconsistent with legitimate Jamf management workflows.\n\n### Possible investigation steps\n\n- Examine the process.command_line to identify the specific Jamf API endpoint being accessed and determine if it matches your organization's Jamf Pro server URL.\n- Review the process.parent.executable and parent process details to understand how the curl request was initiated and trace back to the initial execution vector.\n- Analyze the process.parent.code_signature fields to confirm whether the parent process is unsigned or has an untrusted signature.\n- Correlate with Jamf Pro server logs to review authentication attempts, API calls, and any configuration changes made around the time of the alert.\n- Check if any Jamf API credentials, tokens, or certificates were recently accessed or exfiltrated from the affected system.\n- Review the user.name associated with the process to determine if the behavior is consistent with their role and normal activities.\n- Search for similar curl requests to Jamf endpoints across other systems in the environment to identify potential widespread credential abuse.\n\n### False positive analysis\n\n- Legitimate IT automation scripts may use curl to interact with Jamf APIs for approved management tasks. Verify the script ownership and purpose with IT operations.\n- MDM troubleshooting by administrators may involve manual curl commands to test API connectivity. Confirm with IT staff if such activities were planned.\n- Third-party integrations with Jamf may use scripting languages to automate device management. Review the integration documentation and verify legitimacy.\n- Security testing and penetration testing activities may trigger this detection. Coordinate with security teams to document expected testing windows.\n\n### Response and remediation\n\n- Immediately revoke or rotate the Jamf API credentials that may have been compromised.\n- Block the source IP or endpoint from accessing the Jamf Pro server pending investigation.\n- Review Jamf Pro audit logs for any unauthorized configuration changes, script deployments, or policy modifications.\n- Check all managed devices for unauthorized software deployments or policy changes that may have been pushed via the compromised access.\n- Terminate the suspicious process and quarantine any associated scripts or binaries for analysis.\n- Implement IP allowlisting or certificate-based authentication for Jamf API access to prevent future unauthorized access.\n- Reset credentials for any user accounts that may have had access to Jamf management credentials.\n- Escalate to the incident response team for comprehensive investigation of potential enterprise-wide compromise.\n",
        "query": "process where host.os.type == \"macos\" and event.type == \"start\" and event.action == \"exec\" and\n  process.name in (\"curl\", \"nscurl\") and process.command_line like \"*https://jamf.*\" and\n  ((process.parent.code_signature.exists == false or process.parent.code_signature.trusted == false) or\n   process.parent.name in (\"osascript\", \"node\", \"perl\", \"ruby\") or\n   process.parent.name like \"python*\")\n",
        "related_integrations": [
            {
                "package": "endpoint",
                "version": "^9.0.0"
            }
        ],
        "required_fields": [
            {
                "ecs": true,
                "name": "event.action",
                "type": "keyword"
            },
            {
                "ecs": true,
                "name": "event.type",
                "type": "keyword"
            },
            {
                "ecs": true,
                "name": "host.os.type",
                "type": "keyword"
            },
            {
                "ecs": true,
                "name": "process.command_line",
                "type": "wildcard"
            },
            {
                "ecs": true,
                "name": "process.name",
                "type": "keyword"
            },
            {
                "ecs": true,
                "name": "process.parent.code_signature.exists",
                "type": "boolean"
            },
            {
                "ecs": true,
                "name": "process.parent.code_signature.trusted",
                "type": "boolean"
            },
            {
                "ecs": true,
                "name": "process.parent.name",
                "type": "keyword"
            }
        ],
        "risk_score": 73,
        "rule_id": "a8256685-9736-465b-b159-f25a172d08e8",
        "severity": "high",
        "tags": [
            "Domain: Endpoint",
            "OS: macOS",
            "Use Case: Threat Detection",
            "Tactic: Lateral Movement",
            "Tactic: Execution",
            "Data Source: Elastic Defend",
            "Resources: Investigation Guide"
        ],
        "threat": [
            {
                "framework": "MITRE ATT&CK",
                "tactic": {
                    "id": "TA0008",
                    "name": "Lateral Movement",
                    "reference": "https://attack.mitre.org/tactics/TA0008/"
                },
                "technique": [
                    {
                        "id": "T1072",
                        "name": "Software Deployment Tools",
                        "reference": "https://attack.mitre.org/techniques/T1072/"
                    }
                ]
            },
            {
                "framework": "MITRE ATT&CK",
                "tactic": {
                    "id": "TA0002",
                    "name": "Execution",
                    "reference": "https://attack.mitre.org/tactics/TA0002/"
                },
                "technique": [
                    {
                        "id": "T1072",
                        "name": "Software Deployment Tools",
                        "reference": "https://attack.mitre.org/techniques/T1072/"
                    }
                ]
            }
        ],
        "timestamp_override": "event.ingested",
        "type": "eql",
        "version": 1
    },
    "id": "a8256685-9736-465b-b159-f25a172d08e8_1",
    "type": "security-rule"
}