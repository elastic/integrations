{
  "attributes": {
    "created_at": "2025-11-05T09:19:01.000Z",
    "created_by": "elastic",
    "description": "Identify active network connections to external IPs on common C2 and lateral movement ports like 445, 3389, 4444, 8080",
    "ecs_mapping": [
      {
        "key": "process.pid",
        "value": {
          "field": "pid"
        }
      },
      {
        "key": "source.ip",
        "value": {
          "field": "local_address"
        }
      },
      {
        "key": "source.port",
        "value": {
          "field": "local_port"
        }
      },
      {
        "key": "destination.ip",
        "value": {
          "field": "remote_address"
        }
      },
      {
        "key": "destination.port",
        "value": {
          "field": "remote_port"
        }
      },
      {
        "key": "network.transport",
        "value": {
          "field": "protocol"
        }
      },
      {
        "key": "event.category",
        "value": {
          "value": [
            "network"
          ]
        }
      },
      {
        "key": "event.type",
        "value": {
          "value": [
            "connection"
          ]
        }
      },
      {
        "key": "tags",
        "value": {
          "value": [
            "network_activity",
            "c2_detection",
            "connections"
          ]
        }
      }
    ],
    "id": "network_connections_c2_elastic",
    "interval": "3600",
    "query": "SELECT \n  pid, \n  protocol, \n  local_address, \n  local_port, \n  remote_address, \n  remote_port, \n  state \nFROM process_open_sockets \nWHERE state = 'ESTABLISHED' \n  AND remote_address NOT LIKE '10.%' \n  AND remote_address NOT LIKE '192.168.%' \n  AND remote_address NOT LIKE '172.16.%' \n  AND remote_address NOT LIKE '172.17.%' \n  AND remote_address NOT LIKE '172.18.%' \n  AND remote_address NOT LIKE '172.19.%' \n  AND remote_address NOT LIKE '172.20.%' \n  AND remote_address NOT LIKE '172.21.%' \n  AND remote_address NOT LIKE '172.22.%' \n  AND remote_address NOT LIKE '172.23.%' \n  AND remote_address NOT LIKE '172.24.%' \n  AND remote_address NOT LIKE '172.25.%' \n  AND remote_address NOT LIKE '172.26.%' \n  AND remote_address NOT LIKE '172.27.%' \n  AND remote_address NOT LIKE '172.28.%' \n  AND remote_address NOT LIKE '172.29.%' \n  AND remote_address NOT LIKE '172.30.%' \n  AND remote_address NOT LIKE '172.31.%' \n  AND remote_address != '127.0.0.1' \n  AND remote_address != '::1' \n  AND remote_address != '' \nORDER BY remote_port \nLIMIT 100;",
    "updated_at": "2025-11-05T09:19:01.000Z",
    "updated_by": "elastic"
  },
  "coreMigrationVersion": "9.3.0",
  "id": "osquery_manager-4846c0ca-1962-4692-830f-29451c486ff7",
  "references": [],
  "type": "osquery-saved-query",
  "updated_at": "2025-11-05T09:19:01.000Z",
  "version": "Wzg5LDJd"
}
