{
    "attributes": {
        "created_at": "2026-01-07T00:00:00.000Z",
        "created_by": "elastic",
        "description": "Comprehensive file enumeration with hash values and code signature validation across all directories on Windows. Returns all regular files on the system with PE metadata, file attributes, and authenticode signature verification. Use for complete filesystem forensics and malware hunting when location is unknown.\n\nNote: This query returns ALL files and may produce very large result sets (potentially millions of files on production systems). Use with caution and consider the storage/ingestion impact. For targeted analysis, use file_hash_info_windows_elastic instead.\n\nInterval: This query defaults to every 12 hours (43200 seconds). Adjust based on your environment size and change detection needs.\n\nNote: osquery exposes Windows file attributes as compact letter-codes (for example, \"HSR\") in the `attributes` column. We intentionally do not map this value into ECS `file.attributes` (which ECS documents as an array of keywords like [\"hidden\",\"system\",\"readonly\"]) unless/until a normalization transform is introduced.",
        "ecs_mapping": [
            {
                "key": "event.category",
                "value": {
                    "value": ["file"]
                }
            },
            {
                "key": "event.type",
                "value": {
                    "value": ["info"]
                }
            },
            {
                "key": "event.action",
                "value": {
                    "value": "osquery.file_hash_listing"
                }
            },
            {
                "key": "file.path",
                "value": {
                    "field": "path"
                }
            },
            {
                "key": "file.directory",
                "value": {
                    "field": "directory"
                }
            },
            {
                "key": "file.name",
                "value": {
                    "field": "filename"
                }
            },
            {
                "key": "file.size",
                "value": {
                    "field": "size"
                }
            },
            {
                "key": "file.mtime",
                "value": {
                    "field": "modified_time"
                }
            },
            {
                "key": "file.ctime",
                "value": {
                    "field": "changed_time"
                }
            },
            {
                "key": "file.created",
                "value": {
                    "field": "created_time"
                }
            },
            {
                "key": "file.accessed",
                "value": {
                    "field": "accessed_time"
                }
            },
            {
                "key": "file.uid",
                "value": {
                    "field": "uid"
                }
            },
            {
                "key": "file.gid",
                "value": {
                    "field": "gid"
                }
            },
            {
                "key": "file.mode",
                "value": {
                    "field": "mode"
                }
            },
            {
                "key": "file.inode",
                "value": {
                    "field": "inode"
                }
            },
            {
                "key": "file.type",
                "value": {
                    "field": "type"
                }
            },
            {
                "key": "file.pe.original_file_name",
                "value": {
                    "field": "original_filename"
                }
            },
            {
                "key": "file.pe.file_version",
                "value": {
                    "field": "file_version"
                }
            },
            {
                "key": "file.pe.product",
                "value": {
                    "field": "product_version"
                }
            },
            {
                "key": "file.hash.md5",
                "value": {
                    "field": "md5"
                }
            },
            {
                "key": "file.hash.sha1",
                "value": {
                    "field": "sha1"
                }
            },
            {
                "key": "file.hash.sha256",
                "value": {
                    "field": "sha256"
                }
            },
            {
                "key": "file.code_signature.subject_name",
                "value": {
                    "field": "signature_signer"
                }
            },
            {
                "key": "file.code_signature.status",
                "value": {
                    "field": "signature_status"
                }
            },
            {
                "key": "tags",
                "value": {
                    "value": ["osquery", "file_forensics", "hash_analysis", "code_signature", "windows", "comprehensive"]
                }
            }
        ],
        "id": "file_hash_listing_windows_elastic",
        "interval": "43200",
        "platform": "windows",
        "query": "-- Comprehensive File Hash Listing with Code Signature Validation - Windows\n-- Enumerates ALL regular files with hash values and authenticode validation\n-- Warning: unfiltered enumeration may be expensive and produce large result sets\n-- Note: file table requires a path constraint - scanning C:\\ drive\n\nSELECT\n    f.path,\n    f.directory,\n    f.filename,\n    f.size,\n    f.type,\n    f.attributes,\n    f.original_filename,\n    f.file_version,\n    f.product_version,\n    f.volume_serial,\n    f.file_id,\n    f.shortcut_target_path,\n    f.uid,\n    f.gid,\n    f.mode,\n    f.inode,\n    datetime(f.btime, 'unixepoch') AS created_time,\n    datetime(f.mtime, 'unixepoch') AS modified_time,\n    datetime(f.atime, 'unixepoch') AS accessed_time,\n    datetime(f.ctime, 'unixepoch') AS changed_time,\n    h.md5,\n    h.sha1,\n    h.sha256,\n    'https://www.virustotal.com/gui/file/' || h.sha256 AS vt_link,\n    a.subject_name AS signature_signer,\n    a.result AS signature_status,\n    a.serial_number AS signature_serial,\n    a.issuer_name AS signature_issuer,\n    CASE\n        WHEN f.attributes LIKE '%H%' THEN 'hidden'\n        WHEN f.attributes LIKE '%S%' THEN 'system'\n        ELSE 'normal'\n    END AS file_visibility,\n    CASE\n        WHEN f.original_filename != '' AND f.original_filename != f.filename THEN 'renamed'\n        ELSE 'original'\n    END AS rename_status\nFROM file f\nLEFT JOIN hash h ON h.path = f.path\nLEFT JOIN authenticode a ON a.path = f.path\nWHERE f.path LIKE 'C:\\\\%'\nAND f.type = 'regular'\nAND f.size > 0",
        "updated_at": "2026-01-07T00:00:00.000Z",
        "updated_by": "elastic"
    },
    "coreMigrationVersion": "9.2.0",
    "id": "osquery_manager-de99fd6a-3f4f-4645-9466-bd2945124eb2",
    "references": [],
    "type": "osquery-saved-query",
    "updated_at": "2026-01-07T00:00:00.000Z",
    "version": "WzEsMV0="
}


