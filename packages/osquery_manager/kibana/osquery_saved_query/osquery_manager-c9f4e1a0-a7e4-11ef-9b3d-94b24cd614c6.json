{
    "attributes": {
        "created_at": "2025-11-20T15:30:00.000Z",
        "created_by": "elastic",
        "description": "Investigate Windows Prefetch artifacts for execution history. Prefetch files (.pf) track application launches, execution counts, and associated file/directory access patterns. This query uses the native Osquery prefetch table to parse .pf files and extract forensic intelligence including executable names, run counts, last execution times, and accessed resources. Limited to executables run in the last 90 days to reduce noise. Results capped at 1024 (Windows prefetch directory limit). Equivalent to Velociraptor Windows.Forensics.Prefetch artifact.",
        "ecs_mapping": [
            {
                "key": "process.name",
                "value": {
                    "field": "filename"
                }
            },
            {
                "key": "file.name",
                "value": {
                    "field": "filename"
                }
            },
            {
                "key": "process.hash.md5",
                "value": {
                    "field": "hash"
                }
            },
            {
                "key": "event.created",
                "value": {
                    "field": "last_execution_time"
                }
            },
            {
                "key": "event.sequence",
                "value": {
                    "field": "run_count"
                }
            },
            {
                "key": "file.size",
                "value": {
                    "field": "size"
                }
            },
            {
                "key": "host.id",
                "value": {
                    "field": "volume_serial"
                }
            },
            {
                "key": "file.path",
                "value": {
                    "field": "accessed_files"
                }
            },
            {
                "key": "file.directory",
                "value": {
                    "field": "accessed_directories"
                }
            },
            {
                "key": "file.path",
                "value": {
                    "field": "prefetch_file_path"
                }
            }
        ],
        "id": "prefetch_windows_elastic",
        "interval": "3600",
        "platform": "windows",
        "query": "SELECT\n  datetime(last_run_time, 'unixepoch') AS last_execution_time,\n  filename,\n  hash,\n  run_count,\n  other_run_times,\n  size,\n  volume_serial,\n  volume_creation,\n  accessed_files_count,\n  accessed_directories_count,\n  accessed_files,\n  accessed_directories,\n  path AS prefetch_file_path\nFROM prefetch\nWHERE last_run_time > (strftime('%s', 'now') - 7776000)\nORDER BY last_run_time DESC\nLIMIT 1024",
        "updated_at": "2025-11-20T15:30:00.000Z",
        "updated_by": "elastic"
    },
    "coreMigrationVersion": "8.3.0",
    "id": "osquery_manager-c9f4e1a0-a7e4-11ef-9b3d-94b24cd614c6",
    "references": [],
    "type": "osquery-saved-query",
    "updated_at": "2025-11-20T15:30:00.000Z",
    "version": "WzEwMCwxXQ=="
}
