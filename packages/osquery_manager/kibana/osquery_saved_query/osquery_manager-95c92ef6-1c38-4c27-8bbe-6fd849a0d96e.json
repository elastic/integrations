{
  "attributes": {
    "created_at": "2025-11-05T09:19:01.000Z",
    "created_by": "elastic",
    "description": "Detect suspicious running processes including fileless malware (not on disk), processes from temp folders, and encoded PowerShell commands",
    "ecs_mapping": [
      {
        "key": "process.pid",
        "value": {
          "field": "pid"
        }
      },
      {
        "key": "process.name",
        "value": {
          "field": "name"
        }
      },
      {
        "key": "process.executable",
        "value": {
          "field": "path"
        }
      },
      {
        "key": "process.command_line",
        "value": {
          "field": "cmdline"
        }
      },
      {
        "key": "process.start",
        "value": {
          "field": "start_time"
        }
      },
      {
        "key": "process.parent.pid",
        "value": {
          "field": "parent"
        }
      },
      {
        "key": "event.category",
        "value": {
          "value": [
            "process"
          ]
        }
      },
      {
        "key": "event.type",
        "value": {
          "value": [
            "info"
          ]
        }
      },
      {
        "key": "tags",
        "value": {
          "value": [
            "process_activity",
            "suspicious_process"
          ]
        }
      }
    ],
    "id": "suspicious_processes_elastic",
    "interval": "3600",
    "query": "SELECT \n  pid, \n  name, \n  path, \n  cmdline, \n  start_time, \n  parent, \n  uid, \n  on_disk \nFROM processes \nWHERE (\n    on_disk = 0 \n    OR path LIKE '%\\\\Temp\\\\%' \n    OR path LIKE '%\\\\Users\\\\%\\\\AppData\\\\Local\\\\%' \n    OR path LIKE '%\\\\Users\\\\%\\\\AppData\\\\Roaming\\\\%' \n    OR path LIKE '%\\\\Users\\\\Public\\\\%' \n    OR path LIKE '%\\\\ProgramData\\\\%'\n  ) \n  OR (\n    (cmdline LIKE '%powershell%' OR cmdline LIKE '%pwsh%') \n    AND (\n      cmdline LIKE '%-enc%' \n      OR cmdline LIKE '%-e %' \n      OR cmdline LIKE '%-w hidden%' \n      OR cmdline LIKE '%downloadstring%' \n      OR cmdline LIKE '%iex%' \n      OR cmdline LIKE '%invoke-expression%'\n    )\n  ) \n  OR (\n    cmdline LIKE '%cmd.exe%' \n    AND (\n      cmdline LIKE '%/c %' \n      OR cmdline LIKE '%&%' \n      OR cmdline LIKE '%|%'\n    )\n  ) \nORDER BY start_time DESC \nLIMIT 200;",
    "updated_at": "2025-11-05T09:19:01.000Z",
    "updated_by": "elastic"
  },
  "coreMigrationVersion": "8.8.0",
  "id": "osquery_manager-95c92ef6-1c38-4c27-8bbe-6fd849a0d96e",
  "references": [],
  "type": "osquery-saved-query",
  "updated_at": "2025-11-05T09:19:01.000Z",
  "version": "Wzg2LDJd"
}
