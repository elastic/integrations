{
  "attributes": {
    "created_at": "2025-12-01T12:00:00.000Z",
    "created_by": "elastic",
    "description": "Tracks filesystem changes via FSEvents including file creation, modification, deletion with cryptographic hashes (md5, sha256). Provides forensic evidence of file system activity with hash verification for IOC matching. REQUIRED CONFIG: Add to Kibana osquery integration: {\"options\":{\"disable_events\":\"false\",\"enable_file_events\":\"true\"},\"file_paths\":{\"users\":[\"/Users/%%\"],\"apps\":[\"/Applications/%%\"],\"tmp\":[\"/tmp/%%\"]},\"exclude_paths\":{\"var_folders\":[\"/private/var/folders/%\"]}}. MITRE ATT&CK: T1070.004 (Indicator Removal on Host: File Deletion), T1083 (File and Directory Discovery).",
    "ecs_mapping": [
      {
        "key": "event.category",
        "value": {
          "value": ["file"]
        }
      },
      {
        "key": "event.action",
        "value": {
          "field": "action"
        }
      },
      {
        "key": "file.path",
        "value": {
          "field": "target_path"
        }
      },
      {
        "key": "file.hash.md5",
        "value": {
          "field": "md5"
        }
      },
      {
        "key": "file.hash.sha256",
        "value": {
          "field": "sha256"
        }
      },
      {
        "key": "tags",
        "value": {
          "value": ["file_events", "fsevents", "filesystem_forensics", "mitre_t1070_004", "mitre_t1083"]
        }
      }
    ],
    "id": "file_system_events_macos_elastic",
    "interval": "3600",
    "platform": "darwin",
    "query": "-- File System Events (macOS) via FSEvents\n-- Tracks filesystem changes including file creation, modification, deletion with hashes\n-- MITRE ATT&CK: T1070.004 (File Deletion), T1083 (File Discovery)\n-- REQUIRED: Enable in Kibana osquery integration config:\n-- {\"options\":{\"disable_events\":\"false\",\"enable_file_events\":\"true\"},\"file_paths\":{\"users\":[\"/Users/%%\"],\"apps\":[\"/Applications/%%\"],\"tmp\":[\"/tmp/%%\"]},\"exclude_paths\":{\"var_folders\":[\"/private/var/folders/%\"]}}\nSELECT\n  action,\n  category,\n  target_path,\n  md5,\n  sha1,\n  sha256,\n  time,\n  transaction_id\nFROM file_events\nWHERE action IS NOT NULL\n  -- Exclude noisy system paths\n  AND target_path NOT LIKE '/private/var/folders/%'\n  AND target_path NOT LIKE '%/.DS_Store'\n  AND target_path NOT LIKE '/private/var/db/%'\n  AND target_path NOT LIKE '%.localized'",
    "updated_at": "2025-12-01T12:00:00.000Z",
    "updated_by": "elastic"
  },
  "coreMigrationVersion": "9.2.0",
  "id": "osquery_manager-6954690d-32c3-4c50-a973-3fae66114349",
  "references": [],
  "type": "osquery-saved-query",
  "updated_at": "2025-12-01T12:00:00.000Z",
  "version": "WzEsMV0="
}
