---
description: Pipeline for parsing TYCHON Windows Patches
processors:  
  - dot_expander:
      field: "*"
  - set:
      if: "ctx.containsKey('tychon') && ctx.tychon.containsKey('id')"
      field: 'host.id'
      value: '{{tychon.id}}'  
  - remove:
      if: "ctx.containsKey('tychon') && ctx.tychon.containsKey('id')"
      field: 'tychon'
  - set:
      if: "!(ctx.containsKey('id'))"
      field: id
      value: '{{host.id}}'  
  - set:      
      field: _id
      value: '{{id}}'     
  - set:
      field: '@timestamp'
      value: '{{_ingest.timestamp}}'
  - set:
      if: "ctx.containsKey('rule') && ctx.rule.containsKey('test_result')"
      field: rule.result
      value: '{{rule.test_result}}'
  - remove:
      if: "ctx.containsKey('rule') && ctx.rule.containsKey('test_result')"      
      field: rule.test_result
  - set:
      field: ecs.version
      value: '8.8.0'
  - set:
      field: event.kind
      value: state
  - set:
      field: event.module
      value: tychon
  - set:
      field: event.category
      value: [host]
  - set:
      field: event.ingested
      value: '{{_ingest.timestamp}}'
  - split:
      field: host.ip
      separator: ","
  - set:
      field: tychon.ipv4
      value: "{{host.ipv4}}"
  - set:
      field: tychon.ipv6
      value: "{{host.ipv6}}"
  - remove:
      ignore_missing: true
      field: host.ipv4
  - remove:
      ignore_missing: true
      field: host.ipv6
  - convert:
      field: host.uptime
      type: long
  - script:
      source: ctx.host.mac = ctx.host.mac.replace(':','-')
  - convert:
      field: host.uptime
      type: long
  - gsub:
      field: host.mac
      pattern: ":"
      replacement: "-"
  - convert:
      field: script.current_duration
      type: float
  - convert:
      field: rule.weight
      type: float
on_failure:
  - set:
      field: event.kind
      value: pipeline_error
  - append:
      field: error.message
      value: '{{{ _ingest.on_failure_message }}}'
