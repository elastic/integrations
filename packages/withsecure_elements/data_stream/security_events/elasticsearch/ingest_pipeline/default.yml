---
processors:
  - set:
      field: event.dataset
      value: withsecure_elements.security_events
  - set:
      field: event.module
      value: withsecure_elements
  - set:
      field: event.category
      value: [threat]
  - set:
      field: event.type
      value: [info]
  - set:
      field: event.kind
      value: event
  - set:
      field: event.provider
      value: withsecure_elements
  - set:
      field: event.action
      value: "{{action}}"
      if: ctx.action != null
  - set:
      field: event.id
      value: "{{id}}"
      if: ctx.id != null
  - set:
      field: event.severity
      value: "{{severity}}"
      if: ctx.severity != null
  - set:
      field: "@timestamp"
      value: "{{serverTimestamp}}"
      if: ctx.serverTimestamp != null
  - date:
      field: serverTimestamp
      target_field: "@timestamp"
      formats:
        - UNIX_MS
        - ISO8601
      if: ctx.serverTimestamp != null
      ignore_failure: true
  - rename:
      field: message
      target_field: event.original
      ignore_missing: true
      if: ctx.message != null
  - rename:
      field: engine
      target_field: withsecure.security.event.engine
      ignore_missing: true
  - rename:
      field: description
      target_field: withsecure.security.event.description
      ignore_missing: true
  - rename:
      field: acknowledged
      target_field: withsecure.security.event.acknowledged
      ignore_missing: true
  - rename:
      field: acknowledgedBy
      target_field: withsecure.security.event.acknowledged_by
      ignore_missing: true
  - rename:
      field: userName
      target_field: withsecure.security.event.user_name
      ignore_missing: true
  - rename:
      field: details
      target_field: withsecure.security.event.details
      ignore_missing: true
  - rename:
      field: organization
      target_field: withsecure.security.event.organization
      ignore_missing: true
  - rename:
      field: device
      target_field: withsecure.security.event.device
      ignore_missing: true
  - rename:
      field: target
      target_field: withsecure.security.event.target
      ignore_missing: true
  - remove:
      field:
        - serverTimestamp
        - persistenceTimestamp
        - clientTimestamp
      ignore_missing: true
on_failure:
  - set:
      field: error.message
      value: "{{ _ingest.on_failure_message }}"
