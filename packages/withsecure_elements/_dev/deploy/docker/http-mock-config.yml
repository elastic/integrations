rules:
  # OAuth2 token endpoint
  - path: /as/token.oauth2
    methods: [POST]
    query_params:
      grant_type: client_credentials
      scope: connect.api.read
    request_headers:
      Content-Type:
        - "application/x-www-form-urlencoded"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - "application/json"
        body: |-
          {
            "access_token": "test-access-token-12345",
            "token_type": "Bearer",
            "expires_in": 3600,
            "scope": "connect.api.read"
          }

  # Incidents endpoint - GET /incidents/v1/incidents
  - path: /incidents/v1/incidents
    methods: [GET]
    query_params:
      organizationId: "{organizationId:.*}"
      archived: "false"
      limit: "{limit:.*}"
    request_headers:
      Authorization:
        - "Bearer test-access-token-12345"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - "application/json"
        body: |-
          {
            "items": [
              {
                "incidentId": "7b726ead-e6de-47a7-8ba8-3507d8506cec",
                "incidentPublicId": "2532078-23320",
                "organizationId": "777f240c-752d-4eb5-8422-94c5336e3005",
                "name": "Detection in TEST-WORKSTATION-01",
                "status": "closed",
                "severity": "info",
                "riskLevel": "info",
                "riskScore": 0,
                "resolution": "merged",
                "createdTimestamp": "2025-11-26T15:39:57.574Z",
                "updatedTimestamp": "2025-11-26T15:39:58.719Z",
                "initialReceivedTimestamp": "2025-11-26T15:39:00.000Z",
                "categories": ["ABNORMAL_PROCESS_EXECUTION"],
                "sources": ["endpoint"]
              }
            ],
            "nextAnchor": null
          }

  # Security events endpoint - POST /security-events/v1/security-events
  - path: /security-events/v1/security-events
    methods: [POST]
    request_headers:
      Authorization:
        - "Bearer test-access-token-12345"
      Content-Type:
        - "application/x-www-form-urlencoded"
    request_body: /.*/
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - "application/json"
        body: |-
          {
            "items": [
              {
                "id": "594d2f17-79f6-3bc6-850b-e09e55340eb2_0",
                "action": "trashed",
                "engine": "fileScanning",
                "severity": "warning",
                "serverTimestamp": "2025-11-26T19:24:29.287Z",
                "persistenceTimestamp": "2025-11-26T19:24:30.964Z",
                "eventTransactionId": "0000-7edfb2260ba8479e",
                "clientTimestamp": "2025-11-26T19:24:27.983Z",
                "acknowledged": false,
                "message": "\"Heuristic.HEUR/HTML.Agent.QT\" was detected on accessing \"113873.emlx\" and it was trashed",
                "description": "File Scanning event",
                "organization": {
                  "id": "777f240c-752d-4eb5-8422-94c5336e3005",
                  "name": "FR IT-Sec"
                },
                "target": {
                  "name": "TEST-DESKTOP-01",
                  "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                },
                "device": {
                  "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
                  "name": "TEST-DESKTOP-01"
                },
                "userName": "testuser",
                "details": {
                  "alertSource": "sp.evt.oas.alert",
                  "alertType": "file",
                  "clientTimestamp": "1764185067983",
                  "filePath": "/Users/testuser/Documents/test-file.emlx",
                  "fileScanningType": "fileInfection",
                  "name": "Heuristic.HEUR/HTML.Agent.QT",
                  "profileId": "118181",
                  "profileName": "WithSecureâ„¢ Office for Mac (open)",
                  "profileVersion": "1649230230",
                  "sha1": "a3e65d0ceb320cb60d1281360994615491f38c82",
                  "userName": "testuser"
                }
              }
            ],
            "nextAnchor": null
          }

