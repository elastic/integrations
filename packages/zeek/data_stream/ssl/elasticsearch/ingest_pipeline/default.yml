---
description: Pipeline for normalizing Zeek ssl.log
processors:
  - rename:
      tag: rename_message_to_event_original_56a77271
      field: message
      target_field: event.original
      ignore_missing: true
      if: ctx.event?.original == null
  - json:
      tag: json_event_original_to__temp__7408cf8c
      field: event.original
      target_field: _temp_
  - pipeline:
      tag: pipeline_c69a6660
      if: ctx?._temp_?.result != null
      name: '{{ IngestPipeline "third-party" }}'
  - drop:
      tag: drop_c70c3de1
      description: Drop if no timestamp (invalid json)
      if: 'ctx?._temp_?.ts == null'
  - rename:
      tag: rename__temp__to_zeek_ssl_d15f060c
      field: _temp_
      target_field: zeek.ssl
      # Sets event.created from the @timestamp field generated by filebeat before being overwritten further down
  - set:
      tag: set_event_created_e3f09e3b
      field: event.created
      copy_from: "@timestamp"
  - set:
      tag: set_event_kind_de80643c
      field: event.kind
      value: event
  - set:
      tag: set_ecs_version_f5923549
      field: ecs.version
      value: '8.17.0'
  - append:
      tag: append_event_category_7afdca3c
      field: event.category
      value: network
  - append:
      tag: append_event_type_ab8d9d0e
      field: event.type
      value: connection
  - append:
      tag: append_event_type_7ca1b382
      field: event.type
      value: protocol
  - set:
      tag: set_network_transport_a8ca8f4c
      field: network.transport
      value: tcp
  - dot_expander:
      tag: dot_expander_id_orig_p_09347256
      path: zeek.ssl
      field: id.orig_p
      ignore_failure: true
  - dot_expander:
      tag: dot_expander_id_orig_h_c2fc283e
      path: zeek.ssl
      field: id.orig_h
      ignore_failure: true
  - dot_expander:
      tag: dot_expander_id_resp_h_274cd80f
      path: zeek.ssl
      field: id.resp_h
      ignore_failure: true
  - dot_expander:
      tag: dot_expander_id_resp_p_0914f3f7
      path: zeek.ssl
      field: id.resp_p
      ignore_failure: true
  - rename:
      tag: rename_zeek_ssl_id_orig_h_to_source_address_1fb29429
      field: zeek.ssl.id.orig_h
      target_field: source.address
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_id_orig_p_to_source_port_dd5bf3a6
      field: zeek.ssl.id.orig_p
      target_field: source.port
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_id_resp_h_to_destination_address_1dcff545
      field: zeek.ssl.id.resp_h
      target_field: destination.address
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_id_resp_p_to_destination_port_afdbf422
      field: zeek.ssl.id.resp_p
      target_field: destination.port
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_uid_to_zeek_session_id_95fa737e
      field: zeek.ssl.uid
      target_field: zeek.session_id
      ignore_missing: true
  - set:
      tag: set_event_id_3119a372
      field: event.id
      copy_from: zeek.session_id
      if: ctx.zeek?.session_id != null
  - set:
      tag: set_source_ip_e17d09df
      field: source.ip
      copy_from: source.address
      if: ctx.source?.address != null
  - set:
      tag: set_client_address_0aa293ce
      field: client.address
      copy_from: source.address
      if: ctx.source?.address != null
  - set:
      tag: set_destination_ip_3d6f6004
      field: destination.ip
      copy_from: destination.address
      if: ctx.destination?.address != null
  - set:
      tag: set_server_address_3c18622e
      field: server.address
      copy_from: destination.address
      if: ctx.destination?.address != null
  - rename:
      tag: rename_zeek_ssl_server_name_to_zeek_ssl_server_name_e0158fa9
      field: zeek.ssl.server_name
      target_field: zeek.ssl.server.name
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_cert_chain_to_zeek_ssl_server_cert_chain_2eb43fad
      field: zeek.ssl.cert_chain
      target_field: zeek.ssl.server.cert_chain
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_cert_chain_fuids_to_zeek_ssl_server_cert_chain_fuids_d9c0a60d
      field: zeek.ssl.cert_chain_fuids
      target_field: zeek.ssl.server.cert_chain_fuids
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_client_cert_chain_to_zeek_ssl_client_cert_chain_47adc831
      field: zeek.ssl.client_cert_chain
      target_field: zeek.ssl.client.cert_chain
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_client_cert_chain_fuids_to_zeek_ssl_client_cert_chain_fuids_fcd9dc01
      field: zeek.ssl.client_cert_chain_fuids
      target_field: zeek.ssl.client.cert_chain_fuids
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_validation_status_to_zeek_ssl_validation_status_70a5ff85
      field: zeek.ssl.validation_status
      target_field: zeek.ssl.validation.status
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_validation_code_to_zeek_ssl_validation_code_1880a6ad
      field: zeek.ssl.validation_code
      target_field: zeek.ssl.validation.code
      ignore_missing: true
  - date:
      tag: date_zeek_ssl_ts_6084dae5
      field: zeek.ssl.ts
      formats:
        - UNIX
        - ISO8601
  - remove:
      tag: remove_zeek_ssl_ts_e7fc812f
      field: zeek.ssl.ts
  - rename:
      tag: rename_zeek_ssl_not_valid_after_to_tls_server_not_after_5c3b792a
      field: zeek.ssl.not_valid_after
      target_field: tls.server.not_after
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_not_valid_before_to_tls_server_not_before_92fa49c6
      field: zeek.ssl.not_valid_before
      target_field: tls.server.not_before
      ignore_missing: true
  - date:
      tag: date_tls_server_not_before_to_tls_server_not_before_1478f3a9
      if: ctx.tls?.server?.not_before != null
      field: tls.server.not_before
      target_field: tls.server.not_before
      formats:
        - UNIX
        - ISO8601
  - date:
      tag: date_tls_server_not_after_to_tls_server_not_after_bd9ed62a
      if: ctx.tls?.server?.not_after != null
      field: tls.server.not_after
      target_field: tls.server.not_after
      formats:
        - UNIX
        - ISO8601
  - geoip:
      tag: geoip_destination_ip_to_destination_geo_ab5e2968
      field: destination.ip
      target_field: destination.geo
      ignore_missing: true
  - geoip:
      tag: geoip_source_ip_to_source_geo_da2e41b2
      field: source.ip
      target_field: source.geo
      ignore_missing: true
  - geoip:
      tag: geoip_source_ip_to_source_as_28d69883
      database_file: GeoLite2-ASN.mmdb
      field: source.ip
      target_field: source.as
      properties:
        - asn
        - organization_name
      ignore_missing: true
  - geoip:
      tag: geoip_destination_ip_to_destination_as_8a007787
      database_file: GeoLite2-ASN.mmdb
      field: destination.ip
      target_field: destination.as
      properties:
        - asn
        - organization_name
      ignore_missing: true
  - rename:
      tag: rename_source_as_asn_to_source_as_number_a917047d
      field: source.as.asn
      target_field: source.as.number
      ignore_missing: true
  - rename:
      tag: rename_source_as_organization_name_to_source_as_organization_name_f1362d0b
      field: source.as.organization_name
      target_field: source.as.organization.name
      ignore_missing: true
  - rename:
      tag: rename_destination_as_asn_to_destination_as_number_3b459fcd
      field: destination.as.asn
      target_field: destination.as.number
      ignore_missing: true
  - rename:
      tag: rename_destination_as_organization_name_to_destination_as_organization_name_814bd459
      field: destination.as.organization_name
      target_field: destination.as.organization.name
      ignore_missing: true
  - remove:
      tag: remove_zeek_ssl_client_cert_chain_fuids_fddcdc08
      field: zeek.ssl.client.cert_chain_fuids
      if: ctx.zeek.ssl.client?.cert_chain_fuids?.length == 0
      ignore_missing: true
  - gsub:
      tag: gsub_zeek_ssl_issuer_e992ff57
      field: zeek.ssl.issuer
      pattern: \\,
      replacement: ""
      ignore_missing: true
  - kv:
      tag: kv_zeek_ssl_issuer_to_zeek_ssl_server_issuer_14120838
      field: zeek.ssl.issuer
      field_split: ","
      value_split: "="
      target_field: zeek.ssl.server.issuer
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_issuer_to_tls_server_issuer_c9eaffbd
      field: zeek.ssl.issuer
      target_field: tls.server.issuer
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_resp_certificate_sha1_to_tls_server_hash_sha1_ed218666
      field: zeek.ssl.resp_certificate_sha1
      target_field: tls.server.hash.sha1
      ignore_missing: true
  - uppercase:
      tag: uppercase_tls_server_hash_sha1_b04b0ad7
      field: tls.server.hash.sha1
      ignore_missing: true
  - set:
      tag: set_tls_server_x509_issuer_country_d3673720
      field: tls.server.x509.issuer.country
      value: ["{{{zeek.ssl.server.issuer.C}}}"]
      if: ctx.zeek?.ssl?.server?.issuer?.C instanceof String
  - rename:
      tag: rename_zeek_ssl_server_issuer_C_to_zeek_ssl_server_issuer_country_2c0aede5
      field: zeek.ssl.server.issuer.C
      target_field: zeek.ssl.server.issuer.country
      ignore_missing: true
  - set:
      tag: set_tls_server_x509_issuer_common_name_0ac7715f
      field: tls.server.x509.issuer.common_name
      value: ["{{{zeek.ssl.server.issuer.CN}}}"]
      if: ctx.zeek?.ssl?.server?.issuer?.CN instanceof String
  - rename:
      tag: rename_zeek_ssl_server_issuer_CN_to_zeek_ssl_server_issuer_common_name_9c19e154
      field: zeek.ssl.server.issuer.CN
      target_field: zeek.ssl.server.issuer.common_name
      ignore_missing: true
  - set:
      tag: set_tls_server_x509_issuer_locality_d89082f1
      field: tls.server.x509.issuer.locality
      value: ["{{{zeek.ssl.server.issuer.L}}}"]
      if: ctx.zeek?.ssl?.server?.issuer?.L instanceof String
  - rename:
      tag: rename_zeek_ssl_server_issuer_L_to_zeek_ssl_server_issuer_locality_a8fe340b
      field: zeek.ssl.server.issuer.L
      target_field: zeek.ssl.server.issuer.locality
      ignore_missing: true
  - set:
      tag: set_tls_server_x509_issuer_organization_c3169a19
      field: tls.server.x509.issuer.organization
      value: ["{{{zeek.ssl.server.issuer.O}}}"]
      if: ctx.zeek?.ssl?.server?.issuer?.O instanceof String
  - rename:
      tag: rename_zeek_ssl_server_issuer_O_to_zeek_ssl_server_issuer_organization_022ad0fc
      field: zeek.ssl.server.issuer.O
      target_field: zeek.ssl.server.issuer.organization
      ignore_missing: true
  - set:
      tag: set_tls_server_x509_issuer_organizational_unit_9e2f0213
      field: tls.server.x509.issuer.organizational_unit
      value: ["{{{zeek.ssl.server.issuer.OU}}}"]
      if: ctx.zeek?.ssl?.server?.issuer?.OU instanceof String
  - rename:
      tag: rename_zeek_ssl_server_issuer_OU_to_zeek_ssl_server_issuer_organizational_unit_4279fe67
      field: zeek.ssl.server.issuer.OU
      target_field: zeek.ssl.server.issuer.organizational_unit
      ignore_missing: true
  - set:
      tag: set_tls_server_x509_issuer_state_or_province_f656ed42
      field: tls.server.x509.issuer.state_or_province
      value: ["{{{zeek.ssl.server.issuer.ST}}}"]
      if: ctx.zeek?.ssl?.server?.issuer?.ST instanceof String
  - rename:
      tag: rename_zeek_ssl_server_issuer_ST_to_zeek_ssl_server_issuer_state_c732835e
      field: zeek.ssl.server.issuer.ST
      target_field: zeek.ssl.server.issuer.state
      ignore_missing: true
  - gsub:
      tag: gsub_zeek_ssl_subject_55de8332
      field: zeek.ssl.subject
      pattern: \\,
      replacement: ""
      ignore_missing: true
  - kv:
      tag: kv_zeek_ssl_subject_to_zeek_ssl_server_subject_c1866c44
      field: zeek.ssl.subject
      field_split: ","
      value_split: "="
      target_field: zeek.ssl.server.subject
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_subject_to_tls_server_subject_aae8c93d
      field: zeek.ssl.subject
      target_field: tls.server.subject
      ignore_missing: true
  - set:
      tag: set_tls_server_x509_subject_country_75f44ca5
      field: tls.server.x509.subject.country
      value: ["{{{zeek.ssl.server.subject.C}}}"]
      if: ctx.zeek?.ssl?.server?.subject?.C instanceof String
  - rename:
      tag: rename_zeek_ssl_server_subject_C_to_zeek_ssl_server_subject_country_20d4db6d
      field: zeek.ssl.server.subject.C
      target_field: zeek.ssl.server.subject.country
      ignore_missing: true
  - set:
      tag: set_tls_server_x509_subject_common_name_6312f06c
      field: tls.server.x509.subject.common_name
      value: ["{{{zeek.ssl.server.subject.CN}}}"]
      if: ctx.zeek?.ssl?.server?.subject?.CN instanceof String
  - rename:
      tag: rename_zeek_ssl_server_subject_CN_to_zeek_ssl_server_subject_common_name_c6002c56
      field: zeek.ssl.server.subject.CN
      target_field: zeek.ssl.server.subject.common_name
      ignore_missing: true
  - set:
      tag: set_tls_server_x509_subject_locality_742f7630
      field: tls.server.x509.subject.locality
      value: ["{{{zeek.ssl.server.subject.L}}}"]
      if: ctx.zeek?.ssl?.server?.subject?.L instanceof String
  - rename:
      tag: rename_zeek_ssl_server_subject_L_to_zeek_ssl_server_subject_locality_b2784909
      field: zeek.ssl.server.subject.L
      target_field: zeek.ssl.server.subject.locality
      ignore_missing: true
  - set:
      tag: set_tls_server_x509_subject_organization_12ae9abe
      field: tls.server.x509.subject.organization
      value: ["{{{zeek.ssl.server.subject.O}}}"]
      if: ctx.zeek?.ssl?.server?.subject?.O instanceof String
  - rename:
      tag: rename_zeek_ssl_server_subject_O_to_zeek_ssl_server_subject_organization_438f5454
      field: zeek.ssl.server.subject.O
      target_field: zeek.ssl.server.subject.organization
      ignore_missing: true
  - set:
      tag: set_tls_server_x509_subject_organizational_unit_ed63af56
      field: tls.server.x509.subject.organizational_unit
      value: ["{{{zeek.ssl.server.subject.OU}}}"]
      if: ctx.zeek?.ssl?.server?.subject?.OU instanceof String
  - rename:
      tag: rename_zeek_ssl_server_subject_OU_to_zeek_ssl_server_subject_organizational_unit_7c8e51cf
      field: zeek.ssl.server.subject.OU
      target_field: zeek.ssl.server.subject.organizational_unit
      ignore_missing: true
  - set:
      tag: set_tls_server_x509_subject_state_or_province_d02b3fed
      field: tls.server.x509.subject.state_or_province
      value: ["{{{zeek.ssl.server.subject.ST}}}"]
      if: ctx.zeek?.ssl?.server?.subject?.ST instanceof String
  - rename:
      tag: rename_zeek_ssl_server_subject_ST_to_zeek_ssl_server_subject_state_452d401c
      field: zeek.ssl.server.subject.ST
      target_field: zeek.ssl.server.subject.state
      ignore_missing: true
  - gsub:
      tag: gsub_zeek_ssl_client_issuer_0eba0d6d
      field: zeek.ssl.client_issuer
      pattern: \\,
      replacement: ""
      ignore_missing: true
  - kv:
      tag: kv_zeek_ssl_client_issuer_to_zeek_ssl_client_issuer_e4784266
      field: zeek.ssl.client_issuer
      field_split: ","
      value_split: "="
      target_field: zeek.ssl.client.issuer
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_client_issuer_to_tls_client_issuer_5e7725c1
      field: zeek.ssl.client_issuer
      target_field: tls.client.issuer
      ignore_missing: true
  - set:
      tag: set_tls_client_x509_issuer_country_89927f1c
      field: tls.client.x509.issuer.country
      value: ["{{{zeek.ssl.client.issuer.C}}}"]
      if: ctx.zeek?.ssl?.client?.issuer?.C instanceof String
  - rename:
      tag: rename_zeek_ssl_client_issuer_C_to_zeek_ssl_client_issuer_country_1e9cd32d
      field: zeek.ssl.client.issuer.C
      target_field: zeek.ssl.client.issuer.country
      ignore_missing: true
  - set:
      tag: set_tls_client_x509_issuer_common_name_ffed7edb
      field: tls.client.x509.issuer.common_name
      value: ["{{{zeek.ssl.client.issuer.CN}}}"]
      if: ctx.zeek?.ssl?.client?.issuer?.CN instanceof String
  - rename:
      tag: rename_zeek_ssl_client_issuer_CN_to_zeek_ssl_client_issuer_common_name_9712d304
      field: zeek.ssl.client.issuer.CN
      target_field: zeek.ssl.client.issuer.common_name
      ignore_missing: true
  - set:
      tag: set_tls_client_x509_issuer_locality_bda95a55
      field: tls.client.x509.issuer.locality
      value: ["{{{zeek.ssl.client.issuer.L}}}"]
      if: ctx.zeek?.ssl?.client?.issuer?.L instanceof String
  - rename:
      tag: rename_zeek_ssl_client_issuer_L_to_zeek_ssl_client_issuer_locality_b9ce4fab
      field: zeek.ssl.client.issuer.L
      target_field: zeek.ssl.client.issuer.locality
      ignore_missing: true
  - set:
      tag: set_tls_client_x509_issuer_organization_d4e32b7d
      field: tls.client.x509.issuer.organization
      value: ["{{{zeek.ssl.client.issuer.O}}}"]
      if: ctx.zeek?.ssl?.client?.issuer?.O instanceof String
  - rename:
      tag: rename_zeek_ssl_client_issuer_O_to_zeek_ssl_client_issuer_organization_8752efc4
      field: zeek.ssl.client.issuer.O
      target_field: zeek.ssl.client.issuer.organization
      ignore_missing: true
  - set:
      tag: set_tls_client_x509_issuer_organizational_unit_34f1a98f
      field: tls.client.x509.issuer.organizational_unit
      value: ["{{{zeek.ssl.client.issuer.OU}}}"]
      if: ctx.zeek?.ssl?.client?.issuer?.OU instanceof String
  - rename:
      tag: rename_zeek_ssl_issuer_subject_OU_to_zeek_ssl_issuer_subject_organizational_unit_1bd2945b
      field: zeek.ssl.issuer.subject.OU
      target_field: zeek.ssl.issuer.subject.organizational_unit
      ignore_missing: true
  - set:
      tag: set_tls_client_x509_issuer_state_or_province_72078606
      field: tls.client.x509.issuer.state_or_province
      value: ["{{{zeek.ssl.client.issuer.ST}}}"]
      if: ctx.zeek?.ssl?.client?.issuer?.ST instanceof String
  - rename:
      tag: rename_zeek_ssl_client_issuer_ST_to_zeek_ssl_client_issuer_state_30bc3ef6
      field: zeek.ssl.client.issuer.ST
      target_field: zeek.ssl.client.issuer.state
      ignore_missing: true
  - gsub:
      tag: gsub_zeek_ssl_client_subject_83c6b1f0
      field: zeek.ssl.client_subject
      pattern: \\,
      replacement: ""
      ignore_missing: true
  - kv:
      tag: kv_zeek_ssl_client_subject_to_zeek_ssl_client_subject_0687e01a
      field: zeek.ssl.client_subject
      field_split: ","
      value_split: "="
      target_field: zeek.ssl.client.subject
      ignore_missing: true
  - remove:
      tag: remove_zeek_ssl_client_subject_94220763
      field: zeek.ssl.client_subject
      ignore_missing: true
  - set:
      tag: set_tls_client_x509_subject_country_2c3d7381
      field: tls.client.x509.subject.country
      value: ["{{{zeek.ssl.client.subject.C}}}"]
      if: ctx.zeek?.ssl?.client?.subject?.C instanceof String
  - rename:
      tag: rename_zeek_ssl_client_subject_C_to_zeek_ssl_client_subject_country_848c13ed
      field: zeek.ssl.client.subject.C
      target_field: zeek.ssl.client.subject.country
      ignore_missing: true
  - set:
      tag: set_tls_client_x509_subject_common_name_536e4198
      field: tls.client.x509.subject.common_name
      value: ["{{{zeek.ssl.client.subject.CN}}}"]
      if: ctx.zeek?.ssl?.client?.subject?.CN instanceof String
  - rename:
      tag: rename_zeek_ssl_client_subject_CN_to_zeek_ssl_client_subject_common_name_803e000e
      field: zeek.ssl.client.subject.CN
      target_field: zeek.ssl.client.subject.common_name
      ignore_missing: true
  - set:
      tag: set_tls_client_x509_subject_locality_597b68bc
      field: tls.client.x509.subject.locality
      value: ["{{{zeek.ssl.client.subject.L}}}"]
      if: ctx.zeek?.ssl?.client?.subject?.L instanceof String
  - rename:
      tag: rename_zeek_ssl_client_subject_L_to_zeek_ssl_client_subject_locality_c92a9321
      field: zeek.ssl.client.subject.L
      target_field: zeek.ssl.client.subject.locality
      ignore_missing: true
  - set:
      tag: set_tls_client_x509_subject_organization_056ba2e2
      field: tls.client.x509.subject.organization
      value: ["{{{zeek.ssl.client.subject.O}}}"]
      if: ctx.zeek?.ssl?.client?.subject?.O instanceof String
  - rename:
      tag: rename_zeek_ssl_client_subject_O_to_zeek_ssl_client_subject_organization_5113c774
      field: zeek.ssl.client.subject.O
      target_field: zeek.ssl.client.subject.organization
      ignore_missing: true
  - set:
      tag: set_tls_client_x509_subject_organizational_unit_30163e82
      field: tls.client.x509.subject.organizational_unit
      value: ["{{{zeek.ssl.client.subject.OU}}}"]
      if: ctx.zeek?.ssl?.client?.subject?.OU instanceof String
  - rename:
      tag: rename_zeek_ssl_client_subject_OU_to_zeek_ssl_client_subject_organizational_unit_09aac317
      field: zeek.ssl.client.subject.OU
      target_field: zeek.ssl.client.subject.organizational_unit
      ignore_missing: true
  - set:
      tag: set_tls_client_x509_subject_state_or_province_3bd70991
      field: tls.client.x509.subject.state_or_province
      value: ["{{{zeek.ssl.client.subject.ST}}}"]
      if: ctx.zeek?.ssl?.client?.subject?.ST instanceof String
  - rename:
      tag: rename_zeek_ssl_client_subject_ST_to_zeek_ssl_client_subject_state_3710e104
      field: zeek.ssl.client.subject.ST
      target_field: zeek.ssl.client.subject.state
      ignore_missing: true
  - set:
      tag: set_tls_cipher_ed1b0773
      field: tls.cipher
      value: "{{{zeek.ssl.cipher}}}"
      if: ctx.zeek?.ssl?.cipher != null
  - set:
      tag: set_tls_curve_8dd65eb1
      field: tls.curve
      value: "{{{zeek.ssl.curve}}}"
      if: ctx.zeek?.ssl?.curve != null
  - convert:
      tag: convert_zeek_ssl_established_to_tls_established_cffff9df
      target_field: tls.established
      field: zeek.ssl.established
      type: boolean
      ignore_missing: true
  - convert:
      tag: convert_zeek_ssl_resumed_to_tls_resumed_b448c671
      target_field: tls.resumed
      field: zeek.ssl.resumed
      type: boolean
      ignore_missing: true
  - script:
      tag: script_b5425ae8
      lang: painless
      if: ctx.zeek?.ssl?.version != null
      source: >-
        def parts = ctx.zeek.ssl.version.splitOnToken("v");
        if (parts.length != 2) {
          return;
        }
        if (parts[0] == "SSL") {
          ctx.tls.version = parts[1] + ".0";
        } else {
          ctx.tls.version = parts[1].substring(0,1) + "." + parts[1].substring(1);
        }
        ctx.tls.version_protocol = parts[0].toLowerCase();
  - rename:
      tag: rename_zeek_ssl_ja3_to_tls_client_ja3_7448e66d
      field: zeek.ssl.ja3
      target_field: tls.client.ja3
      ignore_missing: true
  - rename:
      tag: rename_zeek_ssl_ja3s_to_tls_server_ja3s_716bf205
      field: zeek.ssl.ja3s
      target_field: tls.server.ja3s
      ignore_missing: true
  - append:
      tag: append_related_ip_8121c591
      field: related.ip
      value: "{{{source.ip}}}"
      if: "ctx.source?.ip != null"
      allow_duplicates: false
  - append:
      tag: append_related_ip_c1a6356b
      field: related.ip
      value: "{{{destination.ip}}}"
      if: "ctx.destination?.ip != null"
      allow_duplicates: false
  - append:
      tag: append_related_hash_62160678
      field: related.hash
      value: "{{{tls.server.ja3s}}}"
      if: "ctx.tls?.server?.ja3s != null"
  - append:
      tag: append_related_hash_c186cc1b
      field: related.hash
      value: "{{{tls.client.ja3}}}"
      if: "ctx.tls?.client?.ja3 != null"
      allow_duplicates: false
  - community_id:
      tag: community_id_612651e3
      target_field: network.community_id
  - remove:
      tag: remove_b9073500
      field:
        - zeek.ssl.client
      ignore_missing: true
      if: 'ctx.zeek?.ssl?.client == null || ctx.zeek?.ssl?.client.isEmpty()'
  - remove:
      tag: remove_ddd0b326
      field:
        - zeek.ssl.id
      ignore_missing: true
  - append:
      tag: append_preserve_original_event_on_error
      field: tags
      value: preserve_original_event
      allow_duplicates: false
      if: ctx.error?.message != null
on_failure:
  - set:
      field: event.kind
      value: pipeline_error
  - set:
      field: error.message
      value: >-
        Processor '{{{ _ingest.on_failure_processor_type }}}'
        {{#_ingest.on_failure_processor_tag}}with tag '{{{ _ingest.on_failure_processor_tag }}}'
        {{/_ingest.on_failure_processor_tag}}in pipeline '{{{ _ingest.pipeline }}}'
        failed with message '{{{ _ingest.on_failure_message }}}'
  - append:
      field: tags
      value: preserve_original_event
      allow_duplicates: false
