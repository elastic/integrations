<!-- NOTICE: Do not edit this file manually.-->
<!-- This file is automatically generated by Elastic Package -->
# Bitdefender IntelliZone Integration for Elastic

## Overview
The Bitdefender IntelliZone integration ingests threat intelligence indicators from Bitdefender reputation feeds into Elastic Security.

### Compatibility
This integration requires:
- Elastic Stack `8.13.0` or newer (including `9.x`), with a Basic subscription or above
- A valid Bitdefender IntelliZone API token
- Network access from Elastic Agent to `https://feeds.ti.bitdefender.com/reputation`

### How it works
Each data stream uses the CEL input to poll the Bitdefender API and ingest indicators:
- `ip_reputation`
- `web_reputation`
- `file_reputation`

The integration uses checkpoint-based polling with safety controls:
- Requests are capped at `now - 60s` by default (`safety_lag`) to avoid querying very fresh or future data
- The next run starts from the previous successful checkpoint (`last_success_at`)
- A small overlap (`overlap`, default `120s`) protects against scheduler drift
- API windows are chunked to `1h` by default (`max_window`) for safer retries and lower API load

## What data does this integration collect?
The integration collects threat indicators and normalizes them to ECS `threat.indicator.*` fields.

Collected data includes:
- Network indicators (IPv4/IPv6, confidence, severity, ASN, geo, TTL)
- Web indicators (domain/URL, confidence, countries, categories, popularity, TTL)
- File indicators (SHA256/SHA1/MD5, file metadata, confidence, threat family/name)

### Supported use cases
- Indicator match and enrichment in Elastic Security
- Threat hunting pivoting using `related.ip` and `related.hash`
- IOC lifecycle handling for network indicators via TTL-derived expiration fields

## What do I need to use this integration?
- Bitdefender IntelliZone API token with permission to read reputation feeds
- Elastic Agent policy with connectivity to the Bitdefender API endpoint
- Optional proxy/egress rules if outbound internet access is restricted

## How do I deploy this integration?

### Agent-based deployment

Elastic Agent must be installed. For more details, check the Elastic Agent [installation instructions](docs-content://reference/fleet/install-elastic-agents.md). You can install only one Elastic Agent per host.

Elastic Agent is required to stream data from the syslog or log file receiver and ship the data to Elastic, where the events will then be processed via the integration's ingest pipelines.

### Onboard / configure
1. In Kibana, open **Integrations** and install **Bitdefender Threat Intelligence**.
2. Add the integration to an Elastic Agent policy.
3. Provide the package-level `api_token`.
4. Enable one or more data streams: IP reputation, Web reputation, File reputation.
5. Review stream parameters:
- `interval`: poll frequency
- `initial_lookback`: fetch range used only on first run (default `1h`)
- `safety_lag`: delay from current time (default `60s`)
- `overlap`: checkpoint overlap between runs (default `120s`)
- `max_window`: maximum API interval per request (default `1h`)
- `from_param` / `to_param`: query parameter names for interval bounds (defaults `from` and `to`, sent as UNIX seconds)
6. Save and deploy the policy.

Recommended values:
- Keep `safety_lag` at `60s` or higher
- Keep `max_window` at `1h`
- Keep `overlap` at `120s` unless your scheduler jitter is higher

### Validation
After deployment, verify ingestion in Discover:
- `data_stream.dataset : "bitdefender_ti.ip_reputation"`
- `data_stream.dataset : "bitdefender_ti.file_reputation"`
- `data_stream.dataset : "bitdefender_ti.web_reputation"`

Check expected fields:
- `threat.indicator.type`
- `threat.indicator.confidence`
- `threat.feed.vendor : "Bitdefender"`
- `threat.indicator.id`

For network indicators, also verify:
- `threat.indicator.ttl`
- `threat.indicator.valid_until`

## Troubleshooting

For help with Elastic ingest tools, check [Common problems](https://www.elastic.co/docs/troubleshoot/ingest/fleet/common-problems).

Common issues:
- `HTTP 400 BAD REQUEST`: time interval may include future timestamps; increase `safety_lag`
- Missing newest indicators: increase `safety_lag` and keep checkpoint overlap enabled
- Slow or heavy requests: reduce `max_window` or increase `interval`
- Duplicate-looking events: expected in overlap windows; stable `threat.indicator.id` supports dedup-friendly analysis

## Scaling

For more information on architectures that can be used for scaling this integration, check the [Ingest Architectures](https://www.elastic.co/docs/manage-data/ingest/ingest-reference-architectures) documentation.

Operational guidance:
- Prefer shorter request windows (`1h`) instead of very large windows (`24h`)
- Spread polling intervals across agents to avoid synchronized API bursts
- Use ILM/data retention aligned with indicator lifetime and use case

## Reference
### IP reputation

The `ip_reputation` data stream provides network IOC reputation indicators.

#### IP reputation fields
**Exported fields**

| Field | Description | Type |
|---|---|---|
| @timestamp | Event timestamp | date |
| bitdefender.confidence_score | Raw vendor confidence score (0-100) | long |
| data_stream.dataset | Data stream dataset | constant_keyword |
| data_stream.namespace | Data stream namespace | constant_keyword |
| data_stream.type | Data stream type | constant_keyword |
| event.category | Event category (threat) | keyword |
| event.dataset | Event dataset | keyword |
| event.kind | Event kind (enrichment) | keyword |
| event.module | Event module | keyword |
| event.type | Event type (indicator) | keyword |
| first_seen | Vendor first_seen (unix seconds) | long |
| related.ip | Related IP addresses for correlation | ip |
| tags | Vendor-provided tags describing the indicator | keyword |
| threat.feed.name | Threat intelligence feed name | keyword |
| threat.feed.vendor | Threat intelligence feed vendor | keyword |
| threat.indicator.as.number | Autonomous System number | long |
| threat.indicator.as.organization.name | Autonomous System organization name | keyword |
| threat.indicator.cidr | CIDR range associated with the indicator | keyword |
| threat.indicator.confidence | Confidence label of the indicator (low, medium, high) | keyword |
| threat.indicator.description | Analyst-friendly indicator context | text |
| threat.indicator.first_seen | First time the indicator was observed | date |
| threat.indicator.geo.country_iso_code | Country ISO code | keyword |
| threat.indicator.geo.location | Geographic location of the indicator | geo_point |
| threat.indicator.id | Stable identifier for deduplication and aggregation | keyword |
| threat.indicator.ip | IP address indicator | ip |
| threat.indicator.last_seen | Last time the indicator was observed | date |
| threat.indicator.provider | Indicator provider name | keyword |
| threat.indicator.reference | Provider reference for the indicator | keyword |
| threat.indicator.severity | Severity score of the indicator | long |
| threat.indicator.ttl | Time-to-live for the indicator in seconds | long |
| threat.indicator.type | Indicator type (ipv4-addr or ipv6-addr) | keyword |
| threat.indicator.valid_until | Expiration timestamp derived from first_seen or @timestamp plus TTL | date |
| timestamp | Vendor timestamp (unix seconds) | long |
| type | Vendor indicator type | keyword |


### Web reputation

The `web_reputation` data stream provides domain and URL IOC reputation indicators.

#### Web reputation fields
**Exported fields**

| Field | Description | Type |
|---|---|---|
| @timestamp | Event timestamp | date |
| bitdefender.confidence_score | Raw vendor confidence score (0-100) | long |
| bitdefender.popularity | Popularity score of the indicator (1-5) | long |
| bitdefender.tags | Vendor tags preserved before normalization into tags | keyword |
| bitdefender.threat_types | Threat types associated with the indicator | keyword |
| bitdefender.web_content_categories | Web content categories assigned to the indicator | keyword |
| data_stream.dataset | Data stream dataset | constant_keyword |
| data_stream.namespace | Data stream namespace | constant_keyword |
| data_stream.type | Data stream type | constant_keyword |
| event.category | Event category (threat) | keyword |
| event.dataset | Event dataset | keyword |
| event.kind | Event kind (enrichment) | keyword |
| event.module | Event module | keyword |
| event.type | Event type (indicator) | keyword |
| first_seen | Vendor first_seen (unix seconds) | long |
| related.ip | Related hosting IPs for correlation | ip |
| tags | Tags describing the indicator | keyword |
| threat.feed.name | Threat intelligence feed name | keyword |
| threat.feed.vendor | Threat intelligence feed vendor | keyword |
| threat.indicator.confidence | Confidence label of the indicator (low, medium, high) | keyword |
| threat.indicator.description | Analyst-friendly indicator context | text |
| threat.indicator.first_seen | First time the indicator was observed | date |
| threat.indicator.geo.country_iso_code | Country ISO codes associated with the indicator | keyword |
| threat.indicator.id | Stable identifier for the indicator | keyword |
| threat.indicator.last_seen | Last time the indicator was observed | date |
| threat.indicator.name | Display name of the indicator | keyword |
| threat.indicator.provider | Indicator provider name | keyword |
| threat.indicator.reference | Provider reference for the indicator | keyword |
| threat.indicator.ttl | Time-to-live for the indicator in seconds | long |
| threat.indicator.type | Indicator type (domain-name or url) | keyword |
| threat.indicator.url.domain | Domain value of the indicator | keyword |
| threat.indicator.valid_until | Expiration timestamp derived from first_seen or @timestamp plus TTL | date |
| timestamp | Vendor timestamp (unix seconds) | long |
| type | Vendor indicator type | keyword |


### File reputation

The `file_reputation` data stream provides malicious file hash reputation indicators.

#### File reputation fields
**Exported fields**

| Field | Description | Type |
|---|---|---|
| @timestamp | Event timestamp | date |
| TTL | Recommended validity of the verdict in seconds | long |
| bitdefender.confidence_score | Raw vendor confidence score (0-100) | long |
| data_stream.dataset | Data stream dataset | constant_keyword |
| data_stream.namespace | Data stream namespace | constant_keyword |
| data_stream.type | Data stream type | constant_keyword |
| event.category | Event category (threat) | keyword |
| event.dataset | Event dataset | keyword |
| event.kind | Event kind (enrichment) | keyword |
| event.module | Event module | keyword |
| event.type | Event type (indicator) | keyword |
| file_format | Vendor file format string | keyword |
| file_names | Vendor file names | keyword |
| file_size | Vendor file size | long |
| first_seen | Vendor first_seen (unix seconds) | long |
| md5 | Vendor md5 | keyword |
| popularity | Prevalence score (1-5) | long |
| related.hash | Related hashes for correlation | keyword |
| sha1 | Vendor sha1 | keyword |
| sha256 | Vendor sha256 | keyword |
| threat.feed.name | Threat intelligence feed name | keyword |
| threat.feed.vendor | Threat intelligence feed vendor | keyword |
| threat.indicator.confidence | Confidence label of the indicator (low, medium, high) | keyword |
| threat.indicator.description | Analyst-friendly indicator context | text |
| threat.indicator.family | Malware family | keyword |
| threat.indicator.file.hash.md5 | MD5 file hash | keyword |
| threat.indicator.file.hash.sha1 | SHA1 file hash | keyword |
| threat.indicator.file.hash.sha256 | SHA256 file hash | keyword |
| threat.indicator.file.mime_type | File format / mime-like string from Bitdefender | keyword |
| threat.indicator.file.name | Observed file names | keyword |
| threat.indicator.file.size | File size in bytes | long |
| threat.indicator.first_seen | First time the indicator was observed | date |
| threat.indicator.id | Stable identifier for deduplication and aggregation | keyword |
| threat.indicator.last_seen | Last time the indicator was observed | date |
| threat.indicator.name | Malware/threat name | keyword |
| threat.indicator.provider | Indicator provider name | keyword |
| threat.indicator.reference | Provider reference for the indicator | keyword |
| threat.indicator.type | Indicator type (file) | keyword |
| threat_family | Vendor threat family | keyword |
| threat_name | Vendor threat name | keyword |
| timestamp | Vendor timestamp (unix seconds) | long |


### Inputs used
These inputs can be used with this integration:
<details>
<summary>cel</summary>

## Setup

For more details about the CEL input settings, check the [Filebeat documentation](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-input-cel.html).

Before configuring the CEL input, make sure you have:
- Network connectivity to the target API endpoint
- Valid authentication credentials (API keys, tokens, or certificates as required)
- Appropriate permissions to read from the target data source

### Collecting logs from CEL

To configure the CEL input, you must specify the `request.url` value pointing to the API endpoint. The interval parameter controls how frequently requests are made and is the primary way to balance data freshness with API rate limits and costs. Authentication is often configured through the `request.headers` section using the appropriate method for the service.

NOTE: To access the API service, make sure you have the necessary API credentials and that the Filebeat instance can reach the endpoint URL. Some services may require IP whitelisting or VPN access.

To collect logs via API endpoint, configure the following parameters:

- API Endpoint URL
- API credentials (tokens, keys, or username/password)
- Request interval (how often to fetch data)
</details>


### API usage
The integration queries:
- `GET https://feeds.ti.bitdefender.com/reputation`

Query parameters used:
- `feed_name` (`ip-feed`, `web-feed`, `file-feed`)
- Time window parameters (`from`, `to` by default, configurable; sent as UNIX seconds)
