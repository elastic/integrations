metricsets: ["query"]
# Specify hosts in the below format. TODO: hosts need to be updated to support multiple entries.
hosts: 
  - sqlserver://{{username}}:{{password}}@{{hosts}}
period: {{period}}
raw_data.enabled: true
merge_results: false
driver: "mssql"
sql_queries:
    - query: "SELECT
    @@servername AS server_name,
    ag.name AS name,
    CONVERT(NVARCHAR(36), ag.group_id) AS group_id,
    ar.replica_server_name,
    DB_NAME(drs.database_id) AS database_name,
    drs.is_primary_replica,
    drs.synchronization_state,
    drs.synchronization_state_desc,
    drs.synchronization_health,
    drs.synchronization_health_desc,
    drs.is_suspended,
    drs.log_send_queue_size AS log_send_queue_kb,
    drs.log_send_rate AS log_send_rate_kbps,
    drs.redo_queue_size AS redo_queue_kb,
    drs.redo_rate AS redo_rate_kbps,
    drs.secondary_lag_seconds,
    drs.last_commit_time
FROM sys.dm_hadr_database_replica_states drs
JOIN sys.availability_replicas ar ON drs.replica_id = ar.replica_id
JOIN sys.availability_groups ag ON ar.group_id = ag.group_id;"
    response_format: table
{{#if processors}}
processors:
{{processors}}
{{/if}}
tags:
{{#if preserve_sql_queries}}
- preserve_sql_queries
{{/if}}