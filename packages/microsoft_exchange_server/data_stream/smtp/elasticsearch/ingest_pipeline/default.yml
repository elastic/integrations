---
description: Pipeline for processing Exchange Server SMTP Logs
processors:
- drop:
    if: "ctx.message =~ /^[^0-9]/ || ctx.message =~ /^#/"
- set:
    field: event.original
    value: "{{{message}}}"
- csv:
    field: event.original
    ignore_failure: true
    ignore_missing: true
    target_fields:
    - microsoft.exchange.datetime
    - microsoft.exchange.connectorid
    - microsoft.exchange.sessionid
    - microsoft.exchange.sequencenumber
    - microsoft.exchange.localendpoint
    - microsoft.exchange.remoteendpoint
    - microsoft.exchange.event
    - microsoft.exchange.data
    - microsoft.exchange.context
- set:
    field: "@timestamp"
    value: "{{{microsoft.exchange.datetime}}}"
    if: ctx.microsoft?.exchange?.datetime =~ /^\d/
    ignore_empty_value: true
    ignore_failure: true
- set:
    field: microsoft.exchange.logtype
    if: ctx.log?.file?.path =~ /SmtpSend/
    value: smtpsend
    ignore_empty_value: true
    ignore_failure: true
- set:
    field: microsoft.exchange.logtype
    if: ctx.log?.file?.path =~ /SmtpReceive/
    value: smtpreceive
    ignore_empty_value: true
    ignore_failure: true
- convert:
    field: microsoft.exchange.sequencenumber
    type: long
    ignore_failure: true
- set:
    field: event.ingested
    value: "{{{_ingest.timestamp}}}"
    ignore_failure: true
