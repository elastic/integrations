{
    "id": "aws-bedrock-agentcore-identity-token-fetch-failures",
    "type": "alerting_rule_template",
    "attributes": {
      "name": "[AWS Bedrock AgentCore] Identity token fetch failures",
      "tags": ["AWS", "Amazon Bedrock AgentCore", "Identity"],
      "ruleTypeId": ".es-query",
      "schedule": {
        "interval": "5m"
      },
      "params": {
        "searchType": "esqlQuery",
        "timeWindowSize": 5,
        "timeWindowUnit": "m",
        "esqlQuery": {
          "esql": "// Alert triggers when token fetch failures occur in AWS Bedrock AgentCore Identity operations.\n//\n// Identity service manages authentication and authorization for agents, including:\n// - WorkloadAccessTokenFetch: Fetching tokens for workload identities\n// - ResourceAccessTokenFetch: Fetching tokens for resource access (OAuth2)\n//\n// Token fetch failures indicate authentication issues that can prevent agents from\n// accessing protected resources and downstream services. Common causes include:\n// - Expired or invalid credentials\n// - Network connectivity issues to identity providers\n// - Misconfigured authentication settings\n// - Rate limiting from identity providers\n//\n// The alert is grouped by cloud account and region to identify affected environments.\n//\n// To reduce alert noise, increase the threshold (e.g., `total_failures > 5`) to only\n// alert on sustained failure patterns rather than transient authentication issues.\n// For more details, see: https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/identity.html\n\nFROM metrics-aws_bedrock_agentcore.metrics-*\n| STATS workload_failures = sum(aws.bedrock_agentcore.metrics.WorkloadAccessTokenFetchFailures.sum), resource_failures = sum(aws.bedrock_agentcore.metrics.ResourceAccessTokenFetchFailures.sum) BY cloud.account.id, cloud.region\n| EVAL total_failures = COALESCE(workload_failures, TO_LONG(0)) + COALESCE(resource_failures, TO_LONG(0))\n| WHERE total_failures > 0"
        },
        "groupBy": "row",
        "timeField": "event.ingested"
      },
      "alertDelay": {
        "active": 1
      }
    },
    "managed": true,
    "coreMigrationVersion": "8.8.0",
    "typeMigrationVersion": "10.1.0"
  }






