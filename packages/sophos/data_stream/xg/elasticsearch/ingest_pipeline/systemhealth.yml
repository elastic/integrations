---
description: Pipeline for parsing sophos firewall logs (systemhealth pipeline)
processors:
#######################
## ECS Event Mapping ##
#######################
- set:
    tag: set_event_kind_de80643c
    field: event.kind
    value: event
- rename:
    tag: rename_sophos_xg_idle_to_sophos_xg_idle_cpu_7f46a673
    field: sophos.xg.idle
    target_field: sophos.xg.idle_cpu
    ignore_missing: true
- gsub:
    tag: gsub_sophos_xg_idle_cpu_becda5df
    field: sophos.xg.idle_cpu
    pattern: "%$"
    replacement: ""
    ignore_missing: true
    ignore_failure: true
- convert:
    tag: convert_sophos_xg_idle_cpu_db95818d
    field: sophos.xg.idle_cpu
    type: float
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_idle_cpu_3be39495
          field: sophos.xg.idle_cpu
- rename:
    tag: rename_sophos_xg_system_to_sophos_xg_system_cpu_1882b197
    field: sophos.xg.system
    target_field: sophos.xg.system_cpu
    ignore_missing: true
- gsub:
    tag: gsub_sophos_xg_system_cpu_7eb32816
    field: sophos.xg.system_cpu
    pattern: "%$"
    replacement: ""
    ignore_missing: true
    ignore_failure: true
- convert:
    tag: convert_sophos_xg_system_cpu_ec01adad
    field: sophos.xg.system_cpu
    type: float
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_system_cpu_b86fa720
          field: sophos.xg.system_cpu
- rename:
    tag: rename_sophos_xg_user_to_sophos_xg_user_cpu_9524423b
    field: sophos.xg.user
    target_field: sophos.xg.user_cpu
    ignore_missing: true
- gsub:
    tag: gsub_sophos_xg_user_cpu_17d75550
    field: sophos.xg.user_cpu
    pattern: "%$"
    replacement: ""
    ignore_missing: true
    ignore_failure: true
- convert:
    tag: convert_sophos_xg_user_cpu_c2564909
    field: sophos.xg.user_cpu
    type: float
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_user_cpu_3dcf95f2
          field: sophos.xg.user_cpu
- convert:
    tag: convert_sophos_xg_used_8dbe6b69
    field: sophos.xg.used
    type: integer
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_used_fdb59023
          field: sophos.xg.used
- convert:
    tag: convert_sophos_xg_total_memory_e8eb0879
    field: sophos.xg.total_memory
    type: integer
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_total_memory_3d888f40
          field: sophos.xg.total_memory
- convert:
    tag: convert_sophos_xg_free_6cba3b75
    field: sophos.xg.free
    type: integer
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_free_2d67295a
          field: sophos.xg.free
- gsub:
    tag: gsub_sophos_xg_configuration_31bfa46a
    field: sophos.xg.configuration
    pattern: "%$"
    replacement: ""
    ignore_missing: true
    ignore_failure: true
- convert:
    tag: convert_sophos_xg_configuration_e9a7a27f
    field: sophos.xg.configuration
    type: float
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_26779714
          field:
            - sophos.xg.configuration

- gsub:
    tag: gsub_sophos_xg_reports_c4cf069d
    field: sophos.xg.reports
    pattern: "%$"
    replacement: ""
    ignore_missing: true
    ignore_failure: true
- convert:
    tag: convert_sophos_xg_reports_1dfbe06d
    field: sophos.xg.reports
    type: float
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_reports_3325be3d
          field: sophos.xg.reports
- gsub:
    tag: gsub_sophos_xg_temp_43722f3c
    field: sophos.xg.temp
    pattern: "%$"
    replacement: ""
    ignore_missing: true
    ignore_failure: true
- convert:
    tag: convert_sophos_xg_temp_9bb56e85
    field: sophos.xg.temp
    type: float
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_temp_357135ce
          field: sophos.xg.temp
- gsub:
    tag: gsub_sophos_xg_signature_d8eedd06
    field: sophos.xg.signature
    pattern: "%$"
    replacement: ""
    ignore_missing: true
    ignore_failure: true
- convert:
    tag: convert_sophos_xg_signature_f1ca0097
    field: sophos.xg.signature
    type: float
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_signature_dd1b3ddc
          field: sophos.xg.signature
- convert:
    tag: convert_sophos_xg_users_389670cf
    field: sophos.xg.users
    type: integer
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_users_aac7f10a
          field: sophos.xg.users
- convert:
    tag: convert_sophos_xg_transmittedkbits_01bd9d3d
    field: sophos.xg.transmittedkbits
    type: float
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_transmittedkbits_3eb280da
          field: sophos.xg.transmittedkbits
- convert:
    tag: convert_sophos_xg_receivedkbits_0f95c677
    field: sophos.xg.receivedkbits
    type: float
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_receivedkbits_1816cff6
          field: sophos.xg.receivedkbits
- convert:
    tag: convert_sophos_xg_collisions_68b4412d
    field: sophos.xg.collisions
    type: float
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_collisions_314d642f
          field: sophos.xg.collisions
- convert:
    tag: convert_sophos_xg_receiveddrops_50710095
    field: sophos.xg.receiveddrops
    type: float
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_receiveddrops_c125265d
          field: sophos.xg.receiveddrops
- convert:
    tag: convert_sophos_xg_transmitteddrops_c502223d
    field: sophos.xg.transmitteddrops
    type: float
    ignore_missing: true
    on_failure:
      - remove:
          tag: remove_sophos_xg_transmitteddrops_ae60073b
          field: sophos.xg.transmitteddrops

on_failure:
- set:
    field: event.kind
    value: pipeline_error
- append:
    field: error.message
    value: >-
      Processor '{{{ _ingest.on_failure_processor_type }}}'
      {{#_ingest.on_failure_processor_tag}}with tag '{{{ _ingest.on_failure_processor_tag }}}'
      {{/_ingest.on_failure_processor_tag}}in pipeline '{{{ _ingest.pipeline }}}'
      failed with message '{{{ _ingest.on_failure_message }}}'
- append:
    field: tags
    value: preserve_original_event
    allow_duplicates: false
