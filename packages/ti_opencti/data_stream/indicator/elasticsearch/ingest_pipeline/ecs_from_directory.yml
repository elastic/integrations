---
description: Build ECS fields from an OpenCTI directory observable
processors:

  - set:
      field: _tmp_file.accessed
      value: "{{{_ingest._value.atime}}}"
      ignore_empty_value: true

  - set:
      field: _tmp_file.created
      value: "{{{_ingest._value.ctime}}}"
      ignore_empty_value: true

  - set:
      field: _tmp_file.mtime
      value: "{{{_ingest._value.mtime}}}"
      ignore_empty_value: true

  - append:
      field: _tmp_file.path
      value: "{{{_ingest._value.path}}}"
      allow_duplicates: false

  - set:
      field: _tmp_file.type
      value: "dir"
      ignore_empty_value: true

  # append object
  - script:
      description: Append to the destination
      lang: painless
      source: |
        if (ctx.threat == null) {
          ctx.threat = [:];
        }
        if (ctx.threat.indicator == null) {
          ctx.threat.indicator = [:];
        }
        if (ctx.threat.indicator.file == null) {
          ctx.threat.indicator.file = [];
        }
        ctx.threat.indicator.file.add(ctx._tmp_file);

  - remove:
      field: _tmp_file
