---
description: Build ECS fields from an OpenCTI windows registry value type observable
processors:

  - set:
      field: _tmp_registry.value
      value: "{{{_ingest._value.name}}}"

  - set:
      field: _tmp_registry.data.type
      value: "{{{_ingest._value.data_type}}}"

  - append:
      field: _tmp_registry.data.strings
      value: "{{{_ingest._value.data}}}"

  # append object
  - script:
      description: Append to the destination
      lang: painless
      source: |
        if (ctx.threat == null) {
          ctx.threat = [:];
        }
        if (ctx.threat.indicator == null) {
          ctx.threat.indicator = [:];
        }
        if (ctx.threat.indicator.registry == null) {
          ctx.threat.indicator.registry = [];
        }
        ctx.threat.indicator.registry.add(ctx._tmp_registry);

  - remove:
      field: _tmp_registry
