---
description: Pipeline for Barracuda Cloudgen Firewall Web Messages logs
processors:
    - date:
        field: json.timestamp
        target_field: '@timestamp'
        formats:
          - UNIX_MS
    - rename:
        field: json.source_ip
        target_field: source.address
        ignore_missing: true
    - convert:
        field: json.source_port
        target_field: source.port
        type: long
        ignore_missing: true
    - set:
        field: source.ip
        value: "{{source.address}}"
        ignore_empty_value: true
    - rename:
        field: json.destination_ip
        target_field: destination.address
        ignore_missing: true
    - convert:
        field: json.destination_port
        target_field: destination.port
        type: long
        ignore_missing: true
    - set:
        field: destination.ip
        value: "{{destination.address}}"
        ignore_empty_value: true
    - rename:
        field: json.method
        target_field: http.request.method
        ignore_missing: true
    - convert:
        field: json.status_code
        target_field: http.response.status_code
        type: long
        ignore_missing: true
    - user_agent:
        field: json.user_agent
        ignore_missing: true
    - rename:
        field: json.content_type
        target_field: http.request.mime_type
        ignore_missing: true
    - uri_parts:
        field: json.name
        ignore_failure: true
    - rename:
        field: json.domain
        target_field: http.request.referrer
        ignore_missing: true
        if: ctx.json?.domain != null && ctx.json?.domain != "" && (/^https?:\/\/.*$/.matcher(ctx.json?.domain)).matches()
    - set:
        field: url.domain
        value: "{{destination.domain}}"
        if: ctx.url?.domain == null && ctx.destination?.domain != null
    - convert:
        field: json.size
        target_field: http.response.body.bytes
        type: long
        ignore_missing: true
    - rename:
        field: json.user
        target_field: user.name
        ignore_missing: true
        if: ctx.json?.user != null && ctx.json?.user_type == 1
    - rename:
        field: json.fw_rule
        target_field: rule.name
        ignore_missing: true
    - rename:
        field: json.app_rule
        target_field: barracuda_cloudgen_firewall.log.app_rule
        ignore_missing: true
    - set:
        field: event.kind
        value: event
    - append:
        field: event.category
        value: network
        allow_duplicates: false
    - append:
        field: event.type
        value: denied
        allow_duplicates: false
        if: ctx?.event.action == '1'
    - append:
        field: event.type
        value: allowed
        allow_duplicates: false
        if: ctx?.event.action == '0'
on_failure:
  - append:
      field: error.message
      value: '{{ _ingest.on_failure_message }}'