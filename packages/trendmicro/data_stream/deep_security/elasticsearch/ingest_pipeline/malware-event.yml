---
description: Pipeline for processing Anti-Malware event logs
processors:
  - set:
      field: trendmicro.deep_security.event_category
      tag: set_deep_security_event_category
      value: anti-malware-event
  - script:
      lang: painless
      tag: script_to_set_ecs_categorization_in_malware_pipeline
      description: Script to set ECS categorizations.
      if: ctx.trendmicro?.deep_security?.signature_id != null
      source: >-
        def signatureIds = [4000000L, 4000001L, 4000002L, 4000003L, 4000010L, 4000011L, 4000012L, 4000013L, 4000020L, 4000030L];
        if (signatureIds.contains(ctx.trendmicro.deep_security.signature_id)) {
          ctx.event.category = ["malware"];
          ctx.event.kind = "alert";
          ctx.event.type = ["info"];
        }
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
on_failure:
  - append:
      field: error.message
      value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - set:
      field: event.kind
      value: pipeline_error
