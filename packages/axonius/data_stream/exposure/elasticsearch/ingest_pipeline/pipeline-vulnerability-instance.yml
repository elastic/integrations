---
description: Pipeline for processing vulnerability instance logs.
processors:
  - rename:
      field: json.event.associated_adapter_plugin_name
      tag: rename_event_associated_adapter_plugin_name
      target_field: axonius.exposure.event.associated_adapter_plugin_name
      ignore_missing: true
  - rename:
      field: json.event.association_type
      tag: rename_event_association_type
      target_field: axonius.exposure.event.association_type
      ignore_missing: true
  - rename:
      field: json.event.data.associated_asset_type
      tag: rename_event_data_associated_asset_type
      target_field: axonius.exposure.event.data.associated_asset_type
      ignore_missing: true
  - rename:
      field: json.event.data.associated_asset_type_name
      tag: rename_event_data_associated_asset_type_name
      target_field: axonius.exposure.event.data.associated_asset_type_name
      ignore_missing: true
  - date:
      field: json.event.data.axonius_remediation_date
      tag: date_event_data_axonius_remediation_date
      target_field: axonius.exposure.event.data.axonius_remediation_date
      formats:
        - EEE, dd MMM yyyy HH:mm:ss 'GMT'
        - yyyy-MM-dd
        - EEE,dd MMM yyyy HH:mm:ss 'GMT'
      if: ctx.json?.event?.data?.axonius_remediation_date != null && ctx.json.event.data.axonius_remediation_date != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.event.data.axonius_risk_score
      tag: convert_event_data_axonius_risk_score_to_double
      target_field: axonius.exposure.event.data.axonius_risk_score
      type: double
      ignore_missing: true
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - set:
      field: event.risk_score
      tag: set_event_risk_score_from_exposure_event_data_axonius_risk_score
      copy_from: axonius.exposure.event.data.axonius_risk_score
      ignore_empty_value: true
  - rename:
      field: json.event.data.axonius_status
      tag: rename_event_data_axonius_status
      target_field: axonius.exposure.event.data.axonius_status
      ignore_missing: true
  - date:
      field: json.event.data.axonius_status_last_update
      tag: date_event_data_axonius_status_last_update
      target_field: axonius.exposure.event.data.axonius_status_last_update
      formats:
        - EEE, dd MMM yyyy HH:mm:ss 'GMT'
        - yyyy-MM-dd
        - EEE,dd MMM yyyy HH:mm:ss 'GMT'
      if: ctx.json?.event?.data?.axonius_status_last_update != null && ctx.json.event.data.axonius_status_last_update != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.event.data.cisa.action
      tag: rename_event_data_cisa_action
      target_field: axonius.exposure.event.data.cisa.action
      ignore_missing: true
  - date:
      field: json.event.data.cisa.added
      tag: date_event_data_cisa_added
      target_field: axonius.exposure.event.data.cisa.added
      formats:
        - EEE, dd MMM yyyy HH:mm:ss 'GMT'
        - yyyy-MM-dd
        - EEE,dd MMM yyyy HH:mm:ss 'GMT'
      if: ctx.json?.event?.data?.cisa?.added != null && ctx.json.event.data.cisa.added != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.event.data.cisa.cve_id
      tag: rename_event_data_cisa_cve_id
      target_field: axonius.exposure.event.data.cisa.cve_id
      ignore_missing: true
  - append:
      field: vulnerability.id
      tag: append_axonius_exposure_event_data_cisa_cve_id_into_vulnerability_id
      value: '{{{axonius.exposure.event.data.cisa.cve_id}}}'
      allow_duplicates: false
      if: ctx.axonius?.exposure?.event?.data?.cisa?.cve_id != null
  - rename:
      field: json.event.data.cisa.desc
      tag: rename_event_data_cisa_desc
      target_field: axonius.exposure.event.data.cisa.desc
      ignore_missing: true
  - append:
      field: vulnerability.description
      tag: append_axonius_exposure_event_data_cisa_desc_into_vulnerability_description
      value: '{{{axonius.exposure.event.data.cisa.desc}}}'
      allow_duplicates: false
      if: ctx.axonius?.exposure?.event?.data?.cisa?.desc != null
  - date:
      field: json.event.data.cisa.due_date
      tag: date_event_data_cisa_due_date
      target_field: axonius.exposure.event.data.cisa.due_date
      formats:
        - EEE, dd MMM yyyy HH:mm:ss 'GMT'
        - yyyy-MM-dd
        - EEE,dd MMM yyyy HH:mm:ss 'GMT'
      if: ctx.json?.event?.data?.cisa?.due_date != null && ctx.json.event.data.cisa.due_date != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.event.data.cisa.notes
      tag: rename_event_data_cisa_notes
      target_field: axonius.exposure.event.data.cisa.notes
      ignore_missing: true
  - rename:
      field: json.event.data.cisa.product
      tag: rename_event_data_cisa_product
      target_field: axonius.exposure.event.data.cisa.product
      ignore_missing: true
  - convert:
      field: json.event.data.cisa.used_in_ransomware
      tag: convert_event_data_cisa_used_in_ransomware_to_boolean
      target_field: axonius.exposure.event.data.cisa.used_in_ransomware
      type: boolean
      ignore_missing: true
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.event.data.cisa.vendor
      tag: rename_event_data_cisa_vendor
      target_field: axonius.exposure.event.data.cisa.vendor
      ignore_missing: true
  - rename:
      field: json.event.data.cisa.vulnerability_name
      tag: rename_event_data_cisa_vulnerability_name
      target_field: axonius.exposure.event.data.cisa.vulnerability_name
      ignore_missing: true
  - rename:
      field: json.event.data.custom_business_unit
      tag: rename_event_data_custom_business_unit
      target_field: axonius.exposure.event.data.custom_business_unit
      ignore_missing: true
  - rename:
      field: json.event.data.cve_from_sw_analysis
      tag: rename_event_data_cve_from_sw_analysis
      target_field: axonius.exposure.event.data.cve_from_sw_analysis
      ignore_missing: true
  - rename:
      field: json.event.data.device_internal_axon_id
      tag: rename_event_data_device_internal_axon_id
      target_field: axonius.exposure.event.data.device_internal_axon_id
      ignore_missing: true
  - date:
      field: json.event.data.epss.creation_date
      tag: date_event_data_epss_creation_date
      target_field: axonius.exposure.event.data.epss.creation_date
      formats:
        - EEE, dd MMM yyyy HH:mm:ss 'GMT'
        - yyyy-MM-dd
        - EEE,dd MMM yyyy HH:mm:ss 'GMT'
      if: ctx.json?.event?.data?.epss?.creation_date != null && ctx.json.event.data.epss.creation_date != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.event.data.epss.cve_id
      tag: rename_event_data_epss_cve_id
      target_field: axonius.exposure.event.data.epss.cve_id
      ignore_missing: true
  - append:
      field: vulnerability.id
      tag: append_axonius_exposure_event_data_epss_cve_id_into_vulnerability_id
      value: '{{{axonius.exposure.event.data.epss.cve_id}}}'
      allow_duplicates: false
      if: ctx.axonius?.exposure?.event?.data?.epss?.cve_id != null
  - convert:
      field: json.event.data.epss.percentile
      tag: convert_event_data_epss_percentile_to_double
      target_field: axonius.exposure.event.data.epss.percentile
      type: double
      ignore_missing: true
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.event.data.epss.score
      tag: convert_event_data_epss_score_to_double
      target_field: axonius.exposure.event.data.epss.score
      type: double
      ignore_missing: true
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - date:
      field: json.event.data.first_fetch_time
      tag: date_event_data_first_fetch_time
      target_field: axonius.exposure.event.data.first_fetch_time
      formats:
        - EEE, dd MMM yyyy HH:mm:ss 'GMT'
        - yyyy-MM-dd
        - EEE,dd MMM yyyy HH:mm:ss 'GMT'
      if: ctx.json?.event?.data?.first_fetch_time != null && ctx.json.event.data.first_fetch_time != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - date:
      field: json.event.data.last_fetch_time
      tag: date_event_data_last_fetch_time
      target_field: axonius.exposure.event.data.last_fetch_time
      formats:
        - EEE, dd MMM yyyy HH:mm:ss 'GMT'
        - yyyy-MM-dd
        - EEE,dd MMM yyyy HH:mm:ss 'GMT'
      if: ctx.json?.event?.data?.last_fetch_time != null && ctx.json.event.data.last_fetch_time != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.event.data.mitigated
      tag: convert_event_data_mitigated_to_boolean
      target_field: axonius.exposure.event.data.mitigated
      type: boolean
      ignore_missing: true
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - date:
      field: json.event.data.msrc.creation_date
      tag: date_event_data_msrc_creation_date
      target_field: axonius.exposure.event.data.msrc.creation_date
      formats:
        - EEE, dd MMM yyyy HH:mm:ss 'GMT'
        - yyyy-MM-dd
        - EEE,dd MMM yyyy HH:mm:ss 'GMT'
      if: ctx.json?.event?.data?.msrc?.creation_date != null && ctx.json.event.data.msrc.creation_date != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.on_failure_pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.event.data.msrc.cve_id
      tag: rename_event_data_msrc_cve_id
      target_field: axonius.exposure.event.data.msrc.cve_id
      ignore_missing: true
  - append:
      field: vulnerability.id
      tag: append_axonius_exposure_event_data_msrc_cve_id_into_vulnerability_id
      value: '{{{axonius.exposure.event.data.msrc.cve_id}}}'
      allow_duplicates: false
      if: ctx.axonius?.exposure?.event?.data?.msrc?.cve_id != null
  - rename:
      field: json.event.data.msrc.title
      tag: rename_event_data_msrc_title
      target_field: axonius.exposure.event.data.msrc.title
      ignore_missing: true
  - rename:
      field: json.event.data.msrc_remediations.supercedence
      tag: rename_event_data_msrc_remediations_supercedence
      target_field: axonius.exposure.event.data.msrc_remediations.supercedence
      ignore_missing: true
  - rename:
      field: json.event.data.tags_from_associated_asset
      tag: rename_event_data_tags_from_associated_asset
      target_field: axonius.exposure.event.data.tags_from_associated_asset
      ignore_missing: true
  - rename:
      field: json.event.data.vector.access_complexity
      tag: rename_event_data_vector_access_complexity
      target_field: axonius.exposure.event.data.vector.access_complexity
      ignore_missing: true
  - rename:
      field: json.event.data.vector.access_vector
      tag: rename_event_data_vector_access_vector
      target_field: axonius.exposure.event.data.vector.access_vector
      ignore_missing: true
  - rename:
      field: json.event.data.vector.authentication
      tag: rename_event_data_vector_authentication
      target_field: axonius.exposure.event.data.vector.authentication
      ignore_missing: true
  - rename:
      field: json.event.data.vulnerability_status
      tag: rename_event_data_vulnerability_status
      target_field: axonius.exposure.event.data.vulnerability_status
      ignore_missing: true
  - rename:
      field: json.event.name
      tag: rename_event_name
      target_field: axonius.exposure.event.name
      ignore_missing: true
on_failure:
  - append:
      field: error.message
      value: |-
        Processor '{{{ _ingest.on_failure_processor_type }}}'
        {{{#_ingest.on_failure_processor_tag}}}with tag '{{{ _ingest.on_failure_processor_tag }}}'
        {{{/_ingest.on_failure_processor_tag}}}failed with message '{{{ _ingest.on_failure_message }}}'
  - set:
      field: event.kind
      tag: set_pipeline_error_to_event_kind
      value: pipeline_error
  - append:
      field: tags
      value: preserve_original_event
      allow_duplicates: false
