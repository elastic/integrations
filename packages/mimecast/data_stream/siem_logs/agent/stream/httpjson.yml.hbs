config_version: "2"
interval: 5m
request.url: {{base_url}}{{siem_request_uri}}
request.method: "POST"
request.transforms:
  - set:
      target: body.data
      value: '[{"type":"MTA","fileFormat":"json","compress":false}]'
      value_type: json
  - set:
      target: header.x-mc-app-id
      value: {{app_id}}
  - set:
      target: header.x-mc-date
      value: '[[now]]'
  - set:
      target: header.x-mc-req-id
      value: '[[uuid]]'
  - set:
      target: header.Content-Type
      value: application/json
  - set:
      target: header.Authorization
      value: '[["MC {{access_key}}:"(hmacBase64 "sha1" (sprintf "%s:%s:%s:%s %s" (.header.Get "x-mc-date") (.header.Get "x-mc-req-id") .url.String {{app_key}} {{secret_key}}))"]]'
response.decode_as: application/json
response.pagination:
  - set:
      target: body.data
      value: '[{"type":"MTA","fileFormat":"json","compress":false,"token":"[[.last_request.header.Get "mc-siem-token"]]"}]'
      value_type: json
      fail_on_template_error: true
{{!-- tags: --}}
{{!-- {{#if preserve_original_event}}
  - preserve_original_event
{{/if}}
{{#each tags as |tag i|}}
  - {{tag}}
{{/each}}
{{#contains tags "forwarded"}}
publisher_pipeline.disable_host: true
{{/contains}}
{{#if processors}}
processors:
{{processors}}
{{/if}} --}}