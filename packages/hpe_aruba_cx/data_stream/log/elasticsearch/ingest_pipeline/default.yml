---
description: Pipeline for processing HPE Aruba logs.

processors:
  - set:
      field: event.original
      copy_from: message
  - remove:
      field: message
      ignore_missing: true
  - redact:
      field: "event.original"
      tag: redact_passkey
      description: "Reacting passkey updates"
      prefix: "passkey update:   -> "
      patterns:
        - "passkey %{GREEDYDATA:reacted}"
  - set:
      field: ecs.version
      value: "8.11.0"
  - set:
      field: event.category
      value: [network]
  #
  # Parse the syslog message
  # This grok pattern is based on the syslog message format used by HPE Aruba CX switches.
  #
  - grok:
      field: event.original
      tag: grok_event_original
      if: ctx.event?.original != null
      patterns:
        - "%{SYSLOG_HEADER}%{GREEDYDATA:message}"
      pattern_definitions:
        SYSLOG_HEADER: "%{TIMESTAMP_ISO8601:@timestamp}\\s+%{USER:aruba.hardware.device}\\s+%{DATA:log.syslog.appname}\\[%{POSINT:log.syslog.procid}\\]:\\s+%{WORD:aruba.event_type}\\|(?:%{OPTIONAL_HEADER})?"
        OPTIONAL_HEADER: "%{POSINT:event.code}\\|%{USER:log.level}\\|(?:%{USER:aruba.component.category})?\\|(?:%{DATA:aruba.sequence})?\\|"
  - grok:
      field: aruba.sequence
      if: ctx.aruba?.sequence != null && ctx.aruba.sequence.contains("/")
      tag: parse_sequence
      patterns:
        - "%{POSINT:event.sequence:long}\\/%{POSINT}"
  - lowercase:
      field: event.kind
      tag: lowercase_event_kind
      ignore_missing: true


  # Fan Events (2xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/FAN.htm
  # * 212 is not included as it does not require further processing.
  - grok:
      field: message
      tag: fan_event_201
      description: "Log the total number of fans in the subsystem"
      if: "ctx.event?.code == '201'"
      patterns:
        - "^There are %{INT:aruba.fan.count:long} total fans in subsystem %{DATA:aruba.subsystem}\\.?$"
  - grok:
      field: message
      tag: fan_event_202
      description: "Log the fan speed set"
      if: "ctx.event?.code == '202'"
      patterns:
        - "^Subsystem %{DATA:aruba.subsystem} setting fan speed control register to %{DATA:aruba.fan.speedval}: %{FAN_VALUE:aruba.fan.value}"
      pattern_definitions:
        FAN_VALUE: "[-_0-9a-zA-Z]+"
  - grok:
      field: message
      tag: fan_event_203
      description: "Log the air flow direction"
      if: "ctx.event?.code == '203'"
      patterns:
        - "^Air flow direction: %{FAN_VALUE:aruba.fan.value}"
      pattern_definitions:
        FAN_VALUE: "[-_0-9a-zA-Z]+"
  - grok:
      field: message
      tag: fan_event_204_205
      description: "log event when a fan tray is removed|inserted from|into the chassis"
      if: "['204', '205'].contains(ctx.event?.code)"
      patterns:
        - "^Fan tray %{DATA:aruba.fan.ft_num} was (removed|inserted)"
  - grok:
      field: message
      tag: fan_event_206_207
      description: "log event when a fan module is removed|inserted from|into a fan tray"
      if: "['206', '207'].contains(ctx.event?.code)"
      patterns:
        - "^Fan module %{DATA:aruba.fan.fmod_num}( in fan tray %{DATA:aruba.fan.ft_num})? was (removed|inserted)"
  - grok:
      field: message
      tag: fan_event_208
      description: "Log event when an unsupported fan tray is inserted"
      if: "ctx.event?.code == '208'"
      patterns:
        - "^Unsupported fan tray %{DATA:aruba.fan.ft_num} detected. Please insert a standard fan tray"
  - grok:
      field: message
      tag: fan_event_209
      description: "Log error when system shutdown is initiated due to critical fan faults"
      if: "ctx.event?.code == '209'"
      patterns:
        - "^Shutting down system now because %{NUMBER:aruba.error.count:long} %{DATA:error.type} %{DATA:aruba.fan.compare_mode} limit of %{NUMBER:aruba.limit:long}"
  - grok:
      field: message
      tag: fan_event_211
      description: "Log error when the number of failures exceed the allowable limit"
      if: "ctx.event?.code == '211'"
      patterns:
        - "^Shutting down system in %{NUMBER:aruba.time.seconds:long} seconds because %{NUMBER:aruba.error.count:long} %{DATA:error.type} %{DATA:aruba.fan.compare_mode} limit of %{NUMBER:aruba.limit:long}"
  - grok:
      field: message
      tag: fan_event_213
      description: "Log error when there are fan faults"
      if: "ctx.event?.code == '213'"
      patterns:
        - "^%{NUMBER:aruba.error.count:long} %{DATA:error.type} in the system"
  - grok:
      field: message
      tag: fan_event_214
      description: "List out the faulty or missing fan names"
      if: "ctx.event?.code == '214'"
      patterns:
        - "^%{DATA:aruba.fan.function}: Fan fault in tray %{DATA:aruba.fan.tray_idx:long}, module %{NUMBER:aruba.fan.index:long}, reason: %{EVENT_REASON:event.reason}"
      pattern_definitions:
        EVENT_REASON: "[-_0-9a-zA-Z]+"
  - grok:
      field: message
      tag: fan_event_215
      description: "Log the fan status"
      if: "ctx.event?.code == '215'"
      patterns:
        - "^%{DATA:aruba.fan.name} fan is %{FAN_STATUS:aruba.fan.status}"
      pattern_definitions:
        FAN_STATUS: "[-_0-9a-zA-Z]+"
  - grok:
      field: message
      tag: fan_event_216
      description: "Log the change in fan status"
      if: "ctx.event?.code == '216'"
      patterns:
        - "^Status of fan %{NUMBER:aruba.fan.module_idx:long} in tray %{NUMBER:aruba.fan.tray_idx:long} has changed from %{DATA:aruba.fan.old_status} to %{FAN_STATUS:aruba.fan.status}"
      pattern_definitions:
        FAN_STATUS: "[-_0-9a-zA-Z]+"
  - grok:
      field: message
      tag: fan_event_217
      description: "Log when minimum number of fans are not present"
      if: "ctx.event?.code == '217'"
      patterns:
        - "^Operational fan count below minimum. %{NUMBER:aruba.fan.count:long} fans operating, but %{NUMBER:aruba.fan.minimum:long} are required"
  - grok:
      field: message
      tag: fan_event_218
      description: "Log when the fan speed index changes to and from the maximum for each thermal zone"
      if: "ctx.event?.code == '218'"
      patterns:
        - "^Fan speed index for thermal zone %{NUMBER:aruba.fan.zone_idx:long} is %{SPEED_STATUS:aruba.fan.speed_idx_status}"
      pattern_definitions:
        SPEED_STATUS: "[-_0-9a-zA-Z]+"
  - grok:
      field: message
      tag: fan_event_219
      description: "Log event when a fan tray is powered on or off"
      if: "ctx.event?.code == '219'"
      patterns:
        - "^Fan tray %{DATA:aruba.fan.ft_num} powered %{FAN_STATUS:aruba.fan.status}"
      pattern_definitions:
        FAN_STATUS: "[-_0-9a-zA-Z]+"
  - grok:
      field: message
      tag: fan_event_220
      description: "Log event when a fan tray is inserted specifying its airflow direction"
      if: "ctx.event?.code == '220'"
      patterns:
        - "^Fan tray %{DATA:aruba.fan.ft_num} airflow is %{FAN_DIRECTION:aruba.fan.ft_dir}"
      pattern_definitions:
        FAN_DIRECTION: "[-_0-9a-zA-Z]+"
  - dissect:
      field: message
      tag: fan_event_221
      description: "Log event when a fan tray airflow is not matching with system airflow"
      if: "ctx.event?.code == '221'"
      pattern: "%{aruba.fan.ft_air_curr} airflow fan tray %{aruba.fan.ft_num} unsupported; this system requires %{aruba.fan.ft_air_req} airflow"
  - grok:
      field: message
      tag: fan_event_222
      description: "Log error when number of faulty/supported fans does not meet the allowable limit"
      if: "ctx.event?.code == '222'"
      patterns:
        - "^%{NUMBER:aruba.error.count:long} %{DATA:error.type} %{DATA:aruba.fan.compare_mode} limit of %{NUMBER:aruba.limit:long}"
  - dissect:
      field: message
      tag: fan_event_223
      description: "Log when fan tray SKU ID in FRU is mismatched"
      if: "ctx.event?.code == '223'"
      pattern: "Fan tray %{aruba.fan.ft_num} FRU EPPROM is incorrectly programmed"
  - dissect:
      field: message
      tag: fan_event_224
      description: "Log event when a fan tray airflow is not matching with system airflow and is disabled"
      if: "ctx.event?.code == '224'"
      pattern: "%{aruba.fan.ft_air_curr} airflow fan tray %{aruba.fan.ft_num} disabled; this system requires %{aruba.fan.ft_air_req} airflow"
  - grok:
      field: message
      tag: fan_event_225
      description: "Log event when a misconfigured fan tray is enabled or disabled"
      if: "ctx.event?.code == '225'"
      patterns:
        - "^Fan tray %{DATA:aruba.fan.ft_num} misconfigured; this fan tray has been %{FAN_STATUS:aruba.fan.status}"
      pattern_definitions:
        FAN_STATUS: "[-_0-9a-zA-Z]+"

    # CoPP Events (15xx)
    # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/COPP.htm

    # The following Event IDs do not need further processing
    # * 1501
    # * 1502
    # * 1503
    # * 1504
    # * 1505
  - dissect:
      field: message
      tag: copp_event_1506
      description: "Logs failure of programming queue for a CoPP packet class"
      if: "ctx.event?.code == '1506'"
      pattern: "Packet class programming failed for %{aruba.copp.class}"
  - dissect:
      field: message
      tag: copp_event_1507
      description: "Logs failure of programming ingress field processor for a COPP class"
      if: "ctx.event?.code == '1507'"
      pattern: "Failed to program ingress field processor rule for %{aruba.copp.class}"
  - dissect:
      field: message
      tag: copp_event_1508
      description: "Logs failure of programming egress field processor for a COPP class"
      if: "ctx.event?.code == '1508'"
      pattern: "Failed to program egress rule for %{aruba.copp.class}"
  - dissect:
      field: message
      tag: copp_event_1509
      description: "Logs CoPP initial initialization failure on a slot"
      if: "ctx.event?.code == '1509'"
      pattern: "CoPP initial initialization failed on slot %{aruba.slot}"
  - dissect:
      field: message
      tag: copp_event_1510
      description: "Logs CoPP final initialization failure on a slot"
      if: "ctx.event?.code == '1510'"
      pattern: "CoPP final initialization failed on slot %{aruba.slot}"
  - dissect:
      field: message
      tag: copp_event_1511
      description: "Logs CoPP deinitialization failure on a slot"
      if: "ctx.event?.code == '1511'"
      pattern: "CoPP deinitialization failed on slot %{aruba.slot}"
  - dissect:
      field: message
      tag: copp_event_1512
      description: "Logs failure while configuring hardware on a slot for a CoPP class"
      if: "ctx.event?.code == '1512'"
      pattern: "Failed to configure hardware for CoPP on slot %{aruba.slot} class %{aruba.copp.class}"
  - dissect:
      field: message
      tag: copp_event_1513
      description: "Logs failure while retrieving statistics on a slot for a CoPP class"
      if: "ctx.event?.code == '1513'"
      pattern: "Failed to retrieve CoPP statistics from slot %{aruba.slot} class %{aruba.copp.class}"


  # ECMP Events (18xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/ECMP.htm
  - grok:
      field: message
      tag: ecmp_event_1801
      description: "logs errors while creating ecmp group."
      if: "ctx.event?.code == '1801'"
      patterns:
        - "Failed to update ecmp object for route %{DATA:aruba.ecmp.route}, error: %{DATA:aruba.ecmp.err}$"
  - grok:
      field: message
      tag: ecmp_event_1802
      description: "logs while creating ecmp group."
      if: "ctx.event?.code == '1802'"
      patterns:
        - "Update ecmp object for route %{DATA:aruba.ecmp.route}$"
  - grok:
      field: message
      tag: ecmp_event_1803
      description: "logs errors while deleting ecmp group."
      if: "ctx.event?.code == '1803'"
      patterns:
        - "Failed to delete ecmp egress object %{DATA:aruba.ecmp.egressid}, error: %{DATA:aruba.ecmp.err}$"
  - dissect:
      field: message
      tag: ecmp_event_1804
      description: "logs while deleting ecmp group."
      if: "ctx.event?.code == '1804'"
      pattern: "Delete ecmp egress object %{aruba.ecmp.egressid}"
  - grok:
      field: message
      tag: ecmp_event_1805
      description: "logs for ECMP setup errors."
      if: "ctx.event?.code == '1805'"
      patterns:
        - "ECMP error: %{DATA:aruba.ecmp.err}$"

  # DHCP Server events (19xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/DHCP-SERVER.htm
  - grok:
      field: message
      tag: dhcp_server_event_1901_through_1906
      description: "Logs DHCP lease addition, deletion, or update"
      if: "['1901', '1902', '1903', '1904', '1905', '1906'].contains(ctx.event?.code)"
      patterns:
        - "^DHCP Lease (added|addition|deleted|deletion|update|updated)( failed)? %{DHCP_EXPIRE_TIME_FMT:event.end} %{MAC:host.mac} %{IP:host.ip} %{HOSTNAME:host.name} %{DATA:user.id}$"
      pattern_definitions:
        DHCP_EXPIRE_TIME_FMT: "(?:(?:[0-9]{2}:){2}([0-9]){2})"
  - grok:
      field: message
      tag: dhcp_server_event_1907_1908
      description: "Logs enable or disable of DHCP server on a VRF"
      if: "['1907', '1908'].contains(ctx.event?.code)"
      patterns:
        - "^DHCP server (en|dis)abled on VRF %{DATA:aruba.vrf.name}$"
  - dissect:
      field: message
      tag: dhcp_server_event_1909
      description: "Event raised when user configures an invalid DHCP configuration"
      if: "ctx.event.code == '1909'"
      pattern: "Invalid DHCP configuration: %{aruba.dhcp.config} provided on DHCP Server instance running on VRF %{aruba.vrf.name}. Ignoring this config."
  - grok:
      field: message
      tag: dhcp_server_event_1910_1911
      description: "Event raised when DHCP or DHCPv6 Server Lease on the VRF is cleared"
      if: "['1910', '1911'].contains(ctx.event?.code)"
      patterns:
        - "^(DHCP|DHCPv6) Server Lease cleared on vrf %{DATA:aruba.vrf.name}\\.$"

  # AAA events (23xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/AAA.htm
  - grok:
      if: "ctx.event.code == '2301'"
      tag: aaa_event_2301
      field: "message"
      description: "Logs AAA Authentication/Authorization/Accounting/fail-through"
      patterns:
        - "^AAA %{DATA:aruba.aaa.config_type} update\\s?:\\s?%{GREEDYDATA:aruba.aaa.config_event}"
  - grok:
      if: "ctx.event.code == '2302'"
      tag: aaa_event_2302
      field: "message"
      description: "Logs TACACS+ server update, server group update and global default update"
      patterns:
        - "^TACACS %{GREEDYDATA:aruba.aaa.tacacs_type} %{DATA:aruba.aaa.tacacs_action}:\\s?%{GREEDYDATA:aruba.aaa.tacacs_event}"
  - grok:
      if: "ctx.event.code == '2303'"
      tag: aaa_event_2303
      field: "message"
      description: "Logs RADIUS server update, server group update and global default update"
      patterns:
        - "^RADIUS %{GREEDYDATA:aruba.aaa.radius_type} %{DATA:aruba.aaa.radius_action}:\\s?%{GREEDYDATA:aruba.aaa.radius_event}"
  - dissect:
      if: "ctx.event.code == '2304'"
      tag: aaa_event_2304
      field: "message"
      description: "Logs changes in RADIUS server reachability status"
      pattern: 'RADIUS Server with Address: %{server.address}, Authport:%{aruba.port}, VRF_ID:%{aruba.vrf.id} is "%{aruba.status}"'
  - dissect:
      if: "ctx.event.code == '2305'"
      tag: aaa_event_2305
      field: "message"
      description: "Logs changes in TACACS server reachability status"
      pattern: "TACACS server host %{server.address} port %{aruba.port} vrf %{aruba.vrf.id} %{aruba.status}"

  # BGP events (29xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/BGP.htm
  - dissect:
      if: "ctx.event.code == '2901'"
      tag: bgp_event_2901
      field: "message"
      description: "Logs the changes in BGP connection state."
      pattern: "%{destination.address}: Peer up. vrf-name: %{aruba.vrf.name}"
  - dissect:
      if: "ctx.event.code == '2902'"
      tag: bgp_event_2902
      field: "message"
      description: "Logs the failure in BGP connection state changes."
      pattern: "%{destination.address}: Peer down. error-code: %{error.code}, error-sub-code: %{aruba.bgp.error_subcode}. vrf-name: %{aruba.vrf.name}"
  - grok:
      if: "['2903', '2904'].contains(ctx.event?.code)"
      tag: bgp_event_2903_2904
      field: "message"
      description: "Trap when the number of received prefix reached the [threshold|maximum prefix] value."
      patterns:
        - "^%{IPORHOST:destination.address}: Peer has received prefix equal to (Maximum Prefix|Threshold) value configured. vrf-name: %{GREEDYDATA:aruba.vrf.name}"
  - grok:
      if: "['2905', '2906'].contains(ctx.event?.code)"
      tag: bgp_event_2905_2906
      field: "message"
      description: "Logs BGP enable event | Logs BGP disable event"
      patterns:
        - "^BGP AS %{NUMBER:aruba.bgp.as_number:long} %{WORD}. vrf-name: %{GREEDYDATA:aruba.vrf.name}"
  - dissect:
      if: "ctx.event.code == '2907'"
      tag: bgp_event_2907
      field: "message"
      description: "Logs BGP router-id change."
      pattern: "BGP router-id changed. vrf-name: %{aruba.vrf.name}"
  - grok:
      if: "ctx.event.code == '2908'"
      tag: bgp_event_2908
      field: "message"
      description: "Logs creation of BGP peer."
      patterns:
        - "^%{IPORHOST:destination.address}: Peer configured, AS %{NUMBER:destination.as.number:long}. vrf-name: %{GREEDYDATA:aruba.vrf.name}"
  - dissect:
      if: "ctx.event.code == '2909'"
      tag: bgp_event_2909
      field: "message"
      description: "Logs BGP peer session reset event."
      pattern: "%{destination.address}: User reset request. vrf-name: %{aruba.vrf.name}"
  - dissect:
      if: "ctx.event.code == '2910'"
      tag: bgp_event_2910
      field: "message"
      description: "Logs BGP peer password change event."
      pattern: "%{destination.address}: Peer password changed. vrf-name: %{aruba.vrf.name}"
  - dissect:
      if: "ctx.event.code == '2911'"
      tag: bgp_event_2911
      field: "message"
      description: "Logs deletion of BGP peer."
      pattern: "%{destination.address}: Peer deleted. vrf-name: %{aruba.vrf.name}"
  - grok:
      if: "['2912', '2913'].contains(ctx.event?.code)"
      tag: bgp_event_2912_2913
      field: "message"
      description: "Logs BGP peer admin enable/disable event."
      patterns:
        - "^%{IPORHOST:destination.address}: Peer admin (dis|en)abled. vrf-name: %{GREEDYDATA:aruba.vrf.name}"
  - grok:
      if: "ctx.event.code == '2914'"
      tag: bgp_event_2914
      field: "message"
      description: "Logs BGP peer remote-as change event."
      patterns:
        - "^%{IPORHOST:destination.address}: Peer remote-as changed to %{NUMBER:destination.as.number:long}. vrf-name: %{GREEDYDATA:aruba.vrf.name}"
  - grok:
      if: "ctx.event.code == '2915'"
      tag: bgp_event_2915
      field: "message"
      description: "BGP peer local-as change event."
      patterns:
        - "^%{IPORHOST:destination.address}: Peer local-as changed to %{NUMBER:client.as.number:long}. vrf-name: %{GREEDYDATA:aruba.vrf.name}"
  - grok:
      if: "ctx.event.code == '2916'"
      tag: bgp_event_2916
      field: "message"
      description: "Logs peer source address change event."
      patterns:
        - "^%{IPORHOST:destination.address}: Peer source-address changed to %{IP:source.ip}. vrf-name: %{GREEDYDATA:aruba.vrf.name}"
  - dissect:
      if: "ctx.event.code == '2917'"
      tag: bgp_event_2917
      field: "message"
      description: "Logs configuration of peer remove-private-as."
      pattern: "%{destination.address}: Peer remove-private-as configuration changed. vrf-name: %{aruba.vrf.name}"
  - dissect:
      if: "ctx.event.code == '2918'"
      tag: bgp_event_2918
      field: "message"
      description: "Logs peer identifier has been matched with local identifier."
      pattern: "%{aruba.bgp.id}: BGP identifier sent by Peer %{destination.address} matches ours. BGP session may not established. vrf-name: %{aruba.vrf.name}"
  - grok:
      if: "ctx.event.code == '2919'"
      tag: bgp_event_2919
      field: "message"
      description: "Trap when the rib size reaches the threshold value."
      patterns:
        - "^The BGP RIB has reached the threshold limit of %{DATA:aruba.bgp.threshold_limit:long} for VRF %{DATA:aruba.vrf.name}': yes"
  - grok:
      if: "ctx.event.code == '2920'"
      tag: bgp_event_2920
      field: "message"
      description: "BGP peer local-as change event."
      patterns:
        - "^%{DATA:aruba.bgp.pg_name}: Peer-group configured with remote-as %{NUMBER:destination.as.number:long}. vrf-name: %{GREEDYDATA:aruba.vrf.name}"

  # Hardware Health Monitor events (30xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/HW-HEALTH-MONITOR.htm
  - grok:
      if: "['3001', '3002', '3003', '3004', '3005'].contains(ctx.event?.code)"
      tag: hwhm_event_3001_3002_3003_3004_3005
      field: "message"
      description: "Event raised when hardware diagnostics detects error in management module | line card | fabric card | fan tray | rear display card"
      patterns:
        - "^Diagnostic %{DATA:aruba.hardware.test_name} failed with error code %{DATA:error.code} on (management module|line card|fabric card|fan tray|rear display card) %{GREEDYDATA:aruba.slot:long}"
  - dissect:
      if: "ctx.event.code == '3006'"
      tag: hwhm_event_3006
      field: "message"
      description: "Event raised when hardware diagnostics detects error in the system"
      pattern: 'Diagnostic %{aruba.hardware.test_name} failed with error code %{error.code} for the system'
  - dissect:
      if: "ctx.event.code == '3007'"
      tag: hwhm_event_3007
      field: "message"
      description: "Logs MCE BUS error"
      pattern: 'There are %{aruba.hardware.origin} happening on %{aruba.hardware.location}'
  - grok:
      if: "['3008', '3009'].contains(ctx.event?.code)"
      tag: hwhm_event_3008_3009
      field: "message"
      description: "Logs MCE [IO | unknown] error "
      patterns:
        # Warning: 3009 and 3008 pattern definition sequence matters, as 3009 is more strict than 3008
        - "^There are (IO|unknown) errors on %{DATA:aruba.hardware.location} from (%{3009_UNKNKOWN_FIELDS}|%{3008_IO_FIELDS})"
      pattern_definitions:
        3008_IO_FIELDS: "%{DATA:aruba.hardware.seg}:%{DATA:aruba.hardware.bus}:%{DATA:aruba.hardware.device}:%{GREEDYDATA:aruba.hardware.function}"
        3009_UNKNKOWN_FIELDS: "%{DATA:aruba.status}:%{DATA:aruba.hardware.addr}:%{DATA:aruba.hardware.misc}:%{DATA:aruba.hardware.mcgstatus}:%{GREEDYDATA:aruba.hardware.cap}"
  - grok:
      if: "ctx.event.code == '3010'"
      tag: hwhm_event_3010
      field: "message"
      description: "Logs CPU cache error"
      patterns:
        - "^CPUs %{NUMBER:aruba.hardware.cpus:long} L%{DATA:aruba.hardware.level} %{DATA:aruba.hardware.type} cache error detected. CPUs %{NUMBER:aruba.hardware.offlined:long} offlined"
  - grok:
      if: "['3011', '3012', '3013'].contains(ctx.event?.code)"
      tag: hwhm_event_3011_3012_3013
      field: "message"
      description: "Log when [socket | module | page] correctable memory error count is exceeded threshold"
      patterns:
        - "^Socket %{DATA:aruba.hardware.socket} %{3011_3012_3013_COMMON}"
        - "^Module %{DATA:aruba.hardware.channel} %{3011_3012_3013_COMMON}"
        - "^Page %{DATA:aruba.hardware.page} %{3011_3012_3013_COMMON}"
      pattern_definitions:
        3011_3012_3013_COMMON: "correctable memory error count %{NUMBER:aruba.hardware.cecount:long} exceeded threshold %{NUMBER:aruba.limit:long}(?:%{3011_3012_3013_OPTIONAL})?"
        3011_3012_3013_OPTIONAL: " and %{NUMBER:aruba.hardware.offlined:long}"

  # Firmware Update events (44xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/FIRMWARE_UPDATE.htm
  # Following events do not need further processing
  #   * 4405
  #   * 4406
  #   * 4407
  - grok:
      if: "['4401', '4402'].contains(ctx.event?.code)"
      tag: firmware_update_event_4401_4402
      field: "message"
      description: "Indicates that the switch firmware was successfully updated from a remote or local source"
      patterns:
        - "^User %{DATA:user.name}: %{DATA:aruba.firmware.image_profile} image updated via %{DATA:aruba.firmware.dnld_type}( from %{HOSTNAME:source.address})?. Firmware version, Before Update: %{DATA:aruba.firmware.before} After Update: %{DATA:aruba.firmware.after}$"
  - grok:
      if: "['4403', '4404'].contains(ctx.event?.code)"
      tag: firmware_update_event_4403_4404
      field: "message"
      description: "Indicates that a switch firmware update failed from a remote or local source"
      patterns:
        - "^User %{DATA:user.name}: %{DATA:aruba.firmware.image_profile} image update failed via %{DATA:aruba.firmware.dnld_type}( from %{HOSTNAME:source.address})?$"

  # Credential Manager events (65xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/CREDMGR.htm
  #
  # The following event IDs do not need further processing:
  # * 6501
  # * 6502
  # * 6504
  # * 6505
  - dissect:
      if: "ctx.event.code == '6506'"
      tag: credmgr_event_6506
      field: "message"
      description: "Logs a message when SSH authorized keys are added for a user"
      pattern: "SSH authorized keys were added for user %{user.name}"
  - dissect:
      if: "ctx.event.code == '6507'"
      tag: credmgr_event_6507
      field: "message"
      description: "Logs a message after a failure to write SSH authorized keys for a user"
      pattern: "Failed to write SSH authorized keys for user %{user.name}"
  - dissect:
      if: "ctx.event.code == '6508'"
      tag: credmgr_event_6508
      field: "message"
      description: "Logs a message after deleting SSH authorized keys for a user"
      pattern: "SSH authorized keys deleted for user %{user.name}"
  - dissect:
      if: "ctx.event.code == '6509'"
      tag: credmgr_event_6509
      field: "message"
      description: "Logs a message when SSH authorized key fails validation check"
      pattern: "User %{user.name} has configured an invalid SSH authorized key with key identifier %{user.id}"

  # Config Management events (68xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/CONFIG_MGMT.htm
  - dissect:
      if: "ctx.event.code == '6801'"
      tag: config_event_6801
      field: "message"
      description: "Logs a message when configs copying from one format to another"
      pattern: "Copying configs from: %{aruba.config.from} to: %{aruba.config.to}"
  - dissect:
      if: "['6802', '6804'].contains(ctx.event?.code)"
      tag: config_event_6802_6804
      field: "message"
      description: "Logs a message when copying config has some error | Logs a message when copying config to shadowdb has some error"
      pattern: "Error while copying configs. Error: %{event.reason}"
  - dissect:
      if: "ctx.event.code == '6803'"
      tag: config_event_6803
      field: "message"
      description: "Logs a message when config validation prunes tables/columns in startup-config or when errors are encountered"
      pattern: "%{aruba.config.type}:%{aruba.config.value}"
  - dissect:
      if: "ctx.event.code == '6805'"
      tag: config_event_6805
      field: "message"
      description: "Logs a message when copying config has some information"
      pattern: "Information while copying configs. Info: %{event.reason}"

  # BFD events (73xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/BFD.htm
  - grok:
      if: "['7305', '7306'].contains(ctx.event?.code)"
      tag: bfd_event_7305_7306
      field: "message"
      description: "Event raised when BFD echo is enabled/disable on an interface"
      patterns:
        - "^BFD echo was (en|dis)abled on interface %{GREEDYDATA:aruba.interface.id}"
  - grok:
      if: "['7307', '7308', '7309', '7315'].contains(ctx.event?.code)"
      tag: bfd_event_7307_7308_7309_7315
      field: "message"
      description: "Event raised when BFD echo is enabled/disable on an interface | administratively down | becomes unidirectional"
      patterns:
        - "^BFD session is (up|down|administratively down|unidirectional). session_id=%{DATA:aruba.session.id}, vrf=%{DATA:aruba.vrf.name}, op_mode=%{DATA:aruba.bfd.op_mode}, src_port=%{DATA:aruba.port}, dest_ip=%{IP:destination.ip}, local_state=%{DATA:aruba.bfd.local_state}, local_diag=%{DATA:aruba.bfd.local_diag}, remote_state=%{DATA:aruba.bfd.remote_state}, remote_diag=%{GREEDYDATA:aruba.bfd.remote_diag}"
  - grok:
      if: "['7311', '7312'].contains(ctx.event?.code)"
      tag: bfd_event_7311_7312
      field: "message"
      description: "Port can[not] forward BFD traffic"
      patterns:
        - "^Port %{DATA:aruba.port} (can|can not) forward BFD traffic"
  - dissect:
      if: "ctx.event.code == '7314'"
      tag: bfd_event_7314
      field: "message"
      description: "Event raised when an Echo session is created without a valid echo_source IP address configured"
      pattern: "The echo function for the BFD session %{aruba.session.id} will not become active until a global echo source IP address is configured"
  - dissect:
      if: "ctx.event.code == '7316'"
      tag: bfd_event_7316
      field: "message"
      description: "Event raised when BFD echo is enabled on a Tunnel interface"
      pattern: "BFD echo cannot be enabled on tunnels. interface=%{aruba.interface.id}"
  - grok:
      if: "ctx.event.code == '7318'"
      tag: bfd_event_7318
      field: "message"
      description: "Event raised when SRC or DST IP Version doesn't match the session's IP Version"
      patterns:
        - "^IP Version mismatch for BFD. session_id=%{DATA:aruba.session.id}, vrf=%{DATA:aruba.vrf.name}, op_mode=%{DATA:aruba.bfd.op_mode}, src_port=%{DATA:aruba.port}, dest_ip=%{IP:destination.ip}, local_state=%{DATA:aruba.bfd.local_state}, local_diag=%{DATA:aruba.bfd.local_diag}, remote_state=%{DATA:aruba.bfd.remote_state}, remote_diag=%{GREEDYDATA:aruba.bfd.remote_diag}, from=%{DATA:aruba.bfd.from}, ip_version=%{DATA:aruba.bfd.ip_version}, Invalid IP address: %{IPORHOST:aruba.bfd.invalid_ip}"
  - dissect:
      if: "ctx.event.code == '7319'"
      tag: bfd_event_7319
      field: "message"
      description: "Event raised when a BFD single-hop session source port is a loopback"
      pattern: "BFD single-hop is not supported on interface %{aruba.interface.id}"
  - dissect:
      if: "ctx.event.code == '7320'"
      tag: bfd_event_7320
      field: "message"
      description: "Event raised when a BFD session specifies an interval for a protocol that does not support override"
      pattern: "BFD session interval override not supported for protocol %{aruba.bfd.from}"
  - grok:
      if: "ctx.event.code == '7321'"
      tag: bfd_event_7321
      field: "message"
      description: "Event raised when a BFD session specifies an interval outside the specified bounds"
      patterns:
        - "^BFD session %{DATA:aruba.bfd.direction} interval override of %{NUMBER:aruba.bfd.requested_interval:long} ms is out of bounds for protocol %{DATA:aruba.bfd.from}, using %{NUMBER:aruba.bfd.applied_interval:long} ms instead"

  # CPU_RX Events (75xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/CPU_RX.htm
  - dissect:
      field: message
      tag: cpu_rx_event_7501
      description: "Event raised when a kernel filter cannot be created or deleted"
      if: "ctx.event?.code == '7501'"
      pattern: "Kernel filter \"%{event.action}\" failed on unit %{aruba.instance.id} for %{aruba.cpu_rx.filter_description}"
  - dissect:
      field: message
      tag: cpu_rx_event_7502
      description: "Event raised when a kernel filter cannot be created because all filters are in use"
      if: "ctx.event?.code == '7502'"
      pattern: "Cannot create kernel filter on unit %{aruba.instance.id} for %{aruba.cpu_rx.filter_description}. All filters are in use. Configuring fewer per-port features can help with this issue."

  # Certificate management events (77xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/CERTMGR.htm
  - grok:
      if: "['7701', '7702', '7703', '7704'].contains(ctx.event?.code)"
      tag: cm_event_7701_7702_7703_7704
      field: "message"
      description: "Event raised when a ta profile is created/delete | Leaf certificate import/deleted"
      patterns:
        - "^(TA Profile|Leaf certificate) %{DATA:aruba.cm.cert_name} (created|deleted|imported|deleted)"
  - grok:
      if: "ctx.event.code == '7705'"
      tag: cm_event_7705
      field: "message"
      description: "Event raised when an installed certifiate will expire within 60 days"
      patterns:
        - "^Certificate %{DATA:aruba.cm.cert_name} will expire within %{NUMBER:aruba.cm.days:long} days"
  - grok:
      if: "['7706', '7707', '7708'].contains(ctx.event?.code)"
      tag: cm_event_7706_7707_7708
      field: "message"
      description: "Event raised when an installed certifiate is not yet past its start date/expired or is verified"
      patterns:
        - "^Certificate %{DATA:aruba.cm.cert_name} has not yet reached its start date"
        - "^Certificate %{DATA:aruba.cm.cert_name} has expired and can no longer be used"
        - "^Certificate %{DATA:aruba.cm.cert_name} verified and accepted"
  - dissect:
      if: "ctx.event.code == '7709'"
      tag: cm_event_7709
      field: "message"
      description: "Event raised when a certificate chain is rejected"
      pattern: "Certificate %{aruba.cm.cert_name} rejected due to verification failure (%{event.reason})"
  - grok:
      if: "['7710', '7711', '7712'].contains(ctx.event?.code)"
      tag: cm_event_7710_7711_7712
      field: "message"
      description: "Event raised when a (self-signed) certificate signing request is created on the switch | invalid certificate association is made"
      patterns:
        - "^(Certificate signing request|Self-signed certificate) %{DATA:aruba.cm.cert_name} created"
        - "^Application association with the %{DATA:aruba.cm.cert_name} certificate is not permitted"
  - dissect:
      if: "ctx.event.code == '7713'"
      tag: cm_event_7713
      field: "message"
      description: "Event raised when a certificate is verified due to optional OCSP enforcement"
      pattern: "Certificate %{aruba.cm.cert_name} failed OCSP verification (%{aruba.status}), but was accepted because OCSP enforcement is set to optional."
  - grok:
      if: "['7714', '7715'].contains(ctx.event?.code)"
      tag: cm_event_7714_7715
      field: "message"
      description: "Event raised when CA certificates were [successfully|could not be] downloaded from an EST server"
      patterns:
        - "^(CA certificates successfully downloaded|Failed to download CA certificates) from EST server %{GREEDYDATA:aruba.cm.cert_name}"
  - grok:
      if: "['7716', '7717', '7718', '7719'].contains(ctx.event?.code)"
      tag: cm_event_7716_7717_7718_7719
      field: "message"
      description: "Certificate is successfully enrolled with EST | Certificate (re)enrollment with an EST server fails | Certificate is successfully reenrolled with EST"
      patterns:
        - "^Certificate %{DATA:aruba.cm.cert_name} successfully (re)?enrolled by EST server %{GREEDYDATA:aruba.cm.est_name}"
        - "^Failed to (re)?enroll certificate %{DATA:aruba.cm.cert_name} with EST server %{GREEDYDATA:aruba.cm.est_name}"
  - grok:
      if: "['7720', '7721'].contains(ctx.event?.code)"
      tag: cm_event_7720_7721
      field: "message"
      description: "A signer certifiate is not set for signing | An installed certifiate is invalid or malformed"
      patterns:
        - "^Certificate %{DATA:aruba.cm.cert_name} is (not set for signing purpose|invalid or malformed)"

  # External Storage events (78xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/EXTERNAL-STORAGE.htm
  - grok:
      field: message
      tag: external_storage_event_7801_7802
      description: "Event raised when a share fails to mount | dismount"
      if: "['7801', '7802'].contains(ctx.event?.code)"
      patterns:
        - "^Share %{DATA:aruba.storage.name} (dis)?mount failure"
  - grok:
      field: message
      tag: external_storage_event_7803_7804
      description: "Event raised when a share mounts | dismounts"
      if: "['7803', '7804'].contains(ctx.event?.code)"
      patterns:
        - "^Share %{DATA:aruba.storage.name} is (dis)?mounted"
  - dissect:
      field: message
      tag: external_storage_event_7805
      description: "Event raised when a mount times out or aborts due to a config change"
      if: "ctx.event?.code == '7805'"
      pattern: "Share %{aruba.storage.name} mount is aborted"
  - dissect:
      field: message
      tag: external_storage_event_7806
      description: "USB device mounted or unmounted."
      if: "ctx.event?.code == '7806'"
      pattern: "USB device %{aruba.status}."

  # Bluetooth Management events (80xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/BLUETOOTH_MGMT.htm
  - grok:
      if: "['8001', '8003'].contains(ctx.event?.code)"
      tag: btm_event_8001
      field: "message"
      description: "Event raised when Bluetooth is enabled or disabled | receives signal for Bluetooth adapter"
      patterns:
        - "^Bluetooth (has been|adapter) %{GREEDYDATA:event.action}"
  - grok:
      if: "ctx.event.code == '8004'"
      tag: btm_event_8004
      field: "message"
      description: "Event raised when btd receives signal for Bluetooth device event"
      patterns:
        - "^Bluetooth device %{DATA:event.action}: %{MAC:client.mac}"

  # ERPS Events (85xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/ERPS.htm
  - dissect:
      field: message
      tag: erps_event_8501
      description: "Log event when RAPS messages are not received for a certain time interval"
      if: "ctx.event?.code == '8501'"
      pattern: "Expected R-APS packets not received on %{observer.ingress.interface.id} in ring %{aruba.erps.ring_id} with control VLAN %{network.vlan.id}"
  - grok:
      field: message
      tag: erps_event_8502
      description: "Log event when a ring misconfiguration happens"
      if: "ctx.event?.code == '8502'"
      patterns:
        - "^Misconfiguration detected on ring %{DATA:aruba.erps.ring_id} with control VLAN %{DATA:network.vlan.id}. Another node in the ring with mac %{MAC:client.mac} is also operating as an RPL owner"
  - dissect:
      field: message
      tag: erps_event_8503
      description: "Log state transition of ring instance"
      if: "ctx.event?.code == '8503'"
      pattern: "Operational state of the ring %{aruba.erps.ring_id}, instance %{aruba.instance.id} changed to %{aruba.status}"
  - dissect:
      field: message
      tag: erps_event_8504
      description: "Log event when ring is configured with a non-L2 port"
      if: "ctx.event?.code == '8504'"
      pattern: "%{observer.ingress.interface.name} is not an L2 port"
  - dissect:
      field: message
      tag: erps_event_8505
      description: "Log event when an interface which is already associated to a ring port is getting mapped to other ring port as well"
      if: "ctx.event?.code == '8505'"
      pattern: "%{observer.ingress.interface.name} is already associated with %{aruba.erps.port_name} of ERPS ring %{aruba.erps.ring_id}"
  - dissect:
      field: message
      tag: erps_event_8506
      description: "Log event when control-channel VLAN is part of the protected-vlans"
      if: "ctx.event?.code == '8506'"
      pattern: "Configured control-channel VLAN %{network.vlan.id} is already protected by ERPS ring %{aruba.erps.ring_id}, instance %{aruba.instance.id}"
  - dissect:
      field: message
      tag: erps_event_8507
      description: "Log event when control-channel VLAN overlaps with another control-channel of same ring"
      if: "ctx.event?.code == '8507'"
      pattern: "VLAN %{network.vlan.id} is already configured as control-channel for instance %{aruba.instance.id} of ring %{aruba.erps.ring_id}"
  - dissect:
      field: message
      tag: erps_event_8508
      description: "Log event when protected-vlan(s) overlap"
      if: "ctx.event?.code == '8508'"
      pattern: "Vlan %{network.vlan.id} is already part of the protected VLAN set of ring %{aruba.erps.ring_id} instance %{aruba.instance.id}"
  - dissect:
      field: message
      tag: erps_event_8510
      description: "Log event when parent-ring id is configured to be the same as sub-ring"
      if: "ctx.event?.code == '8510'"
      pattern: "Parent-ring %{aruba.erps.ring_id} is same as sub-ring"
  - dissect:
      field: message
      tag: erps_event_8511
      description: "Log event when VLAN from the protected-vlans list is already configured as control-channel VLAN"
      if: "ctx.event?.code == '8511'"
      pattern: "VLAN %{network.vlan.id} in the protected VLANs list is also configured as the control-channel"
  - dissect:
      field: message
      tag: erps_event_8512
      description: "Log event if the same ring port is configured as RPL port for more than one instance"
      if: "ctx.event?.code == '8512'"
      pattern: "%{aruba.erps.port_name} is already configured as RPL port for instance %{aruba.instance.id}"
  - dissect:
      field: message
      tag: erps_event_8513
      description: "Log event if ring port which is also an ISL is being configured as RPL"
      if: "ctx.event?.code == '8513'"
      pattern: "RPL configuration is not allowed on ISL port %{observer.ingress.interface.name}"
  - dissect:
      field: message
      tag: erps_event_8515
      description: "Log transition of state of ring instance to initializing and the reason for it"
      if: "ctx.event?.code == '8515'"
      pattern: "Operational state of the ring %{aruba.erps.ring_id}, instance %{aruba.instance.id} changed to Initializing with reason %{event.reason}"

  # CDP events (89xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/CDP.htm
  - grok:
      if: "['8903', '8904', '8905'].contains(ctx.event?.code)"
      tag: cdp_event_8903_8904_8905
      field: "message"
      description: "Log to indicate CDP neighbor addition/modification/deletion"
      patterns:
        - "^CDP neighbor %{MAC:source.mac} is (added|updated|deleted) on %{GREEDYDATA:aruba.interface.name}"

  # DCBX Events (92xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/DCBX.htm
  - grok:
      field: message
      tag: dcbx_event_9203_9204
      if: "['9203', '9204'].contains(ctx.event?.code)"
      patterns:
        - "^DCBX is (dis|en)abled on interface %{DATA:aruba.dcbx.intf_name}$"
  - grok:
      field: message
      tag: dcbx_event_9205_9206
      if: "['9205', '9206'].contains(ctx.event?.code)"
      patterns:
        - "^DCBX status (in)?active on interface %{DATA:aruba.dcbx.intf_name}$"
  - grok:
      field: message
      tag: dcbx_event_9207_9208
      if: "['9207', '9208'].contains(ctx.event?.code)"
      patterns:
        - "^PFC TLV status (in)?active on interface %{DATA:aruba.dcbx.intf_name}$"
  - grok:
      field: message
      tag: dcbx_event_9209
      if: "['9209'].contains(ctx.event?.code)"
      patterns:
        - "^PFC TLV status priority mismatch on interface %{DATA:aruba.dcbx.intf_name}$"

  # EVPN Events (95xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/EVPN.htm
  - grok:
      field: message
      tag: evpn_event_9501_9502
      description: "Logs EVPN EVI create|delete event."
      if: "['9501', '9502'].contains(ctx.event?.code)"
      patterns:
          - "^EVPN EVI: %{DATA:network.vlan.id} (created|deleted)"
  - dissect:
      field: message
      tag: evpn_event_9503
      description: "Logs EVPN RD update event for an EVI."
      if: "ctx.event?.code == '9503'"
      pattern: "EVPN RD: %{aruba.evpn.rd} updated for EVI: %{network.vlan.id}"
  - dissect:
      field: message
      tag: evpn_event_9504
      description: "Logs EVPN RD delete event for an EVI."
      if: "ctx.event?.code == '9504'"
      pattern: "EVPN RD deleted for EVI: %{network.vlan.id}"
  - grok:
      field: message
      tag: evpn_event_9505_9506_9507
      description: "Logs EVPN RT create|delete|update event for an EVI."
      if: "['9505', '9506', '9507'].contains(ctx.event?.code)"
      patterns:
          - "^EVPN RT: %{DATA:aruba.evpn.rt} (created|deleted|updated) for EVI: %{DATA:network.vlan.id}$"
  - grok:
      field: message
      tag: evpn_event_9508_9509
      description: "Logs EVPN VTEP VNI add|delete event."
      if: "['9508', '9509'].contains(ctx.event?.code)"
      patterns:
          - "^VNI: %{DATA:aruba.evpn.vni} is (added|deleted) for EVPN Peer VTEP: %{DATA:aruba.evpn.vtep_ip}$"
  - grok:
      field: message
      tag: evpn_event_9510
      description: "Logs EVPN static MAC conflict event."
      if: "ctx.event?.code == '9510'"
      patterns:
        - "^EVPN static MAC conflict %{DATA:event.action}, MAC: %{MAC:client.mac}, IP address: %{IP:client.ip}, VTEP: %{IP:aruba.evpn.vtep_ip}$"
  - grok:
      field: message
      tag: evpn_event_9511
      description: "Logs EVPN static MAC conflict event."
      if: "ctx.event?.code == '9511'"
      patterns:
        - "^EVPN static MAC conflict %{DATA:event.action}, MAC: %{MAC:client.mac}$"
  - grok:
      field: message
      tag: evpn_event_9512
      description: "Logs EVPN duplicate MAC dampening event."
      if: "ctx.event?.code == '9512'"
      patterns:
        - "^EVPN duplicate MAC dampening %{DATA:event.action}, MAC: %{MAC:client.mac}$"
  - grok:
      field: message
      tag: evpn_event_9513_9514
      description: "Logs EVPN VRF create|delete event."
      if: "['9513', '9514'].contains(ctx.event?.code)"
      patterns:
          - "^EVPN VRF: %{DATA:aruba.vrf.id} (created|deleted)"
  - dissect:
      field: message
      tag: evpn_event_9515
      description: "Logs EVPN VRF RD update event."
      if: "ctx.event?.code == '9515'"
      pattern: "EVPN RD: %{aruba.evpn.rd} updated for VRF: %{aruba.vrf.id}"
  - grok:
      field: message
      tag: evpn_event_9516_9517_9518
      description: "Logs EVPN VRF RT create|delete|update event."
      if: "['9516', '9517', '9518'].contains(ctx.event?.code)"
      patterns:
          - "^EVPN RT: %{DATA:aruba.evpn.rt} (created|deleted|updated) for VRF: %{DATA:aruba.vrf.id}$"

  # ACLs events (100xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/ACL.htm
  - grok:
      if: "ctx.event.code == '10002'"
      tag: acl_event_10002
      field: "message"
      description: "ACL log statistics"
      patterns:
        - "^%{DATA:aruba.acl.name} on %{DATA:aruba.interface.name} \\(%{DATA:aruba.acl.direction}\\): %{NUMBER:aruba.acl.hit_delta:long} %{GREEDYDATA:aruba.acl.ace_string}"
  - dissect:
      if: "ctx.event.code == '10003'"
      tag: acl_event_10003
      field: "message"
      description: "ACL application failure"
      pattern: "ACL %{aruba.acl.type} %{aruba.acl.name} failed to apply on %{aruba.acl.application}"

  # ARP security events (104xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/ARP-SECURITY.htm
  - grok:
      if: "['10401', '10402'].contains(ctx.event?.code)"
      tag: arp_event_10401_10402
      field: "message"
      description: "ARP inspection configuration on VLAN | ARP inspection port mode configuration"
      patterns:
        - "^ARP inspection %{DATA:aruba.status} on vlan %{GREEDYDATA:network.vlan.id}."
        - "^ARP inspection %{DATA:aruba.status} on port %{GREEDYDATA:aruba.port}."

  # DPSE Events (109xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/DPSE.htm
  - dissect:
      field: message
      tag: dpse_event_10901
      description: "A line card hit a backplane sequence error that triggered a recovery operation"
      if: "ctx.event?.code == '10901'"
      pattern: "Line card module %{aruba.dpse.linecard_name} triggered backplane sequence recovery"
  - dissect:
      field: message
      tag: dpse_event_10904
      description: "The system completed backplane sequence recovery triggered by line card error"
      if: "ctx.event?.code == '10904'"
      pattern: "Line card module %{aruba.dpse.linecard_name} completed backplane sequence recovery"

  # Fault Monitor Events (111xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/FAULT_MONITOR.htm
  - grok:
      field: message
      tag: fault_monitor_event_11101_11102
      description: >
        Logs event when a fault is detected on an interface.
        Logs event and shutdown the interface when a fault is detected on an interface.
      if: "['11101', '11102'].contains(ctx.event?.code)"
      patterns:
          - "^Interface %{DATA:aruba.interface.name}: %{DATA:aruba.fault.type} fault detected( and port disabled)?"
  - grok:
      field: message
      tag: fault_monitor_event_11103
      description: "Interface is auto-enabled on timer expiry."
      if: "ctx.event?.code == '11103'"
      patterns:
          - "^Interface %{DATA:aruba.interface.name}: %{DATA:aruba.fault.type} fault re-enable time expired, port enabled"
  - grok:
      field: message
      tag: fault_monitor_event_11104
      description: "Interface is auto-enabled on profile configuration change."
      if: "ctx.event?.code == '11104'"
      patterns:
          - "^Interface %{DATA:aruba.interface.name}: %{DATA:aruba.fault.type} fault disable cancelled due to configuration change"
  - grok:
      field: message
      tag: fault_monitor_event_11105
      description: "Interface is auto-enabled on admin state change."
      if: "ctx.event?.code == '11105'"
      patterns:
          - "^Admin state changed and interface: %{DATA:aruba.interface.name} is auto-enabled"
  - grok:
      field: message
      tag: fault_monitor_event_11106
      description: "Logs event when disabling of a faulty interface failed."
      if: "ctx.event?.code == '11106'"
      patterns:
          - "^Interface %{DATA:aruba.interface.name}: %{DATA:aruba.fault.type} fault detected, port is already disabled by another fault"
  - grok:
      field: message
      tag: fault_monitor_event_11107
      description: "Logs event when a packet drop is detected for MAC Lockout MAC as source address."
      if: "ctx.event?.code == '11107'"
      patterns:
          - "^MAC Lockout packet drop detected for %{MAC:client.mac} as source address: %{NUMBER:aruba.fault.sa_diff_count:long}"
  - grok:
      field: message
      tag: fault_monitor_event_11108
      description: "Logs event when a packet drop is detected for MAC Lockout MAC as destination address."
      if: "ctx.event?.code == '11108'"
      patterns:
          - "^MAC Lockout packet drop detected for %{MAC:client.mac} as destination address: %{NUMBER:aruba.fault.da_diff_count:long}"
  - grok:
      field: message
      tag: fault_monitor_event_11109
      description: "Logs event when a packet drop is detected for MAC Lockout."
      if: "ctx.event?.code == '11109'"
      patterns:
          - "^MAC Lockout packet drop detected for %{MAC:client.mac} as source: %{NUMBER:aruba.fault.sa_diff_count:long} and destination: %{NUMBER:aruba.fault.da_diff_count:long} address"

  # CFM Events (116xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/ETH_OAM_CFM.htm
  - dissect:
      field: message
      tag: cfm_event_11601
      if: "ctx.event?.code == '11601'"
      pattern: "Connection lost for Maintenance Endpoint %{aruba.cfm.id} on %{aruba.cfm.interface}."
  - dissect:
      field: message
      tag: cfm_event_11602
      if: "ctx.event?.code == '11602'"
      pattern: "Connection restored for Maintenance Endpoint %{aruba.cfm.id} on %{aruba.cfm.interface}."

  # Container Manager Events (118xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/CONTAINER.htm
  - dissect:
      field: message
      tag: container_manager_event_11801_11802_11803
      if: "['11801', '11802', '11803'].contains(ctx.event?.code)"
      pattern: "Container %{container.name} is %{?ignore_action}"

  # DNS Client Events (119xx)
  # https://www.arubanetworks.com/techdocs/AOS-CX/10.07/HTML/5200-8214/Content/events/DNS_CLIENT.htm
  - grok:
      field: message
      tag: dns_client_event_11901
      description: "Event reported when DNS event triggered"
      if: "['11901'].contains(ctx.event?.code)"
      patterns:
        - "%{DATA:aruba.dns.type} event for VRF %{DATA:aruba.dns.vrf_name}$"

  # Cleanup MAC addresses for different fields
  - uppercase:
      field: client.mac
      ignore_missing: true
  - gsub:
      field: client.mac
      pattern: "[:.]"
      replacement: "-"
      ignore_missing: true
  - uppercase:
      field: source.mac
      ignore_missing: true
  - gsub:
      field: source.mac
      pattern: "[:.]"
      replacement: "-"
      ignore_missing: true
  - uppercase:
      field: host.mac
      ignore_missing: true
  - gsub:
      field: host.mac
      pattern: "[:.]"
      replacement: "-"
      ignore_missing: true

  # Make sure that host.ip and host.mac are arrays
  - set:
      field: host.ip
      value: ['{{{host.ip}}}']
      if: ctx.host?.ip instanceof String
  - set:
      field: host.mac
      value: ['{{{host.mac}}}']
      if: ctx.host?.mac instanceof String

  # Convert aruba.slot from a string to a long
  # Dissect processor sets everything to a string type
  - convert:
      tag: convert_aruba_slot
      field: aruba.slot
      type: long
      ignore_missing: true


on_failure:
  - set:
      field: event.kind
      value: pipeline_error
  - append:
      field: error.message
      value: "{{{ _ingest.on_failure_message }}}"
