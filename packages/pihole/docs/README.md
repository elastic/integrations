<!-- NOTICE: Do not edit this file manually.-->
<!-- This file is automatically generated by Elastic Package -->

# Pi-hole Integration

The Pi-hole Integration allows you to monitor DNS query activity from your Pi-hole instances. Pi-hole is a network-level DNS filtering application that blocks ads and trackers.

Use the Pi-hole Integration to collect DNS query logs from your Pi-hole instances. Then visualize that data in Kibana, create alerts to notify you of DNS issues or suspicious activity, and analyze network traffic patterns.

## Data streams

The Pi-hole Integration collects both logs and metrics that provide insights into DNS activity on your network:

### Logs
- **DNS Queries**: Individual DNS query records with query type, resolution status, client information, upstream server details, and DNSSEC status

### Metrics
- **Query History**: Time-series metrics showing DNS query volume over time, broken down by total queries, cached responses, blocked queries, and forwarded queries
- **Pi-hole Summary**: Comprehensive statistics including total queries, blocking effectiveness, query type breakdowns (A, AAAA, PTR, etc.), query status breakdowns (cache hits, forwarded, blocked, etc.), and query reply types
- **Top Clients**: Metrics identifying the most active DNS clients on your network, with separate tracking for allowed and blocked queries
- **Top Domains**: Metrics showing the most frequently queried domains, with separate tracking for allowed and blocked domains

## Requirements

You need Elasticsearch for storing and searching your data and Kibana for visualizing and managing it.
You can use our hosted Elasticsearch Service on Elastic Cloud, which is recommended, or self-manage the Elastic Stack on your own hardware.

### Pi-hole Requirements

- Pi-hole instance (v6.0 or later recommended) with API access enabled
- Admin panel password for authentication
- Network connectivity from the Elastic Agent to the Pi-hole instance
- Pi-hole API endpoint accessible at `http(s)://<pihole-url>/api/`

## Setup

For step-by-step instructions on how to set up an integration, see the
[Getting started](https://www.elastic.co/guide/en/welcome-to-elastic/current/getting-started-observability.html) guide.

### Pi-hole API Authentication

This integration uses Pi-hole's session-based authentication mechanism:

1. The integration POSTs the admin password to `/api/auth` to obtain a session ID (SID)
2. The SID is included in the `X-FTL-SID` header for all subsequent API requests
3. After data collection completes, the session is terminated with a DELETE request to `/api/auth`

Each collection cycle obtains a fresh session ID and terminates it after use, preventing authentication errors from session expiration.

### Configuration

**Required Fields:**
- **Pi-hole URL**: The URL of your Pi-hole instance (e.g., `http://192.168.1.1` or `https://pihole.example.com`)
- **API Password**: Your Pi-hole admin panel password

**Optional Fields:**
- **Collection Interval**: How often to collect DNS queries (default: 60s). For high-volume networks (>400 queries/minute), consider reducing to 10-15 seconds to avoid missing queries.
- **Proxy URL**: Optional HTTP proxy for connecting to Pi-hole
- **SSL Configuration**: Custom SSL/TLS settings for HTTPS connections
- **HTTP Client Timeout**: Request timeout duration (default: 30s)

### Data Collection Strategy

**DNS Queries (Logs):**
The integration uses timestamp-based pagination to avoid duplicate records:
- On the first run, it collects up to 1000 most recent queries
- On subsequent runs, it fetches only queries newer than the last collection using the `from` parameter
- The timestamp cursor persists across agent restarts and integration upgrades
- Maximum of 1000 queries per collection interval (adjust interval if you exceed this limit)

**Metrics Data Streams:**
Query History, Pi-hole Summary, Top Clients, and Top Domains collect point-in-time snapshots at each collection interval:
- Default collection interval: 5 minutes (configurable per data stream)
- No pagination required - each collection captures the current state
- Query History provides 10-minute interval buckets for time-series analysis
- Top Clients and Top Domains each collect top 10 allowed and top 10 blocked items per collection

## Logs reference

### DNS Queries

The `dns_queries` data stream collects individual DNS query records from Pi-hole with detailed information about each query.

**Collected Information:**
- DNS query details (domain, query type, response code)
- Client information (IP address, hostname)
- Upstream DNS server
- Query status (cached, forwarded, blocked, etc.)
- DNSSEC validation status
- Reply time in seconds
- Extended DNS Error (EDE) codes and text
- CNAME records (if applicable)
- Gravity list ID (for blocked queries)

#### Example Event

An example event for `dns_queries` looks as following:

```json
{
    "@timestamp": "2024-10-22T17:47:49.139Z",
    "data_stream": {
        "type": "logs",
        "dataset": "pihole.dns_queries",
        "namespace": "default"
    },
    "ecs": {
        "version": "8.11.0"
    },
    "event": {
        "kind": "event",
        "category": [
            "network"
        ],
        "type": [
            "protocol"
        ],
        "module": "pihole",
        "dataset": "pihole.dns_queries"
    },
    "dns": {
        "question": {
            "name": "monitor.example.com",
            "type": "AAAA"
        },
        "response_code": "NODATA"
    },
    "source": {
        "ip": "192.168.1.100",
        "domain": "workstation.example.com"
    },
    "observer": {
        "vendor": "Pi-hole",
        "product": "Pi-hole",
        "type": "dns"
    },
    "pihole": {
        "query": {
            "id": 22438755,
            "status": "CACHE",
            "dnssec": "UNKNOWN",
            "reply_time": 0.0000243
        },
        "ede": {
            "code": -1
        }
    }
}
```

#### ECS Field Mappings

The integration maps Pi-hole data to the Elastic Common Schema (ECS):

| Pi-hole Field | ECS Field | Description |
|--------------|-----------|-------------|
| `domain` | `dns.question.name` | The queried domain name |
| `type` | `dns.question.type` | DNS record type (A, AAAA, CNAME, etc.) |
| `reply_type` | `dns.response_code` | DNS response code |
| `client_ip` | `source.ip` | Client IP address |
| `client_name` | `source.domain` | Client hostname |
| `upstream_name` | `destination.ip` | Upstream DNS server |
| `time` | `@timestamp` | Query timestamp |

#### Exported fields

**Exported fields**

| Field | Description | Type |
|---|---|---|
| @timestamp | Event timestamp. | date |
| data_stream.dataset | Data stream dataset. | constant_keyword |
| data_stream.namespace | Data stream namespace. | constant_keyword |
| data_stream.type | Data stream type. | constant_keyword |
| destination.ip | Upstream DNS server that handled the query | keyword |
| dns.question.name | The domain name being queried | keyword |
| dns.question.type | The type of DNS record being queried (A, AAAA, CNAME, etc.) | keyword |
| dns.response_code | The DNS response code | keyword |
| observer.product | Observer product name | keyword |
| observer.type | Observer type | keyword |
| observer.vendor | Observer vendor name | keyword |
| pihole.cname | CNAME if the query resulted in a CNAME | keyword |
| pihole.ede.code | Extended DNS Error code | long |
| pihole.ede.text | Extended DNS Error text | keyword |
| pihole.list_id | Gravity list ID if the query matched a blocklist | long |
| pihole.query.dnssec | DNSSEC status (UNKNOWN, SECURE, INSECURE, BOGUS) | keyword |
| pihole.query.id | Unique identifier for this query | long |
| pihole.query.reply_time | Query reply time in seconds | double |
| pihole.query.status | Status of the query (CACHE, FORWARDED, BLOCKED, ALLOWED, etc.) | keyword |
| source.domain | Domain name/hostname of the client | keyword |
| source.ip | IP address of the client | ip |


## Metrics reference

### Query History

The `query_history` data stream collects time-series metrics showing DNS query patterns over time with 10-minute intervals.

**Collected Information:**
- Total DNS queries in the interval
- Queries answered from cache
- Blocked queries
- Queries forwarded to upstream DNS servers

This data stream is ideal for tracking DNS traffic patterns, identifying peak usage times, and monitoring the effectiveness of Pi-hole's caching and blocking mechanisms.

#### Example Event

An example event for `query_history` looks as following:

```json
{
    "@timestamp": "2024-12-30T14:15:00.000Z",
    "data_stream": {
        "type": "metrics",
        "dataset": "pihole.query_history",
        "namespace": "default"
    },
    "ecs": {
        "version": "8.11.0"
    },
    "event": {
        "kind": "metric",
        "category": [
            "network"
        ],
        "type": [
            "info"
        ],
        "module": "pihole",
        "dataset": "pihole.query_history"
    },
    "observer": {
        "vendor": "Pi-hole",
        "product": "Pi-hole",
        "type": "dns"
    },
    "pihole": {
        "query_history": {
            "total": 487,
            "cached": 245,
            "blocked": 98,
            "forwarded": 144
        }
    }
}
```

#### Exported fields

**Exported fields**

| Field | Description | Type | Metric Type |
|---|---|---|---|
| @timestamp | Event timestamp. | date |  |
| data_stream.dataset | Data stream dataset. | constant_keyword |  |
| data_stream.namespace | Data stream namespace. | constant_keyword |  |
| data_stream.type | Data stream type. | constant_keyword |  |
| event.category | Event category. | keyword |  |
| event.dataset | Event dataset name. | keyword |  |
| event.kind | Event kind (metric). | keyword |  |
| event.module | Event module name. | keyword |  |
| event.type | Event type. | keyword |  |
| observer.product | Observer product name. | keyword |  |
| observer.type | Observer type. | keyword |  |
| observer.vendor | Observer vendor name. | keyword |  |
| pihole.query_history.blocked | Number of queries blocked in this time period | long | gauge |
| pihole.query_history.cached | Number of queries answered from cache in this time period | long | gauge |
| pihole.query_history.forwarded | Number of queries forwarded to upstream DNS servers in this time period | long | gauge |
| pihole.query_history.total | Total number of DNS queries in this time period | long | gauge |


### Pi-hole Summary

The `pihole_summary` data stream collects comprehensive statistics about Pi-hole's overall performance and activity.

**Collected Information:**
- Total queries and blocking statistics
- Query frequency (queries per minute)
- Unique domains and clients
- Gravity list information and last update timestamp
- Query type breakdown (A, AAAA, PTR, TXT, MX, HTTPS, SVCB, and 10+ other record types)
- Query status breakdown (cache hits, forwarded, blocked by gravity/regex, special domains, stale cache, and 10+ other statuses)
- Query reply type breakdown (NODATA, NXDOMAIN, CNAME, IP, SERVFAIL, and 10+ other reply types)

This data stream provides a complete picture of Pi-hole's DNS filtering and caching behavior, making it invaluable for capacity planning, troubleshooting, and security monitoring.

#### Example Event

An example event for `pihole_summary` looks as following:

```json
{
    "@timestamp": "2024-12-30T16:00:00.000Z",
    "data_stream": {
        "type": "metrics",
        "dataset": "pihole.pihole_summary",
        "namespace": "default"
    },
    "ecs": {
        "version": "8.11.0"
    },
    "event": {
        "kind": "metric",
        "category": [
            "network"
        ],
        "type": [
            "info"
        ],
        "module": "pihole",
        "dataset": "pihole.pihole_summary"
    },
    "observer": {
        "vendor": "Pi-hole",
        "product": "Pi-hole",
        "type": "dns"
    },
    "pihole": {
        "summary": {
            "dns_queries_today": 579557,
            "ads_blocked_today": 33293,
            "ads_percentage_today": 5.74,
            "domains_being_blocked": 86832,
            "queries_forwarded": 16036,
            "queries_cached": 527297,
            "clients_ever_seen": 117,
            "unique_clients": 72,
            "unique_domains": 17410,
            "query_frequency": 6.33,
            "gravity_last_update": 1767139800,
            "status": "enabled",
            "query_types": {
                "a": 342193,
                "aaaa": 186269,
                "any": 0,
                "srv": 133,
                "soa": 417,
                "ptr": 15328,
                "txt": 1310,
                "naptr": 56,
                "mx": 640,
                "ds": 0,
                "rrsig": 0,
                "dnskey": 0,
                "ns": 0,
                "svcb": 2819,
                "https": 30383,
                "other": 9
            },
            "query_status": {
                "unknown": 1,
                "gravity": 5240,
                "forwarded": 16025,
                "cache": 440217,
                "regex": 11594,
                "denylist": 0,
                "external_blocked_ip": 0,
                "external_blocked_null": 0,
                "external_blocked_nxra": 0,
                "gravity_cname": 41,
                "regex_cname": 0,
                "denylist_cname": 0,
                "retried": 11,
                "retried_dnssec": 0,
                "in_progress": 2930,
                "dbbusy": 0,
                "special_domain": 16418,
                "cache_stale": 87080,
                "external_blocked_ede15": 0
            },
            "query_replies": {
                "unknown": 150,
                "nodata": 203929,
                "nxdomain": 28966,
                "cname": 50400,
                "ip": 292083,
                "domain": 1717,
                "rrname": 26,
                "servfail": 24,
                "refused": 0,
                "notimp": 0,
                "other": 0,
                "dnssec": 0,
                "none": 0,
                "blob": 2262
            }
        }
    }
}
```

#### Exported fields

**Exported fields**

| Field | Description | Type | Metric Type |
|---|---|---|---|
| @timestamp | Event timestamp. | date |  |
| data_stream.dataset | Data stream dataset. | constant_keyword |  |
| data_stream.namespace | Data stream namespace. | constant_keyword |  |
| data_stream.type | Data stream type. | constant_keyword |  |
| event.category | Event category. | keyword |  |
| event.dataset | Event dataset name. | keyword |  |
| event.kind | Event kind (metric). | keyword |  |
| event.module | Event module name. | keyword |  |
| event.type | Event type. | keyword |  |
| observer.product | Observer product name. | keyword |  |
| observer.type | Observer type. | keyword |  |
| observer.vendor | Observer vendor name. | keyword |  |
| pihole.summary.ads_blocked_today | Number of ads blocked today | long | gauge |
| pihole.summary.ads_percentage_today | Percentage of queries blocked today | double | gauge |
| pihole.summary.clients_ever_seen | Total number of clients ever seen | long | gauge |
| pihole.summary.dns_queries_today | Total number of DNS queries today | long | gauge |
| pihole.summary.domains_being_blocked | Total number of domains in blocklist | long | gauge |
| pihole.summary.gravity_last_update | Timestamp of last gravity list update | long | gauge |
| pihole.summary.queries_cached | Number of queries answered from cache | long | gauge |
| pihole.summary.queries_forwarded | Number of queries forwarded to upstream DNS | long | gauge |
| pihole.summary.query_frequency | Query frequency per minute | double | gauge |
| pihole.summary.query_replies.blob | Number of BLOB replies | long | gauge |
| pihole.summary.query_replies.cname | Number of CNAME replies | long | gauge |
| pihole.summary.query_replies.dnssec | Number of DNSSEC replies | long | gauge |
| pihole.summary.query_replies.domain | Number of domain replies | long | gauge |
| pihole.summary.query_replies.ip | Number of IP address replies | long | gauge |
| pihole.summary.query_replies.nodata | Number of NODATA replies | long | gauge |
| pihole.summary.query_replies.none | Number of queries with no reply | long | gauge |
| pihole.summary.query_replies.notimp | Number of NOTIMP replies | long | gauge |
| pihole.summary.query_replies.nxdomain | Number of NXDOMAIN replies | long | gauge |
| pihole.summary.query_replies.other | Number of other reply types | long | gauge |
| pihole.summary.query_replies.refused | Number of REFUSED replies | long | gauge |
| pihole.summary.query_replies.rrname | Number of RRNAME replies | long | gauge |
| pihole.summary.query_replies.servfail | Number of SERVFAIL replies | long | gauge |
| pihole.summary.query_replies.unknown | Number of queries with unknown reply | long | gauge |
| pihole.summary.query_status.cache | Number of queries answered from cache | long | gauge |
| pihole.summary.query_status.cache_stale | Number of queries answered from stale cache | long | gauge |
| pihole.summary.query_status.dbbusy | Number of queries delayed due to database busy | long | gauge |
| pihole.summary.query_status.denylist | Number of queries blocked by denylist | long | gauge |
| pihole.summary.query_status.denylist_cname | Number of queries blocked by denylist CNAME | long | gauge |
| pihole.summary.query_status.external_blocked_ede15 | Number of queries blocked by external EDE15 | long | gauge |
| pihole.summary.query_status.external_blocked_ip | Number of queries blocked by external IP blocking | long | gauge |
| pihole.summary.query_status.external_blocked_null | Number of queries blocked by external null blocking | long | gauge |
| pihole.summary.query_status.external_blocked_nxra | Number of queries blocked by external NXRA blocking | long | gauge |
| pihole.summary.query_status.forwarded | Number of queries forwarded to upstream | long | gauge |
| pihole.summary.query_status.gravity | Number of queries blocked by gravity | long | gauge |
| pihole.summary.query_status.gravity_cname | Number of queries blocked by gravity CNAME | long | gauge |
| pihole.summary.query_status.in_progress | Number of queries in progress | long | gauge |
| pihole.summary.query_status.regex | Number of queries blocked by regex | long | gauge |
| pihole.summary.query_status.regex_cname | Number of queries blocked by regex CNAME | long | gauge |
| pihole.summary.query_status.retried | Number of retried queries | long | gauge |
| pihole.summary.query_status.retried_dnssec | Number of retried DNSSEC queries | long | gauge |
| pihole.summary.query_status.special_domain | Number of queries for special domains | long | gauge |
| pihole.summary.query_status.unknown | Number of queries with unknown status | long | gauge |
| pihole.summary.query_types.a | Number of A record queries | long | gauge |
| pihole.summary.query_types.aaaa | Number of AAAA record queries | long | gauge |
| pihole.summary.query_types.any | Number of ANY record queries | long | gauge |
| pihole.summary.query_types.dnskey | Number of DNSKEY record queries | long | gauge |
| pihole.summary.query_types.ds | Number of DS record queries | long | gauge |
| pihole.summary.query_types.https | Number of HTTPS record queries | long | gauge |
| pihole.summary.query_types.mx | Number of MX record queries | long | gauge |
| pihole.summary.query_types.naptr | Number of NAPTR record queries | long | gauge |
| pihole.summary.query_types.ns | Number of NS record queries | long | gauge |
| pihole.summary.query_types.other | Number of other record type queries | long | gauge |
| pihole.summary.query_types.ptr | Number of PTR record queries | long | gauge |
| pihole.summary.query_types.rrsig | Number of RRSIG record queries | long | gauge |
| pihole.summary.query_types.soa | Number of SOA record queries | long | gauge |
| pihole.summary.query_types.srv | Number of SRV record queries | long | gauge |
| pihole.summary.query_types.svcb | Number of SVCB record queries | long | gauge |
| pihole.summary.query_types.txt | Number of TXT record queries | long | gauge |
| pihole.summary.status | Pi-hole status (enabled/disabled) | keyword |  |
| pihole.summary.unique_clients | Number of unique clients seen today | long | gauge |
| pihole.summary.unique_domains | Number of unique domains queried today | long | gauge |


### Top Clients

The `top_clients` data stream identifies the most active DNS clients on your network.

**Collected Information:**
- Client IP address and hostname
- Number of queries from each client
- Query action (allowed or blocked)
- Total queries and blocked queries across all clients

Each collection gathers the top 10 clients for allowed queries and top 10 clients for blocked queries, providing visibility into both normal DNS usage patterns and potential security issues or misconfigured devices.

#### Example Event

An example event for `top_clients` looks as following:

```json
{
    "@timestamp": "2024-12-30T16:30:00.000Z",
    "data_stream": {
        "type": "metrics",
        "dataset": "pihole.top_clients",
        "namespace": "default"
    },
    "ecs": {
        "version": "8.11.0"
    },
    "event": {
        "kind": "metric",
        "category": [
            "network"
        ],
        "type": [
            "info"
        ],
        "module": "pihole",
        "dataset": "pihole.top_clients"
    },
    "observer": {
        "vendor": "Pi-hole",
        "product": "Pi-hole",
        "type": "dns"
    },
    "client": {
        "ip": "192.168.1.100",
        "domain": "workstation.example.com"
    },
    "pihole": {
        "top_clients": {
            "query_action": "allowed",
            "query_count": 126051
        }
    }
}
```

#### Exported fields

**Exported fields**

| Field | Description | Type | Metric Type |
|---|---|---|---|
| @timestamp | Event timestamp. | date |  |
| client.domain | Client hostname/domain. | keyword |  |
| client.ip | Client IP address. | ip |  |
| data_stream.dataset | Data stream dataset. | constant_keyword |  |
| data_stream.namespace | Data stream namespace. | constant_keyword |  |
| data_stream.type | Data stream type. | constant_keyword |  |
| event.category | Event category. | keyword |  |
| event.dataset | Event dataset name. | keyword |  |
| event.kind | Event kind (metric). | keyword |  |
| event.module | Event module name. | keyword |  |
| event.type | Event type. | keyword |  |
| observer.product | Observer product name. | keyword |  |
| observer.type | Observer type. | keyword |  |
| observer.vendor | Observer vendor name. | keyword |  |
| pihole.top_clients.query_action | Action taken on queries (allowed or blocked) | keyword |  |
| pihole.top_clients.query_count | Number of DNS queries from this client | long | gauge |


### Top Domains

The `top_domains` data stream shows the most frequently queried domains.

**Collected Information:**
- Domain name
- Number of queries for the domain
- Query action (allowed or blocked)
- Total queries and blocked queries across all domains

Each collection gathers the top 10 allowed domains and top 10 blocked domains, helping identify popular services, potential data exfiltration attempts, and the effectiveness of blocklists.

#### Example Event

An example event for `top_domains` looks as following:

```json
{
    "@timestamp": "2024-12-30T18:30:00.000Z",
    "data_stream": {
        "type": "metrics",
        "dataset": "pihole.top_domains",
        "namespace": "default"
    },
    "ecs": {
        "version": "8.11.0"
    },
    "event": {
        "kind": "metric",
        "category": [
            "network"
        ],
        "type": [
            "info"
        ],
        "module": "pihole",
        "dataset": "pihole.top_domains"
    },
    "observer": {
        "vendor": "Pi-hole",
        "product": "Pi-hole",
        "type": "dns"
    },
    "dns": {
        "question": {
            "name": "api.example.com"
        }
    },
    "pihole": {
        "top_domains": {
            "query_action": "allowed",
            "query_count": 235054,
            "total_queries": 577849,
            "blocked_queries": 30142
        }
    }
}
```

#### Exported fields

**Exported fields**

| Field | Description | Type | Metric Type |
|---|---|---|---|
| @timestamp | Event timestamp. | date |  |
| data_stream.dataset | Data stream dataset. | constant_keyword |  |
| data_stream.namespace | Data stream namespace. | constant_keyword |  |
| data_stream.type | Data stream type. | constant_keyword |  |
| dns.question.name | Domain name being queried. | keyword |  |
| event.category | Event category. | keyword |  |
| event.dataset | Event dataset name. | keyword |  |
| event.kind | Event kind (metric). | keyword |  |
| event.module | Event module name. | keyword |  |
| event.type | Event type. | keyword |  |
| observer.product | Observer product name. | keyword |  |
| observer.type | Observer type. | keyword |  |
| observer.vendor | Observer vendor name. | keyword |  |
| pihole.top_domains.blocked_queries | Total number of blocked DNS queries | long | gauge |
| pihole.top_domains.query_action | Action taken on queries (allowed or blocked) | keyword |  |
| pihole.top_domains.query_count | Number of DNS queries for this domain | long | gauge |
| pihole.top_domains.total_queries | Total number of DNS queries across all domains | long | gauge |


## Troubleshooting

### Common Issues

**No data appearing in Elasticsearch:**
- Verify Pi-hole URL is correct and accessible from the Elastic Agent
- Check that the API password is correct
- Enable request tracing (`enable_request_tracer: true`) and check logs at `logs/cel/http-request-trace-*.ndjson`

**Missing queries (less than expected):**
- If you have high query volume (>400 queries/minute), reduce the collection interval to 10-15 seconds
- Check Elastic Agent logs for errors or timeouts

**Authentication errors:**
- Verify the admin password is correct
- Check Pi-hole API is accessible at `/api/auth`
- Ensure Pi-hole version supports session-based authentication (v6.0+)

For help with Elastic ingest tools, check [Common problems](https://www.elastic.co/docs/troubleshoot/ingest/fleet/common-problems).

## Scaling

For high-volume networks with multiple Pi-hole instances:
- Deploy separate Elastic Agent instances for each Pi-hole
- Use namespace separation to distinguish between different Pi-hole instances
- Consider reducing collection interval for high-traffic instances

For more information on architectures that can be used for scaling this integration, check the [Ingest Architectures](https://www.elastic.co/docs/manage-data/ingest/ingest-reference-architectures) documentation.

## Reference

### Inputs used

These inputs can be used with this integration:
<details>
<summary>cel</summary>

## Setup

For more details about the CEL input settings, check the [Filebeat documentation](https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-input-cel.html).

Before configuring the CEL input, make sure you have:
- Network connectivity to the target API endpoint
- Valid authentication credentials (API keys, tokens, or certificates as required)
- Appropriate permissions to read from the target data source

### Collecting logs from CEL

To configure the CEL input, you must specify the `request.url` value pointing to the API endpoint. The interval parameter controls how frequently requests are made and is the primary way to balance data freshness with API rate limits and costs. Authentication is often configured through the `request.headers` section using the appropriate method for the service.

NOTE: To access the API service, make sure you have the necessary API credentials and that the Filebeat instance can reach the endpoint URL. Some services may require IP whitelisting or VPN access.

To collect logs via API endpoint, configure the following parameters:

- API Endpoint URL
- API credentials (tokens, keys, or username/password)
- Request interval (how often to fetch data)
</details>


### API usage

This integration uses the following Pi-hole API endpoints:

**Authentication:**
- `POST /api/auth` - Authenticates and obtains a session ID
- `DELETE /api/auth` - Terminates the session

**Data Collection:**
- `GET /api/queries?length=1000&from=<timestamp>` - Retrieves DNS query logs with timestamp-based filtering (dns_queries data stream)
- `GET /api/history` - Retrieves time-series query metrics (query_history data stream)
- `GET /api/stats/summary` - Retrieves comprehensive Pi-hole statistics (pihole_summary data stream)
- `GET /api/stats/top_clients?blocked=false` - Retrieves top allowed DNS clients (top_clients data stream)
- `GET /api/stats/top_clients?blocked=true` - Retrieves top blocked DNS clients (top_clients data stream)
- `GET /api/stats/top_domains?blocked=false` - Retrieves top allowed domains (top_domains data stream)
- `GET /api/stats/top_domains?blocked=true` - Retrieves top blocked domains (top_domains data stream)

All data collection endpoints require authentication via the `X-FTL-SID` header. Each data stream manages its own session lifecycle independently.

For more information about the Pi-hole API, see the [Pi-hole API documentation](https://docs.pi-hole.net/ftldns/api/).
