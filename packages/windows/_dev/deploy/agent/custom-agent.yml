version: "2.3"
services:
  docker-custom-agent:
    build:
      context: .
      args:
        ES_AGENT_IMAGE: ${ELASTIC_AGENT_IMAGE_REF}
      dockerfile: Dockerfile
    # image: "${ELASTIC_AGENT_IMAGE_REF}"
    # image: elastic-agent-oracle-client-1
    healthcheck:
      test: "elastic-agent status"
      retries: 180
      interval: 1s
    hostname: docker-custom-agent
    environment:
      - FLEET_ENROLL=1
      - FLEET_URL=https://fleet-server:8220
      - KIBANA_HOST=https://kibana:5601
    volumes:
      - ${SERVICE_LOGS_DIR}:/tmp/service_logs/
      - ${LOCAL_CA_CERT}:/etc/ssl/certs/elastic-package.pem

