rules:
  - path: /oauth2/token
    methods: ['POST']
    query_params:
      grant_type: client_credentials
      client_id: xxxx
      client_secret: xxxx
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |
          {"access_token":"xxxx","expires_in":600,"token_type":"Bearer"}
  - path: /api/v1/detections/search
    methods: ['POST']
    request_body: /.*"limit":2.*"offset":4.*/
    request_headers:
      Authorization:
        - 'Bearer xxxx'
    responses:
      - status_code: 200
        body: |
          {{ minify_json `
          [
            {
              "id": 25769804215,
              "start_time": 1751932396000,
              "update_time": 1751933051000,
              "end_time": 1751933051000,
              "title": "Hacking Tool Domain Access",
              "description": "[Device john@extrahop\\.com](https://extrahop-bd.cloud.extrahop.com#/metrics/devices/d5fb171e10ef435bbb77a9c7b3d46362.pankajp%40extrahop.com/overview?from=1751932396&interval_type=DT&until=1751933051) connected to a domain associated with a known hacking tool such as Kali Linux. Certain hacking tools might be prohibited on your network because they can enable malicious activity. Investigate to determine if this activity is expected, or if a user is attempting to gain access to unauthorized hacking tools.\n\nHacking tool linked to this detection:\n* Kali Linux",
              "risk_score": 78,
              "type": "hacking_tools",
              "recommended_factors": [],
              "recommended": false,
              "categories": [
                "sec",
                "sec.caution",
                "sec.attack"
              ],
              "properties": {
                "client_port": 63855,
                "server_port": 443,
                "hacking_tool_name": "Kali Linux"
              },
              "participants": [
                {
                  "role": "offender",
                  "scanner_service": null,
                  "endpoint": "client",
                  "external": false,
                  "object_id": 17179869303,
                  "object_type": "device",
                  "object_value": "67.43.156.0",
                  "username": null,
                  "id": 8026
                },
                {
                  "role": "victim",
                  "scanner_service": null,
                  "endpoint": "server",
                  "external": true,
                  "object_id": 17179869185,
                  "object_type": "ipaddr",
                  "object_value": "89.160.20.112",
                  "hostname": "www.kali.org",
                  "username": null,
                  "id": 6170
                },
                {
                  "role": "victim",
                  "scanner_service": null,
                  "endpoint": "server",
                  "external": true,
                  "object_id": 17179869185,
                  "object_type": "ipaddr",
                  "object_value": "81.2.69.192",
                  "hostname": "cdimage.kali.org",
                  "username": null,
                  "id": 8028
                },
                {
                  "role": "victim",
                  "scanner_service": null,
                  "endpoint": "server",
                  "external": true,
                  "object_id": 17179869185,
                  "object_type": "ipaddr",
                  "object_value": "81.2.69.144",
                  "hostname": "kali.download",
                  "username": null,
                  "id": 8029
                }
              ],
              "ticket_id": null,
              "assignee": "tom.latham",
              "status": "new",
              "resolution": "action_taken",
              "mitre_tactics": [],
              "mitre_techniques": [],
              "appliance_id": 4,
              "is_user_created": false,
              "mod_time": 1751936884441,
              "create_time": 1751932415459,
              "url": "https://extrahop-bd.cloud.extrahop.com/extrahop/#/detections/detail/25769804215/?from=1751931496&until=1751933951&interval_type=DT"
            }
          ]
          `}}
  - path: /api/v1/detections/search
    methods: ['POST']
    request_body: /.*"limit":2.*"offset":2.*/
    request_headers:
      Authorization:
        - 'Bearer xxxx'
    responses:
      - status_code: 200
        body: |
          {{ minify_json `
          [
            {
              "id": 17179860713,
              "start_time": 1751932396000,
              "update_time": 1751933051000,
              "end_time": 1751933051000,
              "title": "Hacking Tool Domain Access",
              "description": "[Device john@extrahop\\.com](https://extrahop-bd.cloud.extrahop.com#/metrics/devices/d5fb171e10ef435bbb77a9c7b3d46362.pankajp%40extrahop.com/overview?from=1751932396&interval_type=DT&until=1751933051) connected to a domain associated with a known hacking tool such as Kali Linux. Certain hacking tools might be prohibited on your network because they can enable malicious activity. Investigate to determine if this activity is expected, or if a user is attempting to gain access to unauthorized hacking tools.\n\nHacking tool linked to this detection:\n* Kali Linux",
              "risk_score": 78,
              "type": "hacking_tools",
              "recommended_factors": [],
              "recommended": false,
              "categories": [
                "sec",
                "sec.caution",
                "sec.attack"
              ],
              "properties": {
                "client_port": 63855,
                "server_port": 443,
                "hacking_tool_name": "Kali Linux"
              },
              "participants": [
                {
                  "role": "offender",
                  "scanner_service": null,
                  "endpoint": "client",
                  "external": false,
                  "object_id": 17179869303,
                  "object_type": "device",
                  "object_value": "67.43.156.0",
                  "username": null,
                  "id": 8026
                },
                {
                  "role": "victim",
                  "scanner_service": null,
                  "endpoint": "server",
                  "external": true,
                  "object_id": 17179869185,
                  "object_type": "ipaddr",
                  "object_value": "89.160.20.112",
                  "hostname": "www.kali.org",
                  "username": null,
                  "id": 6170
                },
                {
                  "role": "victim",
                  "scanner_service": null,
                  "endpoint": "server",
                  "external": true,
                  "object_id": 17179869185,
                  "object_type": "ipaddr",
                  "object_value": "81.2.69.192",
                  "hostname": "cdimage.kali.org",
                  "username": null,
                  "id": 8028
                },
                {
                  "role": "victim",
                  "scanner_service": null,
                  "endpoint": "server",
                  "external": true,
                  "object_id": 17179869185,
                  "object_type": "ipaddr",
                  "object_value": "81.2.69.144",
                  "hostname": "kali.download",
                  "username": null,
                  "id": 8029
                }
              ],
              "ticket_id": null,
              "assignee": null,
              "status": null,
              "resolution": null,
              "mitre_tactics": [],
              "mitre_techniques": [],
              "appliance_id": 4,
              "is_user_created": false,
              "mod_time": 1751936884441,
              "create_time": 1751932415459,
              "url": "https://extrahop-bd.cloud.extrahop.com/extrahop/#/detections/detail/17179860713/?from=1751931496&until=1751933951&interval_type=DT"
            },
            {
              "id": 25769804127,
              "start_time": 1750935450304,
              "update_time": 1751347620747,
              "title": "SSL/TLS Server Certificate",
              "description": "[dc1\\.i\\.rx\\.tours](https://extrahop-bd.cloud.extrahop.com#/metrics/devices/71c6ffe3ae8548bbbb9bf279c912d3ae.0e9442d930570000/overview?from=1750935450&interval_type=DT&until=1751347650) served an SSL/TLS certificate scheduled to expire soon. Many web browsers and tools will not accept expired certificates. Renew certificates before they expire to ensure the availability of all services.",
              "risk_score": 11,
              "type": "cert_individual",
              "recommended_factors": [
                "top_offender"
              ],
              "recommended": true,
              "categories": [
                "sec",
                "sec.hardening"
              ],
              "properties": {
                "certificate": "dc1.attack.local:RSA_2048:3e426a1a3b2c2cae4cb51ec46b6c8a88"
              },
              "participants": [
                {
                  "role": "offender",
                  "scanner_service": "revealX-test",
                  "endpoint": "server",
                  "external": true,
                  "object_id": 25769803777,
                  "object_type": "device",
                  "object_value": "1.128.0.0",
                  "hostname": "dc1.i.rx.tours",
                  "username": "administrator@ATTACK.LOCAL",
                  "id": 7121
                }
              ],
              "ticket_id": 3041,
              "assignee": "tom.doe",
              "status": "new",
              "resolution": "action_taken",
              "mitre_tactics": [
                {
                  "id": "TA0007",
                  "name": "Discovery",
                  "url": "https://attack.mitre.org/tactics/TA0007"
                }
              ],
              "mitre_techniques": [
                {
                  "id": "T1087",
                  "name": "Account Discovery",
                  "url": "https://attack.mitre.org/techniques/T1087",
                  "legacy_ids": [
                    "T1087"
                  ]
                }
              ],
              "appliance_id": 6,
              "is_user_created": false,
              "mod_time": 1750935535971,
              "create_time": 1750935466182,
              "url": "https://extrahop-bd.cloud.extrahop.com/extrahop/#/detections/detail/25769804127/?from=1750934550&until=1751348520&interval_type=DT"
            }
          ]
          `}}
  - path: /api/v1/detections/search
    methods: ['POST']
    request_body: /.*"limit":2.*"offset":0.*/
    request_headers:
      Authorization:
        - 'Bearer xxxx'
    responses:
      - status_code: 200
        body: |
          {{ minify_json `
          [
            {
              "id": 25769805037,
              "start_time": 1750935450304,
              "update_time": 1751347620747,
              "title": "Expiring SSL/TLS Server Certificate",
              "description": "[dc1\\.i\\.rx\\.tours](https://extrahop-bd.cloud.extrahop.com#/metrics/devices/71c6ffe3ae8548bbbb9bf279c912d3ae.0e9442d930570000/overview?from=1750935450&interval_type=DT&until=1751347650) served an SSL/TLS certificate scheduled to expire soon. Many web browsers and tools will not accept expired certificates. Renew certificates before they expire to ensure the availability of all services.",
              "risk_score": 15,
              "type": "expiring_cert_individual",
              "recommended_factors": [
                "top_offender"
              ],
              "recommended": false,
              "categories": [
                "sec",
                "sec.hardening"
              ],
              "properties": {
                "certificate": "dc1.attack.local:RSA_2048:3e426a1a3b2c2cae4cb51ec46b6c8a88"
              },
              "participants": [
                {
                  "role": "offender",
                  "scanner_service": "revealX-test",
                  "endpoint": "server",
                  "external": false,
                  "object_id": 25769803777,
                  "object_type": "device",
                  "object_value": "1.128.0.0",
                  "hostname": "dc1.i.rx.tours",
                  "username": "administrator@ATTACK.LOCAL",
                  "id": 7121
                }
              ],
              "ticket_id": 3041,
              "assignee": "john.doe",
              "status": "open",
              "resolution": "no_action_taken",
              "mitre_tactics": [
                {
                  "id": "TA0007",
                  "name": "Discovery",
                  "url": "https://attack.mitre.org/tactics/TA0007"
                }
              ],
              "mitre_techniques": [
                {
                  "id": "T1087",
                  "name": "Account Discovery",
                  "url": "https://attack.mitre.org/techniques/T1087",
                  "legacy_ids": [
                    "T1087"
                  ]
                }
              ],
              "appliance_id": 6,
              "is_user_created": false,
              "mod_time": 1750935535971,
              "create_time": 1750935466182,
              "url": "https://extrahop-bd.cloud.extrahop.com/extrahop/#/detections/detail/25769805037/?from=1750934550&until=1751348520&interval_type=DT"
            },
            {
              "id": 25769803828,
              "start_time": 1739982210001,
              "update_time": 1739982300000,
              "end_time": 1739982300000,
              "title": "ICMP Tunnel",
              "description": "[Device 0e8398d29d3b0000](https://extrahop-bd.cloud.extrahop.com#/metrics/devices/71c6ffe3ae8548bbbb9bf279c912d3ae.0e8398d29d3b0000/overview?from=1739982210&interval_type=DT&until=1739982300) sent ICMP requests that contain unique payloads to an external IP address. The number of requests was unusually high compared to past activity for this device. Check for unexpected or unauthorized activity, such as hidden information within ping packets.\n\nThis device sent approximately 13000 ICMP requests with unique payloads to external hosts.",
              "risk_score": 61,
              "type": "icmp_tunnel",
              "recommended_factors": [
                "rare_type",
                "top_offender"
              ],
              "recommended": true,
              "categories": [
                "sec",
                "sec.command",
                "sec.attack"
              ],
              "properties": {},
              "participants": [
                {
                  "role": "offender",
                  "scanner_service": null,
                  "endpoint": "receiver",
                  "external": true,
                  "object_id": 25769803780,
                  "object_type": "ipaddr",
                  "object_value": "175.16.199.0",
                  "hostname": "09i2TY0xVtw7DPECOJQte01i7IK8B9FV.rx.tours",
                  "username": null,
                  "id": 7189
                },
                {
                  "role": "victim",
                  "scanner_service": null,
                  "endpoint": "sender",
                  "external": false,
                  "object_id": 25769803807,
                  "object_type": "device",
                  "object_value": "81.2.69.142",
                  "username": null,
                  "id": 7167
                }
              ],
              "ticket_id": "2996",
              "assignee": "sam.joe",
              "status": "open",
              "resolution": "action_taken",
              "mitre_tactics": [
                {
                  "id": "TA0011",
                  "name": "Command and Control",
                  "url": "https://attack.mitre.org/tactics/TA0011"
                }
              ],
              "mitre_techniques": [
                {
                  "id": "T1095",
                  "name": "Non-Application Layer Protocol",
                  "url": "https://attack.mitre.org/techniques/T1095",
                  "legacy_ids": [
                    "T1094",
                    "T1095"
                  ]
                },
                {
                  "id": "T1572",
                  "name": "Protocol Tunneling",
                  "url": "https://attack.mitre.org/techniques/T1572"
                }
              ],
              "appliance_id": 6,
              "is_user_created": false,
              "mod_time": 1739982342927,
              "create_time": 1739982284047,
              "url": "https://extrahop-bd.cloud.extrahop.com/extrahop/#/detections/detail/25769803828/?from=1739981310&until=1739983200&interval_type=DT"
            }
          ]
          `}}
  # Investigation
  - path: /api/v1/investigations/search
    methods: ['POST']
    request_body: '{}'
    request_headers:
      Authorization:
        - 'Bearer xxxx'
    responses:
      - status_code: 200
        body: |
          {{ minify_json `
          [
            {
              "id": 3,
              "notes": "Investigate Internally with AD logs",
              "status": "closed",
              "creation_time": 1747825693321,
              "update_time": 1747825693321,
              "last_interaction_time": 1748613881434,
              "name": "BloodHound Enumeration Investigation",
              "assessment": "benign_true_positive",
              "created_by": "integration@example.com",
              "assignee": "user1",
              "last_interaction_by": "user1",
              "description": "This investigation focuses on potential enumeration behavior observed through BloodHound. Review AD logs and user group mappings to verify intent and exposure.",
              "investigation_types": [
                "Active Directory",
                "Threat Hunting"
              ],
              "is_user_created": true,
              "start_time": 1747825693321,
              "end_time": 1748613881434,
              "detections": [
                25769803958
              ],
              "url": "https://example.com/#/detections/investigations/3"
            },
            {
              "id": 4,
              "notes": "Investigate Internally",
              "status": "open",
              "creation_time": 1747825693321,
              "update_time": 1747825693321,
              "last_interaction_time": 1748613881434,
              "name": "Investigation name 1",
              "assessment": "false_positive",
              "created_by": "abc@example.com",
              "assignee": "john.doe",
              "last_interaction_by": "tom.latham",
              "description": "This is investigation description.",
              "investigation_types": [
                "Threat Hunting"
              ],
              "is_user_created": false,
              "start_time": null,
              "end_time": null,
              "detections": [
                25769803958
              ],
              "url": "https://example.com/#/detections/investigations/4"
            },
            {
              "id": 54,
              "notes": null,
              "status": "open",
              "creation_time": 1752476957453,
              "update_time": 1752476957453,
              "last_interaction_time": 1752476957453,
              "name": "Investigation_Name_46",
              "assessment": "benign_true_positive",
              "created_by": "rest_api_id_1njj2",
              "assignee": "user_46",
              "last_interaction_by": "rest_api_id_1njj2",
              "description": "This is test description",
              "investigation_types": null,
              "is_user_created": true,
              "start_time": null,
              "end_time": null,
              "detections": [
                null
              ],
              "url": "https://example.com/#/detections/investigations/54"
            },
            {
              "id": 206,
              "notes": null,
              "status": "closed",
              "creation_time": 1752477002849,
              "update_time": 1752477002849,
              "last_interaction_time": 1752477002849,
              "name": "Investigation_Name_198",
              "assessment": "benign_true_positive",
              "created_by": "rest_api_id_1njj2",
              "assignee": "user_198",
              "last_interaction_by": "rest_api_id_1njj2",
              "description": "This is user 198",
              "investigation_types": null,
              "is_user_created": true,
              "start_time": null,
              "end_time": null,
              "detections": [
                null
              ],
              "url": "https://example.com/#/detections/investigations/206"
            },
            {
              "id": 10,
              "notes": "Investigate Internally logs",
              "status": "open",
              "creation_time": 1747825693321,
              "update_time": 1747825693321,
              "last_interaction_time": 1748613881434,
              "name": "Enumeration Investigation",
              "assessment": "undecided",
              "created_by": "tom@example.com",
              "assignee": "user2",
              "last_interaction_by": "user2",
              "description": "This investigation observed through Integration.",
              "investigation_types": [
                "Active Directory"
              ],
              "is_user_created": false,
              "start_time": 1747825693321,
              "end_time": 1748613881434,
              "detections": [
                25769803958
              ],
              "url": "https://example.com/#/detections/investigations/10"
            }
          ]
          `}}
