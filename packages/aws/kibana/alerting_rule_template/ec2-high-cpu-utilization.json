{
  "id": "ec2-high-cpu-utilization",
  "type": "alerting_rule_template",
  "attributes": {
    "name": "[AWS EC2] CPU Usage High",
    "tags": ["AWS EC2"],
    "ruleTypeId": ".es-query",
    "schedule": {
      "interval": "5m"
    },
    "params": {
      "searchType": "esqlQuery",
      "timeWindowSize": 5,
      "timeWindowUnit": "m",
      "esqlQuery": {
        "esql": "// The recommended threshold value for CPU usage is >= 80, and the alerting rule is grouped by cloud account id, cloud region and instance id. You can adjust the threshold value by modifying the cpuutilization value in the WHERE clause.\nFROM metrics-aws.ec2_metrics-default\n| STATS cpuutilization=avg(host.cpu.usage*100) by cloud.account.id, cloud.region, aws.dimensions.InstanceId\n| WHERE cpuutilization >= 80"
      },
      "groupBy": "row",
      "timeField": "event.ingested"
    },
    "alertDelay": {
      "active": 1
    }
  },
  "managed": true,
  "coreMigrationVersion": "8.8.0",
  "typeMigrationVersion": "10.1.0"
}