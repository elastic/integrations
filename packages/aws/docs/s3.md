# Amazon S3

The Amazon S3 integration allows you to monitor [Amazon Simple Storage Service (Amazon S3)](https://aws.amazon.com/s3/)—an object storage service.

Use the Amazon S3 integration to collect logs and metrics related to the data stored in your Amazon S3 buckets. Then visualize that data in Kibana, create alerts to notify you if something goes wrong, and reference logs and metrics when troubleshooting an issue.

For example, you could use this data to view access logs, the amount of data stored in a bucket, and the amount of data download requests. Then you can alert the relevant project manager to any significant changes by email.

**IMPORTANT: Extra AWS charges on AWS API requests will be generated by this integration. Please refer to the AWS integration for more details.**

## Data streams

The S3 integration collects two types of data: logs and metrics.

**Logs** help you keep a record of events happening in your Amazon services.
Logs collected by the S3 integration include the apparent internet address of the requester, the name of the bucket that the request was processed, and more. See more details in the [Logs reference](#logs-reference).

**Metrics** give you insight into the state of different Amazon services.
Metrics collected by the S3 integration include S3 daily storage, S3 requests, the latency (elapsed per-request time from the first byte received to the last byte sent to an Amazon S3 bucket), the number of HTTP 4xx client error status code requests made to an Amazon S3 bucket, and more. See more details in the [Metrics reference](#metrics-reference).

## Requirements

You need Elasticsearch for storing and searching your data and Kibana for visualizing and managing it.
You can use our hosted Elasticsearch Service on Elastic Cloud, which is recommended, or self-manage the Elastic Stack on your own hardware.

Before using any AWS integration you will need:

* **AWS Credentials** to connect with your AWS account.
* **AWS Permissions** to make sure the user you're using to connect has permission to share the relevant data.

For more details about these requirements, please take a look at the [AWS integration documentation](https://docs.elastic.co/integrations/aws#requirements).

## Setup

Use this integration if you only need to collect data from the Amazon S3 service.

If you want to collect data from two or more AWS services, consider using the **AWS** integration.
When you configure the AWS integration, you can collect data from as many AWS services as you'd like.

For step-by-step instructions on how to set up an integration, see the [Getting started](https://www.elastic.co/guide/en/welcome-to-elastic/current/getting-started-observability.html) guide.

To enable S3 request metrics, see [Create a CloudWatch metrics configuration](https://docs.aws.amazon.com/AmazonS3/latest/userguide/configure-request-metrics-bucket.html).

To send server access logs to an S3 bucket, see [How to enable server access logging](https://docs.aws.amazon.com/AmazonS3/latest/dev/ServerLogs.html#server-access-logging-overview).

## Logs reference

The `s3access` dataset collects server access logs from Amazon S3. Server access
logging provides detailed records for the requests that are made to a bucket.
Server access logs are useful for many applications. For example, access log
information can be useful in security and access audits. It can also help users
to learn about customer base and understand Amazon S3 bill.

**ECS Field Reference**

Please refer to the following [document](https://www.elastic.co/guide/en/ecs/current/ecs-field-reference.html) for detailed information on ECS fields.

**Exported fields**

| Field | Description | Type |
|---|---|---|
| @timestamp | Event timestamp. | date |
| aws.s3.bucket.arn | The AWS S3 bucket ARN. | keyword |
| aws.s3.bucket.name | The AWS S3 bucket name. | keyword |
| aws.s3.object.key | The AWS S3 Object key. | keyword |
| aws.s3access.authentication_type | The type of request authentication used, AuthHeader for authentication headers, QueryString for query string (pre-signed URL) or a - for unauthenticated requests. | keyword |
| aws.s3access.bucket | The name of the bucket that the request was processed against. | keyword |
| aws.s3access.bucket_owner | The canonical user ID of the owner of the source bucket. | keyword |
| aws.s3access.bytes_sent | The number of response bytes sent, excluding HTTP protocol overhead, or "-" if zero. | long |
| aws.s3access.cipher_suite | The Secure Sockets Layer (SSL) cipher that was negotiated for HTTPS request or a - for HTTP. | keyword |
| aws.s3access.error_code | The Amazon S3 Error Code, or "-" if no error occurred. | keyword |
| aws.s3access.host_header | The endpoint used to connect to Amazon S3. | keyword |
| aws.s3access.host_id | The x-amz-id-2 or Amazon S3 extended request ID. | keyword |
| aws.s3access.http_status | The numeric HTTP status code of the response. | long |
| aws.s3access.key | The "key" part of the request, URL encoded, or "-" if the operation does not take a key parameter. | keyword |
| aws.s3access.object_size | The total size of the object in question. | long |
| aws.s3access.operation | The operation listed here is declared as SOAP.operation, REST.HTTP_method.resource_type, WEBSITE.HTTP_method.resource_type, or BATCH.DELETE.OBJECT. | keyword |
| aws.s3access.referrer | The value of the HTTP Referrer header, if present. | keyword |
| aws.s3access.remote_ip | The apparent internet address of the requester. | ip |
| aws.s3access.request_id | A string generated by Amazon S3 to uniquely identify each request. | keyword |
| aws.s3access.request_uri | The Request-URI part of the HTTP request message. | keyword |
| aws.s3access.requester | The canonical user ID of the requester, or a - for unauthenticated requests. | keyword |
| aws.s3access.signature_version | The signature version, SigV2 or SigV4, that was used to authenticate the request or a - for unauthenticated requests. | keyword |
| aws.s3access.tls_version | The Transport Layer Security (TLS) version negotiated by the client. | keyword |
| aws.s3access.total_time | The total amount of time in milliseconds the request was in flight from the server's perspective. | long |
| aws.s3access.turn_around_time | The total amount of time in milliseconds that Amazon S3 spent processing your request. | long |
| aws.s3access.user_agent | The value of the HTTP User-Agent header. | keyword |
| aws.s3access.version_id | The version ID in the request, or "-" if the operation does not take a versionId parameter. | keyword |
| cloud.image.id | Image ID for the cloud instance. | keyword |
| data_stream.dataset | Data stream dataset. | constant_keyword |
| data_stream.namespace | Data stream namespace. | constant_keyword |
| data_stream.type | Data stream type. | constant_keyword |
| event.module | Event module | constant_keyword |
| geo.city_name | City name. | keyword |
| geo.continent_name | Name of the continent. | keyword |
| geo.country_iso_code | Country ISO code. | keyword |
| geo.country_name | Country name. | keyword |
| geo.location | Longitude and latitude. | geo_point |
| geo.region_iso_code | Region ISO name. | keyword |
| geo.region_name | Region name. | keyword |
| host.containerized | If the host is a container. | boolean |
| host.os.build | OS build information. | keyword |
| host.os.codename | OS codename, if any. | keyword |
| input.type | Input type | keyword |
| log.offset | Log offset | long |


An example event for `s3access` looks as following:

```json
{
    "@timestamp": "2019-08-01T00:24:41.000Z",
    "agent": {
        "ephemeral_id": "cf6858b6-3b45-4306-ac87-691619a051e2",
        "id": "acba78ef-1401-4689-977c-d8c2e5d6a8fa",
        "name": "docker-fleet-agent",
        "type": "filebeat",
        "version": "8.10.1"
    },
    "aws": {
        "s3": {
            "bucket": {
                "arn": "arn:aws:s3:::elastic-package-aws-bucket-70755",
                "name": "elastic-package-aws-bucket-70755"
            },
            "object": {
                "key": "s3-server-access.log"
            }
        },
        "s3access": {
            "authentication_type": "AuthHeader",
            "bucket": "test-s3-ks",
            "bucket_owner": "36c1f05b76016b78528454e6e0c60e2b7ff7aa20c0a5e4c748276e5b0a2debd2",
            "bytes_sent": 142,
            "cipher_suite": "ECDHE-RSA-AES128-SHA",
            "host_header": "s3.ap-southeast-1.amazonaws.com",
            "host_id": "BsCfJedfuSnds2QFoxi+E/O7M6OEWzJnw4dUaes/2hyA363sONRJKzB7EOY+Bt9DTHYUn+HoHxI=",
            "http_status": 200,
            "operation": "REST.GET.LOCATION",
            "remote_ip": "89.160.20.156",
            "request_id": "44EE8651683CB4DA",
            "request_uri": "GET /test-s3-ks/?location&aws-account=627959692251 HTTP/1.1",
            "requester": "arn:aws:sts::123456:assumed-role/AWSServiceRoleForTrustedAdvisor/TrustedAdvisor_627959692251_784ab70b-8cc9-4d37-a2ec-2ff4d0c08af9",
            "signature_version": "SigV4",
            "tls_version": "TLSv1.2",
            "total_time": 17,
            "user_agent": "AWS-Support-TrustedAdvisor, aws-internal/3 aws-sdk-java/1.11.590 Linux/4.9.137-0.1.ac.218.74.329.metal1.x86_64 OpenJDK_64-Bit_Server_VM/25.212-b03 java/1.8.0_212 vendor/Oracle_Corporation"
        }
    },
    "client": {
        "address": "89.160.20.156",
        "geo": {
            "city_name": "Linköping",
            "continent_name": "Europe",
            "country_iso_code": "SE",
            "country_name": "Sweden",
            "location": {
                "lat": 58.4167,
                "lon": 15.6167
            },
            "region_iso_code": "SE-E",
            "region_name": "Östergötland County"
        },
        "ip": "89.160.20.156",
        "user": {
            "id": "arn:aws:sts::123456:assumed-role/AWSServiceRoleForTrustedAdvisor/TrustedAdvisor_627959692251_784ab70b-8cc9-4d37-a2ec-2ff4d0c08af9"
        }
    },
    "cloud": {
        "provider": "aws",
        "region": "ap-southeast-1"
    },
    "data_stream": {
        "dataset": "aws.s3access",
        "namespace": "ep",
        "type": "logs"
    },
    "ecs": {
        "version": "8.11.0"
    },
    "elastic_agent": {
        "id": "acba78ef-1401-4689-977c-d8c2e5d6a8fa",
        "snapshot": false,
        "version": "8.10.1"
    },
    "event": {
        "action": "REST.GET.LOCATION",
        "agent_id_status": "verified",
        "category": "web",
        "dataset": "aws.s3access",
        "duration": 17000000,
        "id": "44EE8651683CB4DA",
        "ingested": "2023-11-07T14:14:29Z",
        "kind": "event",
        "original": "36c1f05b76016b78528454e6e0c60e2b7ff7aa20c0a5e4c748276e5b0a2debd2 test-s3-ks [01/Aug/2019:00:24:41 +0000] 89.160.20.156 arn:aws:sts::123456:assumed-role/AWSServiceRoleForTrustedAdvisor/TrustedAdvisor_627959692251_784ab70b-8cc9-4d37-a2ec-2ff4d0c08af9 44EE8651683CB4DA REST.GET.LOCATION - \"GET /test-s3-ks/?location&aws-account=627959692251 HTTP/1.1\" 200 - 142 - 17 - \"-\" \"AWS-Support-TrustedAdvisor, aws-internal/3 aws-sdk-java/1.11.590 Linux/4.9.137-0.1.ac.218.74.329.metal1.x86_64 OpenJDK_64-Bit_Server_VM/25.212-b03 java/1.8.0_212 vendor/Oracle_Corporation\" - BsCfJedfuSnds2QFoxi+E/O7M6OEWzJnw4dUaes/2hyA363sONRJKzB7EOY+Bt9DTHYUn+HoHxI= SigV4 ECDHE-RSA-AES128-SHA AuthHeader s3.ap-southeast-1.amazonaws.com TLSv1.2",
        "outcome": "success",
        "type": [
            "access"
        ]
    },
    "geo": {
        "city_name": "Linköping",
        "continent_name": "Europe",
        "country_iso_code": "SE",
        "country_name": "Sweden",
        "location": {
            "lat": 58.4167,
            "lon": 15.6167
        },
        "region_iso_code": "SE-E",
        "region_name": "Östergötland County"
    },
    "http": {
        "request": {
            "method": "GET"
        },
        "response": {
            "body": {
                "bytes": 142
            },
            "status_code": 200
        },
        "version": "1.1"
    },
    "input": {
        "type": "aws-s3"
    },
    "log": {
        "file": {
            "path": "https://elastic-package-aws-bucket-70755.s3.us-east-1.amazonaws.com/s3-server-access.log"
        },
        "offset": 0
    },
    "related": {
        "ip": [
            "89.160.20.156"
        ],
        "user": [
            "36c1f05b76016b78528454e6e0c60e2b7ff7aa20c0a5e4c748276e5b0a2debd2"
        ]
    },
    "tags": [
        "preserve_original_event",
        "forwarded",
        "aws-s3access"
    ],
    "tls": {
        "cipher": "ECDHE-RSA-AES128-SHA",
        "version": "1.2",
        "version_protocol": "tls"
    },
    "url": {
        "original": "/test-s3-ks/?location&aws-account=627959692251",
        "path": "/test-s3-ks/",
        "query": "location&aws-account=627959692251"
    },
    "user_agent": {
        "device": {
            "name": "Other"
        },
        "name": "aws-sdk-java",
        "original": "AWS-Support-TrustedAdvisor, aws-internal/3 aws-sdk-java/1.11.590 Linux/4.9.137-0.1.ac.218.74.329.metal1.x86_64 OpenJDK_64-Bit_Server_VM/25.212-b03 java/1.8.0_212 vendor/Oracle_Corporation",
        "os": {
            "full": "Linux 4.9.137",
            "name": "Linux",
            "version": "4.9.137"
        },
        "version": "1.11.590"
    }
}
```

## Metrics reference

### s3_daily_storage

An example event for `s3_daily_storage` looks as following:

```json
{
    "@timestamp": "2022-07-25T19:02:00.000Z",
    "agent": {
        "ephemeral_id": "9ef87976-bec2-4a74-9876-4e76d42035bb",
        "id": "2d4b09d0-cdb6-445e-ac3f-6415f87b9864",
        "name": "docker-fleet-agent",
        "type": "metricbeat",
        "version": "8.3.2"
    },
    "aws": {
        "cloudwatch": {
            "namespace": "AWS/S3"
        },
        "dimensions": {
            "StorageType": "StandardStorage"
        },
        "s3": {
            "bucket": {
                "name": "filebeat-aws-elb-test"
            }
        },
        "s3_daily_storage": {
            "bucket": {
                "size": {
                    "bytes": 469407687
                }
            }
        }
    },
    "cloud": {
        "account": {
            "id": "428152502467",
            "name": "elastic-beats"
        },
        "provider": "aws",
        "region": "eu-central-1"
    },
    "data_stream": {
        "dataset": "aws.s3_daily_storage",
        "namespace": "default",
        "type": "metrics"
    },
    "ecs": {
        "version": "8.11.0"
    },
    "elastic_agent": {
        "id": "2d4b09d0-cdb6-445e-ac3f-6415f87b9864",
        "snapshot": false,
        "version": "8.3.2"
    },
    "event": {
        "agent_id_status": "verified",
        "dataset": "aws.s3_daily_storage",
        "duration": 9553539400,
        "ingested": "2022-07-26T19:02:17Z",
        "module": "aws"
    },
    "metricset": {
        "name": "cloudwatch",
        "period": 86400000
    },
    "service": {
        "type": "aws"
    }
}
```

**ECS Field Reference**

Please refer to the following [document](https://www.elastic.co/guide/en/ecs/current/ecs-field-reference.html) for detailed information on ECS fields.

**Exported fields**

| Field | Description | Type | Metric Type |
|---|---|---|---|
| @timestamp | Event timestamp. | date |  |
| agent.id | Unique identifier of this agent (if one exists). Example: For Beats this would be beat.id. | keyword |  |
| aws.cloudwatch.namespace | The namespace specified when query cloudwatch api. | keyword |  |
| aws.dimensions.BucketName | This dimension filters the data you request for the identified bucket only. | keyword |  |
| aws.dimensions.FilterId | This dimension filters metrics configurations that you specify for request metrics on a bucket, for example, a prefix or a tag. | keyword |  |
| aws.dimensions.StorageType | This dimension filters the data that you have stored in a bucket by types of storage. | keyword |  |
| aws.s3.bucket.name | Name of a S3 bucket. | keyword |  |
| aws.s3_daily_storage.bucket.size.bytes | The amount of data in bytes stored in a bucket. | long | gauge |
| aws.s3_daily_storage.number_of_objects | The total number of objects stored in a bucket for all storage classes. | long | gauge |
| aws.tags | Tag key value pairs from aws resources. | flattened |  |
| cloud | Fields related to the cloud or infrastructure the events are coming from. | group |  |
| cloud.account.id | The cloud account or organization id used to identify different entities in a multi-tenant environment. Examples: AWS account id, Google Cloud ORG Id, or other unique identifier. | keyword |  |
| cloud.image.id | Image ID for the cloud instance. | keyword |  |
| cloud.region | Region in which this host, resource, or service is located. | keyword |  |
| data_stream.dataset | Data stream dataset. | constant_keyword |  |
| data_stream.namespace | Data stream namespace. | constant_keyword |  |
| data_stream.type | Data stream type. | constant_keyword |  |
| error | These fields can represent errors of any kind. Use them for errors that happen while fetching events or in cases where the event itself contains an error. | group |  |
| event.module | Event module | constant_keyword |  |
| host.containerized | If the host is a container. | boolean |  |
| host.os.build | OS build information. | keyword |  |
| host.os.codename | OS codename, if any. | keyword |  |


### s3_request

An example event for `s3_request` looks as following:

```json
{
    "@timestamp": "2022-07-26T20:10:00.000Z",
    "agent": {
        "ephemeral_id": "287cb701-3031-45be-a8c1-4c4860603d9b",
        "id": "2d4b09d0-cdb6-445e-ac3f-6415f87b9864",
        "name": "docker-fleet-agent",
        "type": "metricbeat",
        "version": "8.3.2"
    },
    "aws": {
        "cloudwatch": {
            "namespace": "AWS/S3"
        },
        "dimensions": {
            "FilterId": "AllItems"
        },
        "s3": {
            "bucket": {
                "name": "vpc-flow-logs-ks"
            }
        },
        "s3_request": {
            "downloaded": {
                "bytes": 400
            },
            "errors": {
                "4xx": 1,
                "5xx": 0
            },
            "latency": {
                "total_request": {
                    "ms": 32
                }
            },
            "requests": {
                "head": 1,
                "total": 1
            }
        }
    },
    "cloud": {
        "account": {
            "id": "428152502467",
            "name": "elastic-beats"
        },
        "provider": "aws",
        "region": "us-east-1"
    },
    "data_stream": {
        "dataset": "aws.s3_request",
        "namespace": "default",
        "type": "metrics"
    },
    "ecs": {
        "version": "8.11.0"
    },
    "elastic_agent": {
        "id": "2d4b09d0-cdb6-445e-ac3f-6415f87b9864",
        "snapshot": false,
        "version": "8.3.2"
    },
    "event": {
        "agent_id_status": "verified",
        "dataset": "aws.s3_request",
        "duration": 9552028500,
        "ingested": "2022-07-26T20:16:31Z",
        "module": "aws"
    },
    "metricset": {
        "name": "cloudwatch",
        "period": 60000
    },
    "service": {
        "type": "aws"
    }
}
```

**ECS Field Reference**

Please refer to the following [document](https://www.elastic.co/guide/en/ecs/current/ecs-field-reference.html) for detailed information on ECS fields.

**Exported fields**

| Field | Description | Type | Metric Type |
|---|---|---|---|
| @timestamp | Event timestamp. | date |  |
| agent.id | Unique identifier of this agent (if one exists). Example: For Beats this would be beat.id. | keyword |  |
| aws.cloudwatch.namespace | The namespace specified when query cloudwatch api. | keyword |  |
| aws.dimensions.BucketName | This dimension filters the data you request for the identified bucket only. | keyword |  |
| aws.dimensions.FilterId | This dimension filters metrics configurations that you specify for request metrics on a bucket, for example, a prefix or a tag. | keyword |  |
| aws.dimensions.StorageType | This dimension filters the data that you have stored in a bucket by types of storage. | keyword |  |
| aws.s3.bucket.name | Name of a S3 bucket. | keyword |  |
| aws.s3_request.downloaded.bytes | The number bytes downloaded for requests made to an Amazon S3 bucket, where the response includes a body. | long | gauge |
| aws.s3_request.downloaded.bytes_per_period | The number bytes per period downloaded for requests made to an Amazon S3 bucket, where the response includes a body. | long | gauge |
| aws.s3_request.errors.4xx | The number of HTTP 4xx client error status code requests made to an Amazon S3 bucket with a value of either 0 or 1. | long | gauge |
| aws.s3_request.errors.5xx | The number of HTTP 5xx server error status code requests made to an Amazon S3 bucket with a value of either 0 or 1. | long | gauge |
| aws.s3_request.latency.first_byte.ms | The per-request time from the complete request being received by an Amazon S3 bucket to when the response starts to be returned. | long | gauge |
| aws.s3_request.latency.total_request.ms | The elapsed per-request time from the first byte received to the last byte sent to an Amazon S3 bucket. | long | gauge |
| aws.s3_request.requests.delete | The number of HTTP DELETE requests made for objects in an Amazon S3 bucket. | long | gauge |
| aws.s3_request.requests.get | The number of HTTP GET requests made for objects in an Amazon S3 bucket. | long | gauge |
| aws.s3_request.requests.head | The number of HTTP HEAD requests made to an Amazon S3 bucket. | long | gauge |
| aws.s3_request.requests.list | The number of HTTP requests that list the contents of a bucket. | long | gauge |
| aws.s3_request.requests.post | The number of HTTP POST requests made to an Amazon S3 bucket. | long | gauge |
| aws.s3_request.requests.put | The number of HTTP PUT requests made for objects in an Amazon S3 bucket. | long | gauge |
| aws.s3_request.requests.select | The number of Amazon S3 SELECT Object Content requests made for objects in an Amazon S3 bucket. | long | gauge |
| aws.s3_request.requests.select_returned.bytes | The number of bytes of data returned with Amazon S3 SELECT Object Content requests in an Amazon S3 bucket. | long | gauge |
| aws.s3_request.requests.select_scanned.bytes | The number of bytes of data scanned with Amazon S3 SELECT Object Content requests in an Amazon S3 bucket. | long | gauge |
| aws.s3_request.requests.total | The total number of HTTP requests made to an Amazon S3 bucket, regardless of type. | long | gauge |
| aws.s3_request.uploaded.bytes | The number bytes uploaded that contain a request body, made to an Amazon S3 bucket. | long | gauge |
| aws.s3_request.uploaded.bytes_per_period | The number bytes per period uploaded that contain a request body, made to an Amazon S3 bucket. | long | gauge |
| aws.tags | Tag key value pairs from aws resources. | flattened |  |
| cloud | Fields related to the cloud or infrastructure the events are coming from. | group |  |
| cloud.account.id | The cloud account or organization id used to identify different entities in a multi-tenant environment. Examples: AWS account id, Google Cloud ORG Id, or other unique identifier. | keyword |  |
| cloud.image.id | Image ID for the cloud instance. | keyword |  |
| cloud.region | Region in which this host, resource, or service is located. | keyword |  |
| data_stream.dataset | Data stream dataset. | constant_keyword |  |
| data_stream.namespace | Data stream namespace. | constant_keyword |  |
| data_stream.type | Data stream type. | constant_keyword |  |
| error | These fields can represent errors of any kind. Use them for errors that happen while fetching events or in cases where the event itself contains an error. | group |  |
| event.module | Event module | constant_keyword |  |
| host.containerized | If the host is a container. | boolean |  |
| host.os.build | OS build information. | keyword |  |
| host.os.codename | OS codename, if any. | keyword |  |

