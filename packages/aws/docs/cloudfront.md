# CloudFront

The AWS CloudFront integration allows you to monitor your [AWS CloudFront](https://aws.amazon.com/cloudfront/) usage.

Use the AWS CloudFront integration to collect and parse logs related to content delivery.
Then visualize that data in Kibana, create alerts to notify you if something goes wrong,
and reference logs when troubleshooting an issue.

For example, you could use the data from this integration to know when there are more than some number of failed requests
for a single piece of content in a given time period. You could also use the data to troubleshoot the underlying issue by
looking at additional context in the logs like the number of unique users (by IP address) who experienced the issue,
the source of the request, and more.

**IMPORTANT: Extra AWS charges on API requests will be generated by this integration. Check [API Requests](https://www.elastic.co/docs/current/integrations/aws#api-requests) for more details.**

## Data streams

The AWS CloudFront integration collects one type of data: logs.

**Logs** help you keep a record of every user request that CloudFront receives.
These logs are useful for many scenarios, including security and access audits.
See more details in the [Logs reference](#logs-reference).

## Requirements

Before using any AWS integration you will need:

* **AWS Credentials** to connect with your AWS account.
* **AWS Permissions** to make sure the user you're using to connect has permission to share the relevant data.

For more details about these requirements, please take a look at the [AWS integration documentation](https://docs.elastic.co/integrations/aws#requirements).

## Setup

Use this integration if you only need to collect data from the AWS CloudFront service.

If you want to collect data from two or more AWS services, consider using the
**AWS** integration. When you configure the AWS integration,
you can collect data from as many AWS services as you'd like.

For step-by-step instructions on how to set up an integration, see the
[Getting started](https://www.elastic.co/guide/en/welcome-to-elastic/current/getting-started-observability.html) guide.

## Logs reference

The `cloudfront` data stream collects standard logs (also called access logs) from AWS CloudFront.
CloudFront standard logs provide detailed records about every request that’s made to a distribution.

**ECS Field Reference**

Please refer to the following [document](https://www.elastic.co/guide/en/ecs/current/ecs-field-reference.html) for detailed information on ECS fields.

**Exported fields**

| Field | Description | Type |
|---|---|---|
| @timestamp | Event timestamp. | date |
| aws.cloudfront.domain | The domain name of the CloudFront distribution (for example, d111111abcdef8.cloudfront.net). | keyword |
| aws.cloudfront.edge_detailed_result_type | When the value of the x-edge-result-type field is Error, this field contains the specific type of error. When the object was served to the viewer from the Origin Shield cache, this field contains OriginShieldHit. In all other cases, this field contains the same value as x-edge-result-type. | keyword |
| aws.cloudfront.edge_location | The edge location that served the request. Each edge location is identified by a three-letter code and an arbitrarily assigned number (for example, DFW3). The three-letter code typically corresponds with the International Air Transport Association (IATA) airport code for an airport near the edge location’s geographic location. | keyword |
| aws.cloudfront.edge_response_result_type | How the server classified the response just before returning the response to the viewer. See also the x-edge-result-type field. | keyword |
| aws.cloudfront.edge_result_type | How the server classified the response after the last byte left the server. In some cases, the result type can change between the time that the server is ready to send the response and the time that it finishes sending the response.  See also the x-edge-response-result-type field. For example, in HTTP streaming, suppose the server finds a segment of the stream in the cache. In that scenario, the value of this field would ordinarily be Hit.  However, if the viewer closes the connection before the server has delivered the entire segment, the final result type (and the value of this field) is Error. WebSocket connections will have a value of Miss for this field because the content is not cacheable and is proxied directly to the origin. | keyword |
| aws.cloudfront.range_end | When the response contains the HTTP Content-Range header, this field contains the range end value. | long |
| aws.cloudfront.range_start | When the response contains the HTTP Content-Range header, this field contains the range start value. | long |
| aws.cloudfront.time_to_first_byte | The number of seconds between receiving the request and writing the first byte of the response, as measured on the server. | float |
| aws.edge_location | The edge location that served the request. Each edge location is identified by a three-letter code and an arbitrarily assigned number (for example, DFW3). The three-letter code typically corresponds with the International Air Transport Association (IATA) airport code for an airport near the edge location’s geographic location. | alias |
| aws.s3.bucket.arn | The AWS S3 bucket ARN. | keyword |
| aws.s3.bucket.name | The AWS S3 bucket name. | keyword |
| aws.s3.object.key | The AWS S3 Object key. | keyword |
| cloud.image.id | Image ID for the cloud instance. | keyword |
| data_stream.dataset | Data stream dataset. | constant_keyword |
| data_stream.namespace | Data stream namespace. | constant_keyword |
| data_stream.type | Data stream type. | constant_keyword |
| event.module | Event module | constant_keyword |
| host.containerized | If the host is a container. | boolean |
| host.os.build | OS build information. | keyword |
| host.os.codename | OS codename, if any. | keyword |
| input.type | Input type | keyword |
| log.offset | Log offset | long |


An example event for `cloudfront` looks as following:

```json
{
    "@timestamp": "2019-12-04T21:02:31.000Z",
    "agent": {
        "ephemeral_id": "2e56d54c-2c59-4b67-8f1a-41cf7dbd9d08",
        "id": "acba78ef-1401-4689-977c-d8c2e5d6a8fa",
        "name": "docker-fleet-agent",
        "type": "filebeat",
        "version": "8.10.1"
    },
    "aws": {
        "cloudfront": {
            "domain": "d111111abcdef8.cloudfront.net",
            "edge_detailed_result_type": "Hit",
            "edge_location": "LAX1",
            "edge_response_result_type": "Hit",
            "edge_result_type": "Hit",
            "time_to_first_byte": 0.001
        },
        "s3": {
            "bucket": {
                "arn": "arn:aws:s3:::elastic-package-aws-bucket-58094",
                "name": "elastic-package-aws-bucket-58094"
            },
            "object": {
                "key": "cloudfront"
            }
        }
    },
    "cloud": {
        "provider": "aws",
        "region": "us-east-1"
    },
    "data_stream": {
        "dataset": "aws.cloudfront_logs",
        "namespace": "ep",
        "type": "logs"
    },
    "destination": {
        "address": "d111111abcdef8.cloudfront.net",
        "domain": "d111111abcdef8.cloudfront.net"
    },
    "ecs": {
        "version": "8.11.0"
    },
    "elastic_agent": {
        "id": "acba78ef-1401-4689-977c-d8c2e5d6a8fa",
        "snapshot": false,
        "version": "8.10.1"
    },
    "event": {
        "agent_id_status": "verified",
        "category": [
            "web"
        ],
        "dataset": "aws.cloudfront_logs",
        "id": "SOX4xwn4XV6Q4rgb7XiVGOHms_BGlTAC4KyHmureZmBNrjGdRLiNIQ==",
        "ingested": "2023-11-03T13:01:05Z",
        "kind": "event",
        "original": "2019-12-04\t21:02:31\tLAX1\t392\t89.160.20.112\tGET\td111111abcdef8.cloudfront.net\t/index.html\t200\t-\tMozilla/5.0%20(Windows%20NT%2010.0;%20Win64;%20x64)%20AppleWebKit/537.36%20(KHTML,%20like%20Gecko)%20Chrome/78.0.3904.108%20Safari/537.36\t-\t-\tHit\tSOX4xwn4XV6Q4rgb7XiVGOHms_BGlTAC4KyHmureZmBNrjGdRLiNIQ==\td111111abcdef8.cloudfront.net\thttps\t23\t0.001\t-\tTLSv1.2\tECDHE-RSA-AES128-GCM-SHA256\tHit\tHTTP/2.0\t-\t-\t11040\t0.001\tHit\ttext/html\t78\t-\t-",
        "outcome": "success",
        "type": [
            "access"
        ]
    },
    "http": {
        "request": {
            "bytes": 23,
            "id": "SOX4xwn4XV6Q4rgb7XiVGOHms_BGlTAC4KyHmureZmBNrjGdRLiNIQ==",
            "method": "GET"
        },
        "response": {
            "body": {
                "bytes": 78
            },
            "bytes": 392,
            "mime_type": "text/html",
            "status_code": 200
        },
        "version": "2.0"
    },
    "input": {
        "type": "aws-s3"
    },
    "log": {
        "file": {
            "path": "https://elastic-package-aws-bucket-58094.s3.us-east-1.amazonaws.com/cloudfront"
        },
        "offset": 471
    },
    "network": {
        "protocol": "https",
        "type": "ipv4"
    },
    "related": {
        "hosts": [
            "d111111abcdef8.cloudfront.net"
        ],
        "ip": [
            "89.160.20.112"
        ]
    },
    "source": {
        "address": "89.160.20.112",
        "as": {
            "number": 29518,
            "organization": {
                "name": "Bredband2 AB"
            }
        },
        "geo": {
            "city_name": "Linköping",
            "continent_name": "Europe",
            "country_iso_code": "SE",
            "country_name": "Sweden",
            "location": {
                "lat": 58.4167,
                "lon": 15.6167
            },
            "region_iso_code": "SE-E",
            "region_name": "Östergötland County"
        },
        "ip": "89.160.20.112",
        "port": 11040
    },
    "tags": [
        "preserve_original_event",
        "forwarded",
        "aws-cloudfront"
    ],
    "tls": {
        "cipher": "ECDHE-RSA-AES128-GCM-SHA256",
        "version": "1.2",
        "version_protocol": "tls"
    },
    "url": {
        "domain": "d111111abcdef8.cloudfront.net",
        "extension": "html",
        "full": "https://d111111abcdef8.cloudfront.net/index.html",
        "path": "/index.html",
        "registered_domain": "cloudfront.net",
        "scheme": "https",
        "subdomain": "d111111abcdef8",
        "top_level_domain": "net"
    },
    "user_agent": {
        "device": {
            "name": "Other"
        },
        "name": "Chrome",
        "original": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/78.0.3904.108 Safari/537.36",
        "os": {
            "full": "Windows 10",
            "name": "Windows",
            "version": "10"
        },
        "version": "78.0.3904.108"
    }
}
```