---
description: Pipeline for processing host logs.
processors:
  - set:
      field: ecs.version
      tag: set_ecs_version
      value: 8.11.0
  - set:
      field: event.kind
      tag: set_event_kind
      value: event
  - append:
      field: event.category
      tag: append_event_category
      value: host
  - append:
      field: event.type
      tag: append_event_type
      value: info
  - rename:
      field: message
      tag: rename_message
      target_field: event.original
      ignore_missing: true
  - drop:
      if: ctx.event?.original != null && ctx.event.original.isEmpty()
  - json:
      field: event.original
      tag: json_event_original
      target_field: json
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json._id
      tag: rename_id
      target_field: prisma_cloud.host._id
      ignore_missing: true
  - set:
      field: event.id
      tag: set_id_to_event_id
      copy_from: prisma_cloud.host._id
      ignore_empty_value: true
  - convert:
      field: json.agentless
      tag: convert_agentless
      target_field: prisma_cloud.host.agentless
      type: boolean
      ignore_missing: true
      if: ctx.json?.agentless != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.allCompliance
      tag: rename_allCompliance
      target_field: prisma_cloud.host.all_compliance
      ignore_missing: true
  - rename:
      field: prisma_cloud.host.all_compliance.compliance
      tag: rename_compliance_to_data
      target_field: prisma_cloud.host.all_compliance.data
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.applicableRules
          tag: rename_prisma_cloud_host_all_compliance_data_applicableRules
          target_field: _ingest._value.applicable_rules
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.binaryPkgs
          tag: rename_prisma_cloud_host_all_compliance_data_binaryPkgs
          target_field: _ingest._value.binary_pkgs
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.vecStr
          tag: rename_prisma_cloud_host_all_compliance_data_vecStr
          target_field: _ingest._value.vec_str
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.block
          tag: convert_prisma_cloud_host_all_compliance_data_block
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.block
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.cri
          tag: convert_prisma_cloud_host_all_compliance_data_cri
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.cri
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.custom
          tag: convert_prisma_cloud_host_all_compliance_data_custom
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.custom
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        append:
          field: vulnerability.id
          tag: append_prisma_cloud_host_all_compliance_data_cve
          value: '{{{_ingest._value.cve}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        append:
          field: vulnerability.severity
          tag: append_prisma_cloud_host_all_compliance_data_severity
          value: '{{{_ingest._value.severity}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.cvss
          tag: convert_prisma_cloud_host_all_compliance_data_cvss
          type: float
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.cvss
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        append:
          field: vulnerability.description
          tag: append_description_to_vulnerability_description
          value: '{{{_ingest._value.description}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List && (ctx.tags == null || !(ctx.tags.contains('preserve_duplicate_custom_fields')))
      ignore_failure: true
      processor:
        remove:
          field:
            -  _ingest._value.cve
            -  _ingest._value.severity
            -  _ingest._value.description
          tag: remove_prisma_cloud_host_all_compliance_data_fields_ecs_mapped
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.discovered
          target_field: _ingest._value.discovered
          formats:
            - ISO8601
          on_failure:
            - remove:
                field: _ingest._value.discovered
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.fixDate
          target_field: _ingest._value.fix_date
          formats:
            - UNIX_MS
          on_failure:
            - remove:
                field: _ingest._value.fixDate
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.fixLink
          tag: rename_prisma_cloud_host_all_compliance_data_fixLink
          target_field: _ingest._value.fix_link
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.functionLayer
          tag: rename_prisma_cloud_host_all_compliance_data_functionLayer
          target_field: _ingest._value.function_layer
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.gracePeriodDays
          tag: convert_prisma_cloud_host_all_compliance_data_gracePeriodDays
          target_field: _ingest._value.grace_period_days
          type: long
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.gracePeriodDays
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.id
          tag: convert_prisma_cloud_host_all_compliance_data_id
          type: string
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.id
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.layerTime
          target_field: _ingest._value.layer_time
          formats:
            - UNIX_MS
          on_failure:
            - remove:
                field: _ingest._value.layerTime
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.packageName
          tag: rename_prisma_cloud_host_all_compliance_data_packageName
          target_field: _ingest._value.package.name
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.packageVersion
          tag: rename_prisma_cloud_host_all_compliance_data_packageVersion
          target_field: _ingest._value.package.version
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.riskFactors
          tag: rename_prisma_cloud_host_all_compliance_data_riskFactors
          target_field: _ingest._value.risk_factors
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.published
          target_field: _ingest._value.published
          formats:
            - UNIX_MS
          on_failure:
            - remove:
                field: _ingest._value.published
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.twistlock
          tag: convert_prisma_cloud_host_all_compliance_data_twistlock
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.twistlock
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.vulnTagInfos
          tag: rename_prisma_cloud_host_all_compliance_data_vulnTagInfos
          target_field: _ingest._value.vuln_tag_infos
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.wildfireMalware
          tag: rename_prisma_cloud_host_all_compliance_data_wildfireMalware
          target_field: _ingest._value.wild_fire_malware
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.all_compliance.data
      if: ctx.prisma_cloud?.host?.all_compliance?.data instanceof List
      ignore_failure: true
      processor:
        remove:
          field:
            - _ingest._value.fixDate
            - _ingest._value.gracePeriodDays
            - _ingest._value.layerTime
          tag: foreach_remove_prisma_cloud_host_all_compliance_data_fields
          ignore_missing: true
  - convert:
      field: prisma_cloud.host.all_compliance.enabled
      tag: convert_prisma_cloud_host_all_compliance_enabled
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.all_compliance?.enabled != ''
      on_failure:
        - remove:
            field: prisma_cloud.host.all_compliance.enabled
            ignore_missing: true
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.appEmbedded
      tag: convert_appEmbedded
      target_field: prisma_cloud.host.app_embedded
      type: boolean
      ignore_missing: true
      if: ctx.json?.appEmbedded != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.applications
      tag: rename_applications
      target_field: prisma_cloud.host.applications
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.applications
      if: ctx.prisma_cloud?.host?.applications instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.installedFromPackage
          tag: convert_prisma_cloud_host_applications_installedFromPackage
          target_field: _ingest._value.installed_from_package
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.installedFromPackage
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.applications
      if: ctx.prisma_cloud?.host?.applications instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.knownVulnerabilities
          tag: convert_prisma_cloud_host_applications_knownVulnerabilities
          target_field: _ingest._value.known_vulnerabilities
          type: long
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.knownVulnerabilities
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.applications
      if: ctx.prisma_cloud?.host?.applications instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.layerTime
          target_field: _ingest._value.layer_time
          formats:
            - UNIX_MS
          on_failure:
            - remove:
                field: _ingest._value.layerTime
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.applications
      if: ctx.prisma_cloud?.host?.applications instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.service
          tag: convert_prisma_cloud_host_applications_service
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.service
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.applications
      if: ctx.prisma_cloud?.host?.applications instanceof List
      ignore_failure: true
      processor:
        remove:
          field:
            - _ingest._value.installedFromPackage
            - _ingest._value.knownVulnerabilities
            - _ingest._value.layerTime
          tag: foreach_remove_prisma_cloud_host_applications_fields
          ignore_missing: true
  - rename:
      field: json.baseImage
      tag: rename_baseImage
      target_field: prisma_cloud.host.base_image
      ignore_missing: true
  - rename:
      field: json.binaries
      tag: rename_binaries
      target_field: prisma_cloud.host.binaries
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.binaries
      if: ctx.prisma_cloud?.host?.binaries instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.altered
          tag: convert_binaries_altered
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.altered
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.binaries
      if: ctx.prisma_cloud?.host?.binaries instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.cveCount
          tag: convert_prisma_cloud_host_binaries_cveCount
          target_field: _ingest._value.cve_count
          type: long
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.cveCount
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.binaries
      if: ctx.prisma_cloud?.host?.binaries instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.fileMode
          tag: convert_prisma_cloud_host_binaries_fileMode
          target_field: _ingest._value.file_mode
          type: long
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.fileMode
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.binaries
      if: ctx.prisma_cloud?.host?.binaries instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.functionLayer
          tag: rename_prisma_cloud_host_binaries_functionLayer
          target_field: _ingest._value.function_layer
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.binaries
      if: ctx.prisma_cloud?.host?.binaries instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.missingPkg
          tag: convert_prisma_cloud_host_binaries_missingPkg
          target_field: _ingest._value.missing_pkg
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.missingPkg
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.binaries
      if: ctx.prisma_cloud?.host?.binaries instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.pkgRootDir
          tag: rename_prisma_cloud_host_binaries_pkgRootDir
          target_field: _ingest._value.pkg_root_dir
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.binaries
      if: ctx.prisma_cloud?.host?.binaries instanceof List
      ignore_failure: true
      processor:
        remove:
          field:
            - _ingest._value.cveCount
            - _ingest._value.fileMode
            - _ingest._value.missingPkg
          tag: foreach_remove_prisma_cloud_host_binaries_fields
          ignore_missing: true
  - rename:
      field: json.cloudMetadata
      tag: rename_cloudMetadata
      target_field: prisma_cloud.host.cloud_metadata
      ignore_missing: true
  - rename:
      field: prisma_cloud.host.cloud_metadata.accountID
      tag: rename_accountID
      target_field: prisma_cloud.host.cloud_metadata.account_id
      ignore_missing: true
  - set:
      field: cloud.account.id
      tag: set_account_id
      copy_from: prisma_cloud.host.cloud_metadata.account_id
      ignore_empty_value: true
  - rename:
      field: prisma_cloud.host.cloud_metadata.awsExecutionEnv
      tag: rename_awsExecutionEnv
      target_field: prisma_cloud.host.cloud_metadata.aws_execution_env
      ignore_missing: true
  - rename:
      field: json.cloudMetadata.labels
      tag: rename_cloudMetadata_labels
      target_field: prisma_cloud.host.cloud_metadata.labels
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.cloud_metadata.labels
      if: ctx.prisma_cloud?.host?.cloud_metadata?.labels instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.sourceName
          tag: rename_cloud_metadata_labels_sourceName
          target_field: _ingest._value.source.name
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.cloud_metadata.labels
      if: ctx.prisma_cloud?.host?.cloud_metadata?.labels instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.sourceType
          tag: foreach_cloud_metadata_labels_sourceType
          target_field: _ingest._value.source.type
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.cloud_metadata.labels
      if: ctx.prisma_cloud?.host?.cloud_metadata?.labels instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.timestamp
          target_field: _ingest._value.timestamp
          formats:
            - ISO8601
          on_failure:
            - remove:
                field: _ingest._value.timestamp
                ignore_missing: true
  - set:
      field: cloud.instance.name
      tag: set_cloud_instance_name
      copy_from: prisma_cloud.host.cloud_metadata.name
      ignore_empty_value: true
  - set:
      field: cloud.provider
      tag: set_cloud_provider
      copy_from: prisma_cloud.host.cloud_metadata.provider
      ignore_empty_value: true
  - set:
      field: cloud.region
      tag: set_cloud_region
      copy_from: prisma_cloud.host.cloud_metadata.region
      ignore_empty_value: true
  - rename:
      field: prisma_cloud.host.cloud_metadata.resourceID
      tag: rename_cloud_metadata_resourceID
      target_field: prisma_cloud.host.cloud_metadata.resource.id
      ignore_missing: true
  - set:
      field: cloud.instance.id
      tag: set_cloud_instance_id
      copy_from: prisma_cloud.host.cloud_metadata.resource.id
      ignore_empty_value: true
  - rename:
      field: prisma_cloud.host.cloud_metadata.resourceURL
      tag: rename_cloud_metadata_resourceURL
      target_field: prisma_cloud.host.cloud_metadata.resource.url
      ignore_missing: true
  - set:
      field: cloud.machine.type
      tag: set_cloud_machine_type
      copy_from: prisma_cloud.host.cloud_metadata.type
      ignore_empty_value: true
  - rename:
      field: prisma_cloud.host.cloud_metadata.vmID
      tag: rename_cloud_metadata_vmID
      target_field: prisma_cloud.host.cloud_metadata.vm.id
      ignore_missing: true
  - rename:
      field: prisma_cloud.host.cloud_metadata.vmImageID
      tag: rename_cloud_metadata_vmImageID
      target_field: prisma_cloud.host.cloud_metadata.vm.image_id
      ignore_missing: true
  - rename:
      field: json.clusters
      tag: rename_clusters
      target_field: prisma_cloud.host.clusters
      ignore_missing: true
  - rename:
      field: json.clusterType
      tag: rename_clusterType
      target_field: prisma_cloud.host.cluster_type
      ignore_missing: true
  - rename:
      field: json.collections
      tag: rename_collections
      target_field: prisma_cloud.host.collections
      ignore_missing: true
  - convert:
      field: json.complianceDistribution.critical
      tag: convert_critical
      target_field: prisma_cloud.host.compliance_distribution.critical
      type: long
      ignore_missing: true
      if: ctx.json?.complianceDistribution?.critical != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.complianceDistribution.high
      tag: convert_high
      target_field: prisma_cloud.host.compliance_distribution.high
      type: long
      ignore_missing: true
      if: ctx.json?.complianceDistribution?.high != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.complianceDistribution.low
      tag: convert_low
      target_field: prisma_cloud.host.compliance_distribution.low
      type: long
      ignore_missing: true
      if: ctx.json?.complianceDistribution?.low != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.complianceDistribution.medium
      tag: convert_medium
      target_field: prisma_cloud.host.compliance_distribution.medium
      type: long
      ignore_missing: true
      if: ctx.json?.complianceDistribution?.medium != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.complianceDistribution.total
      tag: convert_total
      target_field: prisma_cloud.host.compliance_distribution.total
      type: long
      ignore_missing: true
      if: ctx.json?.complianceDistribution?.total != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.complianceIssues
      tag: rename_complianceIssues
      target_field: prisma_cloud.host.compliance_issues.data
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.applicableRules
          tag: rename_prisma_cloud_host_compliance_issues_data_applicableRules
          target_field: _ingest._value.applicable_rules
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.binaryPkgs
          tag: rename_prisma_cloud_host_compliance_issues_data_binaryPkgs
          target_field: _ingest._value.binary_pkgs
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.vecStr
          tag: rename_prisma_cloud_host_compliance_issues_data_vecStr
          target_field: _ingest._value.vec_str
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.block
          tag: convert_prisma_cloud_host_compliance_issues_data_block
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.block
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.cri
          tag: convert_prisma_cloud_host_compliance_issues_data_cri
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.cri
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.custom
          tag: convert_prisma_cloud_host_compliance_issues_data_custom
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.custom
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        append:
          field: vulnerability.id
          tag: append_prisma_cloud_host_compliance_issues_data_cve_to_vulnerability_id
          value: '{{{_ingest._value.cve}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        append:
          field: vulnerability.severity
          value: '{{{_ingest._value.severity}}}'
          tag: append_compliance_issues_serevity
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.cvss
          tag: convert_cvss_prisma_cloud_host_compliance_issues_data
          type: float
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.cvss
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        append:
          field: vulnerability.description
          tag: append_prisma_cloud_host_compliance_issues_data_description
          value: '{{{_ingest._value.description}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List && (ctx.tags == null || !(ctx.tags.contains('preserve_duplicate_custom_fields')))
      ignore_failure: true
      processor:
        remove:
          field:
            -  _ingest._value.cve
            -  _ingest._value.severity
            -  _ingest._value.description
          ignore_missing: true
          tag: remove_compliance_issues_ecs_duplicated_fields
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.discovered
          target_field: _ingest._value.discovered
          formats:
            - ISO8601
          on_failure:
            - remove:
                field: _ingest._value.discovered
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.fixDate
          target_field: _ingest._value.fix_date
          formats:
            - UNIX_MS
          on_failure:
            - remove:
                field: _ingest._value.fixDate
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.fixLink
          tag: rename_prisma_cloud_host_compliance_issues_data_fixLink
          target_field: _ingest._value.fix_link
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.functionLayer
          tag: rename_prisma_cloud_host_compliance_issues_data_functionLayer
          target_field: _ingest._value.function_layer
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.gracePeriodDays
          tag: convert_gracePeriodDays_prisma_cloud_host_compliance_issues_data
          target_field: _ingest._value.grace_period_days
          type: long
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.gracePeriodDays
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.id
          tag: convert_prisma_cloud_host_compliance_issues_data_id
          type: string
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.id
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.layerTime
          target_field: _ingest._value.layer_time
          formats:
            - UNIX_MS
          on_failure:
            - remove:
                field: _ingest._value.layerTime
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.packageName
          tag: rename_packageName_prisma_cloud_host_compliance_issues_data
          target_field: _ingest._value.package.name
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.packageVersion
          tag: rename_packageVersion_prisma_cloud_host_compliance_issues_data
          target_field: _ingest._value.package.version
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.riskFactors
          tag: rename_riskFactors_prisma_cloud_host_compliance_issues_data
          target_field: _ingest._value.risk_factors
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.published
          target_field: _ingest._value.published
          formats:
            - UNIX_MS
          on_failure:
            - remove:
                field: _ingest._value.published
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.twistlock
          tag: convert_twistlock_prisma_cloud_host_compliance_issues_data
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.twistlock
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.vulnTagInfos
          tag: rename_vulnTagInfos_prisma_cloud_host_compliance_issues_data
          target_field: _ingest._value.vuln_tag_infos
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.wildfireMalware
          tag: rename_wildfireMalware_prisma_cloud_host_compliance_issues_data
          target_field: _ingest._value.wild_fire_malware
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.compliance_issues.data
      if: ctx.prisma_cloud?.host?.compliance_issues?.data instanceof List
      ignore_failure: true
      processor:
        remove:
          field:
            - _ingest._value.fixDate
            - _ingest._value.gracePeriodDays
            - _ingest._value.layerTime
          ignore_missing: true
          tag: foreach_prisma_cloud_host_compliance_issues_data_remove
  - convert:
      field: json.complianceIssuesCount
      tag: convert_complianceIssueCount
      target_field: prisma_cloud.host.compliance_issues.count
      type: long
      ignore_missing: true
      if: ctx.json?.complianceIssuesCount != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.complianceRiskScore
      tag: convert_complianceRiskScore
      target_field: prisma_cloud.host.compliance_risk_score
      type: float
      ignore_missing: true
      if: ctx.json?.complianceRiskScore != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - date:
      field: json.creationTime
      tag: date_creationTime
      target_field: prisma_cloud.host.creation_time
      formats:
        - ISO8601
      if: ctx.json?.creationTime != null && ctx.json.creationTime != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - set:
      field: event.start
      tag: set_creation_time
      copy_from: prisma_cloud.host.creation_time
      ignore_empty_value: true
  - rename:
      field: json.distro
      tag: rename_distro
      target_field: prisma_cloud.host.distro
      ignore_missing: true
  - rename:
      field: json.ecsClusterName
      tag: rename_ecsClusterName
      target_field: prisma_cloud.host.ecs_cluster_name
      ignore_missing: true
  - rename:
      field: json.err
      tag: rename_err
      target_field: prisma_cloud.host.err
      ignore_missing: true
  - rename:
      field: json.externalLabels
      tag: rename_externalLabels
      target_field: prisma_cloud.host.external_labels
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.external_labels
      if: ctx.prisma_cloud?.host?.external_labels instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.sourceName
          tag: rename_externalLabels_sourceName
          target_field: _ingest._value.source.name
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.external_labels
      if: ctx.prisma_cloud?.host?.external_labels instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.sourceType
          tag: rename_sourceType_externalLabels
          target_field: _ingest._value.source.type
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.external_labels
      if: ctx.prisma_cloud?.host?.external_labels instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.timestamp
          target_field: _ingest._value.timestamp
          formats:
            - ISO8601
          on_failure:
            - remove:
                field: _ingest._value.timestamp
                ignore_missing: true
  - rename:
      field: json.files
      tag: rename_files
      target_field: prisma_cloud.host.files
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.files
      if: ctx.prisma_cloud?.host?.files instanceof List
      ignore_failure: true
      processor:
        append:
          field: file.hash.md5
          tag: append_file_md5
          value: '{{{_ingest._value.md5}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.files
      if: ctx.prisma_cloud?.host?.files instanceof List
      ignore_failure: true
      processor:
        append:
          field: related.hash
          tag: append_related_hash_md5
          value: '{{{_ingest._value.md5}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.files
      if: ctx.prisma_cloud?.host?.files instanceof List
      ignore_failure: true
      processor:
        append:
          field: file.path
          tag: append_file_path
          value: '{{{_ingest._value.path}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.files
      if: ctx.prisma_cloud?.host?.files instanceof List
      ignore_failure: true
      processor:
        append:
          field: file.hash.sha1
          tag: append_file_hash_sha1
          value: '{{{_ingest._value.sha1}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.files
      if: ctx.prisma_cloud?.host?.files instanceof List
      ignore_failure: true
      processor:
        append:
          field: related.hash
          tag: append_related_hash_sha1
          value: '{{{_ingest._value.sha1}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.files
      if: ctx.prisma_cloud?.host?.files instanceof List
      ignore_failure: true
      processor:
        append:
          field: file.hash.sha256
          tag: append_file_sha256
          value: '{{{_ingest._value.sha256}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.files
      if: ctx.prisma_cloud?.host?.files instanceof List
      ignore_failure: true
      processor:
        append:
          field: related.hash
          tag: append_related_hash_sha256
          value: '{{{_ingest._value.sha256}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.files
      if: ctx.prisma_cloud?.host?.files instanceof List && (ctx.tags == null || !(ctx.tags.contains('preserve_duplicate_custom_fields')))
      ignore_failure: true
      processor:
        remove:
          field:
            -  _ingest._value.md5
            -  _ingest._value.path
            -  _ingest._value.sha1
            -  _ingest._value.sha256
          ignore_missing: true
          tag: remove_file_hash_fields_ecs_duplicate
  - rename:
      field: json.firewallProtection
      tag: rename_firewallProtection
      target_field: prisma_cloud.host.firewall_protection
      ignore_missing: true
  - convert:
      field: prisma_cloud.host.firewall_protection.enabled
      tag: convert_enabled
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.firewall_protection?.enabled != ''
      on_failure:
        - remove:
            field: prisma_cloud.host.firewall_protection.enabled
            ignore_missing: true
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: prisma_cloud.host.firewall_protection.outOfBandMode
      tag: rename_out_of_band_mode
      target_field: prisma_cloud.host.firewall_protection.out_of_band_mode
      ignore_missing: true
  - convert:
      field: prisma_cloud.host.firewall_protection.ports
      tag: convert_ports
      type: long
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.firewall_protection?.ports != ''
      on_failure:
        - remove:
            field: prisma_cloud.host.firewall_protection.ports
            ignore_missing: true
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: prisma_cloud.host.firewall_protection.supported
      tag: convert_supported
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.firewall_protection?.supported != ''
      on_failure:
        - remove:
            field: prisma_cloud.host.firewall_protection.supported
            ignore_missing: true
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: prisma_cloud.host.firewall_protection.tlsPorts
      tag: convert_tlsPorts
      target_field: prisma_cloud.host.firewall_protection.tls_ports
      type: long
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.firewall_protection?.tlsPorts != ''
      on_failure:
        - remove:
            field: prisma_cloud.host.firewall_protection.tlsPorts
            ignore_missing: true
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: prisma_cloud.host.firewall_protection.unprotectedProcesses
      tag: rename_unprotectedProcesses
      target_field: prisma_cloud.host.firewall_protection.unprotected_processes
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.firewall_protection.unprotected_processes
      if: ctx.prisma_cloud?.host?.firewall_protection?.unprotected_processes instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.port
          tag: convert_port_firewall_protection_unprotected_processes
          type: long
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.port
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.firewall_protection.unprotected_processes
      if: ctx.prisma_cloud?.host?.firewall_protection?.unprotected_processes instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.tls
          tag: convert_tls_firewall_protection.unprotected_processes
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.tls
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - date:
      field: json.firstScanTime
      tag: date_firstScanTime
      target_field: prisma_cloud.host.first_scan_time
      formats:
        - ISO8601
      if: ctx.json?.firstScanTime != null && ctx.json.firstScanTime != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.history
      tag: rename_history
      target_field: prisma_cloud.host.history
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.baseLayer
          tag: convert_baseLayer_history
          target_field: _ingest._value.base_layer
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.baseLayer
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.emptyLayer
          tag: convert_emptyLayer_history
          target_field: _ingest._value.empty_layer
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.emptyLayer
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.created
          target_field: _ingest._value.created
          formats:
            - UNIX_MS
          on_failure:
            - remove:
                field: _ingest._value.created
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.sizeBytes
          tag: convert_sizeBytes_history
          target_field: _ingest._value.size_bytes
          type: long
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.sizeBytes
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        remove:
          field:
            - _ingest._value.baseLayer
            - _ingest._value.emptyLayer
            - _ingest._value.sizeBytes
          tag: remove_history_fields_duplicate
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.applicableRules
              tag: rename_history_vulnerabilities_applicableRules
              target_field: _ingest._value.applicable_rules
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.binaryPkgs
              tag: rename_history_vulnerabilities_binaryPkgs
              target_field: _ingest._value.binary_pkgs
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.vecStr
              tag: rename_history_vulnerabilities_vecStr
              target_field: _ingest._value.vec_str
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.block
              tag: convert_history_vulnerabilities_block
              target_field: _ingest._value.block
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.block
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.cri
              tag: convert_history_vulnerabilities_cri
              target_field: _ingest._value.cri
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.cri
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.custom
              tag: convert_history_vulnerabilities_custom
              target_field: _ingest._value.custom
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.custom
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            append:
              field: vulnerability.id
              tag: append_history_vulnerabilities_cve
              value: '{{{_ingest._value.cve}}}'
              allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            append:
              field: vulnerability.severity
              value: '{{{_ingest._value.severity}}}'
              tag: nested_append_history_vulnerabilities
              allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.cvss
              tag: convert_cvss_1
              target_field: _ingest._value.cvss
              type: float
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.cvss
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            append:
              field: vulnerability.description
              tag: append_description_2
              value: '{{{_ingest._value.description}}}'
              allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List && (ctx.tags == null || !(ctx.tags.contains('preserve_duplicate_custom_fields')))
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            remove:
              field:
                -  _ingest._value.cve
                -  _ingest._value.severity
                -  _ingest._value.description
              ignore_missing: true
              tag: remove_cve_severity_description_fields
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            date:
              field: _ingest._value.discovered
              target_field: _ingest._value.discovered
              formats:
                - ISO8601
              on_failure:
                - remove:
                    field: _ingest._value.discovered
                    ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            date:
              field: _ingest._value.fixDate
              target_field: _ingest._value.fix_date
              formats:
                - UNIX_MS
              on_failure:
                - remove:
                    field: _ingest._value.fixDate
                    ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.fixLink
              tag: rename_fixLink
              target_field: _ingest._value.fix_link
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.functionLayer
              tag: rename_functionLayer
              target_field: _ingest._value.function_layer
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.gracePeriodDays
              tag: convert_gracePeriodDays
              target_field: _ingest._value.grace_period_days
              type: long
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.graceperiodDays
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.id
              tag: convert_id
              target_field: _ingest._value.id
              type: string
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.id
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            date:
              field: _ingest._value.layerTime
              target_field: _ingest._value.layer_time
              formats:
                - UNIX_MS
              on_failure:
                - remove:
                    field: _ingest._value.layerTime
                    ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.packageName
              tag: rename_vulnerabilities_packageName
              target_field: _ingest._value.package.name
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.packageVersion
              tag: rename_vulnerabilities_packageVersion
              target_field: _ingest._value.package.version
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.riskFactors
              tag: rename_vulnerabilities_riskFactors
              target_field: _ingest._value.risk_factors
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            date:
              field: _ingest._value.published
              target_field: _ingest._value.published
              formats:
                - UNIX_MS
              on_failure:
                - remove:
                    field: _ingest._value.published
                    ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.twistlock
              tag: convert_vulnerabilities_twistlock
              target_field: _ingest._value.twistlock
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.twistlock
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.vulnTagInfos
              tag: rename_vulnerabilities_vulnTagInfos
              target_field: _ingest._value.vuln_tag_infos
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.wildfireMalware
              tag: rename_vulnerabilities_wildfireMalware
              target_field: _ingest._value.wild_fire_malware
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.history
      if: ctx.prisma_cloud?.host?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            remove:
              field:
                - _ingest._value.fixDate
                - _ingest._value.gracePeriodDays
                - _ingest._value.layerTime
              ignore_missing: true
              tag: remove_history_vulnerability_duplicate_fields
  - rename:
      field: json.hostDevices
      tag: rename_hostDevices
      target_field: prisma_cloud.host.devices
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.devices
      if: ctx.prisma_cloud?.host?.devices instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.ip
          tag: convert__devices_ip
          type: ip
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.ip
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.devices
      if: ctx.prisma_cloud?.host?.devices instanceof List
      ignore_failure: true
      processor:
        append:
          field: related.ip
          tag: append_devices_ip_to_related_ip
          value: '{{{_ingest._value.ip}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.devices
      if: ctx.prisma_cloud?.host?.devices instanceof List
      ignore_failure: true
      processor:
        append:
          field: host.ip
          tag: append_devices_ip_to_host_ip
          value: '{{{_ingest._value.ip}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.devices
      if: ctx.prisma_cloud?.host?.devices instanceof List
      ignore_failure: true
      processor:
        append:
          field: related.ip
          tag: append_devices_ip_to_related_ip
          value: '{{{_ingest._value.ip}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.devices
      if: ctx.prisma_cloud?.host?.devices instanceof List
      ignore_failure: true
      processor:
        append:
          field: related.hosts
          tag: append_devices_name_to_related_hosts
          value: '{{{_ingest._value.name}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.devices
      if: ctx.prisma_cloud?.host?.devices instanceof List && (ctx.tags == null || !(ctx.tags.contains('preserve_duplicate_custom_fields')))
      ignore_failure: true
      processor:
        remove:
          field:
            -  _ingest._value.ip
            -  _ingest._value.name
          ignore_missing: true
          tag: foreach_remove_ecs_duplicate_devices_fields
  - rename:
      field: json.hostname
      tag: rename_hostname
      target_field: prisma_cloud.host.hostname
      ignore_missing: true
  - set:
      field: host.hostname
      tag: set_hostname
      copy_from: prisma_cloud.host.hostname
      ignore_empty_value: true
  - append:
      field: related.hosts
      value: '{{{prisma_cloud.host.hostname}}}'
      tag: append_hostname_into_hosts
      allow_duplicates: false
      if: ctx.prisma_cloud?.host?.hostname != null
  - convert:
      field: json.hostRuntimeEnabled
      tag: convert_hostRuntimeEnabled
      target_field: prisma_cloud.host.runtime_enabled
      type: boolean
      ignore_missing: true
      if: ctx.json?.hostRuntimeEnabled != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.hosts
      tag: rename_hosts
      target_field: prisma_cloud.host.hosts
      ignore_missing: true
  - rename:
      field: json.id
      tag: rename_id
      target_field: prisma_cloud.host.id
      ignore_missing: true
  - date:
      field: json.image.created
      tag: date_created
      target_field: prisma_cloud.host.image.created
      formats:
        - ISO8601
      if: ctx.json?.image?.created != null && ctx.json.image.created != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.image.entrypoint
      tag: rename_entrypoint
      target_field: prisma_cloud.host.image.entrypoint
      ignore_missing: true
  - rename:
      field: json.image.env
      tag: rename_env
      target_field: prisma_cloud.host.image.env
      ignore_missing: true
  - convert:
      field: json.image.healthcheck
      tag: convert_healthcheck
      target_field: prisma_cloud.host.image.healthcheck
      type: boolean
      ignore_missing: true
      if: ctx.json?.image?.healthcheck != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.image.history
      tag: rename_image_history
      target_field: prisma_cloud.host.image.history
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.baseLayer
          tag: convert_image_history_baseLayer
          target_field: _ingest._value.base_layer
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.baseLayer
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.emptyLayer
          tag: convert_image_history_emptylayer
          target_field: _ingest._value.empty_layer
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.emptyLayer
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.created
          target_field: _ingest._value.created
          formats:
            - UNIX_MS
          on_failure:
            - remove:
                field: _ingest._value.created
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.sizeBytes
          tag: convert_image_history_sizeBytes
          target_field: _ingest._value.size_bytes
          type: long
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.sizeBytes
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        remove:
          field:
            - _ingest._value.baseLayer
            - _ingest._value.emptyLayer
            - _ingest._value.sizeBytes
          tag: foreach_remove_image_history_duplicate_fields
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.applicableRules
              tag: rename_image_history_vulnerabilities_applicableRules
              target_field: _ingest._value.applicable_rules
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.binaryPkgs
              tag: rename_image_history_vulnerabilities_binaryPkgs
              target_field: _ingest._value.binary_pkgs
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.vecStr
              tag: rename_image_history_vulnerabilities_vecStr
              target_field: _ingest._value.vec_str
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.block
              tag: convert_image_history_vulnerabilities_block
              target_field: _ingest._value.block
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.block
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.cri
              tag: convert_image_history_vulnerabilities_cri
              target_field: _ingest._value.cri
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.cri
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.custom
              tag: convert_image_history_vulnerabilities_custom
              target_field: _ingest._value.custom
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.custom
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            append:
              field: vulnerability.id
              tag: append_image_history_vulnerabilities_cve_to_vulnerability_id
              value: '{{{_ingest._value.cve}}}'
              allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            append:
              field: vulnerability.severity
              tag: append_image_history_vulnerabilities_severity
              value: '{{{_ingest._value.severity}}}'
              allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.cvss
              tag: convert_image_history_vulnerabilities_cvss
              target_field: _ingest._value.cvss
              type: float
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.cvss
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            append:
              field: vulnerability.description
              tag: append__image_history_vulnerabilities_description
              value: '{{{_ingest._value.description}}}'
              allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List && (ctx.tags == null || !(ctx.tags.contains('preserve_duplicate_custom_fields')))
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            remove:
              field:
                -  _ingest._value.cve
                -  _ingest._value.severity
                -  _ingest._value.description
              ignore_missing: true
              tag: remove_image_history_vulnerabilites_ecs_duplicate_fields
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            date:
              field: _ingest._value.discovered
              target_field: _ingest._value.discovered
              formats:
                - ISO8601
              on_failure:
                - remove:
                    field: _ingest._value.discovered
                    ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            date:
              field: _ingest._value.fixDate
              target_field: _ingest._value.fix_date
              formats:
                - UNIX_MS
              on_failure:
                - remove:
                    field: _ingest._value.fixDate
                    ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.fixLink
              tag: rename_image_history_vulnerabilities_fixLink
              target_field: _ingest._value.fix_link
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.functionLayer
              tag: rename_image_history_vulnerabilities_functionLayer
              target_field: _ingest._value.function_layer
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.gracePeriodDays
              tag: convert_image_history_vulnerabilities_gracePeriodDays
              target_field: _ingest._value.grace_period_days
              type: long
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.gracePeriodDays
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.id
              tag: convert_image_history_vulnerabilities_id
              target_field: _ingest._value.id
              type: string
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.id
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            date:
              field: _ingest._value.layerTime
              target_field: _ingest._value.layer_time
              formats:
                - UNIX_MS
              on_failure:
                - remove:
                    field: _ingest._value.layerTime
                    ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.packageName
              tag: rename_image_history_vulnerabilities_packageName
              target_field: _ingest._value.package.name
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.packageVersion
              tag: rename_image_history_vulnerabilities_packageVersion
              target_field: _ingest._value.package.version
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.riskFactors
              tag: rename_image_history_vulnerabilities_riskFactors
              target_field: _ingest._value.risk_factors
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            date:
              field: _ingest._value.published
              target_field: _ingest._value.published
              formats:
                - UNIX_MS
              on_failure:
                - remove:
                    field: _ingest._value.published
                    ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.twistlock
              tag: convert_image_history_vulnerabilities_twistlock
              target_field: _ingest._value.twistlock
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.twistlock
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.vulnTagInfos
              tag: rename_image_history_vulnerabilities_vulnTagInfos
              target_field: _ingest._value.vuln_tag_infos
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.wildfireMalware
              tag: rename_image_history_vulnerabilities_wildfireMalware
              target_field: _ingest._value.wild_fire_malware
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.image.history
      if: ctx.prisma_cloud?.host?.image?.history instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.vulnerabilities
          ignore_failure: true
          processor:
            remove:
              field:
                - _ingest._value.fixDate
                - _ingest._value.gracePeriodDays
                - _ingest._value.layerTime
              ignore_missing: true
              tag: remove_custom_ecs_mapped_fields
  - rename:
      field: json.image.id
      tag: rename_image_id
      target_field: prisma_cloud.host.image.id
      ignore_missing: true
  - rename:
      field: json.image.labels
      tag: rename_image_labels
      target_field: prisma_cloud.host.image.labels
      ignore_missing: true
  - rename:
      field: json.image.layers
      tag: rename_image_layers
      target_field: prisma_cloud.host.image.layers
      ignore_missing: true
  - rename:
      field: json.image.os
      tag: rename_image_os
      target_field: prisma_cloud.host.image.os
      ignore_missing: true
  - rename:
      field: json.image.repoDigest
      tag: rename_repoDigest
      target_field: prisma_cloud.host.image.repo.digest
      ignore_missing: true
  - rename:
      field: json.image.repoTags
      tag: rename_repoTags
      target_field: prisma_cloud.host.image.repo.tags
      ignore_missing: true
  - rename:
      field: json.image.user
      tag: rename_image_user
      target_field: prisma_cloud.host.image.user
      ignore_missing: true
  - rename:
      field: json.image.workingDir
      tag: rename_image_workingDir
      target_field: prisma_cloud.host.image.working_dir
      ignore_missing: true
  - convert:
      field: json.installedProducts.agentless
      tag: convert_prisma_cloud_host_installed_products_agentless
      target_field: prisma_cloud.host.installed_products.agentless
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.agentless != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.installedProducts.apache
      tag: rename_installedProducts_apache
      target_field: prisma_cloud.host.installed_products.apache
      ignore_missing: true
  - rename:
      field: json.installedProducts.docker
      tag: rename_installedProducts_docker
      target_field: prisma_cloud.host.installed_products.docker
      ignore_missing: true
  - rename:
      field: json.installedProducts.kubernetes
      tag: rename_installedProducts_kubernetes
      target_field: prisma_cloud.host.installed_products.kubernetes
      ignore_missing: true
  - convert:
      field: json.installedProducts.awsCloud
      tag: convert_awsClous
      target_field: prisma_cloud.host.installed_products.aws_cloud
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.awsCloud != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.installedProducts.clusterType
      tag: rename_clusterType
      target_field: prisma_cloud.host.installed_products.cluster_type
      ignore_missing: true
  - convert:
      field: json.installedProducts.crio
      tag: convert_crio
      target_field: prisma_cloud.host.installed_products.crio
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.crio != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.installedProducts.dockerEnterprise
      tag: convert_dockerEnterprise
      target_field: prisma_cloud.host.installed_products.docker_enterprise
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.dockerEnterprise != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.installedProducts.hasPackageManager
      tag: convert_hasPackageManager
      target_field: prisma_cloud.host.installed_products.has_package_manager
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.hasPackageManager != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.installedProducts.k8sApiServer
      tag: convert_k8sApiserver
      target_field: prisma_cloud.host.installed_products.k8s_api_server
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.k8sApiServer != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.installedProducts.k8sControllerManager
      tag: convert_k8sControllerManager
      target_field: prisma_cloud.host.installed_products.k8s_controller_manager
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.k8sControllerManager != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.installedProducts.k8sEtcd
      tag: convert_k8sEtcd
      target_field: prisma_cloud.host.installed_products.k8s_etcd
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.k8sEtcd != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.installedProducts.k8sFederationApiServer
      tag: convert_k8sFederationApiServer
      target_field: prisma_cloud.host.installed_products.k8s_federation_api_server
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.k8sFederationApiServer != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.installedProducts.k8sFederationControllerManager
      tag: convert_k8sFederationControllerManager
      target_field: prisma_cloud.host.installed_products.k8s_federation_controller_manager
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.k8sFederationControllerManager != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.installedProducts.k8sKubelet
      tag: convert_k8sKubelet
      target_field: prisma_cloud.host.installed_products.k8s_kubelet
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.k8sKubelet != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.installedProducts.k8sProxy
      tag: convert_k8sProxy
      target_field: prisma_cloud.host.installed_products.k8s_proxy
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.k8sProxy != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.installedProducts.k8sScheduler
      tag: convert_k8sScheduler
      target_field: prisma_cloud.host.installed_products.k8s_scheduler
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.k8sScheduler != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.installedProducts.managedClusterVersion
      tag: rename_managedClusterVersion
      target_field: prisma_cloud.host.installed_products.managed_cluster_version
      ignore_missing: true
  - convert:
      field: json.installedProducts.openshift
      tag: convert_openshift
      target_field: prisma_cloud.host.installed_products.openshift
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.openshift != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.installedProducts.openshiftVersion
      tag: rename_openshiftVersion
      target_field: prisma_cloud.host.installed_products.openshift_version
      ignore_missing: true
  - rename:
      field: json.installedProducts.osDistro
      tag: rename_osDistro
      target_field: prisma_cloud.host.installed_products.os_distro
      ignore_missing: true
  - convert:
      field: json.installedProducts.serverless
      tag: convert_serverless
      target_field: prisma_cloud.host.installed_products.serverless
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.serverless != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.installedProducts.swarmManager
      tag: convert_swarmManager
      target_field: prisma_cloud.host.installed_products.swarm.manager
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.swarmManager != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.installedProducts.swarmNode
      tag: convert_swarmNode
      target_field: prisma_cloud.host.installed_products.swarm.node
      type: boolean
      ignore_missing: true
      if: ctx.prisma_cloud?.host?.installed_products?.swarmNode != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.instances
      tag: rename_instances
      target_field: prisma_cloud.host.instances
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.instances
      if: ctx.prisma_cloud?.host?.instances instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.modified
          target_field: _ingest._value.modified
          formats:
            - ISO8601
          on_failure:
            - remove:
                field: _ingest._value.modified
                ignore_missing: true
  - convert:
      field: json.isARM64
      target_field: prisma_cloud.host.is_arm64
      tag: convert_isARM64
      type: boolean
      ignore_missing: true
      if: ctx.json?.isARM64 != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.k8sClusterAddr
      tag: rename_k8sClusterAddr
      target_field: prisma_cloud.host.k8s_cluster_addr
      ignore_missing: true
  - rename:
      field: json.labels
      tag: rename_labels
      target_field: prisma_cloud.host.labels
      ignore_missing: true
  - date:
      field: json.malwareAnalyzedTime
      tag: date_malwareAnalyzedTime
      target_field: prisma_cloud.host.malware_analyzed_time
      formats:
        - ISO8601
      if: ctx.json?.malwareAnalyzedTime != null && ctx.json.malwareAnalyzedTime != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.missingDistroVulnCoverage
      tag: convert_missingDistroVulnCoverage
      target_field: prisma_cloud.host.missing_distro_vuln_coverage
      type: boolean
      ignore_missing: true
      if: ctx.json?.missingDistroVulnCoverage != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.namespaces
      tag: rename_namespaces
      target_field: prisma_cloud.host.namespaces
      ignore_missing: true
  - rename:
      field: json.osDistro
      tag: rename_osDistro
      target_field: prisma_cloud.host.os_distro.value
      ignore_missing: true
  - set:
      field: os.family
      tag: set_os_distro_value_to_os_family
      copy_from: prisma_cloud.host.os_distro.value
      ignore_empty_value: true
  - rename:
      field: json.osDistroRelease
      tag: rename_osDistroRelease
      target_field: prisma_cloud.host.os_distro.release
      ignore_missing: true
  - set:
      field: os.name
      tag: set_os_distro_release_to_os_name
      copy_from: prisma_cloud.host.os_distro.release
      ignore_empty_value: true
  - rename:
      field: json.osDistroVersion
      tag: rename_osDistroVersion
      target_field: prisma_cloud.host.os_distro.version
      ignore_missing: true
  - set:
      field: os.version
      tag: set_os_distro_version_to_os_version
      copy_from: prisma_cloud.host.os_distro.version
      ignore_empty_value: true
  - convert:
      field: json.packageCorrelationDone
      tag: convert_packageCorrelationDone
      target_field: prisma_cloud.host.package.correlation_done
      type: boolean
      ignore_missing: true
      if: ctx.json?.packageCorrelationDone != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.packageManager
      tag: convert_packageManager
      target_field: prisma_cloud.host.package.manager
      type: boolean
      ignore_missing: true
      if: ctx.json?.packageManager != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.packages
      tag: rename_packages
      target_field: prisma_cloud.host.packages
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.pkgsType
          tag: rename_packages_pkgsType
          target_field: _ingest._value.pkgs_type
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        append:
          field: package.type
          tag: append_packages_pkgs_type_to_package_type
          value: '{{{_ingest._value.pkgs_type}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List && (ctx.tags == null || !(ctx.tags.contains('preserve_duplicate_custom_fields')))
      ignore_failure: true
      processor:
        remove:
          field:
            -  _ingest._value.pkgs_type
          ignore_missing: true
          tag: foreach_remove_packages_ecs_duplicate_fields
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.binaryIdx
              tag: convert_packages_binaryIdx
              target_field: _ingest._value.binary_idx
              type: long
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.binaryIdx
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.binaryPkgs
              tag: rename_packages_pkgs_binaryPkgs
              target_field: _ingest._value.binary_pkgs
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.cveCount
              tag: convert_packages_pkgs_cveCount
              target_field: _ingest._value.cve_count
              type: long
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.cveCount
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.defaultGem
              tag: convert_packages_pkgs_defaultGem
              target_field: _ingest._value.default_gem
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.defaultGem
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.functionLayer
              tag: rename_packages_pkgs_functionLayer
              target_field: _ingest._value.function_layer
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.goPkg
              tag: convert_packages_pkgs_goPkg
              target_field: _ingest._value.go_pkg
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.goPkg
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            rename:
              field: _ingest._value.jarIdentifier
              tag: rename_packages_pkgs_jarIdentifier
              target_field: _ingest._value.jar_identifier
              ignore_missing: true
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            date:
              field: _ingest._value.layerTime
              target_field: _ingest._value.layer_time
              formats:
                - UNIX_MS
              on_failure:
                - remove:
                    field: _ingest._value.layerTime
                    ignore_missing: true
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            append:
              field: package.license
              tag: append_packages_pkgs_license
              value: '{{{_ingest._value.license}}}'
              allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            append:
              field: package.name
              tag: append_packages_pkgs_name_to_package_name
              value: '{{{_ingest._value.name}}}'
              allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            append:
              field: package.path
              tag: append_packages_pkgs_path
              value: '{{{_ingest._value.path}}}'
              allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            append:
              field: package.version
              tag: append_packages_pkgs_version_to_package_version
              value: '{{{_ingest._value.version}}}'
              allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List && (ctx.tags == null || !(ctx.tags.contains('preserve_duplicate_custom_fields')))
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            remove:
              field:
                -  _ingest._value.license
                -  _ingest._value.name
                -  _ingest._value.path
                -  _ingest._value.version
              ignore_missing: true
              tag: remove_packages_ecs_duplicate_fields_custom
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            convert:
              field: _ingest._value.osPackage
              tag: convert_packages_pkgs_osPackage
              target_field: _ingest._value.os_package
              type: boolean
              ignore_missing: true
              on_failure:
                - remove:
                    field: _ingest._value.osPackage
                    ignore_missing: true
                - append:
                    field: error.message
                    value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.packages
      if: ctx.prisma_cloud?.host?.packages instanceof List
      ignore_failure: true
      processor:
        foreach:
          field: _ingest._value.pkgs
          ignore_failure: true
          processor:
            remove:
              field:
                - _ingest._value.binaryIdx
                - _ingest._value.cveCount
                - _ingest._value.defaultGem
                - _ingest._value.goPkg
                - _ingest._value.layerTime
                - _ingest._value.osPackage
              ignore_missing: true
              tag: remove_pacages_custom_duplicate
  - convert:
      field: json.pullDuration
      tag: convert_pullDuration
      target_field: prisma_cloud.host.pull_duration
      type: long
      ignore_missing: true
      if: ctx.json?.pullDuration != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - date:
      field: json.pushTime
      tag: date_pushTime
      target_field: prisma_cloud.host.push_time
      formats:
        - ISO8601
      if: ctx.json?.pushTime != null && ctx.json.pushTime != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.redHatNonRPMImage
      tag: convert_redHatNonRPMImage
      target_field: prisma_cloud.host.red_hat_non_rpm_image
      type: boolean
      ignore_missing: true
      if: ctx.json?.redHatNonRPMImage != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.registryNamespace
      tag: rename_registryNamespace
      target_field: prisma_cloud.host.registry.namespace
      ignore_missing: true
  - rename:
      field: json.registryTags
      tag: rename_registryTags
      target_field: prisma_cloud.host.registry.tags
      ignore_missing: true
  - rename:
      field: json.registryType
      tag: rename_registryType
      target_field: prisma_cloud.host.registry.type
      ignore_missing: true
  - rename:
      field: json.repoDigests
      tag: rename_repoDigests
      target_field: prisma_cloud.host.repo_digests
      ignore_missing: true
  - rename:
      field: json.repoTag.digest
      tag: rename_repoTag_digest
      target_field: prisma_cloud.host.repo_tag.digest
      ignore_missing: true
  - rename:
      field: json.repoTag.id
      tag: rename_repoTag_id
      target_field: prisma_cloud.host.repo_tag.id
      ignore_missing: true
  - rename:
      field: json.repoTag.registry
      tag: rename_repoTag_registry
      target_field: prisma_cloud.host.repo_tag.registry
      ignore_missing: true
  - rename:
      field: json.repoTag.repo
      tag: rename_repoTag_repo
      target_field: prisma_cloud.host.repo_tag.repo
      ignore_missing: true
  - rename:
      field: json.repoTag.tag
      tag: rename_repoTag_tag
      target_field: prisma_cloud.host.repo_tag.value
      ignore_missing: true
  - rename:
      field: json.riskFactors
      tag: rename_riskFactors
      target_field: prisma_cloud.host.risk_factors
      ignore_missing: true
  - rename:
      field: json.rhelRepos
      tag: rename_rhelRepos
      target_field: prisma_cloud.host.rhel_repos
      ignore_missing: true
  - date:
      field: json.scanBuildDate
      tag: date_scanBuildDate
      target_field: prisma_cloud.host.scan.build_date
      formats:
        - ISO8601
        - basic_date
      if: ctx.json?.scanBuildDate != null && ctx.json.scanBuildDate != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.scanDuration
      tag: convert_scanDuration
      target_field: prisma_cloud.host.scan.duration
      type: long
      ignore_missing: true
      if: ctx.json?.scanDuration != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.scanId
      tag: rename_scanId
      target_field: prisma_cloud.host.scan.id
      ignore_missing: true
  - date:
      field: json.scanTime
      tag: date_scanTime
      target_field: prisma_cloud.host.scan.time
      formats:
        - ISO8601
      if: ctx.json?.scanTime != null && ctx.json.scanTime != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.scanVersion
      tag: rename_scanVersion
      target_field: prisma_cloud.host.scan.version
      ignore_missing: true
  - rename:
      field: json.Secrets
      tag: rename_Secrets
      target_field: prisma_cloud.host.secrets
      ignore_missing: true
  - rename:
      field: json.startupBinaries
      tag: rename_startupBinaries
      target_field: prisma_cloud.host.startup_binaries
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.startup_binaries
      tag: foreach_convert_startup_binaries_altered
      if: ctx.prisma_cloud?.host?.startup_binaries instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.altered
          tag: convert_startup_binaries_altered
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.altered
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.startup_binaries
      if: ctx.prisma_cloud?.host?.startup_binaries instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.cveCount
          tag: convert_startup_binaries_cveCount
          target_field: _ingest._value.cve_count
          type: long
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.cveCount
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.startup_binaries
      if: ctx.prisma_cloud?.host?.startup_binaries instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.fileMode
          tag: convert_startup_binaries_fileMode
          target_field: _ingest._value.file_mode
          type: long
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.fileMode
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.startup_binaries
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.functionLayer
          tag: rename_startup_binaries_functionLayer
          target_field: _ingest._value.function_layer
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.startup_binaries
      if: ctx.prisma_cloud?.host?.startup_binaries instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.missingPkg
          tag: convert_startup_binaries_missingPkg
          target_field: _ingest._value.missing_pkg
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.missingPkg
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.startup_binaries
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.pkgRootDir
          tag: rename_startup_binaries_pkgRootDir
          target_field: _ingest._value.pkg_root_dir
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.startup_binaries
      if: ctx.prisma_cloud?.host?.startup_binaries instanceof List
      ignore_failure: true
      processor:
        remove:
          field:
            - _ingest._value.cveCount
            - _ingest._value.fileMode
            - _ingest._value.missingPkg
          ignore_missing: true
          tag: foreach_remove_startupBinaries_custom_duplicate_fields
  - convert:
      field: json.stopped
      tag: convert_stopped
      target_field: prisma_cloud.host.stopped
      type: boolean
      ignore_missing: true
      if: ctx.json?.stopped != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.tags
      tag: rename_tags
      target_field: prisma_cloud.host.tags
      ignore_missing: true
  - rename:
      field: json.topLayer
      tag: rename_topLayer
      target_field: prisma_cloud.host.top_layer
      ignore_missing: true
  - rename:
      field: json.trustResult.hostsStatuses
      tag: rename_hostsStatuses
      target_field: prisma_cloud.host.trust_result.hosts_statuses
      ignore_missing: true
  - rename:
      field: json.trustResult.groups
      tag: rename_groups
      target_field: prisma_cloud.host.trust_result.groups
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.trust_result.groups
      if: ctx.prisma_cloud?.host?.trust_result?.groups instanceof List
      ignore_failure: true
      processor:
        append:
          field: group.name
          tag: append_trust_result_groups_id_to_group_name
          value: '{{{_ingest._value._id}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.trust_result.groups
      if: ctx.prisma_cloud?.host?.trust_result?.groups instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.disabled
          tag: convert_trust_result_groups_disabled
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.disabled
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.trust_result.groups
      if: ctx.prisma_cloud?.host?.trust_result?.groups instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.modified
          target_field: _ingest._value.modified
          formats:
            - ISO8601
          on_failure:
            - remove:
                field: _ingest._value.modified
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.trust_result.groups
      if: ctx.prisma_cloud?.host?.trust_result?.groups instanceof List
      ignore_failure: true
      processor:
        append:
          field: rule.name
          tag: append_trust_result_groups_name_to_rule_name
          value: '{{{_ingest._value.name}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.trust_result.groups
      if: ctx.prisma_cloud?.host?.trust_result?.groups instanceof List
      ignore_failure: true
      processor:
        append:
          field: rule.author
          tag: append_trust_result_groups_owner_to_rule_author
          value: '{{{_ingest._value.owner}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.trust_result.groups
      if: ctx.prisma_cloud?.host?.trust_result?.groups instanceof List && (ctx.tags == null || !(ctx.tags.contains('preserve_duplicate_custom_fields')))
      ignore_failure: true
      processor:
        remove:
          field:
            -  _ingest._value.id
            -  _ingest._value.name
            -  _ingest._value.owner
          ignore_missing: true
          tag: foreach_remove_ecs_mapped_trustResult_fields
  - foreach:
      field: prisma_cloud.host.trust_result.groups
      if: ctx.prisma_cloud?.host?.trust_result?.groups instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.previousName
          tag: rename_trust_result_groups_previousName
          target_field: _ingest._value.previous_name
          ignore_missing: true
  - rename:
      field: json.trustStatus
      tag: rename_trustStatus
      target_field: prisma_cloud.host.trust_status
      ignore_missing: true
  - convert:
      field: json.twistlockImage
      tag: convert_twistlockImage
      target_field: prisma_cloud.host.twistlock_image
      type: boolean
      ignore_missing: true
      if: ctx.json?.twistlockImage != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - rename:
      field: json.type
      tag: rename_type
      target_field: prisma_cloud.host.type
      ignore_missing: true
  - set:
      field: host.type
      tag: set_type_to_host_type
      copy_from: prisma_cloud.host.type
      ignore_empty_value: true
  - rename:
      field: json.vulnerabilities
      tag: rename_vulnerabilities
      target_field: prisma_cloud.host.vulnerabilities.data
      ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.applicableRules
          tag: rename_vulnerabilities_data_applicableRules
          target_field: _ingest._value.applicable_rules
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.binaryPkgs
          tag: rename_vulnerabilities_data_binaryPkgs
          target_field: _ingest._value.binary_pkgs
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.vecStr
          tag: rename_vulnerabilities_data_vecStr
          target_field: _ingest._value.vec_str
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.block
          tag: convert_vulnerabilities_data_block
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.block
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.cri
          tag: convert_vulnerabilities_data_cri
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.cri
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.custom
          tag: convert_vulnerabilities_data_custom
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.custom
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        append:
          field: vulnerability.id
          tag: append_vulnerabilities_data_cve_to_vulnerability_id
          value: '{{{_ingest._value.cve}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        append:
          field: vulnerability.severity
          tag: append__vulnerabilities_data_severity
          value: '{{{_ingest._value.severity}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.cvss
          tag: convert_vulnerabilities_data_cvss
          type: float
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.cvss
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        append:
          field: vulnerability.description
          tag: append_vulnerabilities_data_description
          value: '{{{_ingest._value.description}}}'
          allow_duplicates: false
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List && (ctx.tags == null || !(ctx.tags.contains('preserve_duplicate_custom_fields')))
      ignore_failure: true
      processor:
        remove:
          field:
            -  _ingest._value.cve
            -  _ingest._value.severity
            -  _ingest._value.description
          ignore_missing: true
          tag: foreach_remove_ecs_mapped_vulnerabilities_data_fields
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.discovered
          target_field: _ingest._value.discovered
          formats:
            - ISO8601
          on_failure:
            - remove:
                field: _ingest._value.discovered
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.fixDate
          target_field: _ingest._value.fix_date
          formats:
            - UNIX_MS
          on_failure:
            - remove:
                field: _ingest._value.fixDate
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.fixLink
          tag: rename_vulnerabilities_data_fixLink
          target_field: _ingest._value.fix_link
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.functionLayer
          tag: rename_vulnerabilities_data_functionLayer
          target_field: _ingest._value.function_layer
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.gracePeriodDays
          tag: convert_vulnerabilities_data_gracePeriodDays
          target_field: _ingest._value.grace_period_days
          type: long
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.gracePeriodDays
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.id
          tag: convert_vulnerabilities_data_id
          type: string
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.id
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.layerTime
          target_field: _ingest._value.layer_time
          formats:
            - UNIX_MS
          on_failure:
            - remove:
                field: _ingest._value.layerTime
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.packageName
          tag: rename_vulnerabilities_data_packageName
          target_field: _ingest._value.package.name
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.packageVersion
          tag: rename_vulnerabilities_data_packageVersion
          target_field: _ingest._value.package.version
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.riskFactors
          tag: rename_vulnerabilities_data_riskFactors
          target_field: _ingest._value.risk_factors
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        date:
          field: _ingest._value.published
          target_field: _ingest._value.published
          formats:
            - UNIX_MS
          on_failure:
            - remove:
                field: _ingest._value.published
                ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        convert:
          field: _ingest._value.twistlock
          tag: convert_vulnerabilities_data_twistlock
          type: boolean
          ignore_missing: true
          on_failure:
            - remove:
                field: _ingest._value.twistlock
                ignore_missing: true
            - append:
                field: error.message
                value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.vulnTagInfos
          tag: rename_vulnerabilities_data_vulnTagInfos
          target_field: _ingest._value.vuln_tag_infos
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        rename:
          field: _ingest._value.wildfireMalware
          tag: rename_vulnerabilities_data_wildfireMalware
          target_field: _ingest._value.wild_fire_malware
          ignore_missing: true
  - foreach:
      field: prisma_cloud.host.vulnerabilities.data
      if: ctx.prisma_cloud?.host?.vulnerabilities?.data instanceof List
      ignore_failure: true
      processor:
        remove:
          field:
            - _ingest._value.fixDate
            - _ingest._value.gracePeriodDays
            - _ingest._value.layerTime
          ignore_missing: true
          tag: foreach_remove_ecs_dupliacte_fields
  - convert:
      field: json.vulnerabilitiesCount
      tag: convert_vulnerabilitiesCount
      target_field: prisma_cloud.host.vulnerabilities.count
      type: long
      ignore_missing: true
      if: ctx.json?.vulnerabilitiesCount != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.vulnerabilityDistribution.critical
      tag: convert_vulnerabilityDistribution_critical
      target_field: prisma_cloud.host.vulnerability.distribution.critical
      type: long
      ignore_missing: true
      if: ctx.json?.vulnerabilityDistribution?.critical != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.vulnerabilityDistribution.high
      tag: convert_vulnerabilityDistribution_high
      target_field: prisma_cloud.host.vulnerability.distribution.high
      type: long
      ignore_missing: true
      if: ctx.json?.vulnerabilityDistribution?.high != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.vulnerabilityDistribution.low
      tag: convert_vulnerabilityDistribution_low
      target_field: prisma_cloud.host.vulnerability.distribution.low
      type: long
      ignore_missing: true
      if: ctx.json?.vulnerabilityDistribution?.low != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.vulnerabilityDistribution.medium
      tag: convert_vulnerabilityDistribution_medium
      target_field: prisma_cloud.host.vulnerability.distribution.medium
      type: long
      ignore_missing: true
      if: ctx.json?.vulnerabilityDistribution?.medium != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.vulnerabilityDistribution.total
      tag: convert_vulnerabilityDistribution_total
      target_field: prisma_cloud.host.vulnerability.distribution.total
      type: long
      ignore_missing: true
      if: ctx.json?.vulnerabilityDistribution?.total != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.vulnerabilityRiskScore
      tag: convert_vulnerabilityRiskScore
      target_field: prisma_cloud.host.vulnerability.risk_score
      type: long
      ignore_missing: true
      if: ctx.json?.vulnerabilityRiskScore != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.wildFireUsage.bytes
      tag: convert_wildFireUsage_bytes
      target_field: prisma_cloud.host.wild_fire_usage.bytes
      type: long
      ignore_missing: true
      if: ctx.json?.wildFireUsage?.bytes != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.wildFireUsage.queries
      tag: convert_wildFireUsage_queries
      target_field: prisma_cloud.host.wild_fire_usage.queries
      type: long
      ignore_missing: true
      if: ctx.json?.wildFireUsage?.queries != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - convert:
      field: json.wildFireUsage.uploads
      tag: convert_wildFireUsage_uploads
      target_field: prisma_cloud.host.wild_fire_usage.uploads
      type: long
      ignore_missing: true
      if: ctx.json?.wildFireUsage?.uploads != ''
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'

  - script:
      description: Flatten arrays of arrays.
      tag: flatten_array
      lang: painless
      source: |
        def flatten(def aa) {
          if (!(aa instanceof List)) {
            if (aa instanceof String) {
              return aa;
            }
            return null;
          }
          if (aa.length == 1) {
            // Ensure lexical ordering is consistent between single array optimisation and full set extraction.
            Collections.sort(aa[0]);
            return aa[0];
          }
          def set = new HashSet();
          for (def a: aa) {
            for (def e: a) {
              set.add(e);
            }
          }
          def list = new ArrayList();
          for (def e: set) {
            list.add(e);
          }
          Collections.sort(list);
          return list;
        }

        if (ctx.prisma_cloud?.host?.all_compliance?.data != null) {
          for (int i; i < ctx.prisma_cloud.host.all_compliance.data.length; i++) {
            ctx.prisma_cloud.host.all_compliance.data[i].templates = flatten(ctx.prisma_cloud.host.all_compliance.data[i].templates);
          }
        }
        if (ctx.prisma_cloud?.host?.compliance_issues?.data != null) {
          for (int i; i < ctx.prisma_cloud.host.compliance_issues.data.length; i++) {
            ctx.prisma_cloud.host.compliance_issues.data[i].templates = flatten(ctx.prisma_cloud.host.compliance_issues.data[i].templates);
          }
        }
        if (ctx.prisma_cloud?.host?.history != null) {
          for (int i; i < ctx.prisma_cloud.host.history.length; i++) {
            if (ctx.prisma_cloud.host.history[i].vulnerabilities == null) {
              continue;
            }
            for (int j; j < ctx.prisma_cloud.host.history[i].vulnerabilities.length; j++) {
              ctx.prisma_cloud.host.history[i].vulnerabilities[j].templates = flatten(ctx.prisma_cloud.host.history[i].vulnerabilities[j].templates);
            }
          }
        }
        if (ctx.prisma_cloud?.host?.image?.history != null) {
          for (int i; i < ctx.prisma_cloud.host.image.history.length; i++) {
            if (ctx.prisma_cloud.host.image.history[i].vulnerabilities == null) {
              continue;
            }
            for (int j; j < ctx.prisma_cloud.host.image.history[i].vulnerabilities.length; j++) {
              ctx.prisma_cloud.host.image.history[i].vulnerabilities[j].templates = flatten(ctx.prisma_cloud.host.image.history[i].vulnerabilities[j].templates);
            }
          }
        }
        if (ctx.prisma_cloud?.host?.vulnerabilities?.data != null) {
          for (int i; i < ctx.prisma_cloud.host.vulnerabilities.data.length; i++) {
            ctx.prisma_cloud.host.vulnerabilities.data[i].templates = flatten(ctx.prisma_cloud.host.vulnerabilities.data[i].templates);
          }
        }

  - remove:
      field:
        - json
        - prisma_cloud.host.firewall_protection.tlsPorts
        - prisma_cloud.host.installed_products.awsCloud
        - prisma_cloud.host.installed_products.dockerEnterprise
        - prisma_cloud.host.installed_products.hasPackageManager
        - prisma_cloud.host.installed_products.k8sApiServer
        - prisma_cloud.host.installed_products.k8sControllerManager
        - prisma_cloud.host.installed_products.k8sEtcd
        - prisma_cloud.host.installed_products.k8sFederationApiServer
        - prisma_cloud.host.installed_products.k8sFederationControllerManager
        - prisma_cloud.host.installed_products.k8sKubelet
        - prisma_cloud.host.installed_products.k8sProxy
        - prisma_cloud.host.installed_products.k8sScheduler
        - prisma_cloud.host.installed_products.swarmManager
        - prisma_cloud.host.installed_products.swarmNode
      ignore_missing: true
      tag: remove_json
  - remove:
      field:
        - prisma_cloud.host._id
        - prisma_cloud.host.cloud_metadata.account_id
        - prisma_cloud.host.cloud_metadata.name
        - prisma_cloud.host.cloud_metadata.provider
        - prisma_cloud.host.cloud_metadata.region
        - prisma_cloud.host.cloud_metadata.resource.id
        - prisma_cloud.host.cloud_metadata.type
        - prisma_cloud.host.creation_time
        - prisma_cloud.host.hostname
        - prisma_cloud.host.os_distro.version
        - prisma_cloud.host.os_distro.release
        - prisma_cloud.host.os_distro.value
        - prisma_cloud.host.type
      ignore_missing: true
      if: ctx.tags == null || !(ctx.tags.contains('preserve_duplicate_custom_fields'))
      tag: remove_preserve_duplicate_custom_fields
  - remove:
      field: event.original
      ignore_missing: true
      tag: remove_event_original
      if: ctx.tags == null || !(ctx.tags.contains('preserve_original_event'))
  - script:
      lang: painless
      source: |-
        boolean drop(Object o) {
          if (o == null || o == '') {
            return true;
          } else if (o instanceof Map) {
            ((Map) o).values().removeIf(v -> drop(v));
            return (((Map) o).size() == 0);
          } else if (o instanceof List) {
            ((List) o).removeIf(v -> drop(v));
            return (((List) o).length == 0);
          }
          return false;
        }
        drop(ctx);
      description: Drops null/empty values recursively.
      tag: script_drop_null_values
      on_failure:
        - append:
            field: error.message
            value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - set:
      field: event.kind
      tag: set_pipeline_error_in_event_kind
      value: pipeline_error
      if: ctx.error?.message != null
on_failure:
  - append:
      field: error.message
      value: 'Processor {{{_ingest.on_failure_processor_type}}} with tag {{{_ingest.on_failure_processor_tag}}} in pipeline {{{_ingest.pipeline}}} failed with message: {{{_ingest.on_failure_message}}}'
  - set:
      field: event.kind
      value: pipeline_error
