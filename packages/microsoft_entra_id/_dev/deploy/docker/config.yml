rules:
  - path: /test-cel-tenant-id/oauth2/v2.0/token
    methods: [POST]
    query_params:
      client_id: test-cel-client-id
      client_secret: test-cel-client-secret
      grant_type: client_credentials
      scope: https://graph.microsoft.com/.default
    request_headers:
      Content-Type:
        - "application/x-www-form-urlencoded"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - "application/json"
        body: |-
          {"access_token": "CELtoken","token_type": "Bearer","expires_in": 3600,"ext_expires_in": 3600}
  - path: /v1.0/auditLogs/directoryAudits
    methods: [GET]
    query_params:
      $top: "{$top:10}"
      $orderby: "{$orderby:activityDateTime asc}"
      $filter: "{$filter:.*}"
    request_headers:
      Authorization:
        - "Bearer CELtoken"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - "application/json"
        body: |-
          {"@odata.context":"https://graph.microsoft.com/v1.0/$metadata#auditLogs/directoryAudits","value":[{"id":"Directory_ff629cc2-4337-405c-b348-18741a03da47_8H5XV_265040778","category":"UserManagement","correlationId":"ff629cc2-4337-405c-b348-18741a03da47","result":"success","resultReason":"","activityDisplayName":"Update user","activityDateTime":"2025-02-26T12:07:49.6393364Z","loggedByService":"Core Directory","operationType":"Update","initiatedBy":{"user":null,"app":{"appId":null,"displayName":"Azure MFA StrongAuthenticationService","servicePrincipalId":"f2ee4c91-32e3-4966-93b3-4b3fcbab60f9","servicePrincipalName":null}},"targetResources":[{"id":"4b7ef3e3-3d38-4006-a7bf-898c57dc9c23","displayName":null,"type":"User","userPrincipalName":"maurizio.branca_elastic.co#EXT#@azure2elasticsearch.onmicrosoft.com","groupType":null,"modifiedProperties":[{"displayName":"StrongAuthenticationPhoneAppDetail","oldValue":"[{\"DeviceName\":\"NO_DEVICE\",\"DeviceToken\":\"NO_DEVICE_TOKEN\",\"DeviceTag\":\"SoftwareTokenActivated\",\"PhoneAppVersion\":\"NO_PHONE_APP_VERSION\",\"OathTokenTimeDrift\":0,\"DeviceId\":\"00000000-0000-0000-0000-000000000000\",\"Id\":\"aa4ced83-e369-4d28-ba00-f205838ecdc3\",\"TimeInterval\":0,\"AuthenticationType\":2,\"NotificationType\":1,\"LastAuthenticatedTimestamp\":\"2025-02-24T10:46:04.0400521Z\",\"AuthenticatorFlavor\":\"Authenticator\",\"HashFunction\":\"hmacsha1\",\"TenantDeviceId\":null,\"SecuredPartitionId\":20072,\"SecuredKeyId\":7}]","newValue":"[{\"DeviceName\":\"NO_DEVICE\",\"DeviceToken\":\"NO_DEVICE_TOKEN\",\"DeviceTag\":\"SoftwareTokenActivated\",\"PhoneAppVersion\":\"NO_PHONE_APP_VERSION\",\"OathTokenTimeDrift\":0,\"DeviceId\":\"00000000-0000-0000-0000-000000000000\",\"Id\":\"aa4ced83-e369-4d28-ba00-f205838ecdc3\",\"TimeInterval\":0,\"AuthenticationType\":2,\"NotificationType\":1,\"LastAuthenticatedTimestamp\":\"2025-02-26T12:07:49.4933291Z\",\"AuthenticatorFlavor\":\"Authenticator\",\"HashFunction\":\"hmacsha1\",\"TenantDeviceId\":null,\"SecuredPartitionId\":20072,\"SecuredKeyId\":7}]"},{"displayName":"Included Updated Properties","oldValue":null,"newValue":"\"StrongAuthenticationPhoneAppDetail\""},{"displayName":"TargetId.UserType","oldValue":null,"newValue":"\"Guest\""},{"displayName":"ActorId.ServicePrincipalNames","oldValue":null,"newValue":"\"b5a60e17-278b-4c92-a4e2-b9262e66bb28\""},{"displayName":"SPN","oldValue":null,"newValue":"\"b5a60e17-278b-4c92-a4e2-b9262e66bb28\""}]}],"additionalDetails":[{"key":"UserType","value":"Guest"}]}]}
