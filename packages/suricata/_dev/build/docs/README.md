# Suricata Integration for Elastic

## Overview

The Suricata integration for Elastic enables you to collect and parse logs from Suricata, the open-source threat detection engine. This integration facilitates the collection of network security monitoring data from Suricata's Extensible Event Format (EVE) JSON log, providing visibility into network traffic and potential threats.

By ingesting Suricata logs into Elastic, you can leverage the Elastic Stack for advanced analysis, threat hunting, and security event correlation.

### Compatibility

This module has been developed against Suricata v4.0.4, but is expected to work with other versions of Suricata.

### How it works

The integration works by monitoring and collecting events from Suricata's EVE JSON log file. An Elastic Agent running on the Suricata host reads the log file in near real-time, parses the JSON events, and securely ships them to your Elastic deployment.

## What data does this integration collect?

This integration collects events from Suricata's EVE JSON log. The event types can be configured in Suricata but typically include:

- `alert`: Security alerts generated by rules.
- `anomaly`: Protocol anomalies detected in traffic.
- `flow`: Network flow records.
- `dns`, `http`, `smb`, `tls`, `ssh`, `dhcp`, `nfs`, `smtp`, `kerberos`: Protocol-specific transaction logs.
- `fileinfo`: Information about files extracted from network traffic.
- `stats`: Periodic statistics about Suricata's performance.

### Supported use cases

- **Intrusion Detection and Prevention (IDS/IPS)**: Monitor network traffic for malicious activity and policy violations.
- **Network Traffic Analysis and Threat Hunting**: Analyze detailed protocol logs and flow records to identify suspicious patterns and hunt for threats.
- **Security Event Correlation and Alerting**: Correlate Suricata's security events with other data sources in Elastic SIEM to gain deeper insights and set up automated alerting.

## What do I need to use this integration?

### Vendor prerequisites

- A running instance of Suricata.
- Administrative access to the Suricata host to modify configuration files and restart the service.

### Elastic prerequisites

- An Elastic Agent installed on the Suricata host, enrolled in a policy.

## How do I deploy this integration?

### Agent-based deployment

Elastic Agent must be installed to collect logs from Suricata. You can install only one Elastic Agent per host. For more details, check the Elastic Agent [installation instructions](docs-content://reference/fleet/install-elastic-agents.md).

### Onboard / configure

#### 1. Configure Suricata to generate EVE JSON logs

1.  Locate and open the Suricata configuration file, `suricata.yaml`. The default location is typically `/etc/suricata/suricata.yaml` on Linux systems.
2.  In the `outputs` section of the file, find the `eve-log` logger.
3.  Ensure the `eve-log` output is enabled and configured to write to a file. For comprehensive event logging, enable various event types as shown below.

    ```yaml
    outputs:
      # Extensible Event Format (nicknamed EVE) event log in JSON format
      - eve-log:
          enabled: yes
          filetype: regular #regular|syslog|unix_dgram|unix_stream
          filename: eve.json # The log file to be collected
          # In addition to alerts, you can enable other event types for full visibility.
          types:
            - alert
            - anomaly
            - dhcp
            - dns
            - fileinfo
            - flow
            - http
            - kerberos
            - nfs
            - smb
            - smtp
            - ssh
            - stats
            - tls
    ```

4.  After saving your changes to `suricata.yaml`, restart the Suricata service for the configuration to take effect.
    ```bash
    sudo systemctl restart suricata
    ```
5.  The log file to be collected will be located in the default Suricata log directory, typically `/var/log/suricata/eve.json`.

#### 2. Configure the Elastic integration

1.  In Kibana, navigate to **Management > Integrations**.
2.  Search for "Suricata" and click on the result.
3.  Click **Add Suricata**.
4.  Configure the integration settings. Under **Log file path**, provide the absolute path to the Suricata log file (e.g., `/var/log/suricata/eve.json`).
5.  Choose an existing or create a new agent policy.
6.  Click **Save and continue**, then **Save and deploy changes** to apply the policy to any agents enrolled in it.

### Validation

1.  On the Suricata host, generate test traffic that will trigger an alert. You can use `curl` to a known test domain.
    ```bash
    curl http://testmyids.com
    ```
2.  Check the Suricata `eve.json` log file to confirm that new event data is being written.
    ```bash
    tail -f /var/log/suricata/eve.json
    ```
3.  In Kibana, navigate to the **Discover** tab or open the pre-built **[Logs Suricata] Overview** dashboard.
4.  Filter for Suricata data by using the KQL query `event.dataset : "suricata.eve"`.
5.  Verify that new log events from the Suricata host are appearing. You should see an alert related to the `testmyids.com` traffic.

## Troubleshooting

For help with Elastic ingest tools, check [Common problems](https://www.elastic.co/docs/troubleshoot/ingest/fleet/common-problems).

### Common Configuration Issues

- **Issue:** No data is being ingested into Elastic.
  - **Solution:**
    1.  Verify the Suricata service is running: `sudo systemctl status suricata`.
    2.  Ensure the `eve-log` output is set to `enabled: yes` in `suricata.yaml`.
    3.  Check that the file path in the Elastic integration policy matches the `filename` in `suricata.yaml`. The default is `/var/log/suricata/eve.json`.
    4.  Verify file permissions. The user running Elastic Agent must have read permissions for `eve.json` and execute permissions for its parent directories.
    5.  Check the Elastic Agent logs for "permission denied" or "file not found" errors.

### Ingestion Errors

- **Issue:** Fields are not parsed correctly or `error.message` is present in some documents.
  - **Solution:** This may occur if the EVE JSON output format has been customized. Ensure your `eve-log` configuration in `suricata.yaml` produces standard EVE JSON. Compare your output with the format in the official [Suricata EVE JSON documentation](https://suricata.readthedocs.io/en/latest/output/eve/eve-json-output.html).

### Vendor Resources

- [Suricata User Guide](https://suricata.readthedocs.io/en/latest/)

## Scaling

Suricata's performance depends on hardware, network traffic volume, and rule set complexity. It is multi-threaded and can be scaled by optimizing its configuration (e.g., run modes, CPU affinity) to match the hardware. For high-traffic environments, ensure the disk I/O for the `eve.json` log file can keep up with the event generation rate.

For more information on architectures that can be used for scaling this integration, check the [Ingest Architectures](https://www.elastic.co/docs/manage-data/ingest/ingest-reference-architectures) documentation.

## Reference

### eve

The `eve` data stream collects all event types from the Suricata EVE JSON log file.

#### eve fields

{{ fields "eve" }}

#### eve event

{{ event "eve" }}

### Inputs used

{{ inputDocs }}
