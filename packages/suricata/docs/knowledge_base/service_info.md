# Service Info

## Common use cases
This integration facilitates the collection of network security monitoring data from Suricata. Common use cases include:
- Intrusion Detection and Prevention (IDS/IPS)
- Network traffic analysis and threat hunting
- Security event correlation and alerting

## Data types collected
This integration collects events from Suricata's Extensible Event Format (EVE) JSON log. The event types can be configured in Suricata but typically include:
- `alert`: Security alerts generated by rules.
- `anomaly`: Protocol anomalies detected in traffic.
- `flow`: Network flow records.
- `dns`, `http`, `smb`, `tls`, `ssh`, `dhcp`, `nfs`, `smtp`, `kerberos`: Protocol-specific transaction logs.
- `fileinfo`: Information about files extracted from network traffic.
- `stats`: Periodic statistics about Suricata's performance.

## Compatibility
This integration is compatible with Suricata versions that support EVE JSON output, including versions 5.x, 6.x, and 7.x.

## Scaling and Performance
Suricata's performance is highly dependent on the hardware it runs on, the volume of network traffic being monitored, and the complexity of the enabled rule sets. Suricata is multi-threaded and can be scaled by optimizing its configuration (e.g., run modes, CPU affinity) to match the underlying hardware. For high-traffic environments, ensure the disk I/O for the `eve.json` log file can keep up with the event generation rate.

# Set Up Instructions

## Vendor prerequisites
- A running instance of Suricata.
- Administrative access to the Suricata host to modify configuration files and restart the service.

## Elastic prerequisites
- An Elastic Agent installed on the Suricata host, enrolled in a policy.

## Vendor set up steps
1. Locate and open the Suricata configuration file, `suricata.yaml`. The default location is typically `/etc/suricata/suricata.yaml` on Linux systems.
2. In the `outputs` section of the file, find the `eve-log` logger.
3. Ensure the `eve-log` output is enabled and configured to write to a file. For a comprehensive event log, you can enable various event types.

   ```yaml
   outputs:
     # Extensible Event Format (nicknamed EVE) event log in JSON format
     - eve-log:
         enabled: yes
         filetype: regular #regular|syslog|unix_dgram|unix_stream
         filename: eve.json # The log file to be collected
         # In addition to alerts, you can enable other event types for full visibility.
         types:
           - alert
           - anomaly
           - dhcp
           - dns
           - fileinfo
           - flow
           - http
           - kerberos
           - nfs
           - smb
           - smtp
           - ssh
           - stats
           - tls
   ```
4. After saving your changes to `suricata.yaml`, restart the Suricata service for the configuration to take effect.
   ```bash
   sudo systemctl restart suricata
   ```
5. The log file to be collected will be located in the default Suricata log directory, typically `/var/log/suricata/eve.json`.

## Kibana set up steps
1. In Kibana, navigate to **Management > Integrations**.
2. Search for "Suricata" and click on the result.
3. Click **Add Suricata**.
4. Configure the integration settings. Under **Log file path**, provide the absolute path to the Suricata log file (e.g., `/var/log/suricata/eve.json`).
5. Choose an existing or create a new agent policy.
6. Click **Save and continue**, then **Save and deploy changes** to apply the policy to any agents enrolled in it.

# Validation Steps
1. On the Suricata host, generate traffic that will trigger an alert. You can use `curl` to a known test domain.
   ```bash
   curl http://testmyids.com
   ```
2. Check the Suricata `eve.json` log file to confirm that new event data is being written.
   ```bash
   tail -f /var/log/suricata/eve.json
   ```
3. In Kibana, navigate to the **Discover** tab or open the pre-built **[Logs Suricata] Overview** dashboard.
4. Filter for Suricata data by using the KQL query `event.dataset : "suricata.eve"`.
5. Verify that new log events from the Suricata host are appearing. You should see an alert related to the `testmyids.com` traffic.

# Troubleshooting
/* Add lists of "*Issue* / *Solutions*" for troubleshooting knowledge base into the most appropriate section below */

## Common Configuration Issues
- **Issue:** No data is being ingested into Elastic.
  - **Solution:**
    1. Verify the Suricata service is running on the host: `sudo systemctl status suricata`.
    2. Ensure the `eve-log` output is set to `enabled: yes` in `suricata.yaml`.
    3. Check that the file path configured in the Elastic integration policy matches the `filename` specified in `suricata.yaml`. The default is `/var/log/suricata/eve.json`.
    4. Verify file permissions. The user running the Elastic Agent must have read permissions for the `eve.json` file and execute permissions for its parent directories (`/var/log/` and `/var/log/suricata/`).
    5. Check the Elastic Agent logs for any "permission denied" or "file not found" errors related to the Suricata log file.

## Ingestion Errors
- **Issue:** Fields are not parsed correctly or `error.message` is present in some documents.
  - **Solution:** This may occur if the EVE JSON output format has been customized in a way that the integration does not expect. Ensure your `eve-log` configuration in `suricata.yaml` produces standard EVE JSON. Compare your output with the format described in the official Suricata documentation.

## API Authentication Errors
/_ For API authentication failures, credential errors, and similar _/
- N/A: This integration uses log file collection and does not require API authentication.

## Vendor Resources
- [Suricata User Guide](https://suricata.readthedocs.io/en/latest/)
- [Troubleshooting Common Suricata Issues](https://suricata.readthedocs.io/en/latest/troubleshooting.html)

# Documentation sites
- [Suricata EVE JSON Output Documentation](https://suricata.readthedocs.io/en/latest/output/eve/eve-json-output.html)
- [Suricata Configuration File (suricata.yaml) Documentation](https://suricata.readthedocs.io/en/latest/configuration/suricata-yaml.html#outputs)