# OpenTelemetry Package

Exploratory package to post-process opentelemetry data from apm-server. Neither it is for end-user consumption, nor is it a representative otel integration. For internal research & review purprose only.

Processes opentelemetry documents generated by [apm-server](https://www.elastic.co/guide/en/apm/guide/current/open-telemetry.html) using opentelemetry [collector](https://opentelemetry.io/docs/collector/) for [hostmetrics](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/receiver/hostmetricsreceiver/README.md).

## Assumptions
* opentelemetry-collector to provide *service.name* as dummy. The dataset binding is based on it.
* Uses a dummy data stream for now, which just pings(localhost:9200") as a redundant step.
* Uses hostmetrics system.filesystem mappings in ingest pipeline mapping.

## Datastream
* datastream: metrics-apm.app.dummy-default
* dataset: apm.app.dummy

## Dummy data stream
This is a dummy data-stream for illustrative purpose only.

An example event for `dummy` looks as following:

```json
{
    "agent": {
        "name": "otlp",
        "version": "unknown"
    },
    "data_stream.namespace": "default",
    "processor": {
        "name": "metric",
        "event": "metric"
    },
    "data_stream.type": "metrics",
    "labels": {
        "mode": "rw",
        "state": "reserved",
        "myatt": "test1"
    },
    "metricset.name": "app",
    "observer": {
        "hostname": "Lalits-MacBook-Pro-2.local",
        "id": "7b1af721-6474-4b60-86bb-ddbc6b9b5d53",
        "type": "apm-server",
        "ephemeral_id": "45de8192-14ef-42a4-8680-8839da0470ba",
        "version": "8.5.3"
    },
    "@timestamp": "2022-12-07T04:28:48.823Z",
    "system": {
        "filesystem": {
            "device_name": "/dev/vda1",
            "usage": 10754142208,
            "mount_point": "/etc/hosts",
            "type": "ext4"
        }
    },
    "_metric_descriptions": {
        "system.filesystem.usage": {
            "type": "counter"
        }
    },
    "ecs": {
        "version": "1.12.0"
    },
    "service": {
        "name": "dummy",
        "language": {
            "name": "unknown"
        }
    },
    "data_stream.dataset": "apm.app.dummy",
    "otel": {
        "processed": "done"
    },
    "event": {
        "agent_id_status": "missing",
        "ingested": "2022-12-07T04:28:49Z"
    }
}
```