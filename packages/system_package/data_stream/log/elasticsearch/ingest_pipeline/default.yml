---
description: Pipeline for parsing System Package audit logs
processors:
- set:
    field: ecs.version
    value: "8.5.1"
- set:
    field: event.dataset
    value: system_package.log
- set:
    field: package.architecture
    copy_from: system.audit.package.arch
    if: ctx?.package?.architecture == "" && ctx?.system?.audit?.package?.arch != ""
    on_failure:
        - set:
            field: error.message
            value: "{{ _ingest.on_failure_message }}"
- rename:
    field: message
    target_field: event.original
    ignore_missing: true

  ###########
  # Cleanup #
  ###########

- remove:
    field: event.original
    if: "ctx.tags == null || !(ctx.tags.contains('preserve_original_event'))"
    ignore_missing: true
- remove: 
    field: '@metadata'
    ignore_missing: true
- remove: 
    field: service
    ignore_missing: true