---
description: Pipeline for processing audit logs
processors:
  - dissect:
      field: _temp.remMessage
      pattern: "%{client.user.name} %{barracuda_waf.logs.client_type} %{_temp.clientIp} %{_temp.clientPort} %{barracuda_waf.logs.transaction_type} %{barracuda_waf.logs.transaction_id} %{barracuda_waf.logs.command_name} %{barracuda_waf.logs.change_type} %{barracuda_waf.logs.object_type} %{barracuda_waf.logs.object_name} %{barracuda_waf.logs.variable} %{barracuda_waf.logs.old_value} %{barracuda_waf.logs.new_value} %{barracuda_waf.logs.additional_data}"
  - convert:
      field: _temp.clientIp
      target_field: client.ip
      type: ip
      ignore_missing: true
  - convert:
      field: _temp.clientPort
      target_field: client.port
      type: long
      ignore_missing: true
  - convert:
      field: barracuda_waf.logs.transaction_id
      type: long
      ignore_missing: true
  - geoip:
      field: client.ip
      target_field: client.geo
      ignore_missing: true
  - append:
      field: related.ip
      value: "{{client.ip}}"
      if: ctx.client?.ip != null
      allow_duplicates: false
  - append:
      field: related.user
      value: "{{client.user.name}}"
      if: ctx.client?.user?.name != null
      allow_duplicates: false
  - set:
      field: event.category
      value: [authentication, configuration]
  - set:
      field: event.kind
      value: event
  - set:
      field: event.type
      value: [access]

on_failure:
  - set:
      field: event.kind
      value: pipeline_error
  - append:
      field: error.message
      value: "{{{ _ingest.on_failure_message }}}"
