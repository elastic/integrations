title: "Kubernetes audit logs"
type: logs
release: experimental
elasticsearch:
  index_template:
    mappings:
      dynamic: false
streams:
  - input: aws-cloudwatch
    enabled: false
    template_path: aws-cloudwatch.yml.hbs
    title: Kubernetes audit logs via CloudWatch
    description: Collect Kubernetes audit logs from AWS EKS using AWS Cloudwatch input.
    vars:
      - name: log_group_arn
        type: text
        title: Log Group ARN
        multi: false
        required: false
        show_user: true
        description: ARN of the log group to collect logs from.
      - name: log_group_name
        type: text
        title: Log Group Name
        multi: false
        required: false
        show_user: false
        description: Name of the log group to collect logs from. `region_name` is required when `log_group_name` is given.
      - name: log_group_name_prefix
        type: text
        title: Log Group Name Prefix
        multi: false
        required: false
        show_user: false
        description: The prefix for a group of log group names. `region_name` is required when `log_group_name_prefix` is given. `log_group_name` and `log_group_name_prefix` cannot be given at the same time.
      - name: include_linked_accounts_with_prefix
        type: bool
        title: Include Linked Accounts with prefix
        multi: false
        required: false
        show_user: false
        description: Include log groups from linked accounts when using `log_group_name_prefix` to derive the monitoring log groups.
      - name: region_name
        type: text
        title: Region Name
        multi: false
        required: false
        show_user: false
        description: Region that the specified log group or log group prefix belongs to.
      - name: number_of_workers
        type: integer
        title: Number of Workers
        default: 1
        required: false
        show_user: false
        description: The number of workers assigned to read from log groups. Each worker will read log events from one of the log groups matching `log_group_name_prefix`. For example, if `log_group_name_prefix` matches five log groups, then `number_of_workers` should be set to `5`. The default value is `1`.
      - name: log_streams
        type: text
        title: Log Streams
        multi: true
        required: false
        show_user: false
        description: A list of strings of log streams names that Filebeat collect log events from.
      - name: log_stream_prefix
        type: text
        title: Log Stream Prefix
        multi: false
        required: false
        show_user: false
        description: A string to filter the results to include only log events from log streams that have names starting with this prefix.
      - name: start_position
        type: text
        title: Start Position
        multi: false
        required: false
        default: beginning
        show_user: true
        description: Allows user to specify if this input should read log files from the beginning or from the end.
      - name: scan_frequency
        type: text
        title: Scan Frequency
        multi: false
        required: false
        show_user: false
        default: 1m
        description: This config parameter sets how often Filebeat checks for new log events from the specified log group.
      - name: api_timeput
        type: text
        title: API Timeout
        multi: false
        required: false
        show_user: false
        default: 120s
        description: The maximum duration of AWS API can take. If it exceeds the timeout, AWS API will be interrupted.
      - name: api_sleep
        type: text
        title: API Sleep
        multi: false
        required: false
        show_user: false
        default: 200ms
        description: This is used to sleep between AWS FilterLogEvents API calls inside the same collection period. `FilterLogEvents` API has a quota of 5 transactions per second (TPS)/account/Region. This value should only be adjusted when there are multiple Filebeats or multiple Filebeat inputs collecting logs from the same region and AWS account.
      - name: latency
        type: text
        title: Latency
        multi: false
        required: false
        show_user: false
        description: "The amount of time required for the logs to be available to CloudWatch Logs. Sample values, `1m` or `5m` â€” see Golang [time.ParseDuration](https://pkg.go.dev/time#ParseDuration) for more details. Latency translates the query's time range to consider the CloudWatch Logs latency. Example: `5m` means that the integration will query CloudWatch to search for logs available 5 minutes ago."
      - name: tags
        type: text
        title: Tags
        multi: true
        required: true
        show_user: true
        default:
          - forwarded
          - kubernetes-audit_logs
      - name: processors
        type: yaml
        title: Processors
        multi: false
        required: false
        show_user: false
        description: >
          Processors are used to reduce the number of fields in the exported event or to enhance the event with metadata. This executes in the agent before the logs are parsed. See [Processors](https://www.elastic.co/guide/en/beats/filebeat/current/filtering-and-enhancing-data.html) for details.

      - name: preserve_original_event
        required: true
        show_user: true
        title: Preserve original event
        description: Preserves a raw copy of the original event, added to the field `event.original`
        type: bool
        multi: false
        default: false
  - input: azure-eventhub
    enabled: false
    title: Kubernetes audit logs via Azure Event Hub
    description: Collect Kubernetes audit logs from Azure AKS using Azure Event Hub input.
    template_path: azure-eventhub.yml.hbs
    vars:
      - name: eventhub
        type: text
        title: Azure Event Hub
        multi: false
        required: true
        show_user: true
        description: >-
          Elastic recommends using one Azure Event Hub for each integration. Visit [Create an Azure Event Hub](https://docs.elastic.co/integrations/azure#create-an-event-hub) to learn more. Use Azure Event Hub names up to 30 characters long to avoid compatibility issues.
      - name: consumer_group
        type: text
        title: Consumer Group
        multi: false
        required: true
        show_user: true
        default: $Default
        description: >-
          We recommend using a dedicated consumer group for the Azure Event Hub input. Reusing consumer groups among non-related consumers can cause unexpected behavior and possibly lost events.
      - name: connection_string
        type: password
        title: Connection String
        multi: false
        required: true
        show_user: true
        secret: true
        description: >-
          The connection string required to communicate with Azure Event Hubs. See [Get an Azure Event Hubs connection string](https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-get-connection-string) to learn more.
      - name: storage_account
        type: text
        title: Storage Account
        multi: false
        required: true
        show_user: true
        description: >-
          The name of the storage account where the consumer group's state/offsets will be stored and updated.
      - name: storage_account_key
        type: password
        title: Storage Account Key
        multi: false
        required: true
        show_user: true
        secret: true
        description: >-
          The storage account key will be used to authorise access to data in your storage account.
      - name: storage_account_container
        type: text
        title: Storage Account Container
        multi: false
        required: false
        show_user: false
        description: >-
          The storage account container where the integration stores the checkpoint data for the consumer group. It is an advanced option to use with extreme care. You must use a dedicated storage account container for each Azure log type. Do not reuse the same container name for more than one Azure log type. See [Container Names] (Naming and Referencing Containers, Blobs, and Metadata - Azure Storage) for details on naming rules from Microsoft. The integration generates a default container name if not specified.
      - name: resource_manager_endpoint
        type: text
        title: Resource Manager Endpoint
        multi: false
        required: false
        show_user: false
        description: >-
          By default, we are using the Azure public environment. To override this, users can provide a specific resource manager endpoint in order to use a different Azure environment.
      - name: tags
        type: text
        title: Tags
        multi: true
        required: true
        show_user: false
        default:
          - forwarded
          - kubernetes-audit_logs
      - name: preserve_original_event
        required: true
        show_user: true
        title: Preserve original event
        description: Preserve a raw copy of the original event, added to the field `event.original`.
        type: bool
        multi: false
        default: false
      - name: processors
        type: yaml
        title: Processors
        multi: false
        required: false
        show_user: false
        description: >-
          Processors are used to reduce the number of fields in the exported event or to enhance the event with metadata. This executes in the agent before the logs are parsed. See [Processors](https://www.elastic.co/guide/en/beats/filebeat/current/filtering-and-enhancing-data.html) for details.
  - input: gcp-pubsub
    enabled: false
    title: Kubernetes audit logs via GCP Pub/Sub
    description: Collect Kubernetes audit logs from Google GKE using GCP Pub/Sub.
    template_path: gcp-pubsub.yml.hbs
    vars:
      - name: project_id
        type: text
        title: Project ID
        description: Google Cloud project ID.
        required: true
      - name: topic
        type: text
        title: Topic
        description: Name of the topic where the logs are written to.
        multi: false
        required: true
        show_user: true
      - name: credentials_file
        type: text
        title: Credentials File
        description: Path to a JSON file containing the credentials and key used to subscribe. As an alternative you can use the credentials_json config option or rely on Google Application Default Credentials (ADC).
        multi: false
        required: false
        show_user: true
        secret: true
      - name: credentials_json
        type: text
        title: Credentials JSON
        description: JSON blob containing the credentials and key used to subscribe. This can be as an alternative to credentials_file if you want to embed the credential data within your config file or put the information into a keystore. You may also use Google Application Default Credentials (ADC).
        multi: false
        required: false
        show_user: true
        secret: true
      - name: subscription_name
        type: text
        title: Subscription Name
        description: Use the short subscription name here, not the full-blown path with the project ID. You can find it as "Subscription ID" on the Google Cloud Console.
        multi: false
        required: true
        show_user: true
      - name: subscription_create
        type: bool
        title: Subscription Create
        description: If true, the integration will create the subscription on start.
        multi: false
        required: true
        show_user: false
        default: false
      - name: subscription_num_goroutines
        type: text
        title: Subscription Num Goroutines
        description: Number of goroutines created to read from the subscription. This does not limit the number of messages that can be processed concurrently or the maximum number of goroutines the input will create.
        multi: false
        required: false
        show_user: false
      - name: subscription_max_outstanding_messages
        type: text
        title: Subscription Max Outstanding Messages
        description: The maximum number of unprocessed messages (unacknowledged but not yet expired). If the value is negative, then there will be no limit on the number of unprocessed messages. Default is 1000.
        multi: false
        required: false
        show_user: false
      - name: alternative_host
        type: text
        title: Alternative host
        multi: false
        required: false
        show_user: false
        description: "Overrides the default Pub/Sub service address and disables TLS. For testing."
      - name: tags
        type: text
        title: Tags
        multi: true
        required: true
        show_user: false
        default:
          - forwarded
          - kubernetes-audit_logs
      - name: preserve_original_event
        required: true
        show_user: true
        title: Preserve original event
        description: Preserves a raw copy of the original event, added to the field `event.original`
        type: bool
        multi: false
        default: false
      - name: processors
        type: yaml
        title: Processors
        multi: false
        required: false
        show_user: false
        description: >
          Processors are used to reduce the number of fields in the exported event or to enhance the event with metadata. This executes in the agent before the logs are parsed. See [Processors](https://www.elastic.co/guide/en/fleet/current/elastic-agent-processor-configuration.html) for details.
  - input: filestream
    enabled: false
    title: Collect Kubernetes audit logs via Filestream
    description: Collect Kubernetes audit logs from local K8S nodes using Filestream input.
    vars:
      - name: paths
        type: text
        required: true
        title: Kubernetes audit log path
        multi: true
        default:
          - /var/log/kubernetes/kube-apiserver-audit.log
      - name: processors
        type: yaml
        title: Processors
        multi: false
        required: false
        show_user: false
        description: >-
          Processors are used to reduce the number of fields in the exported event or to enhance the event with metadata. This executes in the agent before the events are shipped. See [Processors](https://www.elastic.co/guide/en/beats/filebeat/current/filtering-and-enhancing-data.html) for details.
      - name: tags
        type: text
        title: Tags
        multi: true
        required: true
        show_user: true
        default:
          - forwarded
          - kubernetes-audit_logs
      - name: condition
        title: Condition
        description: Condition to filter when to collect this input. See [Dynamic Input Configuration](https://www.elastic.co/guide/en/fleet/current/dynamic-input-configuration.html) for details.
        type: text
        multi: false
        required: false
        show_user: false
