{
    "id": "kubernetes-critical-pod-oomkilled-alert",
    "type": "alerting_rule_template",
    "attributes": {
        "name": "[Kubernetes] Critical Pod OOMKilled Alert",
        "tags": [
            "Kubernetes",
            "Container",
            "OOMKilled"
        ],
        "ruleTypeId": ".es-query",
        "schedule": {
            "interval": "1m"
        },
        "params": {
            "searchType": "esqlQuery",
            "timeWindowSize": 5,
            "timeWindowUnit": "m",
            "esqlQuery": {
                "esql": "// Alert when critical pods are killed due to memory exhaustion (OOMKilled).\n//\n// What triggers this alert:\n// Container exceeded memory limits and was terminated by the kernel OOM killer.\n//\n// Placeholders to replace:\n// - Replace the kubernetes.pod.name filter with your critical pod patterns,\n//   e.g., `kubernetes.pod.name` LIKE \"api*\" OR `kubernetes.pod.name` LIKE \"worker*\"\n//\n// What it means:\n// Pods restart automatically but this indicates resource misconfiguration.\n//\n// Action needed:\n// - Increase memory limits\n// - Check for memory leaks\n// - Review recent workload changes\n//\n// To reduce noise, increase the threshold (e.g., doc_count > 3).\nTS metrics-kubernetes.container-*\n| WHERE `kubernetes.container.status.reason` == \"OOMKilled\"\n  AND `kubernetes.pod.name` IS NOT NULL\n| STATS doc_count = COUNT(*)\n  BY `orchestrator.cluster.name`, `kubernetes.pod.name`\n| WHERE doc_count > 1"
            },
            "groupBy": "row",
            "timeField": "@timestamp"
        },
        "alertDelay": {
            "active": 3
        }
    },
    "managed": true,
    "coreMigrationVersion": "8.8.0",
    "typeMigrationVersion": "10.1.0"
}
