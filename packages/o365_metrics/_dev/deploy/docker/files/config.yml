rules:
  - path: /1234/oauth2/v2.0/token
    methods: ['POST']
    responses: 
      - status_code: 200
        headers: 
          Content-Type: 
            'application/json'
        body: |-
          {"token_type":"Bearer","expires_in":3599,"ext_expires_in":3599,"access_token":"xxxx"}
  - path: /communications/callRecords
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
            "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#communications/callRecords",
            "@odata.nextLink": "{{ env "SERVER_ADDRESS" }}/communications/callRecords?$skiptoken=1f9bdf3f-348e-49f0-8ac6-7e50a28da860",
            "value": [
              {
                "id": "6ce-b8fa-4d44-a613-7f81",
                "version": 2,
                "type": "unknown",
                "modalities": [
                  "audio"
                ],
                "lastModifiedDateTime": "2023-09-25T10:36:40Z",
                "startDateTime": "2023-09-25T09:28:38Z",
                "endDateTime": "2023-09-25T09:28:41Z",
                "organizer": {
                  "user": {
                    "id": "82f5-0000-0000-00-3b5777",
                    "displayName": "Aie Wins",
                    "tenantId": "dc3699-474c-4d40-900c-626d81f"
                  }
                },
                "organizer_v2@odata.context": "https://graph.microsoft.com/v1.0/$metadata#communications/callRecords('3cf3bbc8-b21d-4f2e-bfd0-b13603ae6c65')/organizer_v2/$entity",
                "organizer_v2": {
                  "id": "8209f5-0000-0000-0000-3b51777",
                  "identity": {
                    "user": {
                      "id": "8215-0000-0000-0000-3b51777",
                      "displayName": "Aie Wins",
                      "tenantId": "dc3699-474c-4d40-900c-626d81f"
                    }
                  }
                }
              },
              {
                "id": "1000abcd-b8fa-4d44-a613-7f5081",
                "version": 2,
                "type": "unknown",
                "modalities": [
                  "audio"
                ],
                "lastModifiedDateTime": "2023-09-25T10:36:40Z",
                "startDateTime": "2023-09-25T09:28:38Z",
                "endDateTime": "2023-09-25T09:28:41Z",
                "organizer": {
                  "user": {
                    "id": "821809f5-0000-0000-0000-3b5136c0e777",
                    "displayName": "Abbie Wilkins",
                    "tenantId": "dc368399-474c-4d40-900c-6265431fd81f"
                  }
                },
                "organizer_v2@odata.context": "https://graph.microsoft.com/v1.0/$metadata#communications/callRecords('3cf3bbc8-b21d-4f2e-bfd0-b13603ae6c65')/organizer_v2/$entity",
                "organizer_v2": {
                  "id": "821809f5-0000-0000-0000-3b5136c0e777",
                  "identity": {
                    "user": {
                      "id": "821809f5-0000-0000-0000-3b5136c0e777",
                      "displayName": "Abbie Wilkins",
                      "tenantId": "dc368399-474c-4d40-900c-6265431fd81f"
                    }
                  }
                }
              }
            ]
          }
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
            "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#communications/callRecords",
            "value": [
              {
                "id": "a66d-b6f2-443-b12e-5aa1b6",
                "version": 3,
                "type": "groupCall",
                "modalities": [
                  "audio"
                ],
                "lastModifiedDateTime": "2025-03-26T13:42:01.8433333Z",
                "startDateTime": "2025-03-26T13:04:57.2290561Z",
                "endDateTime": "2025-03-26T13:06:31.4360658Z",
                "organizer": {
                  "user": {
                    "id": "ef5628b8-ad86-4de2-9357-014fe8c184e8",
                    "displayName": "Mun Decu",
                    "tenantId": "3f2c-bce5-42b7-8a68-14385af"
                  }
                },
                "organizer_v2@odata.context": "https://graph.microsoft.com/v1.0/$metadata#communications/callRecords('a66d-b6f2-443-b12e-5aa1b67e')/organizer_v2/$entity",
                "organizer_v2": {
                  "id": "ef56b8-ad86-4de2-9357-014fe4e8",
                  "identity": {
                    "user": {
                      "id": "ef56b8-ad86-4de2-9357-014fe4e8",
                      "displayName": "Mun Decu",
                      "tenantId": "3f2c-bce5-42b7-8a68-14385af"
                    }
                  }
                }
              }
            ]
          }              
  - path: /communications/callRecords/6ce-b8fa-4d44-a613-7f81/sessions
    methods: ['GET']
    query_params:
      '$expand': 'segments'
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#communications/callRecords('key6ce-b8fa-4d44-a613-7f81word')/sessions(segments())",
              "@odata.nextLink": "{{ env "SERVER_ADDRESS" }}/communications/callRecords/6ce-b8fa-4d44-a613-7f81/sessions?$expand=segments&$skiptoken=a66d-b6f2-4403-b12e-5ae",
              "value": [
                  {
                      "id": "a66d-b6f2-443-b12e-5aa1b6",
                      "modalities": [
                          "audio"
                      ],
                      "startDateTime": "2025-03-26T13:16:59.5204625Z",
                      "endDateTime": "2025-03-26T13:21:43.2028167Z",
                      "segments": [
                          {
                              "startDateTime": "2025-03-26T13:04:57.232483Z",
                              "endDateTime": "2025-03-26T13:05:14.2824132Z",
                              "id": "a66d-b6f2-443-b12e-5aa1b6",
                              "failureInfo": {
                                "stage": "midcall",
                                "reason": ""
                              },
                              "caller": {
                                  "associatedIdentity": {
                                      "id": "d1941-76c2-45fc-b6ee-2c38dd3",
                                      "displayName": "oma Mrs",
                                      "tenantId": "3f3de92c-bce5-42b7-8a68-1438785455af",
                                      "userPrincipalName": "oma.mrs@m365596.onmoft.com"
                                  }
                              },
                              "callee": {
                                  "associatedIdentity": {
                                      "id": "75b-6ba8-4a80-8ffb-eeda7",
                                      "displayName": "Lu ias",
                                      "tenantId": "3f3de92c-bce5-42b7-8a68-1438785455af",
                                      "userPrincipalName": "lu.ias@m3596.onmicrosoft.com"
                                  }
                              },
                              "media": [
                                  {
                                      "label": "main-audio",
                                      "callerNetwork": {
                                          "ipAddress": "10.0.146.255",
                                          "subnet": null,
                                          "linkSpeed": 0,
                                          "connectionType": "wired",
                                          "port": 3492,
                                          "reflexiveIPAddress": "52.113.244.89",
                                          "relayIPAddress": null,
                                          "relayPort": null,
                                          "macAddress": null,
                                          "wifiMicrosoftDriver": null,
                                          "wifiMicrosoftDriverVersion": null,
                                          "wifiVendorDriver": null,
                                          "wifiVendorDriverVersion": null,
                                          "wifiChannel": null,
                                          "wifiBand": "unknown",
                                          "basicServiceSetIdentifier": null,
                                          "wifiRadioType": "unknown",
                                          "wifiSignalStrength": null,
                                          "wifiBatteryCharge": null,
                                          "dnsSuffix": null,
                                          "sentQualityEventRatio": null,
                                          "receivedQualityEventRatio": null,
                                          "delayEventRatio": null,
                                          "bandwidthLowEventRatio": null,
                                          "networkTransportProtocol": "udp",
                                          "traceRouteHops": []                                         
                                      },
                                      "calleeNetwork": {
                                          "ipAddress": "10.0.146.255",
                                          "subnet": null,
                                          "linkSpeed": 0,                                      
                                          "connectionType": "wired",
                                          "port": 3480,
                                          "reflexiveIPAddress": "52.112.234.86",
                                          "relayIPAddress": null,
                                          "relayPort": null,
                                          "macAddress": null,
                                          "wifiMicrosoftDriver": null,
                                          "wifiMicrosoftDriverVersion": null,
                                          "wifiVendorDriver": null,
                                          "wifiVendorDriverVersion": null,
                                          "wifiChannel": null,
                                          "wifiBand": "unknown",
                                          "basicServiceSetIdentifier": null,
                                          "wifiRadioType": "unknown",
                                          "wifiSignalStrength": null,
                                          "wifiBatteryCharge": null,
                                          "dnsSuffix": null,
                                          "sentQualityEventRatio": null,
                                          "receivedQualityEventRatio": null,
                                          "delayEventRatio": null,
                                          "bandwidthLowEventRatio": null,
                                          "networkTransportProtocol": "udp",
                                          "traceRouteHops": []
                                        },
                                      "streams": [
                                          {
                                              "streamId": "2386820939",
                                              "startDateTime": null,
                                              "endDateTime": null,
                                              "streamDirection": "callerToCallee",
                                              "averageAudioDegradation": null,
                                              "averageJitter": null,
                                              "maxJitter": null,
                                              "averagePacketLossRate": null,
                                              "maxPacketLossRate": null,
                                              "averageRatioOfConcealedSamples": null,
                                              "maxRatioOfConcealedSamples": null,
                                              "averageRoundTripTime": null,
                                              "maxRoundTripTime": null,
                                              "packetUtilization": 0,
                                              "averageBandwidthEstimate": null,
                                              "wasMediaBypassed": null,
                                              "postForwardErrorCorrectionPacketLossRate": null,
                                              "averageVideoFrameLossPercentage": null,
                                              "averageReceivedFrameRate": null,
                                              "lowFrameRateRatio": null,
                                              "averageVideoPacketLossRate": null,
                                              "averageVideoFrameRate": null,
                                              "lowVideoProcessingCapabilityRatio": null,
                                              "averageAudioNetworkJitter": null,
                                              "maxAudioNetworkJitter": null,
                                              "audioCodec": "unknown",
                                              "videoCodec": "unknown",
                                              "rmsFreezeDuration": null,
                                              "averageFreezeDuration": null,
                                              "isAudioForwardErrorCorrectionUsed": null
                                          },
                                          {
                                              "streamId": "8322863909",
                                              "startDateTime": null,
                                              "endDateTime": null,
                                              "streamDirection": "calleeToCaller",
                                              "averageAudioDegradation": null,
                                              "averageJitter": null,
                                              "maxJitter": null,
                                              "averagePacketLossRate": null,
                                              "maxPacketLossRate": null,
                                              "averageRatioOfConcealedSamples": null,
                                              "maxRatioOfConcealedSamples": null,
                                              "averageRoundTripTime": null,
                                              "maxRoundTripTime": null,
                                              "packetUtilization": 0,
                                              "averageBandwidthEstimate": null,
                                              "wasMediaBypassed": null,
                                              "postForwardErrorCorrectionPacketLossRate": null,
                                              "averageVideoFrameLossPercentage": null,
                                              "averageReceivedFrameRate": null,
                                              "lowFrameRateRatio": null,
                                              "averageVideoPacketLossRate": null,
                                              "averageVideoFrameRate": null,
                                              "lowVideoProcessingCapabilityRatio": null,
                                              "averageAudioNetworkJitter": null,
                                              "maxAudioNetworkJitter": null,
                                              "audioCodec": "unknown",
                                              "videoCodec": "unknown",
                                              "rmsFreezeDuration": null,
                                              "averageFreezeDuration": null,
                                              "isAudioForwardErrorCorrectionUsed": null
                                          }
                                      ]
                                  }
                              ]
                          }
                      ]
                  },
                  {
                      "id": "test1",
                      "modalities": [
                          "audio"
                      ],
                      "startDateTime": "2025-03-26T13:16:59.5204625Z",
                      "endDateTime": "2025-03-26T13:21:43.2028167Z",
                      "segments": [
                          {
                              "startDateTime": "2025-03-26T13:04:57.232483Z",
                              "endDateTime": "2025-03-26T13:05:14.2824132Z",
                              "id": "a66d-b6f2-443-b12e-5aa1b6",
                              "failureInfo": {
                                "stage": "midcall",
                                "reason": ""
                              },
                              "caller": {
                                  "associatedIdentity": {
                                      "id": "d1945381-76c2-45fc-b6ee-2c36c5128dd3",
                                      "displayName": "Tia mia",
                                      "tenantId": "3f92c-be5-47-88-14355af",
                                      "userPrincipalName": "tia.mia@m3596.onmicrosoft.com"
                                  }
                              },
                              "callee": {
                                  "associatedIdentity": {
                                      "id": "72cec15b-6ba8-4a80-8ffb-eeda50425a77",
                                      "displayName": "Lui Eia",
                                      "tenantId": "3f2c-b5-47-88-1435af",
                                      "userPrincipalName": "lui.eia@m365596.onmicrosoft.com"
                                  }
                              },
                              "media": [
                                  {
                                      "label": "main-audio",
                                      "callerNetwork": {
                                          "ipAddress": "10.0.146.255",
                                          "subnet": null,
                                          "linkSpeed": 0,                                      
                                          "connectionType": "wired",
                                          "port": 3492,
                                          "reflexiveIPAddress": "52.113.244.89",
                                          "relayIPAddress": null,
                                          "relayPort": null,
                                          "macAddress": null,
                                          "wifiMicrosoftDriver": null,
                                          "wifiMicrosoftDriverVersion": null,
                                          "wifiVendorDriver": null,
                                          "wifiVendorDriverVersion": null,
                                          "wifiChannel": null,
                                          "wifiBand": "unknown",
                                          "basicServiceSetIdentifier": null,
                                          "wifiRadioType": "unknown",
                                          "wifiSignalStrength": null,
                                          "wifiBatteryCharge": null,
                                          "dnsSuffix": null,
                                          "sentQualityEventRatio": null,
                                          "receivedQualityEventRatio": null,
                                          "delayEventRatio": null,
                                          "bandwidthLowEventRatio": null,
                                          "networkTransportProtocol": "udp",
                                          "traceRouteHops": []                                         
                                      },
                                      "calleeNetwork": {
                                          "ipAddress": "10.0.146.255",
                                          "subnet": null,
                                          "linkSpeed": 0,                                      
                                          "connectionType": "wired",
                                          "port": 3480,
                                          "reflexiveIPAddress": "52.112.234.86",
                                          "relayIPAddress": null,
                                          "relayPort": null,
                                          "macAddress": null,
                                          "wifiMicrosoftDriver": null,
                                          "wifiMicrosoftDriverVersion": null,
                                          "wifiVendorDriver": null,
                                          "wifiVendorDriverVersion": null,
                                          "wifiChannel": null,
                                          "wifiBand": "unknown",
                                          "basicServiceSetIdentifier": null,
                                          "wifiRadioType": "unknown",
                                          "wifiSignalStrength": null,
                                          "wifiBatteryCharge": null,
                                          "dnsSuffix": null,
                                          "sentQualityEventRatio": null,
                                          "receivedQualityEventRatio": null,
                                          "delayEventRatio": null,
                                          "bandwidthLowEventRatio": null,
                                          "networkTransportProtocol": "udp",
                                          "traceRouteHops": []
                                        },
                                      "streams": [
                                          {
                                              "streamId": "2386820939",
                                              "startDateTime": null,
                                              "endDateTime": null,
                                              "streamDirection": "callerToCallee",
                                              "averageAudioDegradation": null,
                                              "averageJitter": null,
                                              "maxJitter": null,
                                              "averagePacketLossRate": null,
                                              "maxPacketLossRate": null,
                                              "averageRatioOfConcealedSamples": null,
                                              "maxRatioOfConcealedSamples": null,
                                              "averageRoundTripTime": null,
                                              "maxRoundTripTime": null,
                                              "packetUtilization": 0,
                                              "averageBandwidthEstimate": null,
                                              "wasMediaBypassed": null,
                                              "postForwardErrorCorrectionPacketLossRate": null,
                                              "averageVideoFrameLossPercentage": null,
                                              "averageReceivedFrameRate": null,
                                              "lowFrameRateRatio": null,
                                              "averageVideoPacketLossRate": null,
                                              "averageVideoFrameRate": null,
                                              "lowVideoProcessingCapabilityRatio": null,
                                              "averageAudioNetworkJitter": null,
                                              "maxAudioNetworkJitter": null,
                                              "audioCodec": "unknown",
                                              "videoCodec": "unknown",
                                              "rmsFreezeDuration": null,
                                              "averageFreezeDuration": null,
                                              "isAudioForwardErrorCorrectionUsed": null
                                          },
                                          {
                                              "streamId": "8322863909",
                                              "startDateTime": null,
                                              "endDateTime": null,
                                              "streamDirection": "calleeToCaller",
                                              "averageAudioDegradation": null,
                                              "averageJitter": null,
                                              "maxJitter": null,
                                              "averagePacketLossRate": null,
                                              "maxPacketLossRate": null,
                                              "averageRatioOfConcealedSamples": null,
                                              "maxRatioOfConcealedSamples": null,
                                              "averageRoundTripTime": null,
                                              "maxRoundTripTime": null,
                                              "packetUtilization": 0,
                                              "averageBandwidthEstimate": null,
                                              "wasMediaBypassed": null,
                                              "postForwardErrorCorrectionPacketLossRate": null,
                                              "averageVideoFrameLossPercentage": null,
                                              "averageReceivedFrameRate": null,
                                              "lowFrameRateRatio": null,
                                              "averageVideoPacketLossRate": null,
                                              "averageVideoFrameRate": null,
                                              "lowVideoProcessingCapabilityRatio": null,
                                              "averageAudioNetworkJitter": null,
                                              "maxAudioNetworkJitter": null,
                                              "audioCodec": "unknown",
                                              "videoCodec": "unknown",
                                              "rmsFreezeDuration": null,
                                              "averageFreezeDuration": null,
                                              "isAudioForwardErrorCorrectionUsed": null
                                          }
                                      ]
                                  }
                              ]
                          }
                      ]
                  }
              ]
          }    
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#communications/callRecords('key6ce-b8fa-4d44-a613-7f81word')/sessions(segments())",
              "value": [
                  {
                      "id": "2e89-b0db-40ad-b5d8-dcbc1",
                      "modalities": [
                          "video"
                      ],
                      "startDateTime": "2025-03-26T13:04:57.232483Z",
                      "endDateTime": "2025-03-26T13:06:31.4228153Z",
                      "segments": [
                          {
                              "startDateTime": "2025-03-26T13:04:57.232483Z",
                              "endDateTime": "2025-03-26T13:06:31.4228153Z",
                              "id": "2e569-b0db-40ad-b5d8-dcb2c1",
                              "failureInfo": {
                                "stage": "midcall",
                                "reason": ""
                              },
                              "caller": {
                                  "associatedIdentity": {
                                      "id": "efb8-ad86-4de2-9357-01184e8",
                                      "displayName": "Dev Desan",
                                      "tenantId": "3f2c-e5-b7-8a68-14af",
                                      "userPrincipalName": "dev.desan@m365x96.onmicrosoft.com"
                                  }
                              },
                              "callee": {
                                  "associatedIdentity": {
                                      "id": "75b-a8-80-8fb-ee5a77",
                                      "displayName": "Kung fu",
                                      "tenantId": "3f392c-bce5-42b7-8a68-14f",
                                      "userPrincipalName": "kung.fu@m3696.onmicrosoft.com"
                                  }
                              },
                              "media": [
                                  {
                                      "label": "main-video",
                                      "callerNetwork": {
                                          "ipAddress": "10.0.146.255",
                                          "subnet": null,
                                          "linkSpeed": 0,                                      
                                          "connectionType": "wired",
                                          "port": 3492,
                                          "reflexiveIPAddress": "52.113.244.89",
                                          "relayIPAddress": null,
                                          "relayPort": null,
                                          "macAddress": null,
                                          "wifiMicrosoftDriver": null,
                                          "wifiMicrosoftDriverVersion": null,
                                          "wifiVendorDriver": null,
                                          "wifiVendorDriverVersion": null,
                                          "wifiChannel": null,
                                          "wifiBand": "unknown",
                                          "basicServiceSetIdentifier": null,
                                          "wifiRadioType": "unknown",
                                          "wifiSignalStrength": null,
                                          "wifiBatteryCharge": null,
                                          "dnsSuffix": null,
                                          "sentQualityEventRatio": null,
                                          "receivedQualityEventRatio": null,
                                          "delayEventRatio": null,
                                          "bandwidthLowEventRatio": null,
                                          "networkTransportProtocol": "udp",
                                          "traceRouteHops": []                                         
                                      },
                                      "calleeNetwork": {
                                          "ipAddress": "10.0.146.255",
                                          "subnet": null,
                                          "linkSpeed": 0,                                      
                                          "connectionType": "wired",
                                          "port": 3480,
                                          "reflexiveIPAddress": "52.112.234.86",
                                          "relayIPAddress": null,
                                          "relayPort": null,
                                          "macAddress": null,
                                          "wifiMicrosoftDriver": null,
                                          "wifiMicrosoftDriverVersion": null,
                                          "wifiVendorDriver": null,
                                          "wifiVendorDriverVersion": null,
                                          "wifiChannel": null,
                                          "wifiBand": "unknown",
                                          "basicServiceSetIdentifier": null,
                                          "wifiRadioType": "unknown",
                                          "wifiSignalStrength": null,
                                          "wifiBatteryCharge": null,
                                          "dnsSuffix": null,
                                          "sentQualityEventRatio": null,
                                          "receivedQualityEventRatio": null,
                                          "delayEventRatio": null,
                                          "bandwidthLowEventRatio": null,
                                          "networkTransportProtocol": "udp",
                                          "traceRouteHops": []
                                        },
                                      "streams": [
                                          {
                                              "streamId": "2386820939",
                                              "startDateTime": null,
                                              "endDateTime": null,
                                              "streamDirection": "callerToCallee",
                                              "averageAudioDegradation": null,
                                              "averageJitter": null,
                                              "maxJitter": null,
                                              "averagePacketLossRate": null,
                                              "maxPacketLossRate": null,
                                              "averageRatioOfConcealedSamples": null,
                                              "maxRatioOfConcealedSamples": null,
                                              "averageRoundTripTime": null,
                                              "maxRoundTripTime": null,
                                              "packetUtilization": 0,
                                              "averageBandwidthEstimate": null,
                                              "wasMediaBypassed": null,
                                              "postForwardErrorCorrectionPacketLossRate": null,
                                              "averageVideoFrameLossPercentage": null,
                                              "averageReceivedFrameRate": null,
                                              "lowFrameRateRatio": null,
                                              "averageVideoPacketLossRate": null,
                                              "averageVideoFrameRate": null,
                                              "lowVideoProcessingCapabilityRatio": null,
                                              "averageAudioNetworkJitter": null,
                                              "maxAudioNetworkJitter": null,
                                              "audioCodec": "unknown",
                                              "videoCodec": "unknown",
                                              "rmsFreezeDuration": null,
                                              "averageFreezeDuration": null,
                                              "isAudioForwardErrorCorrectionUsed": null
                                          },
                                          {
                                              "streamId": "8322863909",
                                              "startDateTime": null,
                                              "endDateTime": null,
                                              "streamDirection": "calleeToCaller",
                                              "averageAudioDegradation": null,
                                              "averageJitter": null,
                                              "maxJitter": null,
                                              "averagePacketLossRate": null,
                                              "maxPacketLossRate": null,
                                              "averageRatioOfConcealedSamples": null,
                                              "maxRatioOfConcealedSamples": null,
                                              "averageRoundTripTime": null,
                                              "maxRoundTripTime": null,
                                              "packetUtilization": 0,
                                              "averageBandwidthEstimate": null,
                                              "wasMediaBypassed": null,
                                              "postForwardErrorCorrectionPacketLossRate": null,
                                              "averageVideoFrameLossPercentage": null,
                                              "averageReceivedFrameRate": null,
                                              "lowFrameRateRatio": null,
                                              "averageVideoPacketLossRate": null,
                                              "averageVideoFrameRate": null,
                                              "lowVideoProcessingCapabilityRatio": null,
                                              "averageAudioNetworkJitter": null,
                                              "maxAudioNetworkJitter": null,
                                              "audioCodec": "unknown",
                                              "videoCodec": "unknown",
                                              "rmsFreezeDuration": null,
                                              "averageFreezeDuration": null,
                                              "isAudioForwardErrorCorrectionUsed": null
                                          }
                                      ]
                                  }
                              ]
                          }
                      ]
                  }
              ]
          }
  - path: /communications/callRecords/1000abcd-b8fa-4d44-a613-7f5081/sessions
    methods: ['GET']
    query_params:
      '$expand': 'segments'
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#communications/callRecords('1f9bdf3f-348e-49f0-8ac6-7e50a28da860')/sessions(segments())",
              "value": [
                  {
                      "id": "8ac2-bdf9-4b64-a43a-e8570ab",
                      "modalities": [
                          "audio"
                      ],
                      "startDateTime": "2025-03-26T13:16:59.5204625Z",
                      "endDateTime": "2025-03-26T13:21:43.2028167Z",
                      "segments": [
                          {
                              "startDateTime": "2025-03-26T13:16:59.5204625Z",
                              "endDateTime": "2025-03-26T13:21:43.2028167Z",
                              "id": "843a-e9fab",
                              "failureInfo": {
                                "stage": "midcall",
                                "reason": ""
                              },
                              "caller": {
                                  "associatedIdentity": {
                                      "id": "d81-76c2-45fc-b6ee-2c3dd3",
                                      "displayName": "Jeh Meh",
                                      "tenantId": "3f3c-bce5-42b7-8a68-1438af",
                                      "userPrincipalName": "jeh.meh@m365596.onmicrosoft.com"
                                  }
                              },
                              "media": [
                                  {
                                      "label": "main-audio",
                                      "callerNetwork": {
                                          "ipAddress": "10.0.146.255",
                                          "subnet": null,
                                          "linkSpeed": 0,                                      
                                          "connectionType": "wired",
                                          "port": 3492,
                                          "reflexiveIPAddress": "52.113.244.89",
                                          "relayIPAddress": null,
                                          "relayPort": null,
                                          "macAddress": null,
                                          "wifiMicrosoftDriver": null,
                                          "wifiMicrosoftDriverVersion": null,
                                          "wifiVendorDriver": null,
                                          "wifiVendorDriverVersion": null,
                                          "wifiChannel": null,
                                          "wifiBand": "unknown",
                                          "basicServiceSetIdentifier": null,
                                          "wifiRadioType": "unknown",
                                          "wifiSignalStrength": null,
                                          "wifiBatteryCharge": null,
                                          "dnsSuffix": null,
                                          "sentQualityEventRatio": null,
                                          "receivedQualityEventRatio": null,
                                          "delayEventRatio": null,
                                          "bandwidthLowEventRatio": null,
                                          "networkTransportProtocol": "udp",
                                          "traceRouteHops": []                                         
                                      },
                                      "calleeNetwork": {
                                          "ipAddress": "10.0.146.255",
                                          "subnet": null,
                                          "linkSpeed": 0,                                      
                                          "connectionType": "wired",
                                          "port": 3480,
                                          "reflexiveIPAddress": "52.112.234.86",
                                          "relayIPAddress": null,
                                          "relayPort": null,
                                          "macAddress": null,
                                          "wifiMicrosoftDriver": null,
                                          "wifiMicrosoftDriverVersion": null,
                                          "wifiVendorDriver": null,
                                          "wifiVendorDriverVersion": null,
                                          "wifiChannel": null,
                                          "wifiBand": "unknown",
                                          "basicServiceSetIdentifier": null,
                                          "wifiRadioType": "unknown",
                                          "wifiSignalStrength": null,
                                          "wifiBatteryCharge": null,
                                          "dnsSuffix": null,
                                          "sentQualityEventRatio": null,
                                          "receivedQualityEventRatio": null,
                                          "delayEventRatio": null,
                                          "bandwidthLowEventRatio": null,
                                          "networkTransportProtocol": "udp",
                                          "traceRouteHops": []
                                        },
                                      "streams": [
                                          {
                                              "streamId": "2386820939",
                                              "startDateTime": null,
                                              "endDateTime": null,
                                              "streamDirection": "callerToCallee",
                                              "averageAudioDegradation": null,
                                              "averageJitter": null,
                                              "maxJitter": null,
                                              "averagePacketLossRate": null,
                                              "maxPacketLossRate": null,
                                              "averageRatioOfConcealedSamples": null,
                                              "maxRatioOfConcealedSamples": null,
                                              "averageRoundTripTime": null,
                                              "maxRoundTripTime": null,
                                              "packetUtilization": 0,
                                              "averageBandwidthEstimate": null,
                                              "wasMediaBypassed": null,
                                              "postForwardErrorCorrectionPacketLossRate": null,
                                              "averageVideoFrameLossPercentage": null,
                                              "averageReceivedFrameRate": null,
                                              "lowFrameRateRatio": null,
                                              "averageVideoPacketLossRate": null,
                                              "averageVideoFrameRate": null,
                                              "lowVideoProcessingCapabilityRatio": null,
                                              "averageAudioNetworkJitter": null,
                                              "maxAudioNetworkJitter": null,
                                              "audioCodec": "unknown",
                                              "videoCodec": "unknown",
                                              "rmsFreezeDuration": null,
                                              "averageFreezeDuration": null,
                                              "isAudioForwardErrorCorrectionUsed": null
                                          },
                                          {
                                              "streamId": "8322863909",
                                              "startDateTime": null,
                                              "endDateTime": null,
                                              "streamDirection": "calleeToCaller",
                                              "averageAudioDegradation": null,
                                              "averageJitter": null,
                                              "maxJitter": null,
                                              "averagePacketLossRate": null,
                                              "maxPacketLossRate": null,
                                              "averageRatioOfConcealedSamples": null,
                                              "maxRatioOfConcealedSamples": null,
                                              "averageRoundTripTime": null,
                                              "maxRoundTripTime": null,
                                              "packetUtilization": 0,
                                              "averageBandwidthEstimate": null,
                                              "wasMediaBypassed": null,
                                              "postForwardErrorCorrectionPacketLossRate": null,
                                              "averageVideoFrameLossPercentage": null,
                                              "averageReceivedFrameRate": null,
                                              "lowFrameRateRatio": null,
                                              "averageVideoPacketLossRate": null,
                                              "averageVideoFrameRate": null,
                                              "lowVideoProcessingCapabilityRatio": null,
                                              "averageAudioNetworkJitter": null,
                                              "maxAudioNetworkJitter": null,
                                              "audioCodec": "unknown",
                                              "videoCodec": "unknown",
                                              "rmsFreezeDuration": null,
                                              "averageFreezeDuration": null,
                                              "isAudioForwardErrorCorrectionUsed": null
                                          }
                                      ]
                                  }
                              ]
                          }
                      ]
                  }
              ]
          }          
  - path: /communications/callRecords/a66d-b6f2-443-b12e-5aa1b6/sessions
    methods: ['GET']
    query_params:
      '$expand': 'segments'
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#communications/callRecords('1f9bdf3f-348e-49f0-8ac6-7e50a28da860')/sessions(segments())",
              "value": [
                  {
                      "id": "82-bdf9-4b64-a43a-e9fab",
                      "modalities": [
                          "audio"
                      ],
                      "startDateTime": "2025-03-26T13:16:59.5204625Z",
                      "endDateTime": "2025-03-26T13:21:43.2028167Z",
                      "segments": [
                          {
                              "startDateTime": "2025-03-26T13:16:59.5204625Z",
                              "endDateTime": "2025-03-26T13:21:43.2028167Z",
                              "id": "8a61b4c2-bdf9-4b64-a43a-e85707b19fab",
                              "failureInfo": {
                                "stage": "midcall",
                                "reason": ""
                              },
                              "caller": {
                                  "associatedIdentity": {
                                      "id": "d1945381-76c2-45fc-b6ee-2c36c5128dd3",
                                      "displayName": "Mjs Rjs",
                                      "tenantId": "3f3de92c-bce5-42b7-8a68-1438785455af",
                                      "userPrincipalName": "mjs.rjs@m366596.onmicrosoft.com"
                                  }
                              },
                              "media": [
                                  {
                                      "label": "main-audio",
                                      "callerNetwork": {
                                          "ipAddress": "10.0.146.255",
                                          "subnet": null,
                                          "linkSpeed": 0,                                      
                                          "connectionType": "wired",
                                          "port": 3492,
                                          "reflexiveIPAddress": "52.113.244.89",
                                          "relayIPAddress": null,
                                          "relayPort": null,
                                          "macAddress": null,
                                          "wifiMicrosoftDriver": null,
                                          "wifiMicrosoftDriverVersion": null,
                                          "wifiVendorDriver": null,
                                          "wifiVendorDriverVersion": null,
                                          "wifiChannel": null,
                                          "wifiBand": "unknown",
                                          "basicServiceSetIdentifier": null,
                                          "wifiRadioType": "unknown",
                                          "wifiSignalStrength": null,
                                          "wifiBatteryCharge": null,
                                          "dnsSuffix": null,
                                          "sentQualityEventRatio": null,
                                          "receivedQualityEventRatio": null,
                                          "delayEventRatio": null,
                                          "bandwidthLowEventRatio": null,
                                          "networkTransportProtocol": "udp",
                                          "traceRouteHops": []                                         
                                      },
                                      "calleeNetwork": {
                                          "ipAddress": "10.0.146.255",
                                          "subnet": null,
                                          "linkSpeed": 0,                                      
                                          "connectionType": "wired",
                                          "port": 3480,
                                          "reflexiveIPAddress": "52.112.234.86",
                                          "relayIPAddress": null,
                                          "relayPort": null,
                                          "macAddress": null,
                                          "wifiMicrosoftDriver": null,
                                          "wifiMicrosoftDriverVersion": null,
                                          "wifiVendorDriver": null,
                                          "wifiVendorDriverVersion": null,
                                          "wifiChannel": null,
                                          "wifiBand": "unknown",
                                          "basicServiceSetIdentifier": null,
                                          "wifiRadioType": "unknown",
                                          "wifiSignalStrength": null,
                                          "wifiBatteryCharge": null,
                                          "dnsSuffix": null,
                                          "sentQualityEventRatio": null,
                                          "receivedQualityEventRatio": null,
                                          "delayEventRatio": null,
                                          "bandwidthLowEventRatio": null,
                                          "networkTransportProtocol": "udp",
                                          "traceRouteHops": []
                                        },
                                      "streams": [
                                          {
                                              "streamId": "2386820939",
                                              "startDateTime": null,
                                              "endDateTime": null,
                                              "streamDirection": "callerToCallee",
                                              "averageAudioDegradation": null,
                                              "averageJitter": null,
                                              "maxJitter": null,
                                              "averagePacketLossRate": null,
                                              "maxPacketLossRate": null,
                                              "averageRatioOfConcealedSamples": null,
                                              "maxRatioOfConcealedSamples": null,
                                              "averageRoundTripTime": null,
                                              "maxRoundTripTime": null,
                                              "packetUtilization": 0,
                                              "averageBandwidthEstimate": null,
                                              "wasMediaBypassed": null,
                                              "postForwardErrorCorrectionPacketLossRate": null,
                                              "averageVideoFrameLossPercentage": null,
                                              "averageReceivedFrameRate": null,
                                              "lowFrameRateRatio": null,
                                              "averageVideoPacketLossRate": null,
                                              "averageVideoFrameRate": null,
                                              "lowVideoProcessingCapabilityRatio": null,
                                              "averageAudioNetworkJitter": null,
                                              "maxAudioNetworkJitter": null,
                                              "audioCodec": "unknown",
                                              "videoCodec": "unknown",
                                              "rmsFreezeDuration": null,
                                              "averageFreezeDuration": null,
                                              "isAudioForwardErrorCorrectionUsed": null
                                          },
                                          {
                                              "streamId": "8322863909",
                                              "startDateTime": null,
                                              "endDateTime": null,
                                              "streamDirection": "calleeToCaller",
                                              "averageAudioDegradation": null,
                                              "averageJitter": null,
                                              "maxJitter": null,
                                              "averagePacketLossRate": null,
                                              "maxPacketLossRate": null,
                                              "averageRatioOfConcealedSamples": null,
                                              "maxRatioOfConcealedSamples": null,
                                              "averageRoundTripTime": null,
                                              "maxRoundTripTime": null,
                                              "packetUtilization": 0,
                                              "averageBandwidthEstimate": null,
                                              "wasMediaBypassed": null,
                                              "postForwardErrorCorrectionPacketLossRate": null,
                                              "averageVideoFrameLossPercentage": null,
                                              "averageReceivedFrameRate": null,
                                              "lowFrameRateRatio": null,
                                              "averageVideoPacketLossRate": null,
                                              "averageVideoFrameRate": null,
                                              "lowVideoProcessingCapabilityRatio": null,
                                              "averageAudioNetworkJitter": null,
                                              "maxAudioNetworkJitter": null,
                                              "audioCodec": "unknown",
                                              "videoCodec": "unknown",
                                              "rmsFreezeDuration": null,
                                              "averageFreezeDuration": null,
                                              "isAudioForwardErrorCorrectionUsed": null
                                          }
                                      ]
                                  }
                              ]
                          }
                      ]
                  }
              ]
          }        
  
  - path: /admin/reportSettings
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          { 
                  "@odata.type": "#microsoft.graph.adminReportSettings", 
                  "displayConcealedNames": true 
          }
  - path: /organization
    methods: ['GET']
    query_params:
      '$select': 'id,displayName,tenantType'
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#organization(id,displayName,tenantType)",
              "value": [
                  {
                      "id": "aa40685b-417d-4664-b4ec-8f7640719adb",
                      "displayName": "azure2",
                      "tenantType": "AAD"
                  }
              ]
          }
  - path: /applications
    methods: ['GET']
    query_params:
      '$select': 'id,appId,displayName,passwordCredentials,keyCredentials'
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#applications(id,appId,displayName,passwordCredentials,keyCredentials)",
              "value": [
                  {
                        "id": "7eaf2-b2f6-4fb0-b9f-f171aa69",
                        "appId": "166f-4179-44-aeb-801cf53a",
                        "displayName": "App1",
                        "passwordCredentials": [
                            {
                                "customKeyIdentifier": null,
                                "displayName": "test token",
                                "endDateTime": "2025-08-08T16:46:54.729Z",
                                "hint": "g9W",
                                "keyId": "3468e-f34c-485f-9754-b47161a",
                                "secretText": null,
                                "startDateTime": "2025-02-09T16:46:54.729Z"
                            },
                            {
                                "customKeyIdentifier": null,
                                "displayName": "token",
                                "endDateTime": "2025-08-06T09:23:49.935Z",
                                "hint": "TSL",
                                "keyId": "7b1c7-4aea-421e-abd4-1c48188",
                                "secretText": null,
                                "startDateTime": "2025-02-07T10:23:49.935Z"
                            },
                            {
                                "customKeyIdentifier": null,
                                "displayName": "1234",
                                "endDateTime": "2025-07-30T05:10:48.334Z",
                                "hint": "a3Z",
                                "keyId": "cb7b-ab9c-4aa2-9ad4-6fda517",
                                "secretText": null,
                                "startDateTime": "2025-01-31T06:10:48.334Z"
                            },
                            {
                                "customKeyIdentifier": null,
                                "displayName": "123",
                                "endDateTime": "2025-07-29T13:31:41.601Z",
                                "hint": "b4o",
                                "keyId": "d413b-c6db-4cb3-967e-793d1",
                                "secretText": null,
                                "startDateTime": "2025-01-30T14:31:41.601Z"
                            }
                         ],
                         "keyCredentials": []
                  },
                  {
                      "id": "4e110-f8e5-475c-9d61-4f749c",
                      "appId": "ce296-c620-421f-914c-e59c689",
                      "displayName": "elastic-test",
                      "passwordCredentials": [
                          {
                              "customKeyIdentifier": null,
                              "displayName": "elastic test",
                              "endDateTime": "2025-07-27T19:31:08.355Z",
                              "hint": "uHo",
                              "keyId": "ad11e-4a83-471e-97a7-86426c5e",
                              "secretText": null,
                              "startDateTime": "2025-01-28T20:31:08.355Z"
                          }
                       ],
                       "keyCredentials": []
                  },
                  {
                       "id": "64d86-56cb-4877-acc2-89a84bc",
                       "appId": "7d25d-9a16-4b80-b48c-1352c7b0",
                       "displayName": "EXO_App2",
                       "passwordCredentials": [],
                       "keyCredentials": [
                           {
                               "customKeyIdentifier": "STlLdDhVNldoL01drPQ==",
                               "displayName": "CN=EXO_Cert",
                               "endDateTime": "2024-11-09T13:55:10Z",
                               "key": "TUlJRElqQ0NBZ3FnQXdJQkyTzBqQU5CZ2txaGtpRzl3MEJBUXNGQURBVE1SRXdVGdzB5TXpFd01Ea3hNelExTVRCYUZ3MHlOREV4TURreE16VTFNVEJhTUJNeEVUQJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBMDZoRmxTY2NsTVdqRG5ZZmlSt0dVkxVWdjWVRRak82OEVTN2d6SFg4MmRGNXhTZ25QRENSU3pGZEF4R0RQMzWitpWTh5NHBnZVdDaTN6a21rdzR3dlFNRGhEUUNOCtXZ0RjZzh2WnBtVUlqMnNIZnRMbU81UGhXcmJ1UzlueEc5Tm4yUUJwbWFIcEEyditrZDROdFpXYnZFZVZWcHdQZ2JyMUJWSVhmellrcUpWdHl6SFdiaDNwaUNKRExsY3JEV1lud3JSbi9MY05IK29SS0RrN0FObVQ3M3Evb0ZzbExpd283ZnVVL1NrTXVpaGxkaWxmd0t4bUFLNHVHM241cWdaN3JRSURBUUFCbzNJd2NEQU9CZ05WSFE4QkFmOEVCQU1DQlNBd0NRWURWUjBUQkFJd0FEQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBVEFmQmdOVkhTTUVHREFXZ0JRSitmY3N0TFBqbkxObUorTld0YkdrZWFZcWNUQWRCZ05WSFE0RUZnUVVDZm4zTExTejQ1eXpaaWZqVnJXeHBIbW1LbkV3RFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUZpNGljam9Ib0NMM0JFWTJJc2hUa1dJM0ZCemtnd08vRzlyTzVDMU8xQVRGLzRzblY3TC96TUMvRU56eWxVUjNCRHFQT1hrRHZoc3ZIN3YraVVkQnhlUGVyS3FHOXFiWnZtWDArZTJ6TzdCNHMzZXhEb0d2VEZVMjhxY1hzL0NYTS82TDlObWl2MFJ3MFg1Qm5JSW1NSTZLUHFtUmhwZGZNMk5KNVdTbUdjejNlYlpUQzR3dnhBaGpwZ2dpOHVCRG90WlQ3aERlZHZXemVnTGtBNnpJRGFvaHhOeUVTamUxa25mbm4rc3RZN3A5R2VBZkZ0Z1VVTTdkQ3ZFSFcwRmdOS0YxanN5N1kxdXdJU1k0UXUyenhQM2lZNzh6RElnS2JKNSs5aVhoUFFGRHhiVmRZbGxnZ2V1dUFUM0trQXN6MVNYUmc3VENFRWx5Z2syMW9kNDNsQT0=",
                               "keyId": "20d576e8-a610-44ce-96a0-f08a23c6a9a4",
                               "startDateTime": "2023-10-09T13:45:10Z",
                               "type": "AsymmetricX509Cert",
                               "usage": "Verify"
                            }
                        ]
                   }
                ]
          }
  - path: /users
    methods: ['GET']
    query_params:
      '$select': 'id,userPrincipalName,userType,onPremisesProvisioningErrors,onPremisesSyncEnabled'
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#users(id,userPrincipalName,userType)",
              "@odata.nextLink": "{{ env "SERVER_ADDRESS" }}/users?$select=id%2cuserPrincipalName%2cuserType%2conPremisesProvisioningErrors%2conPremisesSyncEnabled",
              "value": [
                  {
                      "id": "6e7b768e-07e2-4810-8459-485f84f8f204",
                      "userPrincipalName": "Adams@M365x214355.onmicrosoft.com",
                      "userType": "Member",
                      "onPremisesProvisioningErrors": [],
                      "onPremisesSyncEnabled": null
                  },
                  {
                      "id": "87d349ed-44d7-43e1-9a83-5f2406dee5bd",
                      "userPrincipalName": "AdeleV@M365x214355.onmicrosoft.com",
                      "userType": "Member",
                      "onPremisesProvisioningErrors": [],
                      "onPremisesSyncEnabled": null
                  }
              ]
          }
      - status_code: 200
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#users(id,userPrincipalName,userType)",
              "@odata.nextLink": "{{ env "SERVER_ADDRESS" }}/users?$select=id%2cuserPrincipalName%2cuserType%2conPremisesProvisioningErrors%2conPremisesSyncEnabled",
              "value": [
                  {
                      "id": "5bde3e51-d13b-4db1-9948-fe4b109d11a7",
                      "userPrincipalName": "admin@M365x214355.onmicrosoft.com",
                      "userType": "Member",
                      "onPremisesProvisioningErrors": [],
                      "onPremisesSyncEnabled": null
                  },
                  {
                      "id": "4782e723-f4f4-4af3-a76e-25e3bab0d896",
                      "userPrincipalName": "AlexW@M365x214355.onmicrosoft.com",
                      "userType": "Member",
                      "onPremisesProvisioningErrors": [],
                      "onPremisesSyncEnabled": null
                  }
              ]
          }
      - status_code: 200
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#users(id,userPrincipalName,userType)",
              "value": [
                  {
                      "id": "c03e6eaa-b6ab-46d7-905b-73ec7ea1f755",
                      "userPrincipalName": "AllanD@M365x214355.onmicrosoft.com",
                      "userType": "Member",
                      "onPremisesProvisioningErrors": [{
                        "category": "PropertyConflict",
                        "occurredDateTime": "2025-03-25T14:33:19Z",
                        "propertyCausingError": "UserPrincipalName",
                        "value": "allan@contoso.com"
                      }],
                      "onPremisesSyncEnabled": true
                  },
                  {
                      "id": "013b7b1b-5411-4e6e-bdc9-c4790dae1051",
                      "userPrincipalName": "Baker@M365x214355.onmicrosoft.com",
                      "userType": "Member",
                      "onPremisesProvisioningErrors": [{
                        "category": "PropertyConflict",
                        "occurredDateTime": "2025-03-25T14:33:19Z",
                        "propertyCausingError": "UserPrincipalName",
                        "value": "baker@contoso.com"
                      }],
                      "onPremisesSyncEnabled": true
                  }
              ]
          }
  - path: /identityProtection/riskDetections
    methods: ['GET']
    query_params:
      '$select': 'riskEventType,riskState,riskLevel,riskDetail'
      '$filter': "userId eq '{id:[0-9a-z-]+}'"
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
            "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#identityProtection/riskDetections(riskEventType,riskState,riskLevel,riskDetail)",
            "value": [
              {
                "riskEventType": "passwordSpray",
                "riskState": "remediated",
                "riskLevel": "high",
                "riskDetail": "userPerformedSecuredPasswordReset"
              }
            ]
          }
      - status_code: 200
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
            "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#identityProtection/riskDetections(riskEventType,riskState,riskLevel,riskDetail)",
            "value": []
          }
      - status_code: 401
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
              "error": {
                  "code": "InvalidAuthenticationToken",
                  "message": "Lifetime validation failed, the token is expired.",
                  "innerError": {
                      "date": "2025-03-25T14:33:19",
                      "request-id": "61d323d8-abba-4f69-8ab5-660e86160ec4",
                      "client-request-id": "61d323d8-abba-4f69-8ab5-660e86160ec4"
                  }
              }
          }
  - path: /subscribedSkus
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#subscribedSkus",
              "value": [
                  {
                    "accountName": "M365x00716596",
                    "accountId": "3f2c-bce5-42b7-8a68-1438af",
                    "appliesTo": "User",
                    "capabilityStatus": "Enabled",
                    "consumedUnits": 1,
                    "id": "3f2c-bce5-42b7-8a68-1438af_f392-07e9-47e9-837c-803d",
                    "skuId": "f392-07e9-47e9-837c-803d",
                    "skuPartNumber": "Microsoft_Teams_Enterprise_New",
                    "subscriptionIds": [
                        "81209dcb-3bc7-475a-93c0-12b6db4e1429",
                        "6a5cbbfd-b725-43f8-aae5-7999abf275d1"
                    ],
                    "prepaidUnits": {
                        "enabled": 10000,
                        "suspended": 0,
                        "warning": 0,
                        "lockedOut": 0
                    },
                    "servicePlans": [
                        {
                            "servicePlanId": "113feb6c-3fe4-4440-bddc-54d774bf0318",
                            "servicePlanName": "EXCHANGE_S_FOUNDATION",
                            "provisioningStatus": "Success",
                            "appliesTo": "Company"
                        },
                        {
                            "servicePlanId": "17ab22cd-a0b3-4536-910a-cb6eb12696c0",
                            "servicePlanName": "DYN365_CDS_VIRAL",
                            "provisioningStatus": "Success",
                            "appliesTo": "User"
                        },
                        {
                            "servicePlanId": "50e68c76-46c6-4674-81f9-75456511b170",
                            "servicePlanName": "FLOW_P2_VIRAL",
                            "provisioningStatus": "Success",
                            "appliesTo": "User"
                        }
                    ]
                }
              ]
          }
  - path: /directory/subscriptions/6a5cbbfd-b725-43f8-aae5-7999abf275d1
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#directory/subscriptions/$entity",
              "createdDateTime": "2025-03-17T00:00:00Z",
              "commerceSubscriptionId": "f2990b52-b8bf-450b-960b-f731f741fb4f",
              "id": "6a5cbbfd-b725-43f8-aae5-7999abf275d1",
              "isTrial": true,
              "nextLifecycleDateTime": "2025-07-17T00:00:00Z",
              "skuId": "f392-07e9-47e9-837c-803d",
              "skuPartNumber": "Microsoft_Teams_Enterprise_New",
              "status": "Enabled",
              "totalLicenses": 20,
              "ownerTenantId": "abc",
              "ownerId": null,
              "ownerType": null
          }
  - path: /directory/subscriptions/81209dcb-3bc7-475a-93c0-12b6db4e1429
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#directory/subscriptions/$entity",
              "createdDateTime": "2025-03-16T00:00:00Z",
              "commerceSubscriptionId": "f30db892-07e9-47e9-837c-80727f46fd3d",
              "id": "81209dcb-3bc7-475a-93c0-12b6db4e1429",
              "isTrial": false,
              "nextLifecycleDateTime": null,
              "skuId": "f392-07e9-47e9-837c-803d",
              "skuPartNumber": "Microsoft_Teams_Enterprise_New",
              "status": "Enabled",
              "totalLicenses": 10000,
              "ownerTenantId": "xyz",
              "ownerId": null,
              "ownerType": null
          }
      - status_code: 404
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
              "error": {
                  "code": "Directory_ObjectNotFound",
                  "message": "Unable to read the company information from the directory.",
                  "innerError": {
                      "date": "2025-04-07T12:23:19",
                      "request-id": "42e874b1-0f42-4396-b5dc-9c7558c267d8",
                      "client-request-id": "42e874b1-0f42-4396-b5dc-9c7558c267d8"
                  }
              }
          }
  - path: /organization
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#organization",
              "value": [
                  {
                      "onPremisesLastSyncDateTime": null,
                      "onPremisesSyncEnabled": true,
                      "partnerTenantType": null,
                      "postalCode": "98052",
                      "preferredLanguage": "en",
                      "securityComplianceNotificationMails": [],
                      "securityComplianceNotificationPhones": [],
                      "state": "wa",
                      "street": "1 Microsoft Way",
                      "technicalNotificationMails": [
                          "transformprov@microsoft.com"
                      ],
                      "tenantType": "AAD",
                      "directorySizeQuota": {
                          "used": 447,
                          "total": 50000
                      },
                      "assignedPlans": [
                          {
                              "assignedDateTime": "2025-03-17T14:35:00Z",
                              "capabilityStatus": "Enabled",
                              "service": "CRM",
                              "servicePlanId": "17ab22cd-a0b3-4536-910a-cb6eb12696c0"
                          }
                      ]
                  }
              ]
            }
  - path: /directory/onPremisesSynchronization
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#directory/onPremisesSynchronization",
              "value": [
                  {
                      "id": "3f3de92c-bce5-42b7-8a68-1438785455af",
                      "configuration": null,
                      "features": {
                          "passwordSyncEnabled": true,
                          "passwordWritebackEnabled": true,
                          "directoryExtensionsEnabled": true,
                          "quarantineUponUpnConflictEnabled": true,
                          "quarantineUponProxyAddressesConflictEnabled": true,
                          "softMatchOnUpnEnabled": true,
                          "cloudPasswordPolicyForPasswordSyncedUsersEnabled": true,
                          "fopeConflictResolutionEnabled": true,
                          "unifiedGroupWritebackEnabled": true,
                          "userWritebackEnabled": true,
                          "deviceWritebackEnabled": true,
                          "synchronizeUpnForManagedUsersEnabled": true,
                          "userForcePasswordChangeOnLogonEnabled": true,
                          "concurrentOrgIdProvisioningEnabled": true,
                          "concurrentCredentialUpdateEnabled": true,
                          "groupWriteBackEnabled": true,
                          "blockSoftMatchEnabled": true,
                          "blockCloudObjectTakeoverThroughHardMatchEnabled": true,
                          "bypassDirSyncOverridesEnabled": true
                      }
                  }
              ]
          }
  - path: /providers/Microsoft.ADHybridHealthService/services/GetServices/PremiumCheck
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    query_params:
      'serviceType': 'AadSyncService'
      'skipCount': '0'
      'takeCount': 50
      'api-version': '2014-01-01'
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "value": [
                  {
                      "serviceName": "MicrosoftEntraIDIdentityProtection"
                  },
                  {
                      "serviceName": "MicrosoftDefenderforOffice365"
                  },
                  {
                      "serviceName": "MicrosoftSentinel"
                  }
              ]
          }
  - path: /providers/Microsoft.ADHybridHealthService/services/MicrosoftEntraIDIdentityProtection/alerts
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    query_params:
      'api-version': '2014-01-01'
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "value": [
                  {
                    "alertId": "b5f2d6c1-3c44-4a2b-934a-a0e3e21d8e27",
                    "level": "Error",
                    "state": "Active",
                    "shortName": "UnfamiliarSignin",
                    "displayName": "Unfamiliar Sign-in Properties",
                    "description": "Unfamiliar sign-in properties detected for a user account.",
                    "remediation": "Review user risk in Microsoft Entra ID and confirm if sign-in was legitimate. Take remediation actions such as password reset or MFA enforcement.",
                    "scope": "Directory",
                    "createdDate": "2025-04-14T00:00:00Z",
                    "resolvedDate": "2025-04-14T00:00:00Z",
                    "lastUpdated": "2025-04-14T00:00:00Z",
                    "monitorRoleType": "IdentityProtection",
                    "tenantId": "f8cdef31-a31e-4b4a-93e4-5f571e91255a",
                    "serviceId": "aad-identityprotection",
                    "serviceMemberId": "aad-ip-alert-0042"
                    }
              ]
          }
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "value": [],
              "nextLink": null,
              "totalCount": 0,
              "continuationToken": null
          }         
  - path: /providers/Microsoft.ADHybridHealthService/services/MicrosoftDefenderforOffice365/alerts
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    query_params:
      'api-version': '2014-01-01'
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "value": [
                  {
                    "alertId": "dfd5e931-1b47-4e75-b8e2-994f45c6d33c",
                    "level": "Error",
                    "state": "Active",
                    "shortName": "EmailMalwareDetection",
                    "displayName": "Malware Detected in Email",
                    "description": "An email sent to a user was found to contain malware and was blocked by Microsoft Defender for Office 365.",
                    "remediation": "Investigate the source of the email, notify the user, and ensure endpoint protections are in place. Review quarantined message for additional indicators.",
                    "scope": "Exchange Online",
                    "createdDate": "2025-04-14T00:00:00Z",
                    "resolvedDate": "2025-04-14T00:00:00Z",
                    "lastUpdated": "2025-04-14T00:00:00Z",
                    "monitorRoleType": "ThreatProtection",
                    "tenantId": "f8cdef31-a31e-4b4a-93e4-5f571e91255a",
                    "serviceId": "office365-defender",
                    "serviceMemberId": "office365-defender-email-0753"
                    }
              ]
          }
  - path: /providers/Microsoft.ADHybridHealthService/services/MicrosoftSentinel/alerts
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    query_params:
      'api-version': '2014-01-01'
    responses:
      - status_code: 401
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
            "error": {
            "code": "AuthenticationFailed",
            "message": "Authentication failed."
            }
  - path: /providers/Microsoft.ADHybridHealthService/services/MicrosoftEntraIDIdentityProtection/servicemembers
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    query_params:
      'api-version': '2014-01-01'
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "value": [
                  {
                      "lastReboot": "2024-03-12T11:33:07.484Z",
                      "lastDisabled": "2024-03-12T23:17:00.511864Z",
                      "lastUpdated": "2024-03-12T00:15:32.547649Z",
                      "activeAlerts": 1,
                      "resolvedAlerts": 5,
                      "createdDate": "2024-02-18T09:12:45.273Z",
                      "disabled": false,
                      "serviceId": "aad-identityprotection",
                      "serviceMemberId": "aad-ip-node-3012",
                      "machineId": "e4c1b8f2-9f1e-4f55-911e-3cddc0e9d331",
                      "machineName": "ENTRA-ID-NODE-03",
                      "role": "AdfsServer_30",
                      "status": "Healthy",
                      "osVersion": "10.0.17763.3650",
                      "osName": "Windows Server 2019 Datacenter"
                  }
              ]
          }
  - path: /providers/Microsoft.ADHybridHealthService/services/MicrosoftDefenderforOffice365/servicemembers
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    query_params:
      'api-version': '2014-01-01'
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "value": [
                  {
                      "lastReboot": "2023-03-12T11:33:07.484Z",
                      "lastDisabled": "2023-03-12T23:17:00.511864Z",
                      "lastUpdated": "2023-03-12T00:15:32.547649Z",
                      "activeAlerts": 2,
                      "resolvedAlerts": 7,
                      "createdDate": "2023-02-24T10:05:45.123Z",
                      "disabled": false,
                      "serviceId": "office365-defender",
                      "serviceMemberId": "o365-defender-node-1029",
                      "machineId": "f12b8c1e-9d77-42b2-94b1-a9efdc2e91b2",
                      "machineName": "DEFENDER-O365-NODE-01",
                      "role": "ThreatProtectionNode_31",
                      "status": "Healthy",
                      "osVersion": "10.0.20348.1607",
                      "osName": "Windows Server 2022"
                  }
              ]
          }
  - path: /providers/Microsoft.ADHybridHealthService/services/MicrosoftSentinel/servicemembers
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    query_params:
      'api-version': '2014-01-01'
    responses:
      - status_code: 400
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
          "error": {
          "code": "AuthenticationFailed",
          "message": "Authentication failed."
          }