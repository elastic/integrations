rules:
  - path: /1234/oauth2/v2.0/token
    methods: ['POST']
    responses: 
      - status_code: 200
        headers: 
          Content-Type: 
            'application/json'
        body: |-
          {"token_type":"Bearer","expires_in":3599,"ext_expires_in":3599,"access_token":"xxxx"}
  - path: /communications/callRecords
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
            "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#communications/callRecords",
            "value": [
              {
                "id": "64f4cace-b8fa-4d44-a613-7f5689330081",
                "version": 2,
                "type": "unknown",
                "modalities": [
                  "audio"
                ],
                "lastModifiedDateTime": "2023-09-25T10:36:40Z",
                "startDateTime": "2023-09-25T09:28:38Z",
                "endDateTime": "2023-09-25T09:28:41Z",
                "organizer": {
                  "user": {
                    "id": "821809f5-0000-0000-0000-3b5136c0e777",
                    "displayName": "Abbie Wilkins",
                    "tenantId": "dc368399-474c-4d40-900c-6265431fd81f"
                  }
                },
                "organizer_v2@odata.context": "https://graph.microsoft.com/v1.0/$metadata#communications/callRecords('3cf3bbc8-b21d-4f2e-bfd0-b13603ae6c65')/organizer_v2/$entity",
                "organizer_v2": {
                  "id": "821809f5-0000-0000-0000-3b5136c0e777",
                  "identity": {
                    "user": {
                      "id": "821809f5-0000-0000-0000-3b5136c0e777",
                      "displayName": "Abbie Wilkins",
                      "tenantId": "dc368399-474c-4d40-900c-6265431fd81f"
                    }
                  }
                }
              }
            ]
          }
  - path: /communications/callRecords/{id:[0-9a-z-]+}/sessions
    methods: ['GET']
    query_params:
      '$expand': 'segments'
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#communications/callRecords('e523d2ed-2966-4b6b-925b-754a88034cc5')/sessions",
              "value": [
                  {
                      "id": "{{ .request.vars.id }}",
                      "modalities": [
                          "audio"
                      ],
                      "startDateTime": "2020-02-25T18:52:21.2169889Z",
                      "endDateTime": "2020-02-25T18:52:46.7640013Z",
                      "isTest": false,
                      "caller": {
                          "@odata.type": "#microsoft.graph.callRecords.participantEndpoint",
                          "name": "machineName_1",
                          "cpuName": "AMD EPYC 7452 32-Core Processor",
                          "cpuCoresCount": 8,
                          "cpuProcessorSpeedInMhz": 2346,
                          "userAgent": {
                              "@odata.type": "#microsoft.graph.callRecords.clientUserAgent",
                              "headerValue": "RTCC/7.0.0.0 UCWA/7.0.0.0 AndroidLync/6.25.0.27 (SM-G930U Android 8.0.0)",
                              "platform": "android",
                              "productFamily": "skypeForBusiness"
                          },
                          "identity": {
                              "@odata.type": "#microsoft.graph.identitySet",
                              "user": {
                                  "id": "821809f5-0000-0000-0000-3b5136c0e777",
                                  "displayName": "Abbie Wilkins",
                                  "tenantId": "dc368399-474c-4d40-900c-6265431fd81f"
                              }
                          }
                      },
                      "callee": {
                          "@odata.type": "#microsoft.graph.callRecords.participantEndpoint",
                          "name": "machineName_2",
                          "cpuName": "Intel(R) Xeon(R) Platinum 8272CL CPU @ 2.60GHz",
                          "cpuCoresCount": 2,
                          "cpuProcessorSpeedInMhz": 2594,
                          "userAgent": {
                              "@odata.type": "#microsoft.graph.callRecords.clientUserAgent",
                              "headerValue": "UCCAPI/16.0.12527.20122 OC/16.0.12527.20194 (Skype for Business)",
                              "platform": "windows",
                              "productFamily": "skypeForBusiness"
                          },
                          "identity": {
                              "user": {
                                  "id": "f69e2c00-0000-0000-0000-185e5f5f5d8a",
                                  "displayName": "Owen Franklin",
                                  "tenantId": "dc368399-474c-4d40-900c-6265431fd81f"
                              }
                          },
                          "feedback": {
                              "rating": "poor",
                              "tokens": {
                                  "NoSound": false,
                                  "OtherNoSound": false,
                                  "Echo": false,
                                  "Noisy": true,
                                  "LowVolume": false,
                                  "Stopped": false,
                                  "DistortedSound": false,
                                  "Interruptions": false
                              }
                          }
                      },
                      "segments": [
                          {
                              "startDateTime": "2020-02-25T18:52:21.2169889Z",
                              "endDateTime": "2020-02-25T18:52:46.7640013Z",
                              "id": "e523d2ed-2966-4b6b-925b-754a88034cc5",
                              "caller": {
                                  "@odata.type": "#microsoft.graph.callRecords.participantEndpoint",
                                  "name": "machineName_1",
                                  "cpuName": "AMD EPYC 7452 32-Core Processor",
                                  "cpuCoresCount": 8,
                                  "cpuProcessorSpeedInMhz": 2346,
                                  "userAgent": {
                                      "@odata.type": "#microsoft.graph.callRecords.clientUserAgent",
                                      "headerValue": "RTCC/7.0.0.0 UCWA/7.0.0.0 AndroidLync/6.25.0.27 (SM-G930U Android 8.0.0)",
                                      "platform": "android",
                                      "productFamily": "skypeForBusiness"
                                  },
                                  "identity": {
                                      "user": {
                                          "id": "821809f5-0000-0000-0000-3b5136c0e777",
                                          "displayName": "Abbie Wilkins",
                                          "tenantId": "dc368399-474c-4d40-900c-6265431fd81f"
                                      }
                                  }
                              },
                              "callee": {
                                  "@odata.type": "#microsoft.graph.callRecords.participantEndpoint",
                                  "@odata.type": "#microsoft.graph.callRecords.participantEndpoint",
                                  "name": "machineName_2",
                                  "cpuName": "Intel(R) Xeon(R) Platinum 8272CL CPU @ 2.60GHz",
                                  "cpuCoresCount": 2,
                                  "userAgent": {
                                      "@odata.type": "#microsoft.graph.callRecords.clientUserAgent",
                                      "headerValue": "UCCAPI/16.0.12527.20122 OC/16.0.12527.20194 (Skype for Business)",
                                      "platform": "windows",
                                      "productFamily": "skypeForBusiness"
                                  },
                                  "identity": {
                                      "user": {
                                          "id": "f69e2c00-0000-0000-0000-185e5f5f5d8a",
                                          "displayName": "Owen Franklin",
                                          "tenantId": "dc368399-474c-4d40-900c-6265431fd81f"
                                      }
                                  }
                              },
                              "media": [
                                  {
                                      "label": "main-audio",
                                      "callerNetwork": {
                                          "ipAddress": "10.150.0.2",
                                          "subnet": "10.150.0.0",
                                          "linkSpeed": 54000000,
                                          "connectionType": "wifi",
                                          "port": 27288,
                                          "reflexiveIPAddress": "127.0.0.2",
                                          "relayIPAddress": "52.114.188.32",
                                          "relayPort": 53889,
                                          "macAddress": "00-00-00-00-00-00",
                                          "dnsSuffix": null,
                                          "sentQualityEventRatio": 0,
                                          "receivedQualityEventRatio": 0.27,
                                          "delayEventRatio": 0,
                                          "bandwidthLowEventRatio": 0
                                      },
                                      "calleeNetwork": {
                                          "ipAddress": "10.139.0.12",
                                          "subnet": "10.139.80.0",
                                          "linkSpeed": 4294967295,
                                          "connectionType": "wired",
                                          "port": 50011,
                                          "reflexiveIPAddress": "127.0.0.2",
                                          "relayIPAddress": "52.114.188.102",
                                          "relayPort": 52810,
                                          "macAddress": "00-00-00-00-00-00-00-00",
                                          "dnsSuffix": null,
                                          "sentQualityEventRatio": 0.31,
                                          "receivedQualityEventRatio": 0,
                                          "delayEventRatio": 0,
                                          "bandwidthLowEventRatio": 0
                                      },
                                      "callerDevice": {
                                          "captureDeviceName": "Default input device",
                                          "renderDeviceName": "Default output device",
                                          "receivedSignalLevel": -10,
                                          "receivedNoiseLevel": -68,
                                          "initialSignalLevelRootMeanSquare": 60.25816,
                                          "renderZeroVolumeEventRatio": 1,
                                          "renderMuteEventRatio": 1,
                                          "micGlitchRate": 23,
                                          "speakerGlitchRate": 3830
                                      },
                                      "calleeDevice": {
                                          "captureDeviceName": "Microphone (Microsoft Virtual Audio Device (Simple) (WDM))",
                                          "captureDeviceDriver": "Microsoft: 5.0.8638.1100",
                                          "renderDeviceName": "Speakers (Microsoft Virtual Audio Device (Simple) (WDM))",
                                          "renderDeviceDriver": "Microsoft: 5.0.8638.1100",
                                          "receivedSignalLevel": -14,
                                          "receivedNoiseLevel": -86,
                                          "initialSignalLevelRootMeanSquare": 146.7885,
                                          "micGlitchRate": 143,
                                          "speakerGlitchRate": 182
                                      },
                                      "streams": [
                                          {
                                              "streamId": "1504545584",
                                              "streamDirection": "callerToCallee",
                                              "averageAudioDegradation": null,
                                              "averageJitter": "PT0.016S",
                                              "maxJitter": "PT0.021S",
                                              "averagePacketLossRate": 0,
                                              "maxPacketLossRate": 0,
                                              "averageRatioOfConcealedSamples": null,
                                              "maxRatioOfConcealedSamples": null,
                                              "averageRoundTripTime": "PT0.061S",
                                              "maxRoundTripTime": "PT0.079S",
                                              "packetUtilization": 67,
                                              "averageBandwidthEstimate": 9965083,
                                              "wasMediaBypassed": false,
                                              "averageAudioNetworkJitter": "PT0.043S",
                                              "maxAudioNetworkJitter": "PT0.046S",
                                              "rmsFreezeDuration": null,
                                              "averageFreezeDuration": null,
                                              "isAudioForwardErrorCorrectionUsed": true
                                          },
                                          {
                                              "streamId": "1785122252",
                                              "streamDirection": "calleeToCaller",
                                              "averageAudioDegradation": 1.160898,
                                              "averageJitter": "PT0.007S",
                                              "maxJitter": "PT0.012S",
                                              "averagePacketLossRate": 0.01381693,
                                              "maxPacketLossRate": 0.03738318,
                                              "averageRatioOfConcealedSamples": 0.06233422,
                                              "maxRatioOfConcealedSamples": 0.07192807,
                                              "averageRoundTripTime": "PT0.064S",
                                              "maxRoundTripTime": "PT0.106S",
                                              "packetUtilization": 709,
                                              "averageBandwidthEstimate": 15644878,
                                              "wasMediaBypassed": false,
                                              "averageAudioNetworkJitter": "PT0.266S",
                                              "maxAudioNetworkJitter": "PT0.474S",
                                              "rmsFreezeDuration": null,
                                              "averageFreezeDuration": null,
                                              "isAudioForwardErrorCorrectionUsed": false
                                          }
                                      ]
                                  }
                              ]
                          }
                      ]
                  }
              ]
          }
  - path: /admin/reportSettings
    methods: ['GET']
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          { 
              "value": {
                  "@odata.type": "#microsoft.graph.adminReportSettings", 
                  "displayConcealedNames": true 
              }
          }
  - path: /organization
    methods: ['GET']
    query_params:
      '$select': 'id,displayName,tenantType'
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'application/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#organization(id,displayName,tenantType)",
              "value": [
                  {
                      "id": "aa40685b-417d-4664-b4ec-8f7640719adb",
                      "displayName": "azure2",
                      "tenantType": "AAD"
                  }
              ]
          }
  - path: /users
    methods: ['GET']
    query_params:
      '$select': 'id,userPrincipalName,userType,onPremisesProvisioningErrors,onPremisesSyncEnabled'
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#users(id,userPrincipalName,userType)",
              "@odata.nextLink": "{{ env "SERVER_ADDRESS" }}/users?$select=id%2cuserPrincipalName%2cuserType%2conPremisesProvisioningErrors%2conPremisesSyncEnabled",
              "value": [
                  {
                      "id": "6e7b768e-07e2-4810-8459-485f84f8f204",
                      "userPrincipalName": "Adams@M365x214355.onmicrosoft.com",
                      "userType": "Member",
                      "onPremisesProvisioningErrors": [],
                      "onPremisesSyncEnabled": null
                  },
                  {
                      "id": "87d349ed-44d7-43e1-9a83-5f2406dee5bd",
                      "userPrincipalName": "AdeleV@M365x214355.onmicrosoft.com",
                      "userType": "Member",
                      "onPremisesProvisioningErrors": [],
                      "onPremisesSyncEnabled": null
                  }
              ]
          }
      - status_code: 200
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#users(id,userPrincipalName,userType)",
              "@odata.nextLink": "{{ env "SERVER_ADDRESS" }}/users?$select=id%2cuserPrincipalName%2cuserType%2conPremisesProvisioningErrors%2conPremisesSyncEnabled",
              "value": [
                  {
                      "id": "5bde3e51-d13b-4db1-9948-fe4b109d11a7",
                      "userPrincipalName": "admin@M365x214355.onmicrosoft.com",
                      "userType": "Member",
                      "onPremisesProvisioningErrors": [],
                      "onPremisesSyncEnabled": null
                  },
                  {
                      "id": "4782e723-f4f4-4af3-a76e-25e3bab0d896",
                      "userPrincipalName": "AlexW@M365x214355.onmicrosoft.com",
                      "userType": "Member",
                      "onPremisesProvisioningErrors": [],
                      "onPremisesSyncEnabled": null
                  }
              ]
          }
      - status_code: 200
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
              "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#users(id,userPrincipalName,userType)",
              "value": [
                  {
                      "id": "c03e6eaa-b6ab-46d7-905b-73ec7ea1f755",
                      "userPrincipalName": "AllanD@M365x214355.onmicrosoft.com",
                      "userType": "Member",
                      "onPremisesProvisioningErrors": [{
                        "category": "PropertyConflict",
                        "occurredDateTime": "2025-03-25T14:33:19Z",
                        "propertyCausingError": "UserPrincipalName",
                        "value": "allan@contoso.com"
                      }],
                      "onPremisesSyncEnabled": true
                  },
                  {
                      "id": "013b7b1b-5411-4e6e-bdc9-c4790dae1051",
                      "userPrincipalName": "Baker@M365x214355.onmicrosoft.com",
                      "userType": "Member",
                      "onPremisesProvisioningErrors": [{
                        "category": "PropertyConflict",
                        "occurredDateTime": "2025-03-25T14:33:19Z",
                        "propertyCausingError": "UserPrincipalName",
                        "value": "baker@contoso.com"
                      }],
                      "onPremisesSyncEnabled": true
                  }
              ]
          }
  - path: /identityProtection/riskDetections
    methods: ['GET']
    query_params:
      '$select': 'riskEventType,riskState,riskLevel,riskDetail'
      '$filter': "userId eq '{id:[0-9a-z-]+}'"
    request_headers:
      Authorization:
        - "Bearer xxxx"
    responses:
      - status_code: 200
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
            "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#identityProtection/riskDetections(riskEventType,riskState,riskLevel,riskDetail)",
            "value": [
              {
                "riskEventType": "passwordSpray",
                "riskState": "remediated",
                "riskLevel": "high",
                "riskDetail": "userPerformedSecuredPasswordReset"
              }
            ]
          }
      - status_code: 200
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
            "@odata.context": "https://graph.microsoft.com/v1.0/$metadata#identityProtection/riskDetections(riskEventType,riskState,riskLevel,riskDetail)",
            "value": []
          }
      - status_code: 401
        headers:
          Content-Type:
            - 'applciation/json'
        body: |-
          {
              "error": {
                  "code": "InvalidAuthenticationToken",
                  "message": "Lifetime validation failed, the token is expired.",
                  "innerError": {
                      "date": "2025-03-25T14:33:19",
                      "request-id": "61d323d8-abba-4f69-8ab5-660e86160ec4",
                      "client-request-id": "61d323d8-abba-4f69-8ab5-660e86160ec4"
                  }
              }
          }
