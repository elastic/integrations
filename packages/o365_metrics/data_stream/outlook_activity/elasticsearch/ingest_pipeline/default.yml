---
description: Pipeline for renaming object
processors:
  - set:
      field: ecs.version
      value: "8.11.0"
  - json:
      field: outlookactivity
      target_field: o365metrics.outlookactivity   
  - script:
      lang: painless
      description: Replace spaces and dashes in field names under o365metrics.outlookactivity.
      tag: painless_purge_spaces_and_dashes
      if: ctx.o365metrics?.outlookactivity instanceof Map
      source: |
        String underscore(String s) {
          return /[ -]/.matcher(s).replaceAll('_').toLowerCase();
        }
        
        def out = [:];
        for (def item : ctx.o365metrics.outlookactivity.entrySet()) {
          out[underscore(item.getKey())] = item.getValue();
        }
        ctx.o365metrics.outlookactivity = out;

  - remove:
      if: ctx.outlookactivity != null
      field: outlookactivity
      ignore_missing: true

  - rename:
      field: o365metrics.outlookactivity.read
      target_field: o365metrics.outlookactivity.emails_read.count
      ignore_missing: true
  - rename:
      field: o365metrics.outlookactivity.receive
      target_field: o365metrics.outlookactivity.emails_received.count
      ignore_missing: true
  - rename:
      field: o365metrics.outlookactivity.send
      target_field: o365metrics.outlookactivity.emails_sent.count
      ignore_missing: true
  - rename:
      field: o365metrics.outlookactivity.meeting_created
      target_field: o365metrics.outlookactivity.meeting_created.count
      ignore_missing: true
  - rename:
      field: o365metrics.outlookactivity.meeting_interacted
      target_field: o365metrics.outlookactivity.meeting_interacted.count
      ignore_missing: true

on_failure:
  - append:
      field: error.message
      value: "{{{_ingest.on_failure_message}}}"
  - append:
      field: event.kind
      value: pipeline_error
      allow_duplicates: false
