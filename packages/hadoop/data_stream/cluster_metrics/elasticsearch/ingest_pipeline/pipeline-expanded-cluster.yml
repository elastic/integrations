---
description: Pipeline for parsing hadoop expanded cluster metrics
processors:
  - script:
      source: >
        ctx.hadoop.cluster_metrics.temp = ctx.hadoop.cluster_metrics.clusterMetrics;
        ctx.hadoop.cluster_metrics.remove("clusterMetrics")
  - rename:
      field: hadoop.cluster_metrics.temp.appsSubmitted
      target_field: hadoop.cluster_metrics.apps.submitted
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.appsCompleted
      target_field: hadoop.cluster_metrics.apps.completed
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.appsPending
      target_field: hadoop.cluster_metrics.apps.pending
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.appsRunning
      target_field: hadoop.cluster_metrics.apps.running
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.appsFailed
      target_field: hadoop.cluster_metrics.apps.failed
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.appsKilled
      target_field: hadoop.cluster_metrics.apps.killed
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.reservedMB
      target_field: hadoop.cluster_metrics.memory.reserved
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.availableMB
      target_field: hadoop.cluster_metrics.memory.available
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.allocatedMB
      target_field: hadoop.cluster_metrics.memory.allocated
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.totalMB
      target_field: hadoop.cluster_metrics.memory.total
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.reservedVirtualCores
      target_field: hadoop.cluster_metrics.virtual_cores.reserved
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.availableVirtualCores
      target_field: hadoop.cluster_metrics.virtual_cores.available
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.allocatedVirtualCores
      target_field: hadoop.cluster_metrics.virtual_cores.allocated
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.totalVirtualCores
      target_field: hadoop.cluster_metrics.virtual_cores.total
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.containersAllocated
      target_field: hadoop.cluster_metrics.containers.allocated
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.containersReserved
      target_field: hadoop.cluster_metrics.containers.reserved
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.containersPending
      target_field: hadoop.cluster_metrics.containers.pending
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.totalNodes
      target_field: hadoop.cluster_metrics.nodes.total
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.activeNodes
      target_field: hadoop.cluster_metrics.nodes.active
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.lostNodes
      target_field: hadoop.cluster_metrics.nodes.lost
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.unhealthyNodes
      target_field: hadoop.cluster_metrics.nodes.unhealthy
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.decommissioningNodes
      target_field: hadoop.cluster_metrics.nodes.decommissioning
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.decommissionedNodes
      target_field: hadoop.cluster_metrics.nodes.decommissioned
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.rebootedNodes
      target_field: hadoop.cluster_metrics.nodes.rebooted
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster_metrics.temp.shutdownNodes
      target_field: hadoop.cluster_metrics.nodes.shutdown
      ignore_missing: true
      ignore_failure: true
  - remove:
      field:
        - hadoop.cluster_metrics.temp
      ignore_missing: true
      ignore_failure: true
on_failure:
  - set:
      field: error.message
      value: "{{{_ingest.on_failure_message}}}"
