---
description: Pipeline for parsing hadoop expanded cluster metrics
processors:
  - script:
      source: >
        ctx.hadoop.cluster.temp = ctx.hadoop.cluster.clusterMetrics;
        ctx.hadoop.cluster.remove("clusterMetrics")
  - rename:
      field: hadoop.cluster.temp.appsSubmitted
      target_field: hadoop.cluster.applications.submitted
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.appsCompleted
      target_field: hadoop.cluster.applications.completed
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.appsPending
      target_field: hadoop.cluster.applications.pending
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.appsRunning
      target_field: hadoop.cluster.applications.running
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.appsFailed
      target_field: hadoop.cluster.applications.failed
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.appsKilled
      target_field: hadoop.cluster.applications.killed
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.reservedMB
      target_field: hadoop.cluster.memory.reserved
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.availableMB
      target_field: hadoop.cluster.memory.available
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.allocatedMB
      target_field: hadoop.cluster.memory.allocated
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.totalMB
      target_field: hadoop.cluster.memory.total
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.reservedVirtualCores
      target_field: hadoop.cluster.virtual_cores.reserved
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.availableVirtualCores
      target_field: hadoop.cluster.virtual_cores.available
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.allocatedVirtualCores
      target_field: hadoop.cluster.virtual_cores.allocated
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.totalVirtualCores
      target_field: hadoop.cluster.virtual_cores.total
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.containersAllocated
      target_field: hadoop.cluster.containers.allocated
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.containersReserved
      target_field: hadoop.cluster.containers.reserved
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.containersPending
      target_field: hadoop.cluster.containers.pending
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.totalNodes
      target_field: hadoop.cluster.nodes.total
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.activeNodes
      target_field: hadoop.cluster.nodes.active
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.lostNodes
      target_field: hadoop.cluster.nodes.lost
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.unhealthyNodes
      target_field: hadoop.cluster.nodes.unhealthy
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.decommissioningNodes
      target_field: hadoop.cluster.nodes.decommissioning
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.decommissionedNodes
      target_field: hadoop.cluster.nodes.decommissioned
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.rebootedNodes
      target_field: hadoop.cluster.nodes.rebooted
      ignore_missing: true
      ignore_failure: true
  - rename:
      field: hadoop.cluster.temp.shutdownNodes
      target_field: hadoop.cluster.nodes.shutdown
      ignore_missing: true
      ignore_failure: true
  - remove:
      field:
        - hadoop.cluster.temp
      ignore_missing: true
      ignore_failure: true
on_failure:
  - set:
      field: error.message
      value: "{{{_ingest.on_failure_message}}}"
