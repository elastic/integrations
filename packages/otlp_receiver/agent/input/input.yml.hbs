receivers:
  # TODO: More settings from https://github.com/open-telemetry/opentelemetry-collector/tree/main/receiver/otlpreceiver
  otlp:
    protocols:
      grpc:
        endpoint: "{{listen_address_grpc}}"
      http:
        endpoint: "{{listen_address_http}}"

{{#if enable_traces }}
processors:
  elasticapm: {}

{{#if enable_aggregated_metrics }}
connectors:
  elasticapm: {}
{{/if}}
{{/if}}

service:
  pipelines:
    {{#if enable_logs }}
      logs:
        receivers: [otlp]
        processors: []
    {{/if}}
    {{#if enable_metrics }}
      metrics:
        receivers: [otlp]
        processors: []
    {{/if}}
    {{#if enable_traces }}
      traces:
        receivers: [otlp]
        processors: [elasticapm]
    {{#if enable_aggregated_metrics }}
        exporters: [elasticapm]
    {{/if}}

    {{#if enable_aggregated_metrics }}
      metrics/aggregated-metrics:
        receivers: [elasticapm]
        processors: []
    {{/if}}
    {{/if}}