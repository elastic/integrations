---
description: Pipeline for processing nod feed
processors:
  - terminate:
      tag: data_collection_error
      if: ctx.error?.message != null
      description: error message set and no data to process.

  - json:
      if: ctx.message != null
      field: message
      target_field: domaintools

    ############################
    # Generic indicator fields #
    ############################

  - set:
      field: threat.indicator.type
      value: domain-name
  - set:
      if: ctx.domaintools?.domain != null
      field: threat.indicator.name
      copy_from: domaintools.domain

    ####################
    # Event ECS fields #
    ####################

  - set:
      field: ecs.version
      value: '8.17.0'
  - set:
      field: event.kind
      value: enrichment
  - set:
      field: event.category
      value: ['threat']
  - set:
      field: event.type
      value: ['indicator']

on_failure:
- set:
      field: event.kind
      value: pipeline_error
- append:
    field: tags
    value: preserve_original_event
    allow_duplicates: false
- append:
      field: error.message
      value: >-
        Processor '{{{ _ingest.on_failure_processor_type }}}'
        {{{#_ingest.on_failure_processor_tag}}}with tag '{{{ _ingest.on_failure_processor_tag }}}'
        {{{/_ingest.on_failure_processor_tag}}}failed with message '{{{ _ingest.on_failure_message }}}'
