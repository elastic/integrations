---
description: Pipeline for processing nad feed
processors:
- json:
    if: ctx?.message != null
    field: message
    target_field: domaintools

  ############################
  # Generic indicator fields #
  ############################

- set:
    field: threat.indicator.type
    value: domain-name
- set:
    if: ctx.domaintools?.domain != null
    field: threat.indicator.name
    copy_from: domaintools.domain

  ######################
  # Threat feed fields #
  ######################

- set:
    field: threat.feed.description
    value: 'Apex-level domains (e.g. example.com but not www.example.com) that we observe for the first time, and have not observed previously with our global DNS sensor network.'
- set:
    field: threat.feed.name
    value: 'DomainTools NAD'
- set:
    field: threat.feed.reference
    value: https://docs.techdocs.ci.domaintools.cloud/feeds/realtime/userguide/

  ####################
  # Event ECS fields #
  ####################

- set:
    field: ecs.version
    value: '8.11.0'
- set:
    field: event.kind
    value: enrichment
- set:
    field: event.category
    value: ['threat']
- set:
    field: event.type
    value: ['indicator']

on_failure:
- set:
      field: event.kind
      value: pipeline_error
- append:
    field: tags
    value: preserve_original_event
    allow_duplicates: false
- append:
      field: error.message
      value: >-
        Processor '{{{ _ingest.on_failure_processor_type }}}'
        {{#_ingest.on_failure_processor_tag}}with tag '{{{ _ingest.on_failure_processor_tag }}}'
        {{/_ingest.on_failure_processor_tag}}failed with message '{{{ _ingest.on_failure_message }}}'
