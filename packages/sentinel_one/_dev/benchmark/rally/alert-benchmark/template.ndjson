{{- $timestamp := generate "timestamp" }}
{{- /* Agent Data */ -}}
{{- $accountId := generate "agentInfo.accountId" }}
{{- $agentId := generate "agentInfo.id" }}
{{- $infected := generate "agentInfo.infected" }}
{{- $isActive := generate "agentInfo.isActive" }}
{{- $isDecommissioned := generate "agentInfo.isDecommissioned" }}
{{- $machineType := generate "agentInfo.machineType" }}
{{- $agentName := generate "agentInfo.name" }}
{{- $osFamily := generate "agentInfo.osFamily" }}
{{- $osName := generate "agentInfo.osName" }}
{{- $osRevision := generate "agentInfo.osRevision" }}
{{- $siteId := generate "agentInfo.siteId" }}
{{- $uuid := generate "agentInfo.uuid" }}
{{- $version := generate "agentInfo.version" }}
{{- /* Alert Data */ -}}
{{- $alertId := generate "alertInfo.alertId" }}
{{- $analystVerdict := generate "alertInfo.analystVerdict" }}
{{- $createdAt := generate "alertInfo.createdAt" | date "2006-01-02T15:04:05.000000Z" }}
{{- $dvEventId := generate "alertInfo.dvEventId" }}
{{- $eventType := generate "alertInfo.eventType" }}
{{- $hitType := generate "alertInfo.hitType" }}
{{- $incidentStatus := generate "alertInfo.incidentStatus" }}
{{- $indicatorCategory := generate "alertInfo.indicatorCategory" }}
{{- $indicatorDescription := generate "alertInfo.indicatorDescription" }}
{{- $indicatorName := generate "alertInfo.indicatorName" }}
{{- $isEdr := generate "alertInfo.isEdr" }}
{{- $reportedAt := generate "alertInfo.reportedAt" | date "2006-01-02T15:04:05.000000Z" }}
{{- $source := generate "alertInfo.source" }}
{{- $updatedAt := generate "alertInfo.updatedAt" | date "2006-01-02T15:04:05.000000Z" }}
{{- $ipAddress := generate "ipAddress" }}
{{- $port := generate "port" }}
{{- $domain := generate "domain" }}
{{- /* Process Data */ -}}
{{- $effectiveUser := generate "process.effectiveUser" }}
{{- $fileHashMd5 := generate "process.fileHashMd5" }}
{{- $fileHashSha1 := generate "process.fileHashSha1" }}
{{- $fileHashSha256 := generate "process.fileHashSha256" }}
{{- $filePath := generate "process.filePath" }}
{{- $fileSignerIdentity := generate "process.fileSignerIdentity" }}
{{- $integrityLevel := generate "process.integrityLevel" }}
{{- $loginUser := generate "process.loginUser" }}
{{- $pid := generate "process.pid" }}
{{- $processName := generate "process.name" }}
{{- $pidStarttime := generate "process.pidStarttime" | date "2006-01-02T15:04:05.000000Z" }}
{{- $realUser := generate "process.realUser" }}
{{- $storyline := generate "process.storyline" }}
{{- $subsystem := generate "process.subsystem" }}
{{- $tgtFileCreatedAt := generate "process.tgtFileCreatedAt" | date "2006-01-02T15:04:05.000000Z" }}
{{- $tgtFileHashSha1 := generate "process.tgtFileHashSha1" }}
{{- $tgtFileHashSha256 := generate "process.tgtFileHashSha256" }}
{{- $tgtFileId := generate "process.tgtFileId" }}
{{- $tgtFileIsSigned := generate "process.tgtFileIsSigned" }}
{{- $tgtFileModifiedAt := generate "process.tgtFileModifiedAt" | date "2006-01-02T15:04:05.000000Z" }}
{{- $tgtFileOldPath := generate "process.tgtFileOldPath" }}
{{- $tgtFilePath := generate "process.tgtFilePath" }}
{{- $tgtProcCmdLine := generate "process.tgtProcCmdLine" }}
{{- $tgtProcImagePath := generate "process.tgtProcImagePath" }}
{{- $tgtProcIntegrityLevel := generate "process.tgtProcIntegrityLevel" }}
{{- $tgtProcName := generate "process.tgtProcName" }}
{{- $tgtProcPid := generate "process.tgtProcPid" }}
{{- $tgtProcSignedStatus := generate "process.tgtProcSignedStatus" }}
{{- $tgtProcStorylineId := generate "process.tgtProcStorylineId" }}
{{- $tgtProcUid := generate "process.tgtProcUid" }}
{{- $tgtProcessStartTime := generate "process.tgtProcessStartTime" | date "2006-01-02T15:04:05.000000Z" }}
{{- $uniqueId := generate "process.uniqueId" }}
{{- $user := generate "process.user" }}
{{- /* Rule Data */ -}}
{{- $description := generate "ruleInfo.description" }}
{{- $ruleId := generate "ruleInfo.id" }}
{{- $ruleName := generate "ruleInfo.name" }}
{{- $queryLang := generate "ruleInfo.queryLang" }}
{{- $queryType := generate "ruleInfo.queryType" }}
{{- $s1ql := generate "ruleInfo.s1ql" }}
{{- $scopeLevel := generate "ruleInfo.scopeLevel" }}
{{- $severity := generate "ruleInfo.severity" }}
{{- $treatAsThreat := generate "ruleInfo.treatAsThreat" }}
{{- /*
{
    "agentDetectionInfo": {
        "accountId": "{{ $accountId }}",
        "machineType": "{{ $machineType }}",
        "name": "{{ $agentName }}",
        "osFamily": "{{ $osFamily }}",
        "osName": "{{ $osName }}",
        "osRevision": "{{ $osRevision }}",
        "siteId": "{{ $siteId }}",
        "uuid": "{{ $uuid }}",
        "version": "{{ $version }}"
    },
    "agentRealtimeInfo": {
        "id": "{{ $agentId }}",
        "infected": {{ $infected }},
        "isActive": {{ $isActive }},
        "isDecommissioned": {{ $isDecommissioned }},
        "machineType": "{{ $machineType }}",
        "name": "{{ $agentName }}",
        "os": "{{ $osFamily }}",
        "uuid": "{{ $uuid }}"
    },
    "alertInfo": {
        "alertId": "{{ $alertId }}",
        "analystVerdict": "{{ $analystVerdict }}",
        "createdAt": "{{ $createdAt }}",
        "dnsRequest": "type:  1 {{ $domain }}",
        "dnsResponse": "{{ $ipAddress }};",
        "dstIp": "{{ $ipAddress }}",
        "dstPort": "{{ $port }}",
        "dvEventId": "{{ $dvEventId }}",
        "eventType": "{{ $eventType }}",
        "hitType": "{{ $hitType }}",
        "incidentStatus": "{{ $incidentStatus }}",
        "indicatorCategory": "{{ $indicatorCategory }}",
        "indicatorDescription": "{{ $indicatorDescription }}",
        "indicatorName": "{{ $indicatorName }}",
        "isEdr": {{ $isEdr }},
        "loginAccountDomain": null,
        "loginAccountSid": null,
        "loginIsAdministratorEquivalent": null,
        "loginIsSuccessful": null,
        "loginType": null,
        "loginsUserName": null,
        "modulePath": null,
        "moduleSha1": null,
        "netEventDirection": null,
        "registryKeyPath": null,
        "registryOldValue": null,
        "registryOldValueType": null,
        "registryPath": null,
        "registryValue": null,
        "reportedAt": "{{ $reportedAt }}",
        "source": "{{ $source }}",
        "srcIp": "{{ $ipAddress }}",
        "srcMachineIp": "{{ $ipAddress}}",
        "srcPort": "{{ $port }}",
        "tiIndicatorComparisonMethod": null,
        "tiIndicatorSource": null,
        "tiIndicatorType": null,
        "tiIndicatorValue": null,
        "updatedAt": "{{ $updatedAt }}"
    },
    "containerInfo": {
        "id": null,
        "image": null,
        "labels": null,
        "name": null
    },
    "kubernetesInfo": {
        "cluster": null,
        "controllerKind": null,
        "controllerLabels": null,
        "controllerName": null,
        "namespace": null,
        "namespaceLabels": null,
        "node": null,
        "pod": null,
        "podLabels": null
    },
    "ruleInfo": {
        "description": "{{ $description }}",
        "id": "{{ $ruleId }}",
        "name": "{{ $ruleName }}",
        "queryLang": "{{ $queryLang }}",
        "queryType": "{{ $queryType }}",
        "s1ql": "{{ $s1ql }}",
        "scopeLevel": "{{ $scopeLevel }}",
        "severity": "{{ $severity }}",
        "treatAsThreat": "{{ $treatAsThreat }}"
    },
    "sourceParentProcessInfo": {
        "commandline": "{{ $filePath }}",
        "effectiveUser": "{{ $effectiveUser }}",
        "fileHashMd5": "{{ $fileHashMd5 }}",
        "fileHashSha1": "{{ $fileHashSha1 }}",
        "fileHashSha256": "{{ $fileHashSha256 }}",
        "filePath": "{{ $filePath }}",
        "fileSignerIdentity": "{{ $fileSignerIdentity }}",
        "integrityLevel": "{{ $integrityLevel }}",
        "loginUser": "{{ $loginUser }}",
        "name": "{{ $processName }}",
        "pid": "{{ $pid }}",
        "pidStarttime": "{{ $pidStarttime }}",
        "realUser": "{{ $realUser }}",
        "storyline": "{{ $storyline }}",
        "subsystem": "{{ $subsystem }}",
        "uniqueId": "{{ $uniqueId }}",
        "user": "{{ $user }}"
    },
    "sourceProcessInfo": {
        "commandline": "{{ $filePath }}",
        "effectiveUser": "{{ $effectiveUser }}",
        "fileHashMd5": "{{ $fileHashMd5 }}",
        "fileHashSha1": "{{ $fileHashSha1 }}",
        "fileHashSha256": "{{ $fileHashSha256 }}",
        "filePath": "{{ $filePath }}",
        "fileSignerIdentity": "{{ $fileSignerIdentity }}",
        "integrityLevel": "{{ $integrityLevel }}",
        "loginUser": "{{ $loginUser }}",
        "name": "{{ $processName }}",
        "pid": "{{ $pid }}",
        "pidStarttime": "{{ $pidStarttime }}",
        "realUser": "{{ $realUser }}",
        "storyline": "{{ $storyline }}",
        "subsystem": "{{ $subsystem }}",
        "uniqueId": "{{ $uniqueId }}",
        "user": "{{ $user }}"
    },
    "targetProcessInfo": {
        "tgtFileCreatedAt": "{{ $tgtFileCreatedAt }}",
        "tgtFileHashSha1": "{{ $tgtFileHashSha1 }}",
        "tgtFileHashSha256": "{{ $tgtFileHashSha256 }}",
        "tgtFileId": "{{ $tgtFileId }}",
        "tgtFileIsSigned": "{{ $tgtFileIsSigned }}",
        "tgtFileModifiedAt": "{{ $tgtFileModifiedAt }}",
        "tgtFileOldPath": "{{ $tgtFileOldPath }}",
        "tgtFilePath": "{{ $tgtFilePath }}",
        "tgtProcCmdLine": "{{ $tgtProcCmdLine }}",
        "tgtProcImagePath": "{{ $tgtProcImagePath }}",
        "tgtProcIntegrityLevel": "{{ $tgtProcIntegrityLevel }}",
        "tgtProcName": "{{ $tgtProcName }}",
        "tgtProcPid": "{{ $tgtProcPid }}",
        "tgtProcSignedStatus": "{{ $tgtProcSignedStatus }}",
        "tgtProcStorylineId": "{{ $tgtProcStorylineId }}",
        "tgtProcUid": "{{ $tgtProcUid }}",
        "tgtProcessStartTime": "{{ $tgtProcessStartTime }}"
    }
}
*/ -}}
{
    "@timestamp": "{{ $timestamp.Format "2006-01-02T15:04:05.999999Z07:00" }}",
    "agent": {
        "ephemeral_id": "cdaaaabb-be7e-432f-816b-bda019fd7c15",
        "id": "da6cb4c8-c84c-4c5f-97c7-f8586a098af4",
        "name": "docker-fleet-agent",
        "type": "filebeat",
        "version": "8.18.0"
    },
    "data_stream": {
        "dataset": "sentinel_one.alert",
        "namespace": "93724",
        "type": "logs"
    },
    "elastic_agent": {
        "id": "da6cb4c8-c84c-4c5f-97c7-f8586a098af4",
        "snapshot": false,
        "version": "8.18.0"
    },
    "message": "{\"agentDetectionInfo\":{\"accountId\":\"{{ $accountId }}\",\"machineType\":\"{{ $machineType }}\",\"name\":\"{{ $agentName }}\",\"osFamily\":\"{{ $osFamily }}\",\"osName\":\"{{ $osName }}\",\"osRevision\":\"{{ $osRevision }}\",\"siteId\":\"{{ $siteId }}\",\"uuid\":\"{{ $uuid }}\",\"version\":\"{{ $version }}\"},\"agentRealtimeInfo\":{\"id\":\"{{ $agentId }}\",\"infected\":{{ $infected }},\"isActive\":{{ $isActive }},\"isDecommissioned\":{{ $isDecommissioned }},\"machineType\":\"{{ $machineType }}\",\"name\":\"{{ $agentName }}\",\"os\":\"{{ $osFamily }}\",\"uuid\":\"{{ $uuid }}\"},\"alertInfo\":{\"alertId\":\"{{ $alertId }}\",\"analystVerdict\":\"{{ $analystVerdict }}\",\"createdAt\":\"{{ $createdAt }}\",\"dnsRequest\":\"type: 1 {{ $domain }}\",\"dnsResponse\":\"{{ $ipAddress }};\",\"dstIp\":\"{{ $ipAddress }}\",\"dstPort\":\"{{ $port }}\",\"dvEventId\":\"{{ $dvEventId }}\",\"eventType\":\"{{ $eventType }}\",\"hitType\":\"{{ $hitType }}\",\"incidentStatus\":\"{{ $incidentStatus }}\",\"indicatorCategory\":\"{{ $indicatorCategory }}\",\"indicatorDescription\":\"{{ $indicatorDescription }}\",\"indicatorName\":\"{{ $indicatorName }}\",\"isEdr\":{{ $isEdr }},\"loginAccountDomain\":null,\"loginAccountSid\":null,\"loginIsAdministratorEquivalent\":null,\"loginIsSuccessful\":null,\"loginType\":null,\"loginsUserName\":null,\"modulePath\":null,\"moduleSha1\":null,\"netEventDirection\":null,\"registryKeyPath\":null,\"registryOldValue\":null,\"registryOldValueType\":null,\"registryPath\":null,\"registryValue\":null,\"reportedAt\":\"{{ $reportedAt }}\",\"source\":\"{{ $source }}\",\"srcIp\":\"{{ $ipAddress }}\",\"srcMachineIp\":\"{{ $ipAddress}}\",\"srcPort\":\"{{ $port }}\",\"tiIndicatorComparisonMethod\":null,\"tiIndicatorSource\":null,\"tiIndicatorType\":null,\"tiIndicatorValue\":null,\"updatedAt\":\"{{ $updatedAt }}\"},\"containerInfo\":{\"id\":null,\"image\":null,\"labels\":null,\"name\":null},\"kubernetesInfo\":{\"cluster\":null,\"controllerKind\":null,\"controllerLabels\":null,\"controllerName\":null,\"namespace\":null,\"namespaceLabels\":null,\"node\":null,\"pod\":null,\"podLabels\":null},\"ruleInfo\":{\"description\":\"{{ $description }}\",\"id\":\"{{ $ruleId }}\",\"name\":\"{{ $ruleName }}\",\"queryLang\":\"{{ $queryLang }}\",\"queryType\":\"{{ $queryType }}\",\"s1ql\":\"{{ $s1ql }}\",\"scopeLevel\":\"{{ $scopeLevel }}\",\"severity\":\"{{ $severity }}\",\"treatAsThreat\":\"{{ $treatAsThreat }}\"},\"sourceParentProcessInfo\":{\"commandline\":\"{{ $filePath }}\",\"effectiveUser\":\"{{ $effectiveUser }}\",\"fileHashMd5\":\"{{ $fileHashMd5 }}\",\"fileHashSha1\":\"{{ $fileHashSha1 }}\",\"fileHashSha256\":\"{{ $fileHashSha256 }}\",\"filePath\":\"{{ $filePath }}\",\"fileSignerIdentity\":\"{{ $fileSignerIdentity }}\",\"integrityLevel\":\"{{ $integrityLevel }}\",\"loginUser\":\"{{ $loginUser }}\",\"name\":\"{{ $processName }}\",\"pid\":\"{{ $pid }}\",\"pidStarttime\":\"{{ $pidStarttime }}\",\"realUser\":\"{{ $realUser }}\",\"storyline\":\"{{ $storyline }}\",\"subsystem\":\"{{ $subsystem }}\",\"uniqueId\":\"{{ $uniqueId }}\",\"user\":\"{{ $user }}\"},\"sourceProcessInfo\":{\"commandline\":\"{{ $filePath }}\",\"effectiveUser\":\"{{ $effectiveUser }}\",\"fileHashMd5\":\"{{ $fileHashMd5 }}\",\"fileHashSha1\":\"{{ $fileHashSha1 }}\",\"fileHashSha256\":\"{{ $fileHashSha256 }}\",\"filePath\":\"{{ $filePath }}\",\"fileSignerIdentity\":\"{{ $fileSignerIdentity }}\",\"integrityLevel\":\"{{ $integrityLevel }}\",\"loginUser\":\"{{ $loginUser }}\",\"name\":\"{{ $processName }}\",\"pid\":\"{{ $pid }}\",\"pidStarttime\":\"{{ $pidStarttime }}\",\"realUser\":\"{{ $realUser }}\",\"storyline\":\"{{ $storyline }}\",\"subsystem\":\"{{ $subsystem }}\",\"uniqueId\":\"{{ $uniqueId }}\",\"user\":\"{{ $user }}\"},\"targetProcessInfo\":{\"tgtFileCreatedAt\":\"{{ $tgtFileCreatedAt }}\",\"tgtFileHashSha1\":\"{{ $tgtFileHashSha1 }}\",\"tgtFileHashSha256\":\"{{ $tgtFileHashSha256 }}\",\"tgtFileId\":\"{{ $tgtFileId }}\",\"tgtFileIsSigned\":\"{{ $tgtFileIsSigned }}\",\"tgtFileModifiedAt\":\"{{ $tgtFileModifiedAt }}\",\"tgtFileOldPath\":\"{{ $tgtFileOldPath }}\",\"tgtFilePath\":\"{{ $tgtFilePath }}\",\"tgtProcCmdLine\":\"{{ $tgtProcCmdLine }}\",\"tgtProcImagePath\":\"{{ $tgtProcImagePath }}\",\"tgtProcIntegrityLevel\":\"{{ $tgtProcIntegrityLevel }}\",\"tgtProcName\":\"{{ $tgtProcName }}\",\"tgtProcPid\":\"{{ $tgtProcPid }}\",\"tgtProcSignedStatus\":\"{{ $tgtProcSignedStatus }}\",\"tgtProcStorylineId\":\"{{ $tgtProcStorylineId }}\",\"tgtProcUid\":\"{{ $tgtProcUid }}\",\"tgtProcessStartTime\":\"{{ $tgtProcessStartTime }}\"}}",
    "event": {
        "dataset": "sentinel_one.alert"
    },
    "input": {
        "type": "httpjson"
    },
    "tags": [
        "preserve_original_event",
        "forwarded",
        "sentinel_one-alert"
    ]
}
