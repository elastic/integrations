inputs:
    - data_stream:
        namespace: ep
      meta:
        package:
            name: sentinel_one
      name: test-default-sentinel_one
      streams:
        - config_version: 2
          cursor:
            last_create_at:
                value: '[[.last_event.alertInfo.createdAt]]'
          data_stream:
            dataset: sentinel_one.alert
            type: logs
          interval: 30s
          publisher_pipeline.disable_host: true
          request.method: GET
          request.ssl: null
          request.tracer:
            enabled: false
            filename: ../../logs/httpjson/http-request-trace-*.ndjson
            maxbackups: 5
          request.transforms:
            - set:
                target: header.Authorization
                value: ApiToken ${SECRET_0}
            - set:
                target: url.params.limit
                value: "100"
            - set:
                target: url.params.sortBy
                value: alertInfoCreatedAt
            - set:
                target: url.params.sortOrder
                value: asc
            - set:
                default: '[[formatDate (now (parseDuration "-24h"))]]'
                target: url.params.createdAt__gte
                value: '[[formatDate (parseDate .cursor.last_create_at)]]'
          request.url: http://host.tld/web/api/v2.1/cloud-detection/alerts
          response.pagination:
            - set:
                fail_on_template_error: true
                target: url.params.cursor
                value: '[[if (ne .last_response.body.pagination.nextCursor nil)]][[.last_response.body.pagination.nextCursor]][[end]]'
          response.split:
            ignore_empty_value: true
            target: body.data
          tags:
            - forwarded
            - sentinel_one-alert
      type: httpjson
      use_output: default
output_permissions:
    default:
        _elastic_agent_checks:
            cluster:
                - monitor
        _elastic_agent_monitoring:
            indices: []
        uuid-for-permissions-on-related-indices:
            indices:
                - names:
                    - logs-sentinel_one.alert-ep
                  privileges:
                    - auto_configure
                    - create_doc
secret_references:
    - {}
