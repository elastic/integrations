config_version: "2"
interval: 30s

{{#if username}}
auth.basic:
  user: {{username}}
  password: {{password}}
{{/if}}

request:
  method: "GET"
  url: {{hosts.[0]}}/_nodes/stats/ingest?filter_path=nodes.*.ingest
  # timeout:

response:
  split:
    type: map
    target: body.nodes
    key_field: node_id
    split:
      type: map
      target: body.ingest.pipelines
      keep_parent: true
      key_field: pipeline_id

processors:
- decode_json_fields:
    fields: ["message"]
- drop_event:
    when:
      and:
        - equals:
            message.ingest.pipelines.count: 0
        - equals:
            message.ingest.pipelines.failed: 0
        - equals:
            message.ingest.pipelines.time_in_millis: 0
