config_version: "2"
interval: 30s

{{#if username}}
auth.basic:
  user: {{username}}
  password: {{password}}
{{/if}}

request:
  method: "GET"
  url: {{hosts.[0]}}/_nodes/stats/ingest
  # timeout:

response:
  split:
    type: map
    target: body.nodes
    key_field: node_id
    keep_parent: true
    split:
      type: map
      target: body.nodes.ingest.pipelines
      keep_parent: true
      key_field: pipeline_id

processors:
  - decode_json_fields:
      fields:
        - message
  - drop_event:
      when:
        and:
          - equals:
              message.nodes.ingest.pipelines.count: 0
          - equals:
              message.nodes.ingest.pipelines.failed: 0
          - equals:
              message.nodes.ingest.pipelines.time_in_millis: 0
