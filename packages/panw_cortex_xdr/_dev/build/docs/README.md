# Palo Alto Cortex XDR Integration

[Palo Alto Networks Cortex XDR](https://docs-cortex.paloaltonetworks.com/r/Cortex-XDR/Cortex-XDR-Pro-Administrator-Guide/Overview) is a powerful security solution that gives you complete visibility into network traffic, user behavior, and endpoint activity. It streamlines threat investigation by correlating data from various sensors, uncovering attack timelines and root causes with clarity. With Cortex XDR, you can take immediate response actions and minimize threat impact. Additionally, it enables proactive threat prevention through customizable detection rules, including BIOCs, IOCs, and Correlation Rules, helping you stay ahead of emerging threats.

The Palo Alto Cortex XDR integration collects [alerts](https://docs-cortex.paloaltonetworks.com/r/Cortex-XDR-REST-API/Get-Alerts-Multi-Events-v1) and [incidents](https://docs-cortex.paloaltonetworks.com/r/Cortex-XDR-REST-API/Get-all-Incidents) via the REST API and supports [endpoint event forwarding](https://docs-cortex.paloaltonetworks.com/r/Cortex-XDR/Cortex-XDR-Pro-Administrator-Guide/Manage-Event-Forwarding) through Google Cloud Storage (GCS).

## Data streams

**[Alerts](https://docs-cortex.paloaltonetworks.com/r/Cortex-XDR-REST-API/Get-Alerts-Multi-Events-v1)** – Retrieves alerts generated by Cortex XDR based on raw endpoint data. A single alert may include one or more local endpoint events, each of which is ingested as a separate document in Elasticsearch. Requires both an API Key and API Key ID.

**[Incidents](https://docs-cortex.paloaltonetworks.com/r/Cortex-XDR-REST-API/Get-all-Incidents)** – Retrieves incidents generated by Cortex XDR. Each incident may include one or more endpoint events, each stored as a separate document in Elasticsearch. When an incident is modified in the Cortex XDR UI (e.g., severity or status changes, alerts linked), a new document reflecting the updated values is indexed. Requires both an API Key and API Key ID.

**[Event](https://docs-cortex.paloaltonetworks.com/r/Cortex-XDR/Cortex-XDR-Pro-Administrator-Guide/Manage-Event-Forwarding)** - Retrieves events forwarded by Cortex XDR to Google Cloud Storage (GCS).

## Requirements

### Agentless enabled integration
Agentless integrations allow you to collect data without having to manage Elastic Agent in your cloud. They make manual agent deployment unnecessary, so you can focus on your data instead of the agent that collects it. For more information, refer to [Agentless integrations](https://www.elastic.co/guide/en/serverless/current/security-agentless-integrations.html) and the [Agentless integrations FAQ](https://www.elastic.co/guide/en/serverless/current/agentless-integration-troubleshooting.html).

Agentless deployments are only supported in Elastic Serverless and Elastic Cloud environments.  This functionality is in beta and is subject to change. Beta features are not subject to the support SLA of official GA features.

### Agent-based installation

Elastic Agent must be installed. For more details, check the Elastic Agent [installation instructions](docs-content://reference/fleet/install-elastic-agents.md).

## Compatibility

This integration is compatible with Palo Alto Cortex XDR version **V3.13**. For the REST API, it has been tested with versions **v1** and **v2**.

## Setup

### To collect logs through REST API, follow the below steps:

**Note:** To collect logs from API version v1, use the **HTTP JSON** input type. To collect logs from API version v2, use the **CEL** input type.

1. Log in to your Cortex XDR portal.
2. Navigate to **Settings > Configurations > Integrations > API Keys**.
3. Select **+ New Key** to generate a new API key.
4. Choose the type of API key you want to generate: **Standard** or **Advanced**, based on the desired security level.
5. (Optional) To define a time limit for the API key, enable **Expiration Date** and set the desired expiration.
6. Select the **access level** for this key:
   - Choose from existing **Roles**, or
   - Select **Custom** for granular permission settings.
7. Click **Generate** to create the key.
8. **Copy the API Key** shown in the notification and store it securely — you won’t be able to view it again.
9. Locate the **API Key ID** in the **ID** column of the API Keys table. This represents your `x-xdr-auth-id`.
10. To get your **Domain Name**, right-click the API key and select **View Examples**.
    - Copy the domain part from the **CURL example URL** (e.g., `https://api-{fqdn}/public_api/...`).

**Reference:** [Cortex XDR – Get Started with APIs](https://docs-cortex.paloaltonetworks.com/r/Cortex-XDR-REST-API/Get-Started-with-Cortex-XDR-APIs)

### To collect endpoint logs using Event Forwarding, follow the below steps:

1. In your Cortex XDR portal, navigate to:
   **Settings > Configurations > Data Management > Event Forwarding**.
2. In the **Activation** section, enable **Endpoints Event Forwarding** to export raw endpoint data for Cortex XDR Pro EP and Cloud Endpoints.
   - A temporary GCS bucket is automatically created by Cortex XDR(Cortex XDR uses GCS as the storage destination by default).
   - Logs are stored as line-delimited JSON gzip files.
3. In the **Destination** section:
   - Copy the GCS storage path.
   - Download the Service Account JSON Web Token (JWT) file containing access credentials.
4. To configure data collection in Elastic, use the following details:
   - **Project ID**
   - **Service Account Key** (downloaded JSON file)
   - **Bucket path** (copied from the GCS destination)

**Reference:** [Cortex XDR - Manage Event Forwarding](https://docs-cortex.paloaltonetworks.com/r/Cortex-XDR/Cortex-XDR-Pro-Administrator-Guide/Manage-Event-Forwarding)

**Note:** The endpoint event forwarding feature requires a Cortex XDR Pro license along with the Event Forwarding add-on. Enabling this feature requires Administrator access.

### Enabling the integration in Elastic

1. In Kibana, navigate to Management > Integrations.
2. In the "Search for integrations" bar, search for Palo Alto Cortex XDR.
3. Select the "Palo Alto Cortex XDR" integration from the search results.
4. Click "Add Palo Alto Cortex XDR" to add the integration.
5. Configure the integration with the required parameters based on your preferred method of data collection:
  - For REST API (applies to both Alerts and Incidents with HTTP JSON and CEL input):
    - API Domain
    - API Token
    - API Token ID
    - Interval
    - Initial Interval
  - For GCS (used for event collection via endpoint event forwarding):
    - Project ID
    - Service Account Key or Service Account Credentials File
    - Buckets
6. Click **Save and continue** to complete the integration setup.

## Logs reference

### Alerts

This is the `Alerts` dataset.

#### Example

{{fields "alerts"}}

{{event "alerts"}}

### Event

This is the `Event` dataset.

#### Example

{{fields "event"}}

### Incidents

This is the `Incidents` dataset.

#### Example

{{fields "incidents"}}

{{event "incidents"}}
