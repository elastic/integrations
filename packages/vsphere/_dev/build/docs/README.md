# VMware vSphere Integration

## Overview

[vSphere](https://www.vmware.com/products/vsphere.html) is VMware's cloud computing virtualization platform, offering tools for managing virtualized data centers.

Use the vSphere integration to:

- Collect vSphere logs, along with datastore, host, and virtualmachine metrics for comprehensive monitoring and analysis.
- Create informative visualizations to track usage trends, measure key metrics, and derive actionable business insights.
- Set up alerts to minimize Mean Time to Detect (MTTD) and Mean Time to Resolve (MTTR) by quickly referencing relevant logs during troubleshooting.

## Data streams

The vSphere integration collects logs and metrics.

Logs help you keep a record of events that happen on your machine. The `Log` data stream collected by vSphere as integration is `log`.

Metrics give you insight into the statistics of the vSphere. The `Metric` data streams collected by the vSphere integration are `cluster`, `datastore`, `datastorecluster`, `host`, `network`, `resourcepool` and `virtualmachine` so that the user can monitor and troubleshoot the performance of the vSphere instance.

Data streams:

- **`log`**: Collects logs generated by VMware vSphere using a syslog daemon.
- **`cluster`**: Collects metrics from VMware vSphere, such as lists of datastores, hosts and networks associated with cluster.
- **`datastore`**: Gathers datastore metrics from VMware vSphere, including performance statistics such as capacity, usage, read/write operations, latency, and throughput.
- **`datastorecluster`**: Gathers metrics for datastore clusters from VMware vSphere, including statistics like cluster capacity and available free space. Additionally, it provides information about the individual datastores that comprise the cluster.
- **`host`**: Collects host metrics from VMware vSphere, including performance statistics such as CPU usage, memory usage, disk I/O, and network activity.
- **`resourcepool`**: Collects metrics from VMware vSphere, such as CPU and memory usage, CPU and memory reservation, and CPU and memory limit.
- **`virtualmachine`**: Gathers virtual machine metrics from VMware vSphere, including performance statistics such as status, uptime, CPU usage, memory usage, and network activity.
- **`network`**: Gathers metrics and status information related to VMware vSphere networks, including network accessibility, connected hosts and virtual machines, configuration health, and network type.

Note:

Users can monitor and check the log inside the ingested documents for vSphere in the `logs-*` index pattern from `Discover`, and for metrics, the index pattern is `metrics-*`.

## Supported periods
    
- Real-time data collection: An ESXi Server collects data for each performance counter every 20 seconds by default.
- The `datastore` and `host` data streams support performance data collection using the vSphere performance API.
- Since the performance API has usage restrictions based on data collection intervals, make sure that the period is configured optimally to receive real-time data. You can still collect summary metrics if performance metrics are not supported for the configured instance.
- Period configuration can be determined based on the [Data Collection Intervals](https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.monitoring.doc/GUID-247646EA-A04B-411A-8DD4-62A3DCFCF49B.html) and [Data Collection Levels](https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vsphere.monitoring.doc/GUID-25800DE4-68E5-41CC-82D9-8811E27924BC.html).

## Compatibility

This integration has been tested and verified against VMware ESXi and vCenter version 7.0.3.

## Prerequisites

You can store and search your data using Elasticsearch and visualize and manage it with Kibana. We recommend using our hosted Elasticsearch Service on Elastic Cloud or self-managing the Elastic Stack on your own hardware.

## Setup

For step-by-step instructions on how to set up an integration, check the [Getting started](https://www.elastic.co/guide/en/welcome-to-elastic/current/getting-started-observability.html) guide.

## Logs

The `log` data stream collects logs generated by VMware vSphere using a syslog daemon.

To collect logs, follow these steps:

1. Configure the listening host/IP address (default: localhost) and host port (default: 9525) in the integration. 

1. Configure vSphere to send logs to a remote syslog host and provide the configured hostname/IP and port of the Elastic Agent host.

{{event "log"}}

**ECS Field Reference**

Refer to the [ECS Field Reference](https://www.elastic.co/guide/en/ecs/current/ecs-field-reference.html) for detailed information on ECS fields.

{{fields "log"}}

## Metrics

To access the metrics, provide the URL <https://host:port/sdk> in the **Add Integration** page of the vSphere package.

### Cluster

Clusters in vSphere represent a group of ESXi hosts working together to optimize resource allocation, ensure high availability, and manage workloads efficiently.

{{event "cluster"}}

**ECS Field Reference**

Refer to the [ECS Field Reference](https://www.elastic.co/guide/en/ecs/current/ecs-field-reference.html) for detailed information on ECS fields.

{{fields "cluster"}}

### Datastore

This data stream collects datastore metrics from VMware vSphere, including performance statistics such as capacity, usage, read/write operations, latency, and throughput.

{{event "datastore"}}

**ECS Field Reference**

Refer to the [ECS Field Reference](https://www.elastic.co/guide/en/ecs/current/ecs-field-reference.html) for detailed information on ECS fields.

{{fields "datastore"}}

### Datastore cluster

Datastore clusters in vSphere group multiple datastores for optimized management and automated load balancing, ensuring efficient storage utilization and simplified administration.

{{event "datastorecluster"}}

**ECS Field Reference**

Refer to the [ECS Field Reference](https://www.elastic.co/guide/en/ecs/current/ecs-field-reference.html) for detailed information on ECS fields.

{{fields "datastorecluster"}}

### Host

This data stream collects host metrics from VMware vSphere, including performance statistics such as CPU usage, memory usage, disk I/O, and network activity.

{{event "host"}}

**ECS Field Reference**

Refer to the [ECS Field Reference](https://www.elastic.co/guide/en/ecs/current/ecs-field-reference.html) for detailed information on ECS fields.

{{fields "host"}}

### Network

This data stream gathers metrics and status information related to VMware vSphere networks, including network accessibility, connected hosts and virtual machines, configuration health, and network type.

{{event "network"}}

**ECS Field Reference**

Refer to the [ECS Field Reference](https://www.elastic.co/guide/en/ecs/current/ecs-field-reference.html) for detailed information on ECS fields.

{{fields "network"}}

### Resourcepool

Resource pools in vSphere enable the allocation and management of CPU and memory resources across groups of virtual machines.

{{event "resourcepool"}}

**ECS Field Reference**

Refer to the [ECS Field Reference](https://www.elastic.co/guide/en/ecs/current/ecs-field-reference.html) for detailed information on ECS fields.

{{fields "resourcepool"}}

### Virtual Machine

This data stream collects virtual machine metrics from VMware vSphere, including performance statistics such as status, uptime, CPU usage, memory usage, and network activity.

{{event "virtualmachine"}}

**ECS Field Reference**

Refer to the [ECS Field Reference](https://www.elastic.co/guide/en/ecs/current/ecs-field-reference.html) for detailed information on ECS fields.

{{fields "virtualmachine"}}

## Troubleshoot

If you encounter issues during the setup or usage of the VMware vSphere integration, in particular with Data Collection Intervals, with agent error messages such as **`Failed to query performance metrics: ServerFaultCode: A specified parameter was not correct: querySpec.interval`**, refer to 
[Supported periods](#supported-periods) for guidance and resolution.