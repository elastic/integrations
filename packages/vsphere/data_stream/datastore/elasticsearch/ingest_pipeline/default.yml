---
description: Pipeline for datastore
processors:
- set:
    field: ecs.version
    value: '8.11.0'
- script: 
    if: ctx.vsphere?.datastore?.triggered_alarms != null
    lang: painless
    source: >
        def alerts = [];
        def warnings = [];
        for (alarm in ctx.vsphere.datastore.triggered_alarms) {
            if (alarm.status == 'red') {
            alerts.add(alarm.name);
            }
            if (alarm.status == 'yellow') {
            warnings.add(alarm.name);
            }
        }
        ctx.alerts = alerts;
        ctx.warnings = warnings
- rename:
    field: alerts
    target_field: vsphere.datastore.alert.names
    ignore_missing: true
- rename:
    field: warnings
    target_field: vsphere.datastore.warning.names
    ignore_missing: true
on_failure:
- set:
    field: error.message
    value: '{{ _ingest.on_failure_message }}'
