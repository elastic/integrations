---
description: Pipeline for cloudbeat findings
processors:
- set:
    field: ecs.version
    value: '8.6.0'
- set:
    field: rule.benchmark.posture_type
    value: 'kspm'
    description: 'Backward compatibility cloudbeat version < 8.7'
    if: ctx.rule?.benchmark?.posture_type == null
- set:
    field: orchestrator.cluster.id
    copy_from: cluster_id
    description: 'Backward compatibility cloudbeat version < 8.8'
    if: ctx.cluster_id != null && ctx.orchestrator?.cluster?.id == null
- set:
    field: cloud.account.id
    value: 'azure'
    description: 'Sets placeholder value for azure account id when it is not available'
    if: (ctx.cloud?.account?.id == null || ctx.cloud?.account?.id == '') && ctx.cloud?.provider == 'azure'
- set:
    field: cloud.account.id
    value: 'gcp'
    description: 'Sets placeholder value for gcp account id when it is not available'
    if: (ctx.cloud?.account?.id == null || ctx.cloud?.account?.id == '' ) && ctx.cloud?.provider == 'gcp'
- remove:
    field: cloud.account.name
    ignore_missing: true
    description: 'Removes cloud.account.name when it is empty'
    if: ctx.cloud?.account?.name == ''
on_failure:
  - set:
      field: event.kind
      value: pipeline_error
  - append:
      field: error.message
      value: '{{{ _ingest.on_failure_message }}}'
