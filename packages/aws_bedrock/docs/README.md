# AWS Bedrock model invocation logs

## Collecting logs from S3 bucket

When collecting logs from S3 bucket is enabled, users can retrieve logs from S3
objects that are pointed to by S3 notification events read from an SQS queue or
directly polling list of S3 objects in an S3 bucket. 

The use of SQS notification is preferred: polling list of S3 objects is 
expensive in terms of performance and costs and should be preferably used only 
when no SQS notification can be attached to the S3 buckets. This input 
integration also supports S3 notification from SNS to SQS.

SQS notification method is enabled setting `queue_url` configuration value. S3 
bucket list polling method is enabled setting `bucket_arn` configuration value
and `number_of_workers` value. Both `queue_url` and `bucket_arn` cannot be set 
at the same time and at least one of the two value must be set.

## Collecting logs from CloudWatch

When collecting logs from CloudWatch is enabled, users can retrieve logs from 
all log streams in a specific log group. `filterLogEvents` AWS API is used to 
list log events from the specified log group.

**Exported fields**

| Field | Description | Type |
|---|---|---|
| @timestamp | Date/time when the event originated. This is the date/time extracted from the event, typically representing when the event was generated by the source. If the event source has no original timestamp, this value is typically populated by the first time the event was received by the pipeline. Required field for all events. | date |
| aws.cloudwatch.message | CloudWatch log message. | text |
| aws.s3.bucket.arn | ARN of the S3 bucket that this log retrieved from. | keyword |
| aws.s3.bucket.name | Name of the S3 bucket that this log retrieved from. | keyword |
| aws.s3.object.key | Name of the S3 object that this log retrieved from. | keyword |
| aws_bedrock.invocation.artifacts |  | keyword |
| aws_bedrock.invocation.error |  | keyword |
| aws_bedrock.invocation.errorCode |  | keyword |
| aws_bedrock.invocation.imageGenerationConfig.cfgScale |  | double |
| aws_bedrock.invocation.imageGenerationConfig.height |  | long |
| aws_bedrock.invocation.imageGenerationConfig.numberOfImages |  | long |
| aws_bedrock.invocation.imageGenerationConfig.quality |  | keyword |
| aws_bedrock.invocation.imageGenerationConfig.seed |  | long |
| aws_bedrock.invocation.imageGenerationConfig.width |  | long |
| aws_bedrock.invocation.imageVariationParams.images |  | keyword |
| aws_bedrock.invocation.imageVariationParams.text |  | keyword |
| aws_bedrock.invocation.images |  | keyword |
| aws_bedrock.invocation.input.inputBodyJson |  | flattened |
| aws_bedrock.invocation.input.inputBodyJson_massive_hash |  | keyword |
| aws_bedrock.invocation.input.inputBodyS3Path |  | keyword |
| aws_bedrock.invocation.input.inputContentType |  | keyword |
| aws_bedrock.invocation.input.inputTokenCount | TODO | long |
| aws_bedrock.invocation.modelId |  | keyword |
| aws_bedrock.invocation.output.outputBodyJson |  | flattened |
| aws_bedrock.invocation.output.outputBodyS3Path |  | keyword |
| aws_bedrock.invocation.output.outputContentType |  | keyword |
| aws_bedrock.invocation.output.outputTokenCount |  | long |
| aws_bedrock.invocation.requestId |  | keyword |
| aws_bedrock.invocation.result |  | keyword |
| aws_bedrock.invocation.schemaType |  | keyword |
| aws_bedrock.invocation.schemaVersion |  | keyword |
| aws_bedrock.invocation.taskType |  | keyword |
| cloud.account.id | The cloud account or organization id used to identify different entities in a multi-tenant environment. Examples: AWS account id, Google Cloud ORG Id, or other unique identifier. | keyword |
| cloud.availability_zone | Availability zone in which this host, resource, or service is located. | keyword |
| cloud.image.id | Image ID for the cloud instance. | keyword |
| cloud.instance.id | Instance ID of the host machine. | keyword |
| cloud.instance.name | Instance name of the host machine. | keyword |
| cloud.machine.type | Machine type of the host machine. | keyword |
| cloud.project.id | The cloud project identifier. Examples: Google Cloud Project id, Azure Project id. | keyword |
| cloud.provider | Name of the cloud provider. Example values are aws, azure, gcp, or digitalocean. | keyword |
| cloud.region | Region in which this host, resource, or service is located. | keyword |
| container.id | Unique container id. | keyword |
| container.image.name | Name of the image the container was built on. | keyword |
| container.labels | Image labels. | object |
| container.name | Container name. | keyword |
| data_stream.dataset | The field can contain anything that makes sense to signify the source of the data. Examples include `nginx.access`, `prometheus`, `endpoint` etc. For data streams that otherwise fit, but that do not have dataset set we use the value "generic" for the dataset value. `event.dataset` should have the same value as `data_stream.dataset`. Beyond the Elasticsearch data stream naming criteria noted above, the `dataset` value has additional restrictions:   \* Must not contain `-`   \* No longer than 100 characters | constant_keyword |
| data_stream.namespace | A user defined namespace. Namespaces are useful to allow grouping of data. Many users already organize their indices this way, and the data stream naming scheme now provides this best practice as a default. Many users will populate this field with `default`. If no value is used, it falls back to `default`. Beyond the Elasticsearch index naming criteria noted above, `namespace` value has the additional restrictions:   \* Must not contain `-`   \* No longer than 100 characters | constant_keyword |
| data_stream.type | An overarching type for the data stream. Currently allowed values are "logs" and "metrics". We expect to also add "traces" and "synthetics" in the near future. | constant_keyword |
| ecs.version | ECS version this event conforms to. `ecs.version` is a required field and must exist in all events. When querying across multiple indices -- which may conform to slightly different ECS versions -- this field lets integrations adjust to the schema version of the events. | keyword |
| event.dataset | Event dataset | constant_keyword |
| event.module | Name of the module this data is coming from. If your monitoring agent supports the concept of modules or plugins to process events of a given source (e.g. Apache logs), `event.module` should contain the name of this module. | constant_keyword |
| event.original | Raw text message of entire event. Used to demonstrate log integrity or where the full log message (before splitting it up in multiple parts) may be required, e.g. for reindex. This field is not indexed and doc_values are disabled. It cannot be searched, but it can be retrieved from `_source`. If users wish to override this and index this field, please see `Field data types` in the `Elasticsearch Reference`. | keyword |
| host.architecture | Operating system architecture. | keyword |
| host.containerized | If the host is a container. | boolean |
| host.domain | Name of the domain of which the host is a member. For example, on Windows this could be the host's Active Directory domain or NetBIOS domain name. For Linux this could be the domain of the host's LDAP provider. | keyword |
| host.hostname | Hostname of the host. It normally contains what the `hostname` command returns on the host machine. | keyword |
| host.id | Unique host id. As hostname is not always unique, use values that are meaningful in your environment. Example: The current usage of `beat.name`. | keyword |
| host.ip | Host ip addresses. | ip |
| host.mac | Host MAC addresses. The notation format from RFC 7042 is suggested: Each octet (that is, 8-bit byte) is represented by two [uppercase] hexadecimal digits giving the value of the octet as an unsigned integer. Successive octets are separated by a hyphen. | keyword |
| host.name | Name of the host. It can contain what hostname returns on Unix systems, the fully qualified domain name (FQDN), or a name specified by the user. The recommended value is the lowercase FQDN of the host. | keyword |
| host.os.build | OS build information. | keyword |
| host.os.codename | OS codename, if any. | keyword |
| host.os.family | OS family (such as redhat, debian, freebsd, windows). | keyword |
| host.os.kernel | Operating system kernel version as a raw string. | keyword |
| host.os.name | Operating system name, without the version. | keyword |
| host.os.name.text | Multi-field of `host.os.name`. | match_only_text |
| host.os.platform | Operating system platform (such centos, ubuntu, windows). | keyword |
| host.os.version | Operating system version as a raw string. | keyword |
| host.type | Type of host. For Cloud providers this can be the machine type like `t2.medium`. If vm, this could be the container, for example, or other information meaningful in your environment. | keyword |
| input.type | Type of Filebeat input. | keyword |
| llm.analysis.action_recommended | Recommended actions based on the analysis. | keyword |
| llm.analysis.findings | Detailed findings from security tools. | nested |
| llm.analysis.function | Name of the security or analysis function used. | keyword |
| llm.analysis.tool_names | Name of the security or analysis tools used. | keyword |
| llm.content.categories | Categories of content identified as sensitive or requiring moderation. | keyword |
| llm.content.inappropriate | Whether the content was flagged as inappropriate or sensitive. | boolean |
| llm.model.description | Description of the LLM model. | keyword |
| llm.model.id | Unique identifier for the LLM model. | keyword |
| llm.model.name | Name of the LLM model used to generate the response. | keyword |
| llm.model.parameters | Parameters used to confirm the LLM model. | keyword |
| llm.model.role | Role of the LLM model in the interaction. | keyword |
| llm.model.type | Type of LLM model. | keyword |
| llm.model.version | Version of the LLM model used to generate the response. | keyword |
| llm.owasp.description | Description of the OWASP risk triggered. | text |
| llm.owasp.id | Identifier for the OWASP risk addressed. | keyword |
| llm.performance.request_size | Size of the request payload in bytes. | long |
| llm.performance.response_size | Size of the response payload in bytes. | long |
| llm.performance.response_time | Time taken by the LLM to generate a response in milliseconds. | long |
| llm.request.content | The full text of the user's request to the LLM. | text |
| llm.request.filter.triggerer | Filters triggered during the processing of the request. | keyword |
| llm.request.id | Unique identifier for the LLM request. | keyword |
| llm.request.timestamp | Timestamp when the request was made. | date |
| llm.request.token_count | Number of tokens in the user's request. | integer |
| llm.response.compliance.violation | Compliance violation code identified in the interaction. | keyword |
| llm.response.content | The full text of the LLM's response. | text |
| llm.response.filter.triggerer | Filters triggered during the processing of the response. | keyword |
| llm.response.id | Unique identifier for the LLM response. | keyword |
| llm.response.timestamp | Timestamp when the response was received. | date |
| llm.response.token_count | Number of tokens in the LLM's response. | integer |
| llm.security.hallucination_consistency | Consistency check between multiple responses. | float |
| llm.security.jailbreak_score | Measures similarity to known jailbreak attempts. | float |
| llm.security.prompt_injection_score | Measures similarity to known prompt injection attacks. | float |
| llm.security.refusal_score | Measures similarity to known LLM refusal responses. | float |
| llm.security.regex_pattern_count | Counts occurrences of strings matching user-defined regex patterns. | integer |
| llm.security.risk_score | Numerical score indicating the potential risk associated with the response. | float |
| llm.security.threat_action | Recommended action to mitigate the detected security threat. | keyword |
| llm.security.threat_category | Category of the detected security threat. | keyword |
| llm.security.threat_description | Description of the detected security threat. | text |
| llm.security.threat_detected | Whether a security threat was detected. | boolean |
| llm.security.threat_signature | Signature of the detected security threat. | keyword |
| llm.security.threat_source | Source of the detected security threat. | keyword |
| llm.security.threat_type | Type of threat detected in the LLM interaction. | keyword |
| llm.security.yara.matches | Stores results from YARA scans including rule matches and categories. | nested |
| llm.sentiment.score | Sentiment analysis score. | float |
| llm.sentiment.toxicity_score | Toxicity analysis score. | float |
| llm.text.complexity_score | Evaluates the complexity of the text. | float |
| llm.text.readability_score | Measures the readability level of the text. | float |
| llm.text.similarity_score | Measures the similarity between the prompt and response. | float |
| log.file.path | Full path to the log file this event came from, including the file name. It should include the drive letter, when appropriate. If the event wasn't read from a log file, do not populate this field. | keyword |
| log.offset | Log offset | long |
| message | For log events the message field contains the log message, optimized for viewing in a log viewer. For structured logs without an original message field, other fields can be concatenated to form a human-readable summary of the event. If multiple messages exist, they can be combined into one message. | match_only_text |
| tags | List of keywords used to tag each event. | keyword |
| user.id | Unique identifier of the user. | keyword |

