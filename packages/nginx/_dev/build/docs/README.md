# Nginx Integration

This integration periodically fetches metrics from [Nginx](https://nginx.org/) servers. It can parse access and error
logs created by the HTTP server. 

## Compatibility

The Nginx `stubstatus` metrics was tested with Nginx 1.19.5 and are expected to work with all version >= 1.9.
The logs were tested with version 1.19.5.
On Windows, the module was tested with Nginx installed from the Chocolatey repository.

## Logs

**Timezone support**

This datasource parses logs that don’t contain timezone information. For these logs, the Elastic Agent reads the local
timezone and uses it when parsing to convert the timestamp to UTC. The timezone to be used for parsing is included
in the event in the `event.timezone` field.

To disable this conversion, the event.timezone field can be removed with the drop_fields processor.

If logs are originated from systems or applications with a different timezone to the local one, the `event.timezone`
field can be overwritten with the original timezone using the add_fields processor.

### Access Logs

Access logs collects the nginx access logs.

{{event "access"}}

{{fields "access"}}

### Error Logs

Error logs collects the nginx error logs.

{{event "error"}}

{{fields "error"}}

## Metrics

### Stub Status Metrics

The Nginx `stubstatus` stream collects data from the Nginx `ngx_http_stub_status` module. It scrapes the server status
data from the web page generated by `ngx_http_stub_status`. Please verify that your Nginx distribution comes with the mentioned
module and it's enabled in the Nginx configuration file:

```
location /nginx_status {
    stub_status;
    allow 127.0.0.1; # only allow requests from localhost
    deny all;        # deny all other hosts
}
```

It's highly recommended to replace `127.0.0.1` with your server’s IP address and make sure that this page accessible to only you.

{{event "stubstatus"}}

{{fields "stubstatus"}}

## ML Modules

These anomaly detection jobs are available in the Machine Learning app in Kibana
when you have data that matches the query specified in the
[manifest](https://github.com/elastic/integrations/blob/main/packages/nginx/kibana/ml_module/nginx-Logs-ml.json).

### Nginx access logs

Find unusual activity in HTTP access logs.

| Job | Description |
|---|---|
| visitor_rate_nginx | HTTP Access Logs: Detect unusual visitor rates |
| status_code_rate_nginx | HTTP Access Logs: Detect unusual status code rates |
| source_ip_url_count_nginx | HTTP Access Logs: Detect unusual source IPs - high distinct count of URLs |
| source_ip_request_rate_nginx | HTTP Access Logs: Detect unusual source IPs - high request rates |
| low_request_rate_nginx | HTTP Access Logs: Detect low request rates |

